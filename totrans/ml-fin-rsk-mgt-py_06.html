<html><head></head><body><section data-pdf-bookmark="Chapter 4. Machine Learning-Based &#10;Volatility Prediction" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_4">&#13;
<h1><span class="label">Chapter 4. </span>Machine Learning-Based &#13;
<span class="keep-together">Volatility Prediction</span></h1>&#13;
&#13;
<blockquote data-type="epigram">&#13;
<p> The most critical feature of the conditional return distribution is arguably its second moment structure, which is empirically the dominant time-varying characteristic of the distribution. This fact has spurred an enormous literature on the modeling and forecasting of return volatility.</p>&#13;
<p data-type="attribution">Andersen et al. (2003)</p>&#13;
</blockquote>&#13;
&#13;
<p>“Some concepts are easy to understand but hard to define. This also holds true for volatility.” <a data-primary="volatility prediction" data-type="indexterm" id="ix_volatil_predict_ch4"/>This could be a quote from someone living before Markowitz because the way he models volatility is very clear and intuitive. Markowitz proposed his celebrated portfolio theory in which he defined <em>volatility</em>  as <a data-primary="standard deviation" data-type="indexterm" id="idm45737244535760"/>standard deviation so that from then onward, finance became more intertwined with mathematics.</p>&#13;
&#13;
<p>Volatility is the backbone of finance in the sense that it not only provides an information signal to investors, but it also is an input to various financial models. What makes volatility so important? The answer stresses the importance of uncertainty, which is the main characteristic of the financial model.</p>&#13;
&#13;
<p>Increased integration of financial markets has led to  prolonged uncertainty in those markets, which in turn stresses the importance of volatility, the degree at which values of financial assets changes. Volatility used as a proxy of risk is among the most important variables in many fields, including asset pricing and risk management. Its strong presence and latency make it&#13;
even compulsory to model. Volatility as a risk measure has taken on a key role in risk management following the <a data-primary="Basel Accords" data-type="indexterm" id="idm45737244533312"/>Basel Accord that came into effect in 1996 (Karasan and Gaygisiz 2020).</p>&#13;
&#13;
<p class="pagebreak-before less_space">A large and growing body of literature regarding the estimation of volatility has emerged after the ground-breaking studies of Black (1976), including Andersen and Bollerslev (1997), Raju and Ghosh (2004), Dokuchaev (2014), and De Stefani et al. (2017). <a data-primary="GARCH model" data-type="indexterm" id="idm45737244531680"/><a data-primary="ARCH model" data-type="indexterm" id="idm45737244531072"/>We are talking about a long tradition of volatility prediction using ARCH- and GARCH-type models in which there are certain drawbacks that might cause failures, such as volatility clustering, information asymmetry, and so on. Even though these issues are addressed by different models, recent fluctuations in financial &#13;
<span class="keep-together">markets</span> coupled with developments in ML have made researchers rethink volatility &#13;
<span class="keep-together">estimation</span>.</p>&#13;
&#13;
<p>In this chapter, our aim is to show how we can enhance the predictive performance using an ML-based model. We will visit various ML algorithms, namely support vector regression, neural network, and deep learning, so that we are able to compare the predictive performance.</p>&#13;
&#13;
<p>Modeling volatility amounts to modeling uncertainty so that we better understand and approach uncertainty, enabling us to have good enough approximations of the real world. To gauge the extent to which proposed models account for the real-world situation, <a data-primary="return (realized) volatility" data-type="indexterm" id="ix_ret_real_volatil"/><a data-primary="realized (return) volatility" data-type="indexterm" id="ix_real_ret_volatil"/>we need to calculate the return volatility, which is also known as <em>realized volatility</em>. Realized volatility is the square root of realized variance, which is the sum of squared return. Realized volatility is used to calculate the performance of the volatility prediction method. Here is the formula for return volatility:</p>&#13;
<div data-type="equation">&#13;
<math alttext="ModifyingAbove sigma With caret equals StartRoot StartFraction 1 Over n minus 1 EndFraction sigma-summation Underscript n equals 1 Overscript upper N Endscripts left-parenthesis r Subscript n Baseline minus mu right-parenthesis squared EndRoot" display="block">&#13;
  <mrow>&#13;
    <mover accent="true"><mi>σ</mi> <mo>^</mo></mover>&#13;
    <mo>=</mo>&#13;
    <msqrt>&#13;
      <mrow>&#13;
        <mfrac><mn>1</mn> <mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow></mfrac>&#13;
        <msubsup><mo>∑</mo> <mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow> <mi>N</mi> </msubsup>&#13;
        <msup><mrow><mo>(</mo><msub><mi>r</mi> <mi>n</mi> </msub><mo>-</mo><mi>μ</mi><mo>)</mo></mrow> <mn>2</mn> </msup>&#13;
      </mrow>&#13;
    </msqrt>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>r</em> and <math alttext="mu">&#13;
  <mi>μ</mi>&#13;
</math> are return and mean of return, and <em>n</em> is number of observations.</p>&#13;
&#13;
<p>Let’s see how return volatility is computed in Python:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">scipy.stats</code><code> </code><code class="kn">import</code><code> </code><code class="n">norm</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">scipy.optimize</code><code> </code><code class="kn">as</code><code> </code><code class="nn">opt</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">yfinance</code><code> </code><code class="kn">as</code><code> </code><code class="nn">yf</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">datetime</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">time</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">arch</code><code> </code><code class="kn">import</code><code> </code><code class="n">arch_model</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">matplotlib.pyplot</code><code> </code><code class="kn">as</code><code> </code><code class="nn">plt</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">numba</code><code> </code><code class="kn">import</code><code> </code><code class="n">jit</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">sklearn.metrics</code><code> </code><code class="kn">import</code><code> </code><code class="n">mean_squared_error</code><code> </code><code class="k">as</code><code> </code><code class="n">mse</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">warnings</code><code>&#13;
</code><code>        </code><code class="n">warnings</code><code class="o">.</code><code class="n">filterwarnings</code><code class="p">(</code><code class="s1">'</code><code class="s1">ignore</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">stocks</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">^GSPC</code><code class="s1">'</code><code>&#13;
</code><code>        </code><code class="n">start</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2021</code><code class="p">,</code><code> </code><code class="mi">8</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">s_p500</code><code> </code><code class="o">=</code><code> </code><code class="n">yf</code><code class="o">.</code><code class="n">download</code><code class="p">(</code><code class="n">stocks</code><code class="p">,</code><code> </code><code class="n">start</code><code class="o">=</code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="n">end</code><code class="p">,</code><code> </code><code class="n">interval</code><code class="o">=</code><code class="s1">'</code><code class="s1">1d</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="p">[</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="mi">100</code><code class="o">%</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="p">]</code><code>  </code><code class="mi">1</code><code> </code><code class="n">of</code><code> </code><code class="mi">1</code><code> </code><code class="n">completed</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ret</code><code> </code><code class="o">=</code><code> </code><code class="mi">100</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="n">s_p500</code><code class="o">.</code><code class="n">pct_change</code><code class="p">(</code><code class="p">)</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">Adj Close</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO1-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">realized_vol</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="mi">5</code><code class="p">)</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code class="n">realized_vol</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Realized Volatility- S&amp;P-500</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Volatility</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO1-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Calculating the returns of the S&amp;P 500 based on adjusted closing prices.</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#rel_vol">Figure 4-1</a> shows the realized volatility of S&amp;P 500 over the period of 2010–2021. The most striking observation is the spikes around the COVID-19 pandemic.<a data-primary="" data-startref="ix_real_ret_volatil" data-type="indexterm" id="idm45737262625712"/><a data-primary="" data-startref="ix_ret_real_volatil" data-type="indexterm" id="idm45737244218272"/></p>&#13;
&#13;
<figure><div class="figure" id="rel_vol">&#13;
<img alt="rel_vol" src="assets/mlfr_0401.png"/>&#13;
<h6><span class="label">Figure 4-1. </span>Realized volatility—S&amp;P 500</h6>&#13;
</div></figure>&#13;
&#13;
<p>The way volatility is estimated has an undeniable impact on the reliability and accuracy of the related analysis. So this chapter deals with both classical and ML-based volatility prediction techniques with a view to showing the superior prediction performance of the ML-based models. To compare the brand-new ML-based models, we start with modeling the classical volatility models. Some very well known classical volatility models include, but are not limited to, the following:</p>&#13;
&#13;
<ul class="pagebreak-before less_space">&#13;
<li>&#13;
<p>ARCH</p>&#13;
</li>&#13;
<li>&#13;
<p>GARCH</p>&#13;
</li>&#13;
<li>&#13;
<p>GJR-GARCH</p>&#13;
</li>&#13;
<li>&#13;
<p>EGARCH</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>It’s time to dig into the classical volatility models. Let’s start off with the ARCH model.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="ARCH Model" data-type="sect1"><div class="sect1" id="idm45737244209552">&#13;
<h1>ARCH Model</h1>&#13;
&#13;
<p><a data-primary="volatility prediction" data-secondary="ARCH model" data-type="indexterm" id="ix_volatil_predict_arch"/><a data-primary="ARCH model" data-type="indexterm" id="ix_arch_model_ch4"/>One of the early attempts to model volatility was proposed by Eagle (1982) and is known as the ARCH model. The ARCH model is a univariate model and based on  historical asset returns. The ARCH(p) model has the following form:</p>&#13;
<div data-type="equation">&#13;
<math alttext="sigma Subscript t Superscript 2 Baseline equals omega plus sigma-summation Underscript k equals 1 Overscript p Endscripts alpha Subscript k Baseline left-parenthesis r Subscript t minus k Baseline right-parenthesis squared" display="block">&#13;
  <mrow>&#13;
    <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>p</mi> </munderover>&#13;
    <msub><mi>α</mi> <mi>k</mi> </msub>&#13;
    <msup><mrow><mo>(</mo><msub><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> </msub><mo>)</mo></mrow> <mn>2</mn> </msup>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where the mean model is:</p>&#13;
<div data-type="equation">&#13;
<math alttext="r Subscript t Baseline equals sigma Subscript t Baseline epsilon Subscript t" display="block">&#13;
  <mrow>&#13;
    <msub><mi>r</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>σ</mi> <mi>t</mi> </msub>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <math alttext="epsilon Subscript t">&#13;
  <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
</math> is assumed to be normally distributed. In this parametric model, we need to satisfy some assumptions to have strictly positive variance. In this respect, the following conditions should hold:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><math alttext="omega greater-than 0">&#13;
  <mrow>&#13;
    <mi>ω</mi>&#13;
    <mo>&gt;</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math></p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="alpha Subscript k Baseline greater-than-or-equal-to 0">&#13;
  <mrow>&#13;
    <msub><mi>α</mi> <mi>k</mi> </msub>&#13;
    <mo>≥</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>All of these equations tell us that ARCH is a univariate and nonlinear model in which volatility is estimated with the square of past returns. One of the most distinctive features of ARCH is that it has the property of <a data-primary="time-varying conditional variance" data-type="indexterm" id="idm45737244124112"/>time-varying conditional variance<sup><a data-type="noteref" href="ch04.html#idm45737244123312" id="idm45737244123312-marker">1</a></sup> so that ARCH is able to model the <a data-primary="volatility clustering" data-type="indexterm" id="ix_volatil_cluster"/><a data-primary="clustering method" data-secondary="volatility prediction" data-type="indexterm" id="ix_cluster_volatil"/>phenomenon known as <em>volatility clustering</em>—that is, large changes tend to be followed by large changes of either sign, and small changes tend to be followed by small changes, as described by Mandelbrot (1963). Hence, once an important announcement is made to the market, it might result in huge &#13;
<span class="keep-together">volatility</span>.</p>&#13;
&#13;
<p>The following code block shows how to plot clustering and what it looks like:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">retv</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">values</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO2-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">s_p500</code><code class="o">.</code><code class="n">index</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">ret</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Volatility clustering of S&amp;P-500</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Daily returns</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO2-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Return dataframe into a <code>numpy</code> representation</p></dd>&#13;
</dl>&#13;
&#13;
<p>Similar to spikes in realized volatility, <a data-type="xref" href="#vol_clustering">Figure 4-2</a> suggests some large movements, and, unsurprisingly, these ups and downs happen around important events such as the COVID-19 pandemic in mid-2020.<a data-primary="" data-startref="ix_cluster_volatil" data-type="indexterm" id="idm45737244179936"/><a data-primary="" data-startref="ix_volatil_cluster" data-type="indexterm" id="idm45737244178992"/></p>&#13;
&#13;
<figure><div class="figure" id="vol_clustering">&#13;
<img alt="clustering" src="assets/mlfr_0402.png"/>&#13;
<h6><span class="label">Figure 4-2. </span>Volatility clustering—S&amp;P 500</h6>&#13;
</div></figure>&#13;
&#13;
<p>Despite its appealing features, such as simplicity, nonlinearity, easiness, and adjustment for forecast, the ARCH model has certain drawbacks:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Equal response to positive and negative shocks</p>&#13;
</li>&#13;
<li>&#13;
<p>Strong assumptions such as restrictions on parameters</p>&#13;
</li>&#13;
<li>&#13;
<p>Possible misprediction due to slow adjustments to large movements</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These drawbacks motivated researchers to work on extensions of the ARCH model,  notably the GARCH model proposed by Bollerslev (1986) and Taylor (1986), which we will discuss shortly.</p>&#13;
&#13;
<p>Now let’s employ the ARCH model to predict volatility. First, let’s generate  our own Python code, and then compare it with a built-in function from the <code>arch</code> library to see the differences:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">n</code><code> </code><code class="o">=</code><code> </code><code class="mi">252</code><code>&#13;
</code><code>        </code><code class="n">split_date</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sgm2</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">K</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">kurtosis</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">alpha</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="o">-</code><code class="mf">3.0</code><code> </code><code class="o">*</code><code> </code><code class="n">sgm2</code><code> </code><code class="o">+</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="mf">9.0</code><code> </code><code class="o">*</code><code> </code><code class="n">sgm2</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code> </code><code class="o">-</code><code> </code><code class="mf">12.0</code><code> </code><code class="o">*</code><code>&#13;
</code><code>                                     </code><code class="p">(</code><code class="mf">3.0</code><code> </code><code class="o">*</code><code> </code><code class="n">sgm2</code><code> </code><code class="o">-</code><code> </code><code class="n">K</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="n">K</code><code class="p">)</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="p">(</code><code class="mi">6</code><code> </code><code class="o">*</code><code> </code><code class="n">K</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-4" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">omega</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="mi">1</code><code> </code><code class="o">-</code><code> </code><code class="n">alpha</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="n">sgm2</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-5" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="n">initial_parameters</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">alpha</code><code class="p">,</code><code> </code><code class="n">omega</code><code class="p">]</code><code>&#13;
</code><code>        </code><code class="n">omega</code><code class="p">,</code><code> </code><code class="n">alpha</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="mf">0.6345749196895419</code><code class="p">,</code><code> </code><code class="mf">0.46656704131150534</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="nd">@jit</code><code class="p">(</code><code class="n">nopython</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code> </code><code class="n">parallel</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-6" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="k">def</code><code> </code><code class="nf">arch_likelihood</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code><code> </code><code class="n">retv</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>            </code><code class="n">omega</code><code> </code><code class="o">=</code><code> </code><code class="nb">abs</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-7" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>            </code><code class="n">alpha</code><code> </code><code class="o">=</code><code> </code><code class="nb">abs</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-7" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-8"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>            </code><code class="n">T</code><code> </code><code class="o">=</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">retv</code><code class="p">)</code><code>&#13;
</code><code>            </code><code class="n">logliks</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>&#13;
</code><code>            </code><code class="n">sigma2</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">zeros</code><code class="p">(</code><code class="n">T</code><code class="p">)</code><code>&#13;
</code><code>            </code><code class="n">sigma2</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="n">retv</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-8" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-9"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>            </code><code class="k">for</code><code> </code><code class="n">t</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">T</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>                </code><code class="n">sigma2</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">omega</code><code> </code><code class="o">+</code><code> </code><code class="n">alpha</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="n">retv</code><code class="p">[</code><code class="n">t</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-9" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-10"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>            </code><code class="n">logliks</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="mf">0.5</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">sigma2</code><code class="p">)</code><code class="o">+</code><code class="n">retv</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code> </code><code class="o">/</code><code> </code><code class="n">sigma2</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-10" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-11"><img alt="10" src="assets/10.png"/></a><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="n">logliks</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">logliks</code><code> </code><code class="o">=</code><code> </code><code class="n">arch_likelihood</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code><code> </code><code class="n">retv</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">logliks</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">1453.127184488521</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">opt_params</code><code class="p">(</code><code class="n">x0</code><code class="p">,</code><code> </code><code class="n">retv</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">opt_result</code><code> </code><code class="o">=</code><code> </code><code class="n">opt</code><code class="o">.</code><code class="n">minimize</code><code class="p">(</code><code class="n">arch_likelihood</code><code class="p">,</code><code> </code><code class="n">x0</code><code class="o">=</code><code class="n">x0</code><code class="p">,</code><code> </code><code class="n">args</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">retv</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                                       </code><code class="n">method</code><code class="o">=</code><code class="s1">'</code><code class="s1">Nelder-Mead</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>                                       </code><code class="n">options</code><code class="o">=</code><code class="p">{</code><code class="s1">'</code><code class="s1">maxiter</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mi">5000</code><code class="p">}</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-11" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-12"><img alt="11" src="assets/11.png"/></a><code>&#13;
</code><code>             </code><code class="n">params</code><code> </code><code class="o">=</code><code> </code><code class="n">opt_result</code><code class="o">.</code><code class="n">x</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-12" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-13"><img alt="12" src="assets/12.png"/></a><code>&#13;
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">Results of Nelder-Mead minimization</code><code class="se">\n</code><code class="s1">{}</code><code class="se">\n</code><code class="s1">{}</code><code class="s1">'</code><code>&#13;
</code><code>                   </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="s1">'</code><code class="s1">'</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">-</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">*</code><code> </code><code class="mi">28</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">opt_result</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">Resulting params = {}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">params</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="k">return</code><code> </code><code class="n">params</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">params</code><code> </code><code class="o">=</code><code> </code><code class="n">opt_params</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code><code> </code><code class="n">retv</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Results</code><code> </code><code class="n">of</code><code> </code><code class="n">Nelder</code><code class="o">-</code><code class="n">Mead</code><code> </code><code class="n">minimization</code><code>&#13;
</code><code>         </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>&#13;
</code><code>          </code><code class="n">final_simplex</code><code class="p">:</code><code> </code><code class="p">(</code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="mf">0.70168795</code><code class="p">,</code><code> </code><code class="mf">0.39039044</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                </code><code class="p">[</code><code class="mf">0.70163494</code><code class="p">,</code><code> </code><code class="mf">0.3904423</code><code> </code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>         </code><code class="p">[</code><code class="mf">0.70163928</code><code class="p">,</code><code> </code><code class="mf">0.39033154</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="mf">1385.79241695</code><code class="p">,</code><code>&#13;
</code><code>                </code><code class="mf">1385.792417</code><code class="p">,</code><code> </code><code class="mf">1385.79241907</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>                    </code><code class="n">fun</code><code class="p">:</code><code> </code><code class="mf">1385.7924169507244</code><code>&#13;
</code><code>                </code><code class="n">message</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">Optimization terminated successfully.</code><code class="s1">'</code><code>&#13;
</code><code>                   </code><code class="n">nfev</code><code class="p">:</code><code> </code><code class="mi">62</code><code>&#13;
</code><code>                    </code><code class="n">nit</code><code class="p">:</code><code> </code><code class="mi">33</code><code>&#13;
</code><code>                 </code><code class="n">status</code><code class="p">:</code><code> </code><code class="mi">0</code><code>&#13;
</code><code>                </code><code class="n">success</code><code class="p">:</code><code> </code><code class="bp">True</code><code>&#13;
</code><code>                      </code><code class="n">x</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="mf">0.70168795</code><code class="p">,</code><code> </code><code class="mf">0.39039044</code><code class="p">]</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Resulting</code><code> </code><code class="n">params</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="mf">0.70168795</code><code> </code><code class="mf">0.39039044</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">arch_apply</code><code class="p">(</code><code class="n">ret</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>                 </code><code class="n">omega</code><code> </code><code class="o">=</code><code> </code><code class="n">params</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>&#13;
</code><code>                 </code><code class="n">alpha</code><code> </code><code class="o">=</code><code> </code><code class="n">params</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>&#13;
</code><code>                 </code><code class="n">T</code><code> </code><code class="o">=</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">ret</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="n">sigma2_arch</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">zeros</code><code class="p">(</code><code class="n">T</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="n">sigma2_arch</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="n">ret</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="k">for</code><code> </code><code class="n">t</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">T</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>                     </code><code class="n">sigma2_arch</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">omega</code><code> </code><code class="o">+</code><code> </code><code class="n">alpha</code><code> </code><code class="o">*</code><code> </code><code class="n">ret</code><code class="p">[</code><code class="n">t</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code>&#13;
</code><code>                 </code><code class="k">return</code><code> </code><code class="n">sigma2_arch</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sigma2_arch</code><code> </code><code class="o">=</code><code> </code><code class="n">arch_apply</code><code class="p">(</code><code class="n">ret</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Defining the split location and assigning the split data to <code>split</code> variable</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Calculating variance of the S&amp;P 500</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-3" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Calculating kurtosis of the S&amp;P 500</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-4" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Identifying the initial value for slope coefficient <math alttext="alpha">&#13;
  <mi>α</mi>&#13;
</math></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-5" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Identifying the initial value for constant term <math alttext="omega">&#13;
  <mi>ω</mi>&#13;
</math></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-6" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Using parallel processing to decrease the processing time</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-7" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Taking absolute values and assigning the initial values into related variables</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-9" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Identifying the initial values of volatility</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-10" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Iterating the variance of S&amp;P 500</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-11" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-10"><img alt="10" src="assets/10.png"/></a></dt>&#13;
<dd><p>Calculating the log-likelihood</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-12" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-11"><img alt="11" src="assets/11.png"/></a></dt>&#13;
<dd><p>Minimizing the log-likelihood function</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-13" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO3-12"><img alt="12" src="assets/12.png"/></a></dt>&#13;
<dd><p>Creating a variable <code>params</code> for optimized parameters</p></dd>&#13;
</dl>&#13;
&#13;
<p>Well, we modeled volatility via ARCH using our own optimization method and ARCH equation. But how about comparing it with the built-in Python code? This built-in code can be imported from <code>arch</code> library and is extremely easy to apply. The result of the built-in function follows; it turns out that these two results are very similar to each other:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">arch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">vol</code><code class="o">=</code><code class="s1">'ARCH'</code><code class="p">,</code> <code class="n">p</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">arch</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>&#13;
&#13;
                 <code class="n">Zero</code> <code class="n">Mean</code> <code class="o">-</code> <code class="n">ARCH</code> <code class="n">Model</code> <code class="n">Results</code>                        \&#13;
<code class="o">=============================================================================</code>&#13;
<code class="n">Dep</code><code class="o">.</code> <code class="n">Variable</code><code class="p">:</code>            <code class="n">Adj</code> <code class="n">Close</code>   <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                       <code class="mf">0.000</code>&#13;
<code class="n">Mean</code> <code class="n">Model</code><code class="p">:</code>               <code class="n">Zero</code> <code class="n">Mean</code>   <code class="n">Adj</code><code class="o">.</code> <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                  <code class="mf">0.000</code>&#13;
<code class="n">Vol</code> <code class="n">Model</code><code class="p">:</code>                     <code class="n">ARCH</code>   <code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code>               <code class="o">-</code><code class="mf">4063.63</code>&#13;
<code class="n">Distribution</code><code class="p">:</code>                <code class="n">Normal</code>   <code class="n">AIC</code><code class="p">:</code>                           <code class="mf">8131.25</code>&#13;
<code class="n">Method</code><code class="p">:</code>          <code class="n">Maximum</code> <code class="n">Likelihood</code>   <code class="n">BIC</code><code class="p">:</code>                           <code class="mf">8143.21</code>&#13;
<code class="n">No</code><code class="o">.</code> <code class="n">Observations</code><code class="p">:</code>              <code class="mi">2914</code>&#13;
&#13;
<code class="n">Date</code><code class="p">:</code>                <code class="n">Mon</code><code class="p">,</code> <code class="n">Sep</code> <code class="mi">13</code> <code class="mi">2021</code>   <code class="n">Df</code> <code class="n">Residuals</code><code class="p">:</code>                   <code class="mi">2914</code>&#13;
<code class="n">Time</code><code class="p">:</code>                        <code class="mi">21</code><code class="p">:</code><code class="mi">56</code><code class="p">:</code><code class="mi">56</code>   <code class="n">Df</code> <code class="n">Model</code><code class="p">:</code>                        <code class="mi">0</code>&#13;
&#13;
                        <code class="n">Volatility</code> <code class="n">Model</code>&#13;
<code class="o">========================================================================</code>&#13;
                <code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>  <code class="mf">95.0</code><code class="o">%</code> <code class="n">Conf</code><code class="o">.</code> <code class="n">Int</code><code class="o">.</code>&#13;
<code class="o">------------------------------------------------------------------------</code>&#13;
<code class="n">omega</code>          <code class="mf">0.7018</code>  <code class="mf">5.006e-02</code>     <code class="mf">14.018</code>  <code class="mf">1.214e-44</code> <code class="p">[</code>  <code class="mf">0.604</code><code class="p">,</code>  <code class="mf">0.800</code><code class="p">]</code>&#13;
<code class="n">alpha</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>       <code class="mf">0.3910</code>  <code class="mf">7.016e-02</code>      <code class="mf">5.573</code>  <code class="mf">2.506e-08</code> <code class="p">[</code>  <code class="mf">0.253</code><code class="p">,</code>  <code class="mf">0.529</code><code class="p">]</code>&#13;
<code class="o">========================================================================</code>&#13;
&#13;
<code class="n">Covariance</code> <code class="n">estimator</code><code class="p">:</code> <code class="n">robust</code></pre>&#13;
&#13;
<p>Although developing our own code is always helpful and improves our understanding, it does not necessarily mean that there’s no need to use built-in functions or libraries. Rather, these functions makes our lives easier in terms of efficiency and ease of use.</p>&#13;
&#13;
<p>All we need is to create a for loop and define a proper information criteria. <a data-primary="BIC (Bayesian Information Criteria)" data-type="indexterm" id="idm45737244312544"/>Here, we’ll choose Bayesian Information Criteria (BIC) as the model selection method and to select lag. The reason BIC is used is that as long as we have large enough samples, BIC is a reliable tool for model selection as per Burnham and Anderson (2002 and 2004). Now, we iterate ARCH model from 1 to 5 lags:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">bic_arch</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">p</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>                 </code><code class="n">arch</code><code> </code><code class="o">=</code><code> </code><code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code><code> </code><code class="n">mean</code><code class="o">=</code><code class="s1">'</code><code class="s1">zero</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">vol</code><code class="o">=</code><code class="s1">'</code><code class="s1">ARCH</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">p</code><code class="o">=</code><code class="n">p</code><code class="p">)</code><code>\&#13;
</code><code>                         </code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'</code><code class="s1">off</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                 </code><code class="n">bic_arch</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">arch</code><code class="o">.</code><code class="n">bic</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="k">if</code><code> </code><code class="n">arch</code><code class="o">.</code><code class="n">bic</code><code> </code><code class="o">==</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="n">bic_arch</code><code class="p">)</code><code class="p">:</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>                     </code><code class="n">best_param</code><code> </code><code class="o">=</code><code> </code><code class="n">p</code><code>&#13;
</code><code>         </code><code class="n">arch</code><code> </code><code class="o">=</code><code> </code><code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code><code> </code><code class="n">mean</code><code class="o">=</code><code class="s1">'</code><code class="s1">zero</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">vol</code><code class="o">=</code><code class="s1">'</code><code class="s1">ARCH</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">p</code><code class="o">=</code><code class="n">best_param</code><code class="p">)</code><code>\&#13;
</code><code>                 </code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'</code><code class="s1">off</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-4" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="n">arch</code><code class="o">.</code><code class="n">summary</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">forecast</code><code> </code><code class="o">=</code><code> </code><code class="n">arch</code><code class="o">.</code><code class="n">forecast</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="n">split_date</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-5" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>         </code><code class="n">forecast_arch</code><code> </code><code class="o">=</code><code> </code><code class="n">forecast</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Zero</code><code> </code><code class="n">Mean</code><code> </code><code class="o">-</code><code> </code><code class="n">ARCH</code><code> </code><code class="n">Model</code><code> </code><code class="n">Results</code><code>&#13;
</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code class="n">Dep</code><code class="o">.</code><code> </code><code class="n">Variable</code><code class="p">:</code><code>              </code><code class="n">Adj</code><code> </code><code class="n">Close</code><code>   </code><code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code><code>                       </code><code class="mf">0.000</code><code>&#13;
</code><code class="n">Mean</code><code> </code><code class="n">Model</code><code class="p">:</code><code>                 </code><code class="n">Zero</code><code> </code><code class="n">Mean</code><code>   </code><code class="n">Adj</code><code class="o">.</code><code> </code><code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code><code>                  </code><code class="mf">0.000</code><code>&#13;
</code><code class="n">Vol</code><code> </code><code class="n">Model</code><code class="p">:</code><code>                       </code><code class="n">ARCH</code><code>   </code><code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code><code>               </code><code class="o">-</code><code class="mf">3712.38</code><code>&#13;
</code><code class="n">Distribution</code><code class="p">:</code><code>                  </code><code class="n">Normal</code><code>   </code><code class="n">AIC</code><code class="p">:</code><code>                           </code><code class="mf">7434.75</code><code>&#13;
</code><code class="n">Method</code><code class="p">:</code><code>            </code><code class="n">Maximum</code><code> </code><code class="n">Likelihood</code><code>   </code><code class="n">BIC</code><code class="p">:</code><code>                           </code><code class="mf">7464.64</code><code>&#13;
</code><code class="n">No</code><code class="o">.</code><code> </code><code class="n">Observations</code><code class="p">:</code><code>                </code><code class="mi">2914</code><code>&#13;
</code><code>&#13;
</code><code class="n">Date</code><code class="p">:</code><code>                </code><code class="n">Mon</code><code class="p">,</code><code> </code><code class="n">Sep</code><code> </code><code class="mi">13</code><code> </code><code class="mi">2021</code><code>   </code><code class="n">Df</code><code> </code><code class="n">Residuals</code><code class="p">:</code><code>                     </code><code class="mi">2914</code><code>&#13;
</code><code class="n">Time</code><code class="p">:</code><code>                        </code><code class="mi">21</code><code class="p">:</code><code class="mi">56</code><code class="p">:</code><code class="mi">58</code><code>   </code><code class="n">Df</code><code> </code><code class="n">Model</code><code class="p">:</code><code>                          </code><code class="mi">0</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Volatility</code><code> </code><code class="n">Model</code><code>&#13;
</code><code>&#13;
</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>&#13;
</code><code>                 </code><code class="n">coef</code><code>    </code><code class="n">std</code><code> </code><code class="n">err</code><code>          </code><code class="n">t</code><code>      </code><code class="n">P</code><code class="o">&gt;</code><code class="o">|</code><code class="n">t</code><code class="o">|</code><code>    </code><code class="mf">95.0</code><code class="o">%</code><code> </code><code class="n">Conf</code><code class="o">.</code><code> </code><code class="n">Int</code><code class="o">.</code><code>&#13;
</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>&#13;
</code><code class="n">omega</code><code>          </code><code class="mf">0.2798</code><code>  </code><code class="mf">2.584e-02</code><code>     </code><code class="mf">10.826</code><code>  </code><code class="mf">2.580e-27</code><code>   </code><code class="p">[</code><code>  </code><code class="mf">0.229</code><code class="p">,</code><code>  </code><code class="mf">0.330</code><code class="p">]</code><code>&#13;
</code><code class="n">alpha</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>       </code><code class="mf">0.1519</code><code>  </code><code class="mf">3.460e-02</code><code>      </code><code class="mf">4.390</code><code>  </code><code class="mf">1.136e-05</code><code> </code><code class="p">[</code><code class="mf">8.406e-02</code><code class="p">,</code><code>  </code><code class="mf">0.220</code><code class="p">]</code><code>&#13;
</code><code class="n">alpha</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code>       </code><code class="mf">0.2329</code><code>  </code><code class="mf">3.620e-02</code><code>      </code><code class="mf">6.433</code><code>  </code><code class="mf">1.249e-10</code><code>   </code><code class="p">[</code><code>  </code><code class="mf">0.162</code><code class="p">,</code><code>  </code><code class="mf">0.304</code><code class="p">]</code><code>&#13;
</code><code class="n">alpha</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code>       </code><code class="mf">0.1917</code><code>  </code><code class="mf">3.707e-02</code><code>      </code><code class="mf">5.170</code><code>  </code><code class="mf">2.337e-07</code><code>   </code><code class="p">[</code><code>  </code><code class="mf">0.119</code><code class="p">,</code><code>  </code><code class="mf">0.264</code><code class="p">]</code><code>&#13;
</code><code class="n">alpha</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code>       </code><code class="mf">0.1922</code><code>  </code><code class="mf">4.158e-02</code><code>      </code><code class="mf">4.623</code><code>  </code><code class="mf">3.780e-06</code><code>   </code><code class="p">[</code><code>  </code><code class="mf">0.111</code><code class="p">,</code><code>  </code><code class="mf">0.274</code><code class="p">]</code><code>&#13;
</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Covariance</code><code> </code><code class="n">estimator</code><code class="p">:</code><code> </code><code class="n">robust</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rmse_arch</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                                 </code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">forecast_arch</code><code>\&#13;
</code><code>                                 </code><code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">)</code><code class="p">:</code><code class="p">]</code><code>&#13;
</code><code>                                 </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-6" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">The RMSE value of ARCH model is {:.4f}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_arch</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">RMSE</code><code> </code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">ARCH</code><code> </code><code class="n">model</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.0896</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Realized Volatility</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">forecast_arch</code><code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">)</code><code class="p">:</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                  </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Volatility Prediction-ARCH</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Volatility Prediction with ARCH</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Iterating ARCH parameter <em>p</em> over specified interval</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Running ARCH model with different <em>p</em> values</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-3" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Finding the minimum BIC score to select the best model</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-4" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Running ARCH model with the best <em>p</em> value</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-5" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Forecasting the volatility based on the optimized ARCH model</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-6" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO4-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Calculating the root mean square error (RMSE) score</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary="RMSE (root mean square error)" data-type="indexterm" id="idm45737243016448"/>The result of volatility prediction based on our first model is shown in <a data-type="xref" href="#arch_vol">Figure 4-3</a>.<a data-primary="" data-startref="ix_arch_model_ch4" data-type="indexterm" id="idm45737243310272"/><a data-primary="" data-startref="ix_volatil_predict_arch" data-type="indexterm" id="idm45737243309296"/></p>&#13;
&#13;
<figure><div class="figure" id="arch_vol">&#13;
<img alt="arch" src="assets/mlfr_0403.png"/>&#13;
<h6><span class="label">Figure 4-3. </span>Volatility prediction with ARCH</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="GARCH Model" data-type="sect1"><div class="sect1" id="idm45737244208608">&#13;
<h1>GARCH Model</h1>&#13;
&#13;
<p><a data-primary="volatility prediction" data-secondary="GARCH model" data-type="indexterm" id="ix_volatil_predict_garch"/><a data-primary="GARCH model" data-type="indexterm" id="ix_garch_model_ch4"/>The GARCH model is an extension of the ARCH model incorporating <a data-primary="lagged conditional variance" data-type="indexterm" id="idm45737243302288"/>lagged conditional variance. So ARCH is improved by adding <em>p</em> number of delated conditional variance, which makes the GARCH model multivariate in the sense that it is an autoregressive moving average model for conditional variance with <em>p</em> number of lagged squared returns and <em>q</em> number of lagged conditional variance. GARCH(<em>p</em>, <em>q</em>) can be formulated as:</p>&#13;
<div data-type="equation">&#13;
<math alttext="sigma Subscript t Superscript 2 Baseline equals omega plus sigma-summation Underscript k equals 1 Overscript q Endscripts alpha Subscript k Baseline r Subscript t minus k Superscript 2 Baseline plus sigma-summation Underscript k equals 1 Overscript p Endscripts beta Subscript k Baseline sigma Subscript t minus k Superscript 2" display="block">&#13;
  <mrow>&#13;
    <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>q</mi> </munderover>&#13;
    <msub><mi>α</mi> <mi>k</mi> </msub>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>p</mi> </munderover>&#13;
    <msub><mi>β</mi> <mi>k</mi> </msub>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <math alttext="omega">&#13;
  <mi>ω</mi>&#13;
</math>, <math alttext="beta">&#13;
  <mi>β</mi>&#13;
</math>, and <math alttext="alpha">&#13;
  <mi>α</mi>&#13;
</math> are parameters to be estimated and <em>p</em> and <em>q</em> are maximum lag in the model. To have consistent GARCH, the following conditions should hold:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><math alttext="omega">&#13;
  <mi>ω</mi>&#13;
</math> &gt; 0</p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="beta greater-than-or-equal-to 0">&#13;
  <mrow>&#13;
    <mi>β</mi>&#13;
    <mo>≥</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math></p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="alpha greater-than-or-equal-to 0">&#13;
  <mrow>&#13;
    <mi>α</mi>&#13;
    <mo>≥</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math></p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="beta plus alpha">&#13;
  <mrow>&#13;
    <mi>β</mi>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
  </mrow>&#13;
</math> &lt; 1</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The ARCH model is unable to capture the influence of historical innovations. However, as a more parsimonious model, the GARCH model can account for the change in historical innovations because GARCH models can be expressed as an infinite-order ARCH. Let’s see how GARCH can be shown as an infinite order of ARCH:</p>&#13;
<div data-type="equation">&#13;
<math alttext="sigma Subscript t Superscript 2 Baseline equals omega plus alpha r Subscript t minus 1 Superscript 2 Baseline plus beta sigma Subscript t minus 1 Superscript 2" display="block">&#13;
  <mrow>&#13;
    <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <mi>β</mi>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> <mn>2</mn> </msubsup>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Then replace <math alttext="sigma Subscript t minus 1 Superscript 2">&#13;
  <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> <mn>2</mn> </msubsup>&#13;
</math> by <math alttext="omega plus alpha r Subscript t minus 2 Superscript 2 plus beta sigma Subscript t minus 2 Superscript 2">&#13;
  <mrow>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <mi>β</mi>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
  </mrow>&#13;
</math>:</p>&#13;
<div data-type="equation">&#13;
<math alttext="sigma Subscript t Superscript 2 Baseline equals omega plus alpha r Subscript t minus 1 Superscript 2 Baseline plus beta left-parenthesis omega plus alpha r Subscript t minus 2 Superscript 2 Baseline sigma Subscript t minus 2 Superscript 2 Baseline right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <mi>β</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>ω</mi>&#13;
      <mo>+</mo>&#13;
      <mi>α</mi>&#13;
      <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
      <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math alttext="equals omega left-parenthesis 1 plus beta right-parenthesis plus alpha r Subscript t minus 1 Superscript 2 Baseline plus beta alpha r Subscript t minus 2 Superscript 2 Baseline plus beta squared sigma Subscript t minus 2 Superscript 2 Baseline right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mn>1</mn>&#13;
      <mo>+</mo>&#13;
      <mi>β</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <mi>β</mi>&#13;
    <mi>α</mi>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <msup><mi>β</mi> <mn>2</mn> </msup>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mrow>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Now, let’s substitute <math alttext="sigma Subscript t minus 2 Superscript 2">&#13;
  <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> <mn>2</mn> </msubsup>&#13;
</math> with <math alttext="omega plus alpha r Subscript t minus 3 Superscript 2 plus beta sigma Subscript t minus 3 Superscript 2">&#13;
  <mrow>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mn>3</mn></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <mi>β</mi>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mn>3</mn></mrow> <mn>2</mn> </msubsup>&#13;
  </mrow>&#13;
</math> and do the necessary math so that we end up with:</p>&#13;
<div data-type="equation">&#13;
<math alttext="sigma Subscript t Superscript 2 Baseline equals omega left-parenthesis 1 plus beta plus beta squared plus period period period right-parenthesis plus alpha sigma-summation Underscript k equals 1 Overscript normal infinity Endscripts beta Superscript k minus 1 Baseline r Subscript t minus k" display="block">&#13;
  <mrow>&#13;
    <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mn>1</mn>&#13;
      <mo>+</mo>&#13;
      <mi>β</mi>&#13;
      <mo>+</mo>&#13;
      <msup><mi>β</mi> <mn>2</mn> </msup>&#13;
      <mo>+</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>∞</mi> </munderover>&#13;
    <msup><mi>β</mi> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow> </msup>&#13;
    <msub><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Similar to the ARCH model, there is more than one way to model volatility using GARCH in Python. Let us try to develop our own Python-based code using the optimization technique first. In what follows, the <code>arch</code> library will be used to predict &#13;
<span class="keep-together">volatility</span>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">a0</code> <code class="o">=</code> <code class="mf">0.0001</code>&#13;
         <code class="n">sgm2</code> <code class="o">=</code> <code class="n">ret</code><code class="o">.</code><code class="n">var</code><code class="p">()</code>&#13;
         <code class="n">K</code> <code class="o">=</code> <code class="n">ret</code><code class="o">.</code><code class="n">kurtosis</code><code class="p">()</code>&#13;
         <code class="n">h</code> <code class="o">=</code> <code class="mi">1</code> <code class="o">-</code> <code class="n">alpha</code> <code class="o">/</code> <code class="n">sgm2</code>&#13;
         <code class="n">alpha</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">K</code> <code class="o">*</code> <code class="p">(</code><code class="mi">1</code> <code class="o">-</code> <code class="n">h</code> <code class="o">**</code> <code class="mi">2</code><code class="p">)</code> <code class="o">/</code> <code class="p">(</code><code class="mf">2.0</code> <code class="o">*</code> <code class="p">(</code><code class="n">K</code> <code class="o">+</code> <code class="mi">3</code><code class="p">)))</code>&#13;
         <code class="n">beta</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">abs</code><code class="p">(</code><code class="n">h</code> <code class="o">-</code> <code class="n">omega</code><code class="p">)</code>&#13;
         <code class="n">omega</code> <code class="o">=</code> <code class="p">(</code><code class="mi">1</code> <code class="o">-</code> <code class="n">omega</code><code class="p">)</code> <code class="o">*</code> <code class="n">sgm2</code>&#13;
         <code class="n">initial_parameters</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([</code><code class="n">omega</code><code class="p">,</code> <code class="n">alpha</code><code class="p">,</code> <code class="n">beta</code><code class="p">])</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'Initial parameters for omega, alpha, and beta are </code><code class="se">\n</code><code class="s1">{}</code><code class="se">\n</code><code class="s1">{}</code><code class="se">\n</code><code class="s1">{}'</code>&#13;
               <code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">omega</code><code class="p">,</code> <code class="n">alpha</code><code class="p">,</code> <code class="n">beta</code><code class="p">))</code>&#13;
         <code class="n">Initial</code> <code class="n">parameters</code> <code class="k">for</code> <code class="n">omega</code><code class="p">,</code> <code class="n">alpha</code><code class="p">,</code> <code class="ow">and</code> <code class="n">beta</code>  <code class="n">are</code>&#13;
         <code class="mf">0.43471178001576827</code>&#13;
         <code class="mf">0.512827280537482</code>&#13;
         <code class="mf">0.02677799855546381</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="n">retv</code> <code class="o">=</code> <code class="n">ret</code><code class="o">.</code><code class="n">values</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">21</code><code class="p">]:</code> <code class="nd">@jit</code><code class="p">(</code><code class="n">nopython</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code> <code class="n">parallel</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
         <code class="k">def</code> <code class="nf">garch_likelihood</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code> <code class="n">retv</code><code class="p">):</code>&#13;
             <code class="n">omega</code> <code class="o">=</code> <code class="n">initial_parameters</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>&#13;
             <code class="n">alpha</code> <code class="o">=</code> <code class="n">initial_parameters</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>&#13;
             <code class="n">beta</code> <code class="o">=</code> <code class="n">initial_parameters</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code>&#13;
             <code class="n">T</code> <code class="o">=</code>  <code class="nb">len</code><code class="p">(</code><code class="n">retv</code><code class="p">)</code>&#13;
             <code class="n">logliks</code> <code class="o">=</code> <code class="mi">0</code>&#13;
             <code class="n">sigma2</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">zeros</code><code class="p">(</code><code class="n">T</code><code class="p">)</code>&#13;
             <code class="n">sigma2</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="n">retv</code><code class="p">)</code>&#13;
             <code class="k">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="n">T</code><code class="p">):</code>&#13;
                 <code class="n">sigma2</code><code class="p">[</code><code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">omega</code> <code class="o">+</code> <code class="n">alpha</code> <code class="o">*</code> <code class="p">(</code><code class="n">retv</code><code class="p">[</code><code class="n">t</code> <code class="o">-</code> <code class="mi">1</code><code class="p">])</code> <code class="o">**</code> <code class="mi">2</code> <code class="o">+</code>&#13;
                             <code class="n">beta</code> <code class="o">*</code> <code class="n">sigma2</code><code class="p">[</code><code class="n">t</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code>&#13;
             <code class="n">logliks</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="mf">0.5</code> <code class="o">*</code> <code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">sigma2</code><code class="p">)</code> <code class="o">+</code> <code class="n">retv</code> <code class="o">**</code> <code class="mi">2</code> <code class="o">/</code> <code class="n">sigma2</code><code class="p">))</code>&#13;
             <code class="k">return</code> <code class="n">logliks</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">22</code><code class="p">]:</code> <code class="n">logliks</code> <code class="o">=</code> <code class="n">garch_likelihood</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code> <code class="n">retv</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'The Log likelihood  is {:.4f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">logliks</code><code class="p">))</code>&#13;
         <code class="n">The</code> <code class="n">Log</code> <code class="n">likelihood</code>  <code class="ow">is</code> <code class="mf">1387.7215</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">garch_constraint</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">):</code>&#13;
             <code class="n">alpha</code> <code class="o">=</code> <code class="n">initial_parameters</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>&#13;
             <code class="n">gamma</code> <code class="o">=</code> <code class="n">initial_parameters</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>&#13;
             <code class="n">beta</code> <code class="o">=</code> <code class="n">initial_parameters</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code>&#13;
             <code class="k">return</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([</code><code class="mi">1</code> <code class="o">-</code> <code class="n">alpha</code> <code class="o">-</code> <code class="n">beta</code><code class="p">])</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">24</code><code class="p">]:</code> <code class="n">bounds</code> <code class="o">=</code> <code class="p">[(</code><code class="mf">0.0</code><code class="p">,</code> <code class="mf">1.0</code><code class="p">),</code> <code class="p">(</code><code class="mf">0.0</code><code class="p">,</code> <code class="mf">1.0</code><code class="p">),</code> <code class="p">(</code><code class="mf">0.0</code><code class="p">,</code> <code class="mf">1.0</code><code class="p">)]</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">25</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">opt_paramsG</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code> <code class="n">retv</code><code class="p">):</code>&#13;
             <code class="n">opt_result</code> <code class="o">=</code> <code class="n">opt</code><code class="o">.</code><code class="n">minimize</code><code class="p">(</code><code class="n">garch_likelihood</code><code class="p">,</code>&#13;
                                       <code class="n">x0</code><code class="o">=</code><code class="n">initial_parameters</code><code class="p">,</code>&#13;
                                       <code class="n">constraints</code><code class="o">=</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([</code><code class="mi">1</code> <code class="o">-</code> <code class="n">alpha</code> <code class="o">-</code> <code class="n">beta</code><code class="p">]),</code>&#13;
                                       <code class="n">bounds</code><code class="o">=</code><code class="n">bounds</code><code class="p">,</code> <code class="n">args</code> <code class="o">=</code> <code class="p">(</code><code class="n">retv</code><code class="p">),</code>&#13;
                                       <code class="n">method</code><code class="o">=</code><code class="s1">'Nelder-Mead'</code><code class="p">,</code>&#13;
                                       <code class="n">options</code><code class="o">=</code><code class="p">{</code><code class="s1">'maxiter'</code><code class="p">:</code> <code class="mi">5000</code><code class="p">})</code>&#13;
             <code class="n">params</code> <code class="o">=</code> <code class="n">opt_result</code><code class="o">.</code><code class="n">x</code>&#13;
             <code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">Results of Nelder-Mead minimization</code><code class="se">\n</code><code class="s1">{}</code><code class="se">\n</code><code class="s1">{}'</code>\&#13;
                   <code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="s1">'-'</code> <code class="o">*</code> <code class="mi">35</code><code class="p">,</code> <code class="n">opt_result</code><code class="p">))</code>&#13;
             <code class="k">print</code><code class="p">(</code><code class="s1">'-'</code> <code class="o">*</code> <code class="mi">35</code><code class="p">)</code>&#13;
             <code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">Resulting parameters = {}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">params</code><code class="p">))</code>&#13;
             <code class="k">return</code> <code class="n">params</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">26</code><code class="p">]:</code> <code class="n">params</code> <code class="o">=</code> <code class="n">opt_paramsG</code><code class="p">(</code><code class="n">initial_parameters</code><code class="p">,</code> <code class="n">retv</code><code class="p">)</code>&#13;
&#13;
         <code class="n">Results</code> <code class="n">of</code> <code class="n">Nelder</code><code class="o">-</code><code class="n">Mead</code> <code class="n">minimization</code>&#13;
         <code class="o">-----------------------------------</code>&#13;
          <code class="n">final_simplex</code><code class="p">:</code> <code class="p">(</code><code class="n">array</code><code class="p">([[</code><code class="mf">0.03918956</code><code class="p">,</code> <code class="mf">0.17370549</code><code class="p">,</code> <code class="mf">0.78991502</code><code class="p">],</code>&#13;
                <code class="p">[</code><code class="mf">0.03920507</code><code class="p">,</code> <code class="mf">0.17374466</code><code class="p">,</code> <code class="mf">0.78987403</code><code class="p">],</code>&#13;
                <code class="p">[</code><code class="mf">0.03916671</code><code class="p">,</code> <code class="mf">0.17377319</code><code class="p">,</code> <code class="mf">0.78993078</code><code class="p">],</code>&#13;
         <code class="p">[</code><code class="mf">0.03917324</code><code class="p">,</code> <code class="mf">0.17364595</code><code class="p">,</code> <code class="mf">0.78998753</code><code class="p">]]),</code> <code class="n">array</code><code class="p">([</code><code class="mf">979.87109624</code><code class="p">,</code> <code class="mf">979.8710967</code> <code class="p">,</code>&#13;
          <code class="mf">979.87109865</code><code class="p">,</code> <code class="mf">979.8711147</code> <code class="p">]))</code>&#13;
                    <code class="n">fun</code><code class="p">:</code> <code class="mf">979.8710962352685</code>&#13;
                <code class="n">message</code><code class="p">:</code> <code class="s1">'Optimization terminated successfully.'</code>&#13;
                   <code class="n">nfev</code><code class="p">:</code> <code class="mi">178</code>&#13;
                    <code class="n">nit</code><code class="p">:</code> <code class="mi">102</code>&#13;
                 <code class="n">status</code><code class="p">:</code> <code class="mi">0</code>&#13;
                <code class="n">success</code><code class="p">:</code> <code class="bp">True</code>&#13;
                      <code class="n">x</code><code class="p">:</code> <code class="n">array</code><code class="p">([</code><code class="mf">0.03918956</code><code class="p">,</code> <code class="mf">0.17370549</code><code class="p">,</code> <code class="mf">0.78991502</code><code class="p">])</code>&#13;
         <code class="o">-----------------------------------</code>&#13;
&#13;
         <code class="n">Resulting</code> <code class="n">parameters</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.03918956</code> <code class="mf">0.17370549</code> <code class="mf">0.78991502</code><code class="p">]</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">27</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">garch_apply</code><code class="p">(</code><code class="n">ret</code><code class="p">):</code>&#13;
                 <code class="n">omega</code> <code class="o">=</code> <code class="n">params</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>&#13;
                 <code class="n">alpha</code> <code class="o">=</code> <code class="n">params</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>&#13;
                 <code class="n">beta</code> <code class="o">=</code> <code class="n">params</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code>&#13;
                 <code class="n">T</code> <code class="o">=</code> <code class="nb">len</code><code class="p">(</code><code class="n">ret</code><code class="p">)</code>&#13;
                 <code class="n">sigma2</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">zeros</code><code class="p">(</code><code class="n">T</code> <code class="o">+</code> <code class="mi">1</code><code class="p">)</code>&#13;
                 <code class="n">sigma2</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="n">ret</code><code class="p">)</code>&#13;
                 <code class="k">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="n">T</code><code class="p">):</code>&#13;
                     <code class="n">sigma2</code><code class="p">[</code><code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">omega</code> <code class="o">+</code> <code class="n">alpha</code> <code class="o">*</code> <code class="n">ret</code><code class="p">[</code><code class="n">t</code> <code class="o">-</code> <code class="mi">1</code><code class="p">]</code> <code class="o">**</code> <code class="mi">2</code> <code class="o">+</code>&#13;
                                 <code class="n">beta</code> <code class="o">*</code> <code class="n">sigma2</code><code class="p">[</code><code class="n">t</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code>&#13;
                 <code class="k">return</code> <code class="n">sigma2</code></pre>&#13;
&#13;
<p>The parameters we get from our own GARCH code are approximately:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><math alttext="omega">&#13;
  <mi>ω</mi>&#13;
</math> = 0.0392</p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="alpha">&#13;
  <mi>α</mi>&#13;
</math> = 0.1737</p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="beta">&#13;
  <mi>β</mi>&#13;
</math> = 0.7899</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Now, let’s try it with the built-in Python function:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="n">garch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">vol</code><code class="o">=</code><code class="s1">'GARCH'</code><code class="p">,</code> <code class="n">p</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code> <code class="n">o</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code> <code class="n">q</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>\&#13;
                 <code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">garch</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>&#13;
&#13;
         <code class="n">Zero</code> <code class="n">Mean</code> <code class="o">-</code> <code class="n">GARCH</code> <code class="n">Model</code> <code class="n">Results</code>&#13;
<code class="o">==============================================================================</code>&#13;
<code class="n">Dep</code><code class="o">.</code> <code class="n">Variable</code><code class="p">:</code>              <code class="n">Adj</code> <code class="n">Close</code>   <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                       <code class="mf">0.000</code>&#13;
<code class="n">Mean</code> <code class="n">Model</code><code class="p">:</code>                 <code class="n">Zero</code> <code class="n">Mean</code>   <code class="n">Adj</code><code class="o">.</code> <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                  <code class="mf">0.000</code>&#13;
<code class="n">Vol</code> <code class="n">Model</code><code class="p">:</code>                      <code class="n">GARCH</code>   <code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code>               <code class="o">-</code><code class="mf">3657.62</code>&#13;
<code class="n">Distribution</code><code class="p">:</code>                  <code class="n">Normal</code>   <code class="n">AIC</code><code class="p">:</code>                           <code class="mf">7321.23</code>&#13;
<code class="n">Method</code><code class="p">:</code>            <code class="n">Maximum</code> <code class="n">Likelihood</code>   <code class="n">BIC</code><code class="p">:</code>                           <code class="mf">7339.16</code>&#13;
<code class="n">No</code><code class="o">.</code> <code class="n">Observations</code><code class="p">:</code>                 <code class="mi">2914</code>&#13;
&#13;
<code class="n">Date</code><code class="p">:</code>                <code class="n">Mon</code><code class="p">,</code> <code class="n">Sep</code> <code class="mi">13</code> <code class="mi">2021</code>   <code class="n">Df</code> <code class="n">Residuals</code><code class="p">:</code>                     <code class="mi">2914</code>&#13;
<code class="n">Time</code><code class="p">:</code>                        <code class="mi">21</code><code class="p">:</code><code class="mi">57</code><code class="p">:</code><code class="mi">08</code>   <code class="n">Df</code> <code class="n">Model</code><code class="p">:</code>                          <code class="mi">0</code>&#13;
<code class="n">Volatility</code> <code class="n">Model</code>&#13;
&#13;
<code class="o">============================================================================</code>&#13;
<code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>      <code class="mf">95.0</code><code class="o">%</code> <code class="n">Conf</code><code class="o">.</code> <code class="n">Int</code><code class="o">.</code>&#13;
&#13;
<code class="o">----------------------------------------------------------------------------</code>&#13;
<code class="n">omega</code>          <code class="mf">0.0392</code>  <code class="mf">8.422e-03</code>      <code class="mf">4.652</code>  <code class="mf">3.280e-06</code> <code class="p">[</code><code class="mf">2.268e-02</code><code class="p">,</code><code class="mf">5.569e-02</code><code class="p">]</code>&#13;
<code class="n">alpha</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>       <code class="mf">0.1738</code>  <code class="mf">2.275e-02</code>      <code class="mf">7.637</code>  <code class="mf">2.225e-14</code>     <code class="p">[</code>  <code class="mf">0.129</code><code class="p">,</code>  <code class="mf">0.218</code><code class="p">]</code>&#13;
<code class="n">beta</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>        <code class="mf">0.7899</code>  <code class="mf">2.275e-02</code>     <code class="mf">34.715</code> <code class="mf">4.607e-264</code>     <code class="p">[</code>  <code class="mf">0.745</code><code class="p">,</code>  <code class="mf">0.835</code><code class="p">]</code>&#13;
<code class="o">============================================================================</code>&#13;
&#13;
         <code class="n">Covariance</code> <code class="n">estimator</code><code class="p">:</code> <code class="n">robust</code></pre>&#13;
&#13;
<p>The built-in function confirms that we did a great job, as the parameters obtained via the built-in code are almost the same as ours, so we have learned how to code GARCH and ARCH models to predict volatility.</p>&#13;
&#13;
<p>It’s apparent that it is easy to work with GARCH(1, 1), but how do we know that the parameters are the optimum ones? Let’s decide the optimum parameter set given the lowest BIC value (and in doing so, generate <a data-type="xref" href="#garch_vol">Figure 4-4</a>):</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="n">bic_garch</code> <code class="o">=</code> <code class="p">[]</code>&#13;
&#13;
         <code class="k">for</code> <code class="n">p</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
             <code class="k">for</code> <code class="n">q</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
                 <code class="n">garch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code><code class="n">vol</code><code class="o">=</code><code class="s1">'GARCH'</code><code class="p">,</code> <code class="n">p</code><code class="o">=</code><code class="n">p</code><code class="p">,</code> <code class="n">o</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code> <code class="n">q</code><code class="o">=</code><code class="n">q</code><code class="p">)</code>\&#13;
                         <code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
                 <code class="n">bic_garch</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">garch</code><code class="o">.</code><code class="n">bic</code><code class="p">)</code>&#13;
                 <code class="k">if</code> <code class="n">garch</code><code class="o">.</code><code class="n">bic</code> <code class="o">==</code> <code class="n">np</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="n">bic_garch</code><code class="p">):</code>&#13;
                     <code class="n">best_param</code> <code class="o">=</code> <code class="n">p</code><code class="p">,</code> <code class="n">q</code>&#13;
         <code class="n">garch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">vol</code><code class="o">=</code><code class="s1">'GARCH'</code><code class="p">,</code>&#13;
                            <code class="n">p</code><code class="o">=</code><code class="n">best_param</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">o</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code> <code class="n">q</code><code class="o">=</code><code class="n">best_param</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code>\&#13;
                 <code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">garch</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>&#13;
         <code class="n">forecast</code> <code class="o">=</code> <code class="n">garch</code><code class="o">.</code><code class="n">forecast</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="n">split_date</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
         <code class="n">forecast_garch</code> <code class="o">=</code> <code class="n">forecast</code>&#13;
&#13;
         <code class="n">Zero</code> <code class="n">Mean</code> <code class="o">-</code> <code class="n">GARCH</code> <code class="n">Model</code> <code class="n">Results</code>&#13;
<code class="o">==============================================================================</code>&#13;
<code class="n">Dep</code><code class="o">.</code> <code class="n">Variable</code><code class="p">:</code>              <code class="n">Adj</code> <code class="n">Close</code>   <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                       <code class="mf">0.000</code>&#13;
<code class="n">Mean</code> <code class="n">Model</code><code class="p">:</code>                 <code class="n">Zero</code> <code class="n">Mean</code>   <code class="n">Adj</code><code class="o">.</code> <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                  <code class="mf">0.000</code>&#13;
<code class="n">Vol</code> <code class="n">Model</code><code class="p">:</code>                      <code class="n">GARCH</code>   <code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code>               <code class="o">-</code><code class="mf">3657.62</code>&#13;
<code class="n">Distribution</code><code class="p">:</code>                  <code class="n">Normal</code>   <code class="n">AIC</code><code class="p">:</code>                           <code class="mf">7321.23</code>&#13;
<code class="n">Method</code><code class="p">:</code>            <code class="n">Maximum</code> <code class="n">Likelihood</code>   <code class="n">BIC</code><code class="p">:</code>                           <code class="mf">7339.16</code>&#13;
<code class="n">No</code><code class="o">.</code> <code class="n">Observations</code><code class="p">:</code>                 <code class="mi">2914</code>&#13;
&#13;
<code class="n">Date</code><code class="p">:</code>                <code class="n">Mon</code><code class="p">,</code> <code class="n">Sep</code> <code class="mi">13</code> <code class="mi">2021</code>   <code class="n">Df</code> <code class="n">Residuals</code><code class="p">:</code>                     <code class="mi">2914</code>&#13;
<code class="n">Time</code><code class="p">:</code>                        <code class="mi">21</code><code class="p">:</code><code class="mi">57</code><code class="p">:</code><code class="mi">10</code>   <code class="n">Df</code> <code class="n">Model</code><code class="p">:</code>                          <code class="mi">0</code>&#13;
<code class="n">Volatility</code> <code class="n">Model</code>&#13;
&#13;
<code class="o">============================================================================</code>&#13;
                  <code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>      <code class="mf">95.0</code><code class="o">%</code> <code class="n">Conf</code><code class="o">.</code> <code class="n">Int</code><code class="o">.</code>&#13;
<code class="o">----------------------------------------------------------------------------</code>&#13;
<code class="n">omega</code>          <code class="mf">0.0392</code>  <code class="mf">8.422e-03</code>      <code class="mf">4.652</code>  <code class="mf">3.280e-06</code> <code class="p">[</code><code class="mf">2.268e-02</code><code class="p">,</code> <code class="mf">5.569e-02</code><code class="p">]</code>&#13;
<code class="n">alpha</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>       <code class="mf">0.1738</code>  <code class="mf">2.275e-02</code>      <code class="mf">7.637</code>  <code class="mf">2.225e-14</code>       <code class="p">[</code>  <code class="mf">0.129</code><code class="p">,</code> <code class="mf">0.218</code><code class="p">]</code>&#13;
<code class="n">beta</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>        <code class="mf">0.7899</code>  <code class="mf">2.275e-02</code>     <code class="mf">34.715</code> <code class="mf">4.607e-264</code>       <code class="p">[</code>  <code class="mf">0.745</code><code class="p">,</code> <code class="mf">0.835</code><code class="p">]</code>&#13;
<code class="o">============================================================================</code>&#13;
&#13;
         <code class="n">Covariance</code> <code class="n">estimator</code><code class="p">:</code> <code class="n">robust</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">30</code><code class="p">]:</code> <code class="n">rmse_garch</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                                  <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">forecast_garch</code>\&#13;
                                  <code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">):]</code>&#13;
                                  <code class="o">/</code> <code class="mi">100</code><code class="p">)))</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'The RMSE value of GARCH model is {:.4f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_garch</code><code class="p">))</code>&#13;
         <code class="n">The</code> <code class="n">RMSE</code> <code class="n">value</code> <code class="n">of</code> <code class="n">GARCH</code> <code class="n">model</code> <code class="ow">is</code> <code class="mf">0.0878</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">31</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Realized Volatility'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">forecast_garch</code><code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">):]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                  <code class="n">label</code><code class="o">=</code><code class="s1">'Volatility Prediction-GARCH'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'Volatility Prediction with GARCH'</code><code class="p">,</code> <code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">()</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="garch_vol">&#13;
<img alt="garch" src="assets/mlfr_0404.png"/>&#13;
<h6><span class="label">Figure 4-4. </span>Volatility prediction with GARCH</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before less_space">The volatility of returns is well-fitted by the GARCH model partly because of&#13;
its volatility clustering and partly because GARCH does not assume that the returns are independent, which allows it to account for the leptokurtic property of returns. However, despite these useful properties and its intuitiveness, GARCH is not able to model the asymmetric response of the shocks (Karasan and Gaygisiz 2020). To remedy this issue, GJR-GARCH was proposed by Glosten, Jagannathan, and Runkle (1993).<a data-primary="" data-startref="ix_garch_model_ch4" data-type="indexterm" id="idm45737242540096"/><a data-primary="" data-startref="ix_volatil_predict_garch" data-type="indexterm" id="idm45737242539120"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="GJR-GARCH" data-type="sect1"><div class="sect1" id="idm45737243305584">&#13;
<h1>GJR-GARCH</h1>&#13;
&#13;
<p><a data-primary="GJR-GARCH model" data-type="indexterm" id="ix_gjr-garch_model_ch4"/><a data-primary="volatility prediction" data-secondary="GJR-GARCH model" data-type="indexterm" id="ix_volatil_predict_gjr"/><a data-primary="GARCH model" data-secondary="GJR-GARCH" data-type="indexterm" id="ix_garch_model_gjr"/>The GJR-GARCH model performs well in modeling the <a data-primary="asymmetric information" data-secondary="GARCH model" data-type="indexterm" id="idm45737240808208"/>asymmetric effects of announcements in the way that bad news has a larger impact than good news. In other words, in the presence of asymmetry, the distribution of losses has a fatter tail than the distribution of gains. The equation of the model includes one more parameter, <math alttext="gamma">&#13;
  <mi>γ</mi>&#13;
</math>, and it takes the following form:</p>&#13;
<div data-type="equation">&#13;
<math mode="display">&#13;
  <mrow>&#13;
    <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>q</mi> </munderover>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msub><mi>α</mi> <mi>k</mi> </msub>&#13;
      <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup>&#13;
      <mo>+</mo>&#13;
      <mi>γ</mi>&#13;
      <msubsup><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup>&#13;
      <mi>I</mi>&#13;
      <mrow>&#13;
        <mo>(</mo>&#13;
        <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
        <mo>&lt;</mo>&#13;
        <mn>0</mn>&#13;
        <mo>)</mo>&#13;
      </mrow>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>p</mi> </munderover>&#13;
    <msub><mi>β</mi> <mi>k</mi> </msub>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup>&#13;
  </mrow>&#13;
</math></div>&#13;
&#13;
<p>where <math alttext="gamma">&#13;
  <mi>γ</mi>&#13;
</math> controls for the asymmetry of the announcements and if:</p>&#13;
<dl>&#13;
<dt><math alttext="gamma">&#13;
  <mi>γ</mi>&#13;
</math> = 0</dt>&#13;
<dd>&#13;
<p>The response to the past shock is the same.</p>&#13;
</dd>&#13;
<dt><math alttext="gamma">&#13;
  <mi>γ</mi>&#13;
</math> &gt; 0</dt>&#13;
<dd>&#13;
<p>The response to the past negative shock is stronger than a positive one.</p>&#13;
</dd>&#13;
<dt><math alttext="gamma">&#13;
  <mi>γ</mi>&#13;
</math> &lt; 0</dt>&#13;
<dd>&#13;
<p>The response to the past positive shock is stronger than a negative one.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Let’s now run the GJR-GARCH model by finding the optimum parameter values using BIC, and producing <a data-type="xref" href="#gjr_garch_vol">Figure 4-5</a> as a result:</p>&#13;
&#13;
<pre class="slightly-smaller-code" data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">32</code><code class="p">]:</code> <code class="n">bic_gjr_garch</code> <code class="o">=</code> <code class="p">[]</code>&#13;
&#13;
         <code class="k">for</code> <code class="n">p</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
             <code class="k">for</code> <code class="n">q</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
                 <code class="n">gjrgarch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">p</code><code class="o">=</code><code class="n">p</code><code class="p">,</code> <code class="n">o</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code> <code class="n">q</code><code class="o">=</code><code class="n">q</code><code class="p">)</code>\&#13;
                            <code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
                 <code class="n">bic_gjr_garch</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">gjrgarch</code><code class="o">.</code><code class="n">bic</code><code class="p">)</code>&#13;
                 <code class="k">if</code> <code class="n">gjrgarch</code><code class="o">.</code><code class="n">bic</code> <code class="o">==</code> <code class="n">np</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="n">bic_gjr_garch</code><code class="p">):</code>&#13;
                     <code class="n">best_param</code> <code class="o">=</code> <code class="n">p</code><code class="p">,</code> <code class="n">q</code>&#13;
         <code class="n">gjrgarch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code><code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">p</code><code class="o">=</code><code class="n">best_param</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">o</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code>&#13;
                               <code class="n">q</code><code class="o">=</code><code class="n">best_param</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">gjrgarch</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>&#13;
         <code class="n">forecast</code> <code class="o">=</code> <code class="n">gjrgarch</code><code class="o">.</code><code class="n">forecast</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="n">split_date</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
         <code class="n">forecast_gjrgarch</code> <code class="o">=</code> <code class="n">forecast</code>&#13;
&#13;
         <code class="n">Zero</code> <code class="n">Mean</code> <code class="o">-</code> <code class="n">GJR</code><code class="o">-</code><code class="n">GARCH</code> <code class="n">Model</code> <code class="n">Results</code>&#13;
<code class="o">==============================================================================</code>&#13;
<code class="n">Dep</code><code class="o">.</code> <code class="n">Variable</code><code class="p">:</code>              <code class="n">Adj</code> <code class="n">Close</code>   <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                      <code class="mf">0.000</code>&#13;
<code class="n">Mean</code> <code class="n">Model</code><code class="p">:</code>                 <code class="n">Zero</code> <code class="n">Mean</code>   <code class="n">Adj</code><code class="o">.</code> <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                 <code class="mf">0.000</code>&#13;
<code class="n">Vol</code> <code class="n">Model</code><code class="p">:</code>                  <code class="n">GJR</code><code class="o">-</code><code class="n">GARCH</code>   <code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code>              <code class="o">-</code><code class="mf">3593.36</code>&#13;
<code class="n">Distribution</code><code class="p">:</code>                  <code class="n">Normal</code>   <code class="n">AIC</code><code class="p">:</code>                          <code class="mf">7194.73</code>&#13;
<code class="n">Method</code><code class="p">:</code>            <code class="n">Maximum</code> <code class="n">Likelihood</code>   <code class="n">BIC</code><code class="p">:</code>                          <code class="mf">7218.64</code>&#13;
<code class="n">No</code><code class="o">.</code> <code class="n">Observations</code><code class="p">:</code>                 <code class="mi">2914</code>&#13;
&#13;
<code class="n">Date</code><code class="p">:</code>                <code class="n">Mon</code><code class="p">,</code> <code class="n">Sep</code> <code class="mi">13</code> <code class="mi">2021</code>   <code class="n">Df</code> <code class="n">Residuals</code><code class="p">:</code>                    <code class="mi">2914</code>&#13;
<code class="n">Time</code><code class="p">:</code>                        <code class="mi">21</code><code class="p">:</code><code class="mi">57</code><code class="p">:</code><code class="mi">14</code>   <code class="n">Df</code> <code class="n">Model</code><code class="p">:</code>                         <code class="mi">0</code>&#13;
<code class="n">Volatility</code> <code class="n">Model</code>&#13;
&#13;
<code class="o">=============================================================================</code>&#13;
                 <code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>       <code class="mf">95.0</code><code class="o">%</code> <code class="n">Conf</code><code class="o">.</code> <code class="n">Int</code><code class="o">.</code>&#13;
<code class="o">-----------------------------------------------------------------------------</code>&#13;
<code class="n">omega</code>          <code class="mf">0.0431</code>  <code class="mf">7.770e-03</code>      <code class="mf">5.542</code>  <code class="mf">2.983e-08</code>  <code class="p">[</code><code class="mf">2.784e-02</code><code class="p">,</code><code class="mf">5.829e-02</code><code class="p">]</code>&#13;
<code class="n">alpha</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>       <code class="mf">0.0386</code>  <code class="mf">3.060e-02</code>      <code class="mf">1.261</code>      <code class="mf">0.207</code> <code class="p">[</code><code class="o">-</code><code class="mf">2.139e-02</code><code class="p">,</code><code class="mf">9.855e-02</code><code class="p">]</code>&#13;
<code class="n">gamma</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>       <code class="mf">0.2806</code>  <code class="mf">4.818e-02</code>      <code class="mf">5.824</code>  <code class="mf">5.740e-09</code>       <code class="p">[</code>  <code class="mf">0.186</code><code class="p">,</code> <code class="mf">0.375</code><code class="p">]</code>&#13;
<code class="n">beta</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>        <code class="mf">0.7907</code>  <code class="mf">2.702e-02</code>     <code class="mf">29.263</code> <code class="mf">3.029e-188</code>       <code class="p">[</code>  <code class="mf">0.738</code><code class="p">,</code> <code class="mf">0.844</code><code class="p">]</code>&#13;
<code class="o">=============================================================================</code>&#13;
&#13;
         <code class="n">Covariance</code> <code class="n">estimator</code><code class="p">:</code> <code class="n">robust</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">33</code><code class="p">]:</code> <code class="n">rmse_gjr_garch</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                                      <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">forecast_gjrgarch</code>\&#13;
                                      <code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">):]</code>&#13;
                                      <code class="o">/</code> <code class="mi">100</code><code class="p">)))</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'The RMSE value of GJR-GARCH models is {:.4f}'</code>&#13;
               <code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_gjr_garch</code><code class="p">))</code>&#13;
         <code class="n">The</code> <code class="n">RMSE</code> <code class="n">value</code> <code class="n">of</code> <code class="n">GJR</code><code class="o">-</code><code class="n">GARCH</code> <code class="n">models</code> <code class="ow">is</code> <code class="mf">0.0882</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">34</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Realized Volatility'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">forecast_gjrgarch</code><code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">):]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                  <code class="n">label</code><code class="o">=</code><code class="s1">'Volatility Prediction-GJR-GARCH'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'Volatility Prediction with GJR-GARCH'</code><code class="p">,</code> <code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">()</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="gjr_garch_vol">&#13;
<img alt="gjr_garch" src="assets/mlfr_0405.png"/>&#13;
<h6><span class="label">Figure 4-5. </span>Volatility prediction with GJR-GARCH</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="EGARCH" data-type="sect1"><div class="sect1" id="idm45737240300032">&#13;
<h1>EGARCH</h1>&#13;
&#13;
<p><a data-primary="GARCH model" data-secondary="EGARCH" data-type="indexterm" id="ix_garch_egarch_ch4"/><a data-primary="volatility prediction" data-secondary="EGARCH model" data-type="indexterm" id="ix_volatil_predict_egarch"/><a data-primary="EGARCH model" data-type="indexterm" id="ix_egarch_model_ch4"/>Together with the GJR-GARCH model, the EGARCH model, proposed by Nelson (1991), is another tool for controlling for the effect of asymmetric announcements. Additionally, it is specified in logarithmic form, so there is no need to add restrictions to avoid negative volatility:</p>&#13;
<div data-type="equation">&#13;
<math alttext="log left-parenthesis sigma Subscript t Superscript 2 Baseline right-parenthesis equals omega plus sigma-summation Underscript k equals 1 Overscript p Endscripts beta Subscript k Baseline log sigma Subscript t minus k Superscript 2 Baseline plus sigma-summation Underscript k equals 1 Overscript q Endscripts alpha Subscript i Baseline StartFraction StartAbsoluteValue r Subscript k minus 1 Baseline EndAbsoluteValue Over StartRoot sigma Subscript t minus k Superscript 2 Baseline EndRoot EndFraction plus sigma-summation Underscript k equals 1 Overscript q Endscripts gamma Subscript k Baseline StartFraction r Subscript t minus k Baseline Over StartRoot sigma Subscript t minus k Superscript 2 Baseline EndRoot EndFraction" display="block">&#13;
  <mrow>&#13;
    <mtext>log</mtext>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msubsup><mi>σ</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mi>ω</mi>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>p</mi> </munderover>&#13;
    <msub><mi>β</mi> <mi>k</mi> </msub>&#13;
    <mtext>log</mtext>&#13;
    <msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>q</mi> </munderover>&#13;
    <msub><mi>α</mi> <mi>i</mi> </msub>&#13;
    <mfrac><mrow><mrow><mo>|</mo></mrow><msub><mi>r</mi> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow> </msub><mrow><mo>|</mo></mrow></mrow> <msqrt><msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup></msqrt></mfrac>&#13;
    <mo>+</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>q</mi> </munderover>&#13;
    <msub><mi>γ</mi> <mi>k</mi> </msub>&#13;
    <mfrac><msub><mi>r</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> </msub> <msqrt><msubsup><mi>σ</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> <mn>2</mn> </msubsup></msqrt></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>The main difference in the EGARCH equation is that logarithm is taken of the variance on the left-hand side of the equation. This indicates the leverage effect, meaning that there exists a negative correlation between past asset returns and volatility. If <math alttext="gamma less-than 0">&#13;
  <mrow>&#13;
    <mi>γ</mi>&#13;
    <mo>&lt;</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math>, it implies leverage effect, and if <math alttext="gamma not-equals 0">&#13;
  <mrow>&#13;
    <mi>γ</mi>&#13;
    <mo>≠</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math>, that shows asymmetry in volatility.</p>&#13;
&#13;
<p>Following the same procedure we used previously, let’s model the volatility using the EGARCH model (resulting in <a data-type="xref" href="#egarch_vol">Figure 4-6</a>):</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">35</code><code class="p">]:</code> <code class="n">bic_egarch</code> <code class="o">=</code> <code class="p">[]</code>&#13;
&#13;
         <code class="k">for</code> <code class="n">p</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
             <code class="k">for</code> <code class="n">q</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
                 <code class="n">egarch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">vol</code><code class="o">=</code><code class="s1">'EGARCH'</code><code class="p">,</code> <code class="n">p</code><code class="o">=</code><code class="n">p</code><code class="p">,</code> <code class="n">q</code><code class="o">=</code><code class="n">q</code><code class="p">)</code>\&#13;
                          <code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
                 <code class="n">bic_egarch</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">egarch</code><code class="o">.</code><code class="n">bic</code><code class="p">)</code>&#13;
                 <code class="k">if</code> <code class="n">egarch</code><code class="o">.</code><code class="n">bic</code> <code class="o">==</code> <code class="n">np</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="n">bic_egarch</code><code class="p">):</code>&#13;
                     <code class="n">best_param</code> <code class="o">=</code> <code class="n">p</code><code class="p">,</code> <code class="n">q</code>&#13;
         <code class="n">egarch</code> <code class="o">=</code> <code class="n">arch_model</code><code class="p">(</code><code class="n">ret</code><code class="p">,</code> <code class="n">mean</code><code class="o">=</code><code class="s1">'zero'</code><code class="p">,</code> <code class="n">vol</code><code class="o">=</code><code class="s1">'EGARCH'</code><code class="p">,</code>&#13;
                             <code class="n">p</code><code class="o">=</code><code class="n">best_param</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">q</code><code class="o">=</code><code class="n">best_param</code><code class="p">[</code><code class="mi">1</code><code class="p">])</code>\&#13;
                  <code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">disp</code><code class="o">=</code><code class="s1">'off'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">egarch</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>&#13;
         <code class="n">forecast</code> <code class="o">=</code> <code class="n">egarch</code><code class="o">.</code><code class="n">forecast</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="n">split_date</code><code class="p">[</code><code class="mi">0</code><code class="p">])</code>&#13;
         <code class="n">forecast_egarch</code> <code class="o">=</code> <code class="n">forecast</code>&#13;
&#13;
         <code class="n">Zero</code> <code class="n">Mean</code> <code class="o">-</code> <code class="n">EGARCH</code> <code class="n">Model</code> <code class="n">Results</code>&#13;
<code class="o">==============================================================================</code>&#13;
<code class="n">Dep</code><code class="o">.</code> <code class="n">Variable</code><code class="p">:</code>              <code class="n">Adj</code> <code class="n">Close</code>   <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                      <code class="mf">0.000</code>&#13;
<code class="n">Mean</code> <code class="n">Model</code><code class="p">:</code>                 <code class="n">Zero</code> <code class="n">Mean</code>   <code class="n">Adj</code><code class="o">.</code> <code class="n">R</code><code class="o">-</code><code class="n">squared</code><code class="p">:</code>                 <code class="mf">0.000</code>&#13;
<code class="n">Vol</code> <code class="n">Model</code><code class="p">:</code>                     <code class="n">EGARCH</code>   <code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code>              <code class="o">-</code><code class="mf">3676.18</code>&#13;
<code class="n">Distribution</code><code class="p">:</code>                  <code class="n">Normal</code>   <code class="n">AIC</code><code class="p">:</code>                          <code class="mf">7358.37</code>&#13;
<code class="n">Method</code><code class="p">:</code>            <code class="n">Maximum</code> <code class="n">Likelihood</code>   <code class="n">BIC</code><code class="p">:</code>                          <code class="mf">7376.30</code>&#13;
<code class="n">No</code><code class="o">.</code> <code class="n">Observations</code><code class="p">:</code>                 <code class="mi">2914</code>&#13;
&#13;
<code class="n">Date</code><code class="p">:</code>                <code class="n">Mon</code><code class="p">,</code> <code class="n">Sep</code> <code class="mi">13</code> <code class="mi">2021</code>   <code class="n">Df</code> <code class="n">Residuals</code><code class="p">:</code>                    <code class="mi">2914</code>&#13;
<code class="n">Time</code><code class="p">:</code>                        <code class="mi">21</code><code class="p">:</code><code class="mi">57</code><code class="p">:</code><code class="mi">19</code>   <code class="n">Df</code> <code class="n">Model</code><code class="p">:</code>                         <code class="mi">0</code>&#13;
<code class="n">Volatility</code> <code class="n">Model</code>&#13;
&#13;
<code class="o">=============================================================================</code>&#13;
                 <code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>       <code class="mf">95.0</code><code class="o">%</code> <code class="n">Conf</code><code class="o">.</code> <code class="n">Int</code><code class="o">.</code>&#13;
<code class="o">-----------------------------------------------------------------------------</code>&#13;
<code class="n">omega</code>      <code class="mf">2.3596e-03</code>  <code class="mf">6.747e-03</code>      <code class="mf">0.350</code>      <code class="mf">0.727</code>  <code class="p">[</code><code class="o">-</code><code class="mf">1.086e-02</code><code class="p">,</code><code class="mf">1.558e-02</code><code class="p">]</code>&#13;
<code class="n">alpha</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>       <code class="mf">0.3266</code>  <code class="mf">3.427e-02</code>      <code class="mf">9.530</code>  <code class="mf">1.567e-21</code>        <code class="p">[</code>  <code class="mf">0.259</code><code class="p">,</code> <code class="mf">0.394</code><code class="p">]</code>&#13;
<code class="n">beta</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>        <code class="mf">0.9456</code>  <code class="mf">1.153e-02</code>     <code class="mf">82.023</code>      <code class="mf">0.000</code>        <code class="p">[</code>  <code class="mf">0.923</code><code class="p">,</code> <code class="mf">0.968</code><code class="p">]</code>&#13;
<code class="o">=============================================================================</code>&#13;
&#13;
         <code class="n">Covariance</code> <code class="n">estimator</code><code class="p">:</code> <code class="n">robust</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">36</code><code class="p">]:</code> <code class="n">rmse_egarch</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                                   <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">forecast_egarch</code><code class="o">.</code><code class="n">variance</code>\&#13;
                                   <code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">):]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">)))</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'The RMSE value of EGARCH models is {:.4f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_egarch</code><code class="p">))</code>&#13;
         <code class="n">The</code> <code class="n">RMSE</code> <code class="n">value</code> <code class="n">of</code> <code class="n">EGARCH</code> <code class="n">models</code> <code class="ow">is</code> <code class="mf">0.0904</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">37</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Realized Volatility'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">forecast_egarch</code><code class="o">.</code><code class="n">variance</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="nb">len</code><code class="p">(</code><code class="n">split_date</code><code class="p">):]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                  <code class="n">label</code><code class="o">=</code><code class="s1">'Volatility Prediction-EGARCH'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'Volatility Prediction with EGARCH'</code><code class="p">,</code> <code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">()</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="egarch_vol">&#13;
<img alt="egarch" src="assets/mlfr_0406.png"/>&#13;
<h6><span class="label">Figure 4-6. </span>Volatility prediction with EGARCH</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="RMSE (root mean square error)" data-type="indexterm" id="idm45737239740064"/>Given the RMSE results shown in <a data-type="xref" href="#vol_results_all">Table 4-1</a>, the best and worst performing models are GARCH and EGARCH, respectively. But there are no big differences in the performance of the models we have used here. In particular, during bad news/good news announcements, the performances of EGARCH and GJR-GARCH might be different due to the asymmetry in the market.<a data-primary="" data-startref="ix_egarch_model_ch4" data-type="indexterm" id="idm45737239738048"/><a data-primary="" data-startref="ix_garch_egarch_ch4" data-type="indexterm" id="idm45737239737104"/><a data-primary="" data-startref="ix_volatil_predict_egarch" data-type="indexterm" id="idm45737239259248"/></p>&#13;
<table id="vol_results_all">&#13;
<caption><span class="label">Table 4-1. </span>RMSE results for all four models</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Model</th>&#13;
<th>RMSE</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>ARCH</p></td>&#13;
<td><p>0.0896</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>GARCH</p></td>&#13;
<td><p>0.0878</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>GJR-GARCH</p></td>&#13;
<td><p>0.0882</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>EGARCH</p></td>&#13;
<td><p>0.0904</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Up to now, we have discussed the classical volatility models, but from this point on, we will see how ML and the Bayesian approach can be used to model volatility. In the context of ML, support vector machines and neural networks will be the first models to explore. Let’s get started.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Support Vector Regression: GARCH" data-type="sect1"><div class="sect1" id="idm45737240299408">&#13;
<h1>Support Vector Regression: GARCH</h1>&#13;
&#13;
<p><a data-primary="SVMs (support vector machines)" data-type="indexterm" id="ix_svm_ch4"/><a data-primary="volatility prediction" data-secondary="SVM and GARCH model" data-type="indexterm" id="ix_volatil_predict_svm-garch"/><a data-primary="ML (machine learning)" data-secondary="support vector machines" data-type="indexterm" id="ix_ml_svm_ch4"/>Support vector machine (SVM) is a supervised learning algorithm that can be applicable to both classification and regression. The aim of SVM is to find a line that separates two classes. It sounds easy but here is the challenging part: there are almost an infinite number of lines that can be used to distinguish the classes. But we are looking for the optimal line by which the classes can be perfectly discriminated.</p>&#13;
&#13;
<p><a data-primary="hyperplane" data-type="indexterm" id="idm45737239241296"/>In linear algebra, the optimal line is called <em>hyperplane</em>, which maximizes the distance between the points that are closest to the hyperplane but belong to different classes. <a data-primary="margin, support vectors" data-type="indexterm" id="idm45737239239888"/>The distance between the two points (support vectors) is known as <em>margin</em>. So, in SVM, what we are trying to do is to maximize the margin between support vectors.</p>&#13;
&#13;
<p><a data-primary="SVC (support vector classification)" data-type="indexterm" id="idm45737239238272"/>SVM for classification is known as support vector classification (SVC). Keeping all characteristics of SVM, it can be applicable to regression. Again, in regression, the aim is to find the hyperplane that minimizes the error and maximizes the margin. <a data-primary="SVR (support vector regression)" data-type="indexterm" id="idm45737239237152"/>This method is called support vector regression (SVR) and, in this part, we will apply this method to the GARCH model.&#13;
<a data-primary="SVR-GARCH model" data-type="indexterm" id="ix_svr-garch_model"/><a data-primary="GARCH model" data-secondary="SVR-GARCH" data-type="indexterm" id="ix_garch_svr_garch"/>Combining these two models gets us <em>SVR-GARCH</em>.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45737239233408">&#13;
<h5>Kernel Functions</h5>&#13;
<p><a data-primary="kernel functions" data-type="indexterm" id="idm45737239232000"/>What happens if the data we are working on cannot be linearly separable? That would be a huge headache for us, but don’t worry: we have kernel functions to remedy this problem. This is a nice and easy method for modeling nonlinear and high-dimensional data. The steps we take in kernel SVM are:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Move the data into high dimension</p>&#13;
</li>&#13;
<li>&#13;
<p>Find a suitable hyperplane</p>&#13;
</li>&#13;
<li>&#13;
<p>Go back to the initial data</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>To do this, we use kernel functions. Using the idea of feature map, we indicate that our original variables are mapped to new set of quantities, and then passed to the learning algorithm.</p>&#13;
&#13;
<p>Finally, instead of input data, we use the following main kernel functions in optimization procedures:</p>&#13;
<dl>&#13;
<dt><a data-primary="polynomial kernel function" data-type="indexterm" id="idm45737239225744"/>Polynomial kernel</dt>&#13;
<dd>&#13;
<p><math alttext="upper K left-parenthesis x comma z right-parenthesis equals left-parenthesis x Superscript upper T Baseline z plus b right-parenthesis">&#13;
  <mrow>&#13;
    <mi>K</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>x</mi>&#13;
      <mo>,</mo>&#13;
      <mi>z</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msup><mi>x</mi> <mi>T</mi> </msup>&#13;
      <mi>z</mi>&#13;
      <mo>+</mo>&#13;
      <mi>b</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math></p>&#13;
</dd>&#13;
<dt><a data-primary="RBF (radial basis function)" data-type="indexterm" id="idm45737239214880"/><a data-primary="radial basis (Gaussian) kernel function" data-type="indexterm" id="idm45737239214176"/>Radial basis (Gaussian) kernel</dt>&#13;
<dd>&#13;
<p><math alttext="upper K left-parenthesis x comma z right-parenthesis equals exp left-parenthesis minus StartFraction StartAbsoluteValue x minus z EndAbsoluteValue squared Over 2 sigma squared EndFraction right-parenthesis">&#13;
  <mrow>&#13;
    <mi>K</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>x</mi>&#13;
      <mo>,</mo>&#13;
      <mi>z</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mtext>exp</mtext>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mo>-</mo>&#13;
      <mfrac><msup><mrow><mo>|</mo><mi>x</mi><mo>-</mo><mi>z</mi><mo>|</mo></mrow> <mn>2</mn> </msup> <mrow><mn>2</mn><msup><mi>σ</mi> <mn>2</mn> </msup></mrow></mfrac>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math></p>&#13;
</dd>&#13;
<dt><a data-primary="exponential kernel function" data-type="indexterm" id="idm45737239200784"/>Exponential kernel</dt>&#13;
<dd>&#13;
<p><math alttext="upper K left-parenthesis x comma z right-parenthesis equals ex p left-parenthesis minus StartFraction StartAbsoluteValue x minus z EndAbsoluteValue Over sigma EndFraction right-parenthesis">&#13;
  <mrow>&#13;
    <mi>K</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>x</mi>&#13;
      <mo>,</mo>&#13;
      <mi>z</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mtext>ex</mtext>&#13;
    <mi>p</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mo>-</mo>&#13;
      <mfrac><mrow><mo>|</mo><mi>x</mi><mo>-</mo><mi>z</mi><mo>|</mo></mrow> <mi>σ</mi></mfrac>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math></p>&#13;
&#13;
<p>where <em>x</em> is input, <em>b</em> is bias or constant, and <em>z</em> is linear combination of x.<sup><a data-type="noteref" href="ch04.html#idm45737239187584" id="idm45737239187584-marker">2</a></sup></p>&#13;
</dd>&#13;
</dl>&#13;
</div></aside>&#13;
&#13;
<p>The following code shows us the preparations before running the SVR-GARCH in Python. The most crucial step here is to obtain independent variables, which are realized volatility and square of historical returns:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">38</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.svm</code><code> </code><code class="kn">import</code><code> </code><code class="n">SVR</code><code>&#13;
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">scipy.stats</code><code> </code><code class="kn">import</code><code> </code><code class="n">uniform</code><code> </code><code class="k">as</code><code> </code><code class="n">sp_rand</code><code>&#13;
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">sklearn.model_selection</code><code> </code><code class="kn">import</code><code> </code><code class="n">RandomizedSearchCV</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">39</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">realized_vol</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="mi">5</code><code class="p">)</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">realized_vol</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">realized_vol</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="n">drop</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">40</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">returns_svm</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code>&#13;
</code><code>         </code><code class="n">returns_svm</code><code> </code><code class="o">=</code><code> </code><code class="n">returns_svm</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="k">del</code><code> </code><code class="n">returns_svm</code><code class="p">[</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">41</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">X</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">(</code><code class="p">[</code><code class="n">realized_vol</code><code class="p">,</code><code> </code><code class="n">returns_svm</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">ignore_index</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">X</code><code> </code><code class="o">=</code><code> </code><code class="n">X</code><code class="p">[</code><code class="mi">4</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">copy</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">X</code><code> </code><code class="o">=</code><code> </code><code class="n">X</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">X</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'</code><code class="s1">index</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">42</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">realized_vol</code><code> </code><code class="o">=</code><code> </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'</code><code class="s1">index</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">43</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">svr_poly</code><code> </code><code class="o">=</code><code> </code><code class="n">SVR</code><code class="p">(</code><code class="n">kernel</code><code class="o">=</code><code class="s1">'</code><code class="s1">poly</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">degree</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">svr_lin</code><code> </code><code class="o">=</code><code> </code><code class="n">SVR</code><code class="p">(</code><code class="n">kernel</code><code class="o">=</code><code class="s1">'</code><code class="s1">linear</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-3"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">svr_rbf</code><code> </code><code class="o">=</code><code> </code><code class="n">SVR</code><code class="p">(</code><code class="n">kernel</code><code class="o">=</code><code class="s1">'</code><code class="s1">rbf</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-4"><img alt="2" src="assets/2.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Computing realized volatility and assigning a new variable to it named <code>realized_vol</code></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Creating new variables for each SVR kernel</p></dd>&#13;
</dl>&#13;
&#13;
<p class="pagebreak-before less_space"><a data-primary="linear kernel function" data-type="indexterm" id="idm45737239098352"/>Let’s run and see our first SVR-GARCH application with linear kernel (and produce <a data-type="xref" href="#SVR_GARCH_linear_vol">Figure 4-7</a>); we’ll use the RMSE metric to compare the applications:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">44</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">para_grid</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">gamma</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">sp_rand</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                      </code><code class="s1">'</code><code class="s1">C</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">sp_rand</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                      </code><code class="s1">'</code><code class="s1">epsilon</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">sp_rand</code><code class="p">(</code><code class="p">)</code><code class="p">}</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">clf</code><code> </code><code class="o">=</code><code> </code><code class="n">RandomizedSearchCV</code><code class="p">(</code><code class="n">svr_lin</code><code class="p">,</code><code> </code><code class="n">para_grid</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">clf</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="o">-</code><code class="n">n</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="o">-</code><code class="p">(</code><code class="n">n</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">predict_svr_lin</code><code> </code><code class="o">=</code><code> </code><code class="n">clf</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-4" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">45</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">predict_svr_lin</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">predict_svr_lin</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">predict_svr_lin</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">46</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rmse_svr</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                                </code><code class="n">predict_svr_lin</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">The RMSE value of SVR with Linear Kernel is {:.6f}</code><code class="s1">'</code><code>&#13;
</code><code>               </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_svr</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">RMSE</code><code> </code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">SVR</code><code> </code><code class="k">with</code><code> </code><code class="n">Linear</code><code> </code><code class="n">Kernel</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.000462</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">47</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">4</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Realized Volatility</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">predict_svr_lin</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Volatility Prediction-SVR-GARCH</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Volatility Prediction with SVR-GARCH (Linear)</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Identifying the hyperparameter space for tuning</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Applying hyperparameter tuning with <code>RandomizedSearchCV</code></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-3" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Fitting SVR-GARCH with linear kernel to data</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-4" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO6-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Predicting the volatilities based on the last 252 observations and storing them in the <code>predict_svr_lin</code></p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="SVR_GARCH_linear_vol">&#13;
<img alt="svr_garch_linear" src="assets/mlfr_0407.png"/>&#13;
<h6><span class="label">Figure 4-7. </span>Volatility prediction with  SVR-GARCH linear kernel</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-type="xref" href="#SVR_GARCH_linear_vol">Figure 4-7</a> exhibits the predicted values and actual observation. By eyeballing it, we can tell that SVR-GARCH performs well. As you can guess, the linear kernel works fine if the dataset is linearly separable; <a data-primary="Occam’s Razor" data-type="indexterm" id="idm45737238526384"/>it is also suggested by <em>Occam’s razor</em>.<sup><a data-type="noteref" href="ch04.html#idm45737238525200" id="idm45737238525200-marker">3</a></sup> <a data-primary="RBF (radial basis function)" data-type="indexterm" id="ix_rbf_ch4"/><a data-primary="radial basis (Gaussian) kernel function" data-type="indexterm" id="ix_radial_basis_kernel"/>But what if the dataset isn’t linearly separable? Let’s continue with the radial basis function (RBF) and polynomial kernels. The former uses elliptical curves around the observations, and the latter, unlike the first two, focuses on the combinations of samples. Let’s now see how they work.</p>&#13;
&#13;
<p>Let’s start with an SVR-GARCH application using the RBF kernel, a function that projects data into a new vector space. From a practical standpoint, SVR-GARCH application with different kernels is not a labor-intensive process; all we need to do is switch the kernel name, as shown in the following (and resulting in <a data-type="xref" href="#SVR_GARCH_rbf_vol">Figure 4-8</a>):</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">49</code><code class="p">]:</code> <code class="n">para_grid</code> <code class="o">=</code><code class="p">{</code><code class="s1">'gamma'</code><code class="p">:</code> <code class="n">sp_rand</code><code class="p">(),</code>&#13;
                     <code class="s1">'C'</code><code class="p">:</code> <code class="n">sp_rand</code><code class="p">(),</code>&#13;
                     <code class="s1">'epsilon'</code><code class="p">:</code> <code class="n">sp_rand</code><code class="p">()}</code>&#13;
         <code class="n">clf</code> <code class="o">=</code> <code class="n">RandomizedSearchCV</code><code class="p">(</code><code class="n">svr_rbf</code><code class="p">,</code> <code class="n">para_grid</code><code class="p">)</code>&#13;
         <code class="n">clf</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="o">-</code><code class="n">n</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code>&#13;
                 <code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="o">-</code><code class="p">(</code><code class="n">n</code><code class="o">-</code><code class="mi">1</code><code class="p">)]</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,))</code>&#13;
         <code class="n">predict_svr_rbf</code> <code class="o">=</code> <code class="n">clf</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:])</code>&#13;
&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">50</code><code class="p">]:</code> <code class="n">predict_svr_rbf</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">predict_svr_rbf</code><code class="p">)</code>&#13;
         <code class="n">predict_svr_rbf</code><code class="o">.</code><code class="n">index</code> <code class="o">=</code> <code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code><code class="o">.</code><code class="n">index</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">51</code><code class="p">]:</code> <code class="n">rmse_svr_rbf</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                                    <code class="n">predict_svr_rbf</code> <code class="o">/</code> <code class="mi">100</code><code class="p">))</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'The RMSE value of SVR with RBF Kernel is  {:.6f}'</code>&#13;
               <code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_svr_rbf</code><code class="p">))</code>&#13;
         <code class="n">The</code> <code class="n">RMSE</code> <code class="n">value</code> <code class="n">of</code> <code class="n">SVR</code> <code class="k">with</code> <code class="n">RBF</code> <code class="n">Kernel</code> <code class="ow">is</code>  <code class="mf">0.000970</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">52</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Realized Volatility'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">predict_svr_rbf</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Volatility Prediction-SVR_GARCH'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'Volatility Prediction with SVR-GARCH (RBF)'</code><code class="p">,</code> <code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">()</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="SVR_GARCH_rbf_vol">&#13;
<img alt="svr_garch_rbf" src="assets/mlfr_0408.png"/>&#13;
<h6><span class="label">Figure 4-8. </span>Volatility prediction with the SVR-GARCH RBF kernel</h6>&#13;
</div></figure>&#13;
&#13;
<p>Both the RMSE score and the visualization suggest that SVR-GARCH with linear kernel outperforms SVR-GARCH with RBF kernel. The RMSEs of SVR-GARCH with linear and RBF kernels are 0.000462 and 0.000970, respectively. So SVR with linear kernel performs well.</p>&#13;
&#13;
<p><a data-primary="polynomial kernel function" data-type="indexterm" id="idm45737238219072"/>Lastly, let’s try SVR-GARCH with the polynomial kernel. It will turn out that it has the highest RMSE (0.002386), implying that it is the worst-performing kernel among these three different applications. The predictive performance of SVR-GARCH with polynomial kernel can be found in <a data-type="xref" href="#SVR_GARCH_poly_vol">Figure 4-9</a>:<a data-primary="" data-startref="ix_ml_svm_ch4" data-type="indexterm" id="idm45737238216944"/><a data-primary="" data-startref="ix_svm_ch4" data-type="indexterm" id="idm45737238215968"/><a data-primary="" data-startref="ix_volatil_predict_svm-garch" data-type="indexterm" id="idm45737238215024"/><a data-primary="" data-startref="ix_garch_svr_garch" data-type="indexterm" id="idm45737238214064"/><a data-primary="" data-startref="ix_svr-garch_model" data-type="indexterm" id="idm45737238213120"/><a data-primary="" data-startref="ix_radial_basis_kernel" data-type="indexterm" id="idm45737238212176"/><a data-primary="" data-startref="ix_rbf_ch4" data-type="indexterm" id="idm45737238211232"/></p>&#13;
&#13;
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">53</code><code class="p">]:</code> <code class="n">para_grid</code> <code class="o">=</code> <code class="p">{</code><code class="s1">'gamma'</code><code class="p">:</code> <code class="n">sp_rand</code><code class="p">(),</code>&#13;
                     <code class="s1">'C'</code><code class="p">:</code> <code class="n">sp_rand</code><code class="p">(),</code>&#13;
                     <code class="s1">'epsilon'</code><code class="p">:</code> <code class="n">sp_rand</code><code class="p">()}</code>&#13;
         <code class="n">clf</code> <code class="o">=</code> <code class="n">RandomizedSearchCV</code><code class="p">(</code><code class="n">svr_poly</code><code class="p">,</code> <code class="n">para_grid</code><code class="p">)</code>&#13;
         <code class="n">clf</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="o">-</code><code class="n">n</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code>&#13;
                 <code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="o">-</code><code class="p">(</code><code class="n">n</code><code class="o">-</code><code class="mi">1</code><code class="p">)]</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,))</code>&#13;
         <code class="n">predict_svr_poly</code> <code class="o">=</code> <code class="n">clf</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:])</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="n">predict_svr_poly</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">predict_svr_poly</code><code class="p">)</code>&#13;
         <code class="n">predict_svr_poly</code><code class="o">.</code><code class="n">index</code> <code class="o">=</code> <code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code><code class="o">.</code><code class="n">index</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">55</code><code class="p">]:</code> <code class="n">rmse_svr_poly</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                                     <code class="n">predict_svr_poly</code> <code class="o">/</code> <code class="mi">100</code><code class="p">))</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'The RMSE value of SVR with Polynomial Kernel is {:.6f}'</code>\&#13;
               <code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_svr_poly</code><code class="p">))</code>&#13;
         <code class="n">The</code> <code class="n">RMSE</code> <code class="n">value</code> <code class="n">of</code> <code class="n">SVR</code> <code class="k">with</code> <code class="n">Polynomial</code> <code class="n">Kernel</code> <code class="ow">is</code> <code class="mf">0.002386</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">56</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">/</code><code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Realized Volatility'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">predict_svr_poly</code><code class="o">/</code><code class="mi">100</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Volatility Prediction-SVR-GARCH'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'Volatility Prediction with SVR-GARCH (Polynomial)'</code><code class="p">,</code>&#13;
                   <code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">()</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="SVR_GARCH_poly_vol">&#13;
<img alt="svr_garch_poly" src="assets/mlfr_0409.png"/>&#13;
<h6><span class="label">Figure 4-9. </span>Volatility prediction with SVR-GARCH polynomial kernel</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Neural Networks" data-type="sect1"><div class="sect1" id="idm45737239246768">&#13;
<h1>Neural Networks</h1>&#13;
&#13;
<p><a data-primary="volatility prediction" data-secondary="neural networks" data-type="indexterm" id="ix_volatil_predict_nns"/><a data-primary="NNs (neural networks)" data-secondary="in volatility prediction" data-secondary-sortas="volatility prediction" data-type="indexterm" id="ix_nns_volatil_predict"/>Neural networks are the building block for deep learning. In an NN, data is processed in multiple stages to make a decision. Each neuron takes a result of a dot product as input and uses it in an activation function to make a decision:</p>&#13;
<div data-type="equation">&#13;
<math alttext="z equals w 1 x 1 plus w 2 x 2 plus b" display="block">&#13;
  <mrow>&#13;
    <mi>z</mi>&#13;
    <mo>=</mo>&#13;
    <msub><mi>w</mi> <mn>1</mn> </msub>&#13;
    <msub><mi>x</mi> <mn>1</mn> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>w</mi> <mn>2</mn> </msub>&#13;
    <msub><mi>x</mi> <mn>2</mn> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>b</mi>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>b</em> is bias, <em>w</em> is weight, and <em>x</em> is input data.</p>&#13;
&#13;
<p>During this process, input data is mathematically manipulated in various ways in hidden and output layers. Generally speaking, an NN has three types of layers:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Input layers</p>&#13;
</li>&#13;
<li>&#13;
<p>Hidden layers</p>&#13;
</li>&#13;
<li>&#13;
<p>Output layers</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-type="xref" href="#nn_str">Figure 4-10</a> can help to illustrate the relationships among layers.</p>&#13;
&#13;
<p><a data-primary="input layers, NNs" data-type="indexterm" id="idm45737237917296"/>The input layer includes raw data. <a data-primary="hidden layers, NNs" data-type="indexterm" id="idm45737237916464"/>In going from the input layer to the hidden layer, we learn coefficients. There may be one or more than one hidden layers depending on the network structure. The more hidden layers the network has, the more complicated it is. Hidden layers, located between input and output layers, perform nonlinear transformations via activation functions.</p>&#13;
&#13;
<figure><div class="figure" id="nn_str">&#13;
<img alt="nn_str" src="assets/mlfr_0410.png"/>&#13;
<h6><span class="label">Figure 4-10. </span>NN structure</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="output layers, NNs" data-type="indexterm" id="idm45737237913056"/>Finally, the output layer is the layer in which output is produced and decisions are made.</p>&#13;
&#13;
<p><a data-primary="gradient descent, ML" data-type="indexterm" id="ix_gradient_desc_ml"/>In ML, <em>gradient descent</em> is applied to find the optimum parameters that minimize the cost function, but employing only gradient descent in NN is not feasible due to the chain-like structure within the NN. <a data-primary="backpropagation" data-type="indexterm" id="idm45737237910144"/>Thus, a new concept known as backpropagation is proposed to minimize the cost function. The idea of <em>backpropagation</em> rests on &#13;
<span class="keep-together">calculating</span> the error between observed and actual output, and then passing this error to the hidden layer. So we move backward, and the main equation takes the form of:</p>&#13;
<div data-type="equation">&#13;
<math alttext="delta Superscript l Baseline equals StartFraction delta upper J Over delta z Subscript j Superscript l Baseline EndFraction" display="block">&#13;
  <mrow>&#13;
    <msup><mi>δ</mi> <mi>l</mi> </msup>&#13;
    <mo>=</mo>&#13;
    <mfrac><mrow><mi>δ</mi><mi>J</mi></mrow> <mrow><mi>δ</mi><msubsup><mi>z</mi> <mi>j</mi> <mi>l</mi> </msubsup></mrow></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>z</em> is linear transformation and <math alttext="delta">&#13;
  <mi>δ</mi>&#13;
</math> represents error. There is much more to say here, but to keep us on track we’ll stop here. For those who want to dig more into the math behind NNs, please refer to Wilmott (2013) and Alpaydin (2020).</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45737237898256">&#13;
<h5>Gradient Descent</h5>&#13;
<p>Suppose that we are at the top of a hill and are trying to reach the plateau at which we minimize the cost function. Formally, gradient descent is an optimization algorithm used to search for best parameter space (<em>w</em>, <em>b</em>) that minimizes the cost function via following update rule:</p>&#13;
<div data-type="equation">&#13;
<math alttext="theta Subscript t plus 1 Baseline equals theta Subscript t Baseline minus lamda StartFraction delta upper J Over delta theta Subscript t Baseline EndFraction" display="block">&#13;
  <mrow>&#13;
    <msub><mi>θ</mi> <mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>θ</mi> <mi>t</mi> </msub>&#13;
    <mo>-</mo>&#13;
    <mi>λ</mi>&#13;
    <mfrac><mrow><mi>δ</mi><mi>J</mi></mrow> <mrow><mi>δ</mi><msub><mi>θ</mi> <mi>t</mi> </msub></mrow></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <math alttext="theta left-parenthesis w comma b right-parenthesis">&#13;
  <mrow>&#13;
    <mi>θ</mi>&#13;
    <mo>(</mo>&#13;
    <mi>w</mi>&#13;
    <mo>,</mo>&#13;
    <mi>b</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> is the function of weight, <em>w</em>, and bias, <em>b</em>. <em>J</em> is cost function, and <math alttext="lamda">&#13;
  <mi>λ</mi>&#13;
</math> is the learning rate, which is a constant number deciding how fast we want to minimize the cost function. At each iteration, we update the parameters to minimize the error.</p>&#13;
&#13;
<p>The gradient descent algorithm works in the following way:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Select initial values for <em>w</em> and <em>b</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Take an <math alttext="lamda">&#13;
  <mi>λ</mi>&#13;
</math> step in the direction opposite to where the gradient points.</p>&#13;
</li>&#13;
<li>&#13;
<p>Update <em>w</em> and <em>b</em> at each iteration.</p>&#13;
</li>&#13;
<li>&#13;
<p>Repeat from step 2 until convergence.<a data-primary="" data-startref="ix_gradient_desc_ml" data-type="indexterm" id="idm45737237871728"/></p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></aside>&#13;
&#13;
<p><a data-primary="MLPRegressor module" data-type="indexterm" id="idm45737237870240"/>Now, we apply NN-based volatility prediction using the <code>MLPRegressor</code> module from scikit-learn, even though we have various options to run NNs in Python.<sup><a data-type="noteref" href="ch04.html#idm45737237868960" id="idm45737237868960-marker">4</a></sup> Given the NN structure we’ve introduced, the result follows:</p>&#13;
&#13;
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">57</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.neural_network</code><code> </code><code class="kn">import</code><code> </code><code class="n">MLPRegressor</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">NN_vol</code><code> </code><code class="o">=</code><code> </code><code class="n">MLPRegressor</code><code class="p">(</code><code class="n">learning_rate_init</code><code class="o">=</code><code class="mf">0.001</code><code class="p">,</code><code> </code><code class="n">random_state</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">para_grid_NN</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">hidden_layer_sizes</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">(</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="mi">50</code><code class="p">)</code><code class="p">,</code><code> </code><code class="p">(</code><code class="mi">50</code><code class="p">,</code><code> </code><code class="mi">50</code><code class="p">)</code><code class="p">,</code><code> </code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">100</code><code class="p">)</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                        </code><code class="s1">'</code><code class="s1">max_iter</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mi">500</code><code class="p">,</code><code> </code><code class="mi">1000</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                        </code><code class="s1">'</code><code class="s1">alpha</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mf">0.00005</code><code class="p">,</code><code> </code><code class="mf">0.0005</code><code> </code><code class="p">]</code><code class="p">}</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">clf</code><code> </code><code class="o">=</code><code> </code><code class="n">RandomizedSearchCV</code><code class="p">(</code><code class="n">NN_vol</code><code class="p">,</code><code> </code><code class="n">para_grid_NN</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">clf</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="o">-</code><code class="n">n</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="o">-</code><code class="p">(</code><code class="n">n</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">NN_predictions</code><code> </code><code class="o">=</code><code> </code><code class="n">clf</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-4" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">58</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">NN_predictions</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">NN_predictions</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">NN_predictions</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">59</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rmse_NN</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                               </code><code class="n">NN_predictions</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">The RMSE value of NN is {:.6f}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">rmse_NN</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">RMSE</code><code> </code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">NN</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.000583</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">60</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Realized Volatility</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">NN_predictions</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Volatility Prediction-NN</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Volatility Prediction with Neural Network</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Importing the <code>MLPRegressor</code> module</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Configuring the NN model with three hidden layers and varying neuron &#13;
<span class="keep-together">numbers</span></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-3" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Fitting the NN model to the training data<sup><a data-type="noteref" href="ch04.html#idm45737237767616" id="idm45737237767616-marker">5</a></sup></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-4" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO7-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Predicting the volatilities based on the last 252 observations and storing them in the <code>NN_predictions</code> variable</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#NN_vol">Figure 4-11</a> shows the volatility prediction result based on the NN model. Despite its reasonable performance, we can play with the number of hidden neurons to generate a deep learning model. <a data-primary="Keras library" data-type="indexterm" id="idm45737237791824"/>To do that, we can apply the Keras library, Python’s interface for artificial neural networks.</p>&#13;
&#13;
<figure><div class="figure" id="NN_vol">&#13;
<img alt="NN" src="assets/mlfr_0411.png"/>&#13;
<h6><span class="label">Figure 4-11. </span>Volatility prediction with an NN</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="deep learning" data-secondary="volatility prediction" data-type="indexterm" id="ix_deep_learn_volatil"/>Now it’s time to predict volatility using deep learning. Based on Keras, it is easy to configure the network structure. All we need is to determine the number of neurons of the specific layer. Here, the number of neurons for the first and second hidden layers are 256 and 128, respectively. As volatility has a continuous type, we have only one output neuron:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">61</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">tensorflow</code><code> </code><code class="kn">as</code><code> </code><code class="nn">tf</code><code>&#13;
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">tensorflow</code><code> </code><code class="kn">import</code><code> </code><code class="n">keras</code><code>&#13;
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">tensorflow.keras</code><code> </code><code class="kn">import</code><code> </code><code class="n">layers</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">62</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">keras</code><code class="o">.</code><code class="n">Sequential</code><code class="p">(</code><code>&#13;
</code><code>             </code><code class="p">[</code><code class="n">layers</code><code class="o">.</code><code class="n">Dense</code><code class="p">(</code><code class="mi">256</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s2">"</code><code class="s2">relu</code><code class="s2">"</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>              </code><code class="n">layers</code><code class="o">.</code><code class="n">Dense</code><code class="p">(</code><code class="mi">128</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s2">"</code><code class="s2">relu</code><code class="s2">"</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>              </code><code class="n">layers</code><code class="o">.</code><code class="n">Dense</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s2">"</code><code class="s2">linear</code><code class="s2">"</code><code class="p">)</code><code class="p">,</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">63</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="n">loss</code><code class="o">=</code><code class="s1">'</code><code class="s1">mse</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">optimizer</code><code class="o">=</code><code class="s1">'</code><code class="s1">rmsprop</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">64</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">epochs_trial</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="mi">400</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">batch_trial</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="mi">400</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-4"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">DL_pred</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="n">DL_RMSE</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">j</code><code class="p">,</code><code> </code><code class="n">k</code><code> </code><code class="ow">in</code><code> </code><code class="nb">zip</code><code class="p">(</code><code class="nb">range</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">epochs_trial</code><code class="p">,</code><code> </code><code class="n">batch_trial</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="o">-</code><code class="n">n</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="o">-</code><code class="p">(</code><code class="n">n</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">batch_size</code><code class="o">=</code><code class="n">k</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="n">j</code><code class="p">,</code><code> </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-4" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-5"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>             </code><code class="n">DL_predict</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">asarray</code><code class="p">(</code><code class="n">X</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-5" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-6"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>             </code><code class="n">DL_RMSE</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                                     </code><code class="n">DL_predict</code><code class="o">.</code><code class="n">flatten</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-6" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-7"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>             </code><code class="n">DL_pred</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">DL_predict</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">DL_RMSE_{}:{:.6f}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">i</code><code class="o">+</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">DL_RMSE</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">DL_RMSE_1</code><code class="p">:</code><code class="mf">0.000551</code><code>&#13;
</code><code>         </code><code class="n">DL_RMSE_2</code><code class="p">:</code><code class="mf">0.000714</code><code>&#13;
</code><code>         </code><code class="n">DL_RMSE_3</code><code class="p">:</code><code class="mf">0.000627</code><code>&#13;
</code><code>         </code><code class="n">DL_RMSE_4</code><code class="p">:</code><code class="mf">0.000739</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">65</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">DL_predict</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">DL_pred</code><code class="p">[</code><code class="n">DL_RMSE</code><code class="o">.</code><code class="n">index</code><code class="p">(</code><code class="nb">min</code><code class="p">(</code><code class="n">DL_RMSE</code><code class="p">)</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">DL_predict</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">66</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Realized Volatility</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">DL_predict</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Volatility Prediction-DL</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Volatility Prediction with Deep Learning</code><code class="s1">'</code><code class="p">,</code><code>  </code><code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Configuring the network structure by deciding number of layers and neurons</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Compiling the model with loss and optimizer</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-3" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Deciding the epoch and batch size using <code>np.arange</code></p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-5" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Fitting the deep learning model</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-6" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Predicting the volatility based on the weights obtained from the training phase</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-7" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO8-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Calculating the RMSE score by flattening the predictions</p></dd>&#13;
</dl>&#13;
&#13;
<p>It turns out that we get a minimum RMSE score when we have epoch number and batch size of 100. This shows that increasing the complexity of the model does not necessarily imply high predictive performance. The key is to find a sweet spot between complexity and predictive performance. Otherwise, the model can easily tend to overfit.</p>&#13;
&#13;
<p><a data-type="xref" href="#DL_vol">Figure 4-12</a> shows the volatility prediction result derived from the preceding code, and it implies that deep learning provides a strong tool for modeling volatility, too.<a data-primary="" data-startref="ix_nns_volatil_predict" data-type="indexterm" id="idm45737237024640"/><a data-primary="" data-startref="ix_volatil_predict_nns" data-type="indexterm" id="idm45737237023696"/><a data-primary="" data-startref="ix_deep_learn_volatil" data-type="indexterm" id="idm45737237022752"/></p>&#13;
&#13;
<figure><div class="figure" id="DL_vol">&#13;
<img alt="DL" src="assets/mlfr_0412.png"/>&#13;
<h6><span class="label">Figure 4-12. </span>Volatility prediction with deep learning</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Bayesian Approach" data-type="sect1"><div class="sect1" id="idm45737237937216">&#13;
<h1>The Bayesian Approach</h1>&#13;
&#13;
<p><a data-primary="volatility prediction" data-secondary="Bayesian approach" data-type="indexterm" id="ix_volatil_predict_bayesian"/><a data-primary="ML (machine learning)" data-secondary="Bayesian approach" data-type="indexterm" id="ix_ml_bayes_approach_ch4"/><a data-primary="probability approaches" data-secondary="volatility prediction" data-type="indexterm" id="ix_probab_volatil_predict"/><a data-primary="Bayesian approach" data-secondary="volatility prediction" data-type="indexterm" id="ix_bayes_volatil_predict"/><a data-primary="Frequentist (classical) approach to probability" data-type="indexterm" id="idm45737236903616"/>The way we approach probability is of central importance in the sense that it distinguishes the classical (or Frequentist) and Bayesian approaches. According to the former, the relative frequency will converge to the true probability. However, a Bayesian application is based on the subjective interpretation. Unlike the Frequentists, Bayesian statisticians consider the probability distribution as uncertain, and it is revised as new information comes in.</p>&#13;
&#13;
<p><a data-primary="likelihood function, classical versus Bayesian" data-type="indexterm" id="idm45737236902112"/>Due to the different interpretation in the probability of these two approaches, <em>likelihood</em>—defined as the probability of an observed event given a set of parameters—is computed differently.</p>&#13;
&#13;
<p>Starting from the joint density function, we can give the mathematical representation of the likelihood function:</p>&#13;
<div data-type="equation">&#13;
<math alttext="script upper L left-parenthesis theta vertical-bar x 1 comma x 2 comma period period period comma x Subscript p Baseline right-parenthesis equals probability left-parenthesis x 1 comma x 2 comma period period period comma x Subscript p Baseline vertical-bar theta right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <mi>ℒ</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>θ</mi>&#13;
      <mo>|</mo>&#13;
      <msub><mi>x</mi> <mn>1</mn> </msub>&#13;
      <mo>,</mo>&#13;
      <msub><mi>x</mi> <mn>2</mn> </msub>&#13;
      <mo>,</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>,</mo>&#13;
      <msub><mi>x</mi> <mi>p</mi> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msub><mi>x</mi> <mn>1</mn> </msub>&#13;
      <mo>,</mo>&#13;
      <msub><mi>x</mi> <mn>2</mn> </msub>&#13;
      <mo>,</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>,</mo>&#13;
      <msub><mi>x</mi> <mi>p</mi> </msub>&#13;
      <mo>|</mo>&#13;
      <mi>θ</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Among possible <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math> values, what we are trying to do is  decide which one is more likely. Under the statistical model proposed by the likelihood function, the observed data <math alttext="x 1 comma period period period comma x Subscript p Baseline">&#13;
  <mrow>&#13;
    <msub><mi>x</mi> <mn>1</mn> </msub>&#13;
    <mo>,</mo>&#13;
    <mo>.</mo>&#13;
    <mo>.</mo>&#13;
    <mo>.</mo>&#13;
    <mo>,</mo>&#13;
    <msub><mi>x</mi> <mi>p</mi> </msub>&#13;
  </mrow>&#13;
</math> is the most probable.</p>&#13;
&#13;
<p><a data-primary="likelihood function, classical versus Bayesian" data-type="indexterm" id="idm45737236871088"/>In fact, you are familiar with the method based on this approach, <a data-primary="maximum likelihood estimation" data-type="indexterm" id="idm45737236870288"/>which is maximum likelihood estimation. Having defined the main difference between Bayesian and Frequentist approaches, it is time to delve more into Bayes’ theorem.</p>&#13;
&#13;
<p><a data-primary="Bayes' theorem" data-type="indexterm" id="ix_bayes_theorem"/><a data-primary="Bayesian approach" data-secondary="volatility prediction" data-tertiary="Bayes' theorem" data-type="indexterm" id="ix_bayesian_volatil_predict_theorem"/><a data-primary="conditional distribution, Bayesian approach" data-type="indexterm" id="idm45737236866560"/>The Bayesian approach is based on conditional distribution, which states that probability gauges the extent to which one has about a uncertain event. So the Bayesian application suggests a rule that can be used to update the beliefs that one holds in light of new information:</p>&#13;
<blockquote data-type="epigram">&#13;
<p>&#13;
Bayesian estimation is used when we have some prior information regarding a parameter. For example, before looking at a sample to estimate the mean of a distribution, we may have some prior belief that it is close to 2, between 1 and 3. Such prior beliefs are especially important when we have a small sample. In such a case, we are interested in combining what the data tells us, namely, the value calculated from the sample, and our prior information.</p>&#13;
<p data-type="attribution"> Rachev et al., 2008 </p>&#13;
</blockquote>&#13;
&#13;
<p><a data-primary="Frequentist (classical) approach to probability" data-type="indexterm" id="idm45737236862928"/>Similar to the Frequentist application, Bayesian estimation is based on <a data-primary="probability density, Bayes’ theorem" data-type="indexterm" id="idm45737236861968"/>probability density <math alttext="probability left-parenthesis x vertical-bar theta right-parenthesis">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mo>(</mo>&#13;
    <mi>x</mi>&#13;
    <mo>|</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math>. However, as we have discussed previously, Bayesian and Frequentist methods treat parameter set <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math> differently. A Frequentist assumes <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math> to be fixed, whereas in a Bayesian setting, <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math> is taken as a random variable whose probability is known as <a data-primary="prior density, Bayes’ theorem" data-type="indexterm" id="idm45737236841568"/>prior density <math alttext="probability left-parenthesis theta right-parenthesis">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mo>(</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math>. Well, we have another unknown term, but no worries—it is easy to understand.</p>&#13;
&#13;
<p>In light of this information, we can estimate <math alttext="script upper L left-parenthesis x vertical-bar theta right-parenthesis">&#13;
  <mrow>&#13;
    <mi>ℒ</mi>&#13;
    <mo>(</mo>&#13;
    <mi>x</mi>&#13;
    <mo>|</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> using prior density <math alttext="probability left-parenthesis theta right-parenthesis">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mo>(</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> and come up with the following formula. Prior is employed when we need to estimate the conditional distribution of the parameters given observations:</p>&#13;
<div data-type="equation">&#13;
<math alttext="probability left-parenthesis theta vertical-bar x 1 comma x 2 comma period period period comma x Subscript p Baseline right-parenthesis equals StartFraction script upper L left-parenthesis x 1 comma x 2 comma period period period comma x Subscript p Baseline vertical-bar theta right-parenthesis probability left-parenthesis theta right-parenthesis Over probability left-parenthesis x 1 comma x 2 comma period period period comma x Subscript p Baseline right-parenthesis EndFraction" display="block">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>θ</mi>&#13;
      <mo>|</mo>&#13;
      <msub><mi>x</mi> <mn>1</mn> </msub>&#13;
      <mo>,</mo>&#13;
      <msub><mi>x</mi> <mn>2</mn> </msub>&#13;
      <mo>,</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>,</mo>&#13;
      <msub><mi>x</mi> <mi>p</mi> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mfrac><mrow><mi>ℒ</mi><mrow><mo>(</mo><msub><mi>x</mi> <mn>1</mn> </msub><mo>,</mo><msub><mi>x</mi> <mn>2</mn> </msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi> <mi>p</mi> </msub><mo>|</mo><mi>θ</mi><mo>)</mo></mrow><mo form="prefix">Pr</mo><mrow><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mrow> <mrow><mo form="prefix">Pr</mo><mo>(</mo><msub><mi>x</mi> <mn>1</mn> </msub><mo>,</mo><msub><mi>x</mi> <mn>2</mn> </msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><msub><mi>x</mi> <mi>p</mi> </msub><mo>)</mo></mrow></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>or</p>&#13;
<div data-type="equation">&#13;
<math alttext="probability left-parenthesis theta vertical-bar d a t a right-parenthesis equals StartFraction script upper L left-parenthesis d a t a vertical-bar theta right-parenthesis probability left-parenthesis theta right-parenthesis Over probability left-parenthesis d a t a right-parenthesis EndFraction" display="block">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>θ</mi>&#13;
      <mo>|</mo>&#13;
      <mi>d</mi>&#13;
      <mi>a</mi>&#13;
      <mi>t</mi>&#13;
      <mi>a</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mfrac><mrow><mi>ℒ</mi><mo>(</mo><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mo>|</mo><mi>θ</mi><mo>)</mo><mo form="prefix">Pr</mo><mo>(</mo><mi>θ</mi><mo>)</mo></mrow> <mrow><mo form="prefix">Pr</mo><mo>(</mo><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mo>)</mo></mrow></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><math alttext="probability left-parenthesis theta vertical-bar d a t a right-parenthesis">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mo>(</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>|</mo>&#13;
    <mi>d</mi>&#13;
    <mi>a</mi>&#13;
    <mi>t</mi>&#13;
    <mi>a</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> is the <a data-primary="posterior density, Bayes’ theorem" data-type="indexterm" id="idm45737236787888"/>posterior density, which gives us information about the parameters given observed data.</p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="script upper L left-parenthesis d a t a vertical-bar theta right-parenthesis">&#13;
  <mrow>&#13;
    <mi>ℒ</mi>&#13;
    <mo>(</mo>&#13;
    <mi>d</mi>&#13;
    <mi>a</mi>&#13;
    <mi>t</mi>&#13;
    <mi>a</mi>&#13;
    <mo>|</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> is the likelihood function, which estimates the probability of the data given parameters.</p>&#13;
</li>&#13;
<li>&#13;
<p><math alttext="probability left-parenthesis theta right-parenthesis">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mo>(</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> is prior probability. It is the probability of the parameters. Prior is basically the initial beliefs about estimates.</p>&#13;
</li>&#13;
<li>&#13;
<p>Finally, <math alttext="probability">&#13;
  <mo form="prefix">Pr</mo>&#13;
</math> is the evidence, which is used to update the prior.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Consequently, Bayes’ theorem suggests that the posterior density is directly proportional to the prior and likelihood terms but inverserly related to the evidence term. As the evidence is there for scaling, we can describe this process as:</p>&#13;
<div data-type="equation">&#13;
<math alttext="Posterior proportional-to Likelihood times prior" display="block">&#13;
  <mrow>&#13;
    <mtext>Posterior</mtext>&#13;
    <mo>∝</mo>&#13;
    <mtext>Likelihood</mtext>&#13;
    <mo>×</mo>&#13;
    <mtext>prior</mtext>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <math alttext="proportional-to">&#13;
  <mo>∝</mo>&#13;
</math> means “is proportional to.”</p>&#13;
&#13;
<p>Within this context, Bayes’ theorem sounds attractive, doesn’t it? Well, it does, but it comes with a cost, which is analytical intractability. Even if Bayes’ theorem is theoretically intuitive, it is, by and large, hard to solve analytically. This is the major drawback in wide applicability of Bayes’ theorem. However, the good news is that numerical methods provide solid methods to solve this probabilistic model.</p>&#13;
&#13;
<p>Some methods proposed to deal with the computational issues in Bayes’ theorem provide solutions with approximation, including:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Quadrature approximation</p>&#13;
</li>&#13;
<li>&#13;
<p>Maximum a posteriori estimation (MAP) (discussed in <a data-type="xref" href="ch06.html#chapter_6">Chapter 6</a>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Grid approach</p>&#13;
</li>&#13;
<li>&#13;
<p>Sampling-based approach</p>&#13;
</li>&#13;
<li>&#13;
<p>Metropolis–Hastings</p>&#13;
</li>&#13;
<li>&#13;
<p>Gibbs sampler</p>&#13;
</li>&#13;
<li>&#13;
<p>No U-Turn sampler</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Of these approaches, let us restrict our attention to the Metropolis–Hastings algorithm (M-H), which will be our method for modeling Bayes’ theorem. The M-H method rests on the Markov chain Monte Carlo (MCMC) method. So before moving forward, let’s talk about the MCMC method.<a data-primary="" data-startref="ix_bayesian_volatil_predict_theorem" data-type="indexterm" id="idm45737236761456"/><a data-primary="" data-startref="ix_bayes_theorem" data-type="indexterm" id="idm45737236760608"/></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Markov Chain Monte Carlo" data-type="sect2"><div class="sect2" id="idm45737236759632">&#13;
<h2>Markov Chain Monte Carlo</h2>&#13;
&#13;
<p><a data-primary="MCMC (Markov chain Monte Carlo) method" data-type="indexterm" id="ix_mcmc_method"/><a data-primary="Bayesian approach" data-secondary="volatility prediction" data-tertiary="Markov chain Monte Carlo" data-type="indexterm" id="ix_bayesian_volatil_predict_mcmc"/>The Markov chain is a model used to describe the transition probabilities among states. A chain is called <em>Markovian</em> if the probability of the current state <math alttext="s Subscript t">&#13;
  <msub><mi>s</mi> <mi>t</mi> </msub>&#13;
</math> depends only on the most recent state <math alttext="s Subscript t minus 1">&#13;
  <msub><mi>s</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
</math>:</p>&#13;
<div data-type="equation">&#13;
<math alttext="probability left-parenthesis s Subscript t Baseline vertical-bar s Subscript t minus 1 Baseline comma s Subscript t minus 2 Baseline comma period period period comma s Subscript t minus p Baseline right-parenthesis equals probability left-parenthesis s Subscript t Baseline vertical-bar s Subscript t minus 1 Baseline right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msub><mi>s</mi> <mi>t</mi> </msub>&#13;
      <mo>|</mo>&#13;
      <msub><mi>s</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
      <mo>,</mo>&#13;
      <msub><mi>s</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
      <mo>,</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>.</mo>&#13;
      <mo>,</mo>&#13;
      <msub><mi>s</mi> <mrow><mi>t</mi><mo>-</mo><mi>p</mi></mrow> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msub><mi>s</mi> <mi>t</mi> </msub>&#13;
      <mo>|</mo>&#13;
      <msub><mi>s</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Thus, MCMC relies on the Markov chain to find the parameter space <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math> with the highest posterior probability. <a data-primary="posterior density, Bayes’ theorem" data-type="indexterm" id="idm45737236729520"/>As the sample size grows, parameter values approximate to the posterior density:</p>&#13;
<div data-type="equation">&#13;
<math alttext="limit Underscript j right-arrow plus normal infinity Endscripts theta Superscript j Baseline right-arrow Overscript upper D Endscripts probability left-parenthesis theta vertical-bar x right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <munder><mo form="prefix" movablelimits="true">lim</mo> <mrow><mi>j</mi><mo>→</mo><mo>+</mo><mi>∞</mi></mrow> </munder>&#13;
    <msup><mi>θ</mi> <mi>j</mi> </msup>&#13;
    <mover><mo>→</mo> <mi>D</mi></mover>&#13;
    <mo form="prefix">Pr</mo>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>θ</mi>&#13;
      <mo>|</mo>&#13;
      <mi>x</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>D</em> refers to distributional approximation. Realized values of parameter space can be used to make inferences about the posterior. In a nutshell, the MCMC method helps us gather <a data-primary="IID (identically and independently distributed) assumption" data-type="indexterm" id="idm45737236717600"/>IID samples from posterior density so that we can calculate the posterior probability.</p>&#13;
&#13;
<p>To illustrate this, we can refer to <a data-type="xref" href="#mc_states">Figure 4-13</a>. This figure shows the probability of moving from one state to another. For the sake of simplicity, we’ll set the probability to be 0.2, indicating that the transition from “studying” to “sleeping” has a probability of 0.2:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">67</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">quantecon</code> <code class="kn">as</code> <code class="nn">qe</code>&#13;
         <code class="kn">from</code> <code class="nn">quantecon</code> <code class="kn">import</code> <code class="n">MarkovChain</code>&#13;
         <code class="kn">import</code> <code class="nn">networkx</code> <code class="kn">as</code> <code class="nn">nx</code>&#13;
         <code class="kn">from</code> <code class="nn">pprint</code> <code class="kn">import</code> <code class="n">pprint</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">68</code><code class="p">]:</code> <code class="n">P</code> <code class="o">=</code> <code class="p">[[</code><code class="mf">0.5</code><code class="p">,</code> <code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.3</code><code class="p">],</code>&#13;
              <code class="p">[</code><code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.3</code><code class="p">,</code> <code class="mf">0.5</code><code class="p">],</code>&#13;
              <code class="p">[</code><code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.6</code><code class="p">]]</code>&#13;
&#13;
         <code class="n">mc</code> <code class="o">=</code> <code class="n">qe</code><code class="o">.</code><code class="n">MarkovChain</code><code class="p">(</code><code class="n">P</code><code class="p">,</code> <code class="p">(</code><code class="s1">'studying'</code><code class="p">,</code> <code class="s1">'travelling'</code><code class="p">,</code> <code class="s1">'sleeping'</code><code class="p">))</code>&#13;
         <code class="n">mc</code><code class="o">.</code><code class="n">is_irreducible</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">68</code><code class="p">]:</code> <code class="bp">True</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">69</code><code class="p">]:</code> <code class="n">states</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'studying'</code><code class="p">,</code> <code class="s1">'travelling'</code><code class="p">,</code> <code class="s1">'sleeping'</code><code class="p">]</code>&#13;
         <code class="n">initial_probs</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.5</code><code class="p">,</code> <code class="mf">0.3</code><code class="p">,</code> <code class="mf">0.6</code><code class="p">]</code>&#13;
         <code class="n">state_space</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">Series</code><code class="p">(</code><code class="n">initial_probs</code><code class="p">,</code> <code class="n">index</code><code class="o">=</code><code class="n">states</code><code class="p">,</code> <code class="n">name</code><code class="o">=</code><code class="s1">'states'</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">70</code><code class="p">]:</code> <code class="n">q_df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="n">states</code><code class="p">,</code> <code class="n">index</code><code class="o">=</code><code class="n">states</code><code class="p">)</code>&#13;
         <code class="n">q_df</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="n">states</code><code class="p">,</code> <code class="n">index</code><code class="o">=</code><code class="n">states</code><code class="p">)</code>&#13;
         <code class="n">q_df</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">states</code><code class="p">[</code><code class="mi">0</code><code class="p">]]</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.5</code><code class="p">,</code> <code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.3</code><code class="p">]</code>&#13;
         <code class="n">q_df</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">states</code><code class="p">[</code><code class="mi">1</code><code class="p">]]</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.3</code><code class="p">,</code> <code class="mf">0.5</code><code class="p">]</code>&#13;
         <code class="n">q_df</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">states</code><code class="p">[</code><code class="mi">2</code><code class="p">]]</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.2</code><code class="p">,</code> <code class="mf">0.6</code><code class="p">]</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">71</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">_get_markov_edges</code><code class="p">(</code><code class="n">Q</code><code class="p">):</code>&#13;
             <code class="n">edges</code> <code class="o">=</code> <code class="p">{}</code>&#13;
             <code class="k">for</code> <code class="n">col</code> <code class="ow">in</code> <code class="n">Q</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code>&#13;
                 <code class="k">for</code> <code class="n">idx</code> <code class="ow">in</code> <code class="n">Q</code><code class="o">.</code><code class="n">index</code><code class="p">:</code>&#13;
                     <code class="n">edges</code><code class="p">[(</code><code class="n">idx</code><code class="p">,</code><code class="n">col</code><code class="p">)]</code> <code class="o">=</code> <code class="n">Q</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">idx</code><code class="p">,</code><code class="n">col</code><code class="p">]</code>&#13;
             <code class="k">return</code> <code class="n">edges</code>&#13;
         <code class="n">edges_wts</code> <code class="o">=</code> <code class="n">_get_markov_edges</code><code class="p">(</code><code class="n">q_df</code><code class="p">)</code>&#13;
         <code class="n">pprint</code><code class="p">(</code><code class="n">edges_wts</code><code class="p">)</code>&#13;
         <code class="p">{(</code><code class="s1">'sleeping'</code><code class="p">,</code> <code class="s1">'sleeping'</code><code class="p">):</code> <code class="mf">0.6</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'sleeping'</code><code class="p">,</code> <code class="s1">'studying'</code><code class="p">):</code> <code class="mf">0.2</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'sleeping'</code><code class="p">,</code> <code class="s1">'travelling'</code><code class="p">):</code> <code class="mf">0.2</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'studying'</code><code class="p">,</code> <code class="s1">'sleeping'</code><code class="p">):</code> <code class="mf">0.3</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'studying'</code><code class="p">,</code> <code class="s1">'studying'</code><code class="p">):</code> <code class="mf">0.5</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'studying'</code><code class="p">,</code> <code class="s1">'travelling'</code><code class="p">):</code> <code class="mf">0.2</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'travelling'</code><code class="p">,</code> <code class="s1">'sleeping'</code><code class="p">):</code> <code class="mf">0.5</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'travelling'</code><code class="p">,</code> <code class="s1">'studying'</code><code class="p">):</code> <code class="mf">0.2</code><code class="p">,</code>&#13;
          <code class="p">(</code><code class="s1">'travelling'</code><code class="p">,</code> <code class="s1">'travelling'</code><code class="p">):</code> <code class="mf">0.3</code><code class="p">}</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">72</code><code class="p">]:</code> <code class="n">G</code> <code class="o">=</code> <code class="n">nx</code><code class="o">.</code><code class="n">MultiDiGraph</code><code class="p">()</code>&#13;
         <code class="n">G</code><code class="o">.</code><code class="n">add_nodes_from</code><code class="p">(</code><code class="n">states</code><code class="p">)</code>&#13;
         <code class="k">for</code> <code class="n">k</code><code class="p">,</code> <code class="n">v</code> <code class="ow">in</code> <code class="n">edges_wts</code><code class="o">.</code><code class="n">items</code><code class="p">():</code>&#13;
             <code class="n">tmp_origin</code><code class="p">,</code> <code class="n">tmp_destination</code> <code class="o">=</code> <code class="n">k</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">k</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>&#13;
             <code class="n">G</code><code class="o">.</code><code class="n">add_edge</code><code class="p">(</code><code class="n">tmp_origin</code><code class="p">,</code> <code class="n">tmp_destination</code><code class="p">,</code> <code class="n">weight</code><code class="o">=</code><code class="n">v</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="n">v</code><code class="p">)</code>&#13;
&#13;
         <code class="n">pos</code> <code class="o">=</code> <code class="n">nx</code><code class="o">.</code><code class="n">drawing</code><code class="o">.</code><code class="n">nx_pydot</code><code class="o">.</code><code class="n">graphviz_layout</code><code class="p">(</code><code class="n">G</code><code class="p">,</code> <code class="n">prog</code><code class="o">=</code><code class="s1">'dot'</code><code class="p">)</code>&#13;
         <code class="n">nx</code><code class="o">.</code><code class="n">draw_networkx</code><code class="p">(</code><code class="n">G</code><code class="p">,</code> <code class="n">pos</code><code class="p">)</code>&#13;
         <code class="n">edge_labels</code> <code class="o">=</code> <code class="p">{(</code><code class="n">n1</code><code class="p">,</code> <code class="n">n2</code><code class="p">):</code><code class="n">d</code><code class="p">[</code><code class="s1">'label'</code><code class="p">]</code> <code class="k">for</code> <code class="n">n1</code><code class="p">,</code> <code class="n">n2</code><code class="p">,</code> <code class="n">d</code> <code class="ow">in</code> <code class="n">G</code><code class="o">.</code><code class="n">edges</code><code class="p">(</code><code class="n">data</code><code class="o">=</code><code class="bp">True</code><code class="p">)}</code>&#13;
         <code class="n">nx</code><code class="o">.</code><code class="n">draw_networkx_edge_labels</code><code class="p">(</code><code class="n">G</code> <code class="p">,</code> <code class="n">pos</code><code class="p">,</code> <code class="n">edge_labels</code><code class="o">=</code><code class="n">edge_labels</code><code class="p">)</code>&#13;
         <code class="n">nx</code><code class="o">.</code><code class="n">drawing</code><code class="o">.</code><code class="n">nx_pydot</code><code class="o">.</code><code class="n">write_dot</code><code class="p">(</code><code class="n">G</code><code class="p">,</code> <code class="s1">'mc_states.dot'</code><code class="p">)</code></pre>&#13;
&#13;
<figure><div class="figure" id="mc_states">&#13;
<img alt="mc_states" src="assets/mlfr_0413.png"/>&#13;
<h6><span class="label">Figure 4-13. </span>Interactions of different states</h6>&#13;
</div></figure>&#13;
&#13;
<p>There are two common MCMC methods: M–H and <a data-primary="Gibbs sampler" data-type="indexterm" id="idm45737236678480"/>Gibbs sampler. Here, we delve into the former.<a data-primary="" data-startref="ix_bayesian_volatil_predict_mcmc" data-type="indexterm" id="idm45737236677584"/><a data-primary="" data-startref="ix_mcmc_method" data-type="indexterm" id="idm45737236676576"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Metropolis–Hastings" data-type="sect2"><div class="sect2" id="idm45737236759040">&#13;
<h2>Metropolis–Hastings</h2>&#13;
&#13;
<p><a data-primary="M-H (Metropolis–Hastings) algorithm for MCMC" data-type="indexterm" id="ix_m-h_method"/><a data-primary="Bayesian approach" data-secondary="volatility prediction" data-tertiary="Metropolis–Hasting method" data-type="indexterm" id="ix_bayesian_volatil_predict_m-h"/>M-H allows us to have an efficient sampling procedure with two steps. <a data-primary="proposal density, M-H method" data-type="indexterm" id="idm45737236133488"/>First, we draw a sample from proposal density, then we decide either to accept or reject it.</p>&#13;
&#13;
<p>Let <math alttext="q left-parenthesis theta vertical-bar theta Superscript t minus 1 Baseline right-parenthesis">&#13;
  <mrow>&#13;
    <mi>q</mi>&#13;
    <mo>(</mo>&#13;
    <mi>θ</mi>&#13;
    <mo>|</mo>&#13;
    <msup><mi>θ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msup>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> be a proposal density and <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math> be a parameter space. The entire algorithm of M-H can be summarized as:</p>&#13;
<ol class="pagebreak-before less_space">&#13;
<li>&#13;
<p>Select initial value for <math alttext="theta Superscript 1">&#13;
  <msup><mi>θ</mi> <mn>1</mn> </msup>&#13;
</math> from parameter space <math alttext="theta">&#13;
  <mi>θ</mi>&#13;
</math>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Select a new parameter value <math alttext="theta squared">&#13;
  <msup><mi>θ</mi> <mn>2</mn> </msup>&#13;
</math> from proposal density, which can be, for the sake of easiness, Gaussian or uniform distribution.</p>&#13;
</li>&#13;
<li>&#13;
<p>Compute the following acceptance probability:</p>&#13;
<div data-type="equation">&#13;
<math alttext="probability Underscript a Endscripts left-parenthesis theta Superscript asterisk Baseline comma theta Superscript t minus 1 Baseline right-parenthesis equals m i n left-parenthesis 1 comma StartFraction p left-parenthesis theta Superscript asterisk Baseline right-parenthesis slash q left-parenthesis theta Superscript asterisk Baseline vertical-bar theta Superscript t minus 1 Baseline right-parenthesis Over p left-parenthesis theta Superscript t minus 1 Baseline right-parenthesis slash q left-parenthesis theta Superscript t minus 1 Baseline vertical-bar theta Superscript asterisk Baseline right-parenthesis EndFraction right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <msub><mo form="prefix">Pr</mo> <mi>a</mi> </msub>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msup><mi>θ</mi> <mo>*</mo> </msup>&#13;
      <mo>,</mo>&#13;
      <msup><mi>θ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msup>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mi>m</mi>&#13;
    <mi>i</mi>&#13;
    <mi>n</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mn>1</mn>&#13;
      <mo>,</mo>&#13;
      <mfrac><mrow><mi>p</mi><mrow><mo>(</mo><msup><mi>θ</mi> <mo>*</mo> </msup><mo>)</mo></mrow><mo>/</mo><mi>q</mi><mrow><mo>(</mo><msup><mi>θ</mi> <mo>*</mo> </msup><mo>|</mo><msup><mi>θ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msup><mo>)</mo></mrow></mrow> <mrow><mi>p</mi><mrow><mo>(</mo><msup><mi>θ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msup><mo>)</mo></mrow><mo>/</mo><mi>q</mi><mrow><mo>(</mo><msup><mi>θ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msup><mo>|</mo><msup><mi>θ</mi> <mo>*</mo> </msup><mo>)</mo></mrow></mrow></mfrac>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
</li>&#13;
<li>&#13;
<p>If <math alttext="probability Underscript a Endscripts left-parenthesis theta Superscript asterisk Baseline comma theta Superscript t minus 1 Baseline right-parenthesis">&#13;
  <mrow>&#13;
    <msub><mo form="prefix">Pr</mo> <mi>a</mi> </msub>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msup><mi>θ</mi> <mo>*</mo> </msup>&#13;
      <mo>,</mo>&#13;
      <msup><mi>θ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msup>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math> is greater than a sample value drawn from uniform distribution U(0,1), repeat this process from step 2.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>Well, it appears intimidating, but don’t worry; we have built-in code in Python that makes the applicability of the M-H algorithm much easier. <a data-primary="PyFlux library" data-type="indexterm" id="idm45737236079264"/>We use the PyFlux library to make use of Bayes’ theorem. Let’s apply the M-H algorithm to predict volatility:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">73</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">pyflux</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pf</code><code>&#13;
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">scipy.stats</code><code> </code><code class="kn">import</code><code> </code><code class="n">kurtosis</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">74</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">pf</code><code class="o">.</code><code class="n">GARCH</code><code class="p">(</code><code class="n">ret</code><code class="o">.</code><code class="n">values</code><code class="p">,</code><code> </code><code class="n">p</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">q</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="n">model</code><code class="o">.</code><code class="n">latent_variables</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">adjust_prior</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">pf</code><code class="o">.</code><code class="n">Normal</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">adjust_prior</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">pf</code><code class="o">.</code><code class="n">Normal</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-3" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-4"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">x</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">method</code><code class="o">=</code><code class="s1">'</code><code class="s1">M-H</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">iterations</code><code class="o">=</code><code class="s1">'</code><code class="s1">1000</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-4" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-5"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="n">x</code><code class="o">.</code><code class="n">summary</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Index</code><code>    </code><code class="n">Latent</code><code> </code><code class="n">Variable</code><code>           </code><code class="n">Prior</code><code>           </code><code class="n">Prior</code><code> </code><code class="n">Hyperparameters</code><code>&#13;
</code><code>            </code><code class="n">V</code><code class="o">.</code><code class="n">I</code><code class="o">.</code><code> </code><code class="n">Dist</code><code>  </code><code class="n">Transform</code><code>&#13;
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code> </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code> </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>&#13;
</code><code>          </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code> </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code> </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>         </code><code class="mi">0</code><code>        </code><code class="n">Vol</code><code> </code><code class="n">Constant</code><code>              </code><code class="n">Normal</code><code>          </code><code class="n">mu0</code><code class="p">:</code><code> </code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">sigma0</code><code class="p">:</code><code> </code><code class="mi">3</code><code>&#13;
</code><code>            </code><code class="n">Normal</code><code>     </code><code class="n">exp</code><code>&#13;
</code><code>         </code><code class="mi">1</code><code>        </code><code class="n">q</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code>                      </code><code class="n">Normal</code><code>          </code><code class="n">mu0</code><code class="p">:</code><code> </code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">sigma0</code><code class="p">:</code><code> </code><code class="mf">0.5</code><code>&#13;
</code><code>            </code><code class="n">Normal</code><code>     </code><code class="n">logit</code><code>&#13;
</code><code>         </code><code class="mi">2</code><code>        </code><code class="n">p</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code>                      </code><code class="n">Normal</code><code>          </code><code class="n">mu0</code><code class="p">:</code><code> </code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">sigma0</code><code class="p">:</code><code> </code><code class="mf">0.5</code><code>&#13;
</code><code>            </code><code class="n">Normal</code><code>     </code><code class="n">logit</code><code>&#13;
</code><code>         </code><code class="mi">3</code><code>        </code><code class="n">Returns</code><code> </code><code class="n">Constant</code><code>          </code><code class="n">Normal</code><code>          </code><code class="n">mu0</code><code class="p">:</code><code> </code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">sigma0</code><code class="p">:</code><code> </code><code class="mi">3</code><code>&#13;
</code><code>            </code><code class="n">Normal</code><code>     </code><code class="bp">None</code><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.0023</code><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.23925</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Tuning</code><code> </code><code class="n">complete</code><code class="err">!</code><code> </code><code class="n">Now</code><code> </code><code class="n">sampling</code><code class="o">.</code><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.239175</code><code>&#13;
</code><code>         </code><code class="n">GARCH</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>&#13;
</code><code>          </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>         </code><code class="n">Dependent</code><code> </code><code class="n">Variable</code><code class="p">:</code><code> </code><code class="n">Series</code><code>                          </code><code class="n">Method</code><code class="p">:</code><code> </code><code class="n">Metropolis</code><code>&#13;
</code><code>          </code><code class="n">Hastings</code><code>&#13;
</code><code>         </code><code class="n">Start</code><code> </code><code class="n">Date</code><code class="p">:</code><code> </code><code class="mi">1</code><code>                                       </code><code class="n">Unnormalized</code><code> </code><code class="n">Log</code><code>&#13;
</code><code>          </code><code class="n">Posterior</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">3635.1348</code><code>&#13;
</code><code>         </code><code class="n">End</code><code> </code><code class="n">Date</code><code class="p">:</code><code> </code><code class="mi">2913</code><code>                                      </code><code class="n">AIC</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">7278.269645045323</code><code>&#13;
</code><code>         </code><code class="n">Number</code><code> </code><code class="n">of</code><code> </code><code class="n">observations</code><code class="p">:</code><code> </code><code class="mi">2913</code><code>                        </code><code class="n">BIC</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">7302.177400073161</code><code>&#13;
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>          </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>         </code><code class="n">Latent</code><code> </code><code class="n">Variable</code><code>                          </code><code class="n">Median</code><code>             </code><code class="n">Mean</code><code>&#13;
</code><code>              </code><code class="mi">95</code><code class="o">%</code><code> </code><code class="n">Credibility</code><code> </code><code class="n">Interval</code><code>&#13;
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code> </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>          </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code> </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>&#13;
</code><code>         </code><code class="n">Vol</code><code> </code><code class="n">Constant</code><code>                             </code><code class="mf">0.04</code><code>               </code><code class="mf">0.0398</code><code>&#13;
</code><code>              </code><code class="p">(</code><code class="mf">0.0315</code><code> </code><code class="o">|</code><code> </code><code class="mf">0.0501</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">q</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code>                                     </code><code class="mf">0.1936</code><code>             </code><code class="mf">0.194</code><code>&#13;
</code><code>              </code><code class="p">(</code><code class="mf">0.1638</code><code> </code><code class="o">|</code><code> </code><code class="mf">0.2251</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">p</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code>                                     </code><code class="mf">0.7736</code><code>             </code><code class="mf">0.7737</code><code>&#13;
</code><code>              </code><code class="p">(</code><code class="mf">0.7438</code><code> </code><code class="o">|</code><code> </code><code class="mf">0.8026</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">Returns</code><code> </code><code class="n">Constant</code><code>                         </code><code class="mf">0.0866</code><code>             </code><code class="mf">0.0855</code><code>&#13;
</code><code>              </code><code class="p">(</code><code class="mf">0.0646</code><code> </code><code class="o">|</code><code> </code><code class="mf">0.1038</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>          </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>         </code><code class="bp">None</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">75</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">plot_z</code><code class="p">(</code><code class="p">[</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-5" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-6"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">plot_fit</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">15</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-6" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-7"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">plot_ppc</code><code class="p">(</code><code class="n">T</code><code class="o">=</code><code class="n">kurtosis</code><code class="p">,</code><code> </code><code class="n">nsims</code><code class="o">=</code><code class="mi">1000</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-7" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-8"><img alt="7" src="assets/7.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Configuring GARCH model using the PyFlux library</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Printing the estimation of latent variables (parameters)</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-3" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Adjusting the priors for the model latent variables</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-5" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Fitting the model using M-H process</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-6" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Plotting the latent variables</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-7" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Plotting the fitted model</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-8" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO9-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Plotting the histogram for posterior check</p></dd>&#13;
</dl>&#13;
&#13;
<p class="pagebreak-before less_space"><a data-primary="GARCH model" data-secondary="based on Bayesian approach" data-type="indexterm" id="idm45737235734912"/>It is worthwhile to visualize the results of what we have done so far for volatility prediction with a Bayesian-based GARCH Model.</p>&#13;
&#13;
<p><a data-type="xref" href="#latent_variable_vol">Figure 4-14</a> exhibits the distribution of latent variables. Latent variable <em>q</em> gathers around 0.2, and the other latent variable, <em>p</em>, mostly takes values between 0.7 and 0.8.</p>&#13;
&#13;
<figure><div class="figure" id="latent_variable_vol">&#13;
<img alt="latent_variable" src="assets/mlfr_0414.png"/>&#13;
<h6><span class="label">Figure 4-14. </span>Latent variables</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-type="xref" href="#model_fit_vol">Figure 4-15</a> indicates the demeaned volatility series and the GARCH prediction result based on the Bayesian approach.</p>&#13;
&#13;
<figure><div class="figure" id="model_fit_vol">&#13;
<img alt="model_fit" src="assets/mlfr_0415.png"/>&#13;
<h6><span class="label">Figure 4-15. </span>Model fit</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-type="xref" href="#posterior_predict_vol">Figure 4-16</a> visualizes the <a data-primary="posterior density, Bayes’ theorem" data-type="indexterm" id="idm45737233548480"/>posterior predictions of the Bayesian model with the data so that we are able to detect systematic discrepancies, if any. The vertical line represents the test statistic, and it turns out the observed value is larger than that of our model.</p>&#13;
&#13;
<figure><div class="figure" id="posterior_predict_vol">&#13;
<img alt="posterior_predict" src="assets/mlfr_0416.png"/>&#13;
<h6><span class="label">Figure 4-16. </span>Posterior prediction</h6>&#13;
</div></figure>&#13;
&#13;
<p>After we are done with the training part, we are all set to move on to the next phase, which is prediction. Prediction analysis is done for the 252 steps ahead, and the RMSE is calculated given the realized volatility:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">76</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">bayesian_prediction</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict_is</code><code class="p">(</code><code class="n">n</code><code class="p">,</code><code> </code><code class="n">fit_method</code><code class="o">=</code><code class="s1">'</code><code class="s1">M-H</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-1" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.11515</code><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.1787</code><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.2675</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">Tuning</code><code> </code><code class="n">complete</code><code class="err">!</code><code> </code><code class="n">Now</code><code> </code><code class="n">sampling</code><code class="o">.</code><code>&#13;
</code><code>         </code><code class="n">Acceptance</code><code> </code><code class="n">rate</code><code> </code><code class="n">of</code><code> </code><code class="n">Metropolis</code><code class="o">-</code><code class="n">Hastings</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.2579</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">77</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">bayesian_RMSE</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">mse</code><code class="p">(</code><code class="n">realized_vol</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                                  </code><code class="n">bayesian_prediction</code><code class="o">.</code><code class="n">values</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-2" id="co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">The RMSE of Bayesian model is {:.6f}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">bayesian_RMSE</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">RMSE</code><code> </code><code class="n">of</code><code> </code><code class="n">Bayesian</code><code> </code><code class="n">model</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.004047</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">78</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">bayesian_prediction</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">ret</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="n">n</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">index</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-1" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>In-sample volatility prediction</p></dd>&#13;
<dt><a class="co" href="#co_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-2" id="callout_machine_learning_based___span_class__keep_together__volatility_prediction__span__CO10-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Calculating the RMSE score</p></dd>&#13;
</dl>&#13;
&#13;
<p>Eventually, we are ready to observe the prediction result of the Bayesian approach, and the following code does it for us, generating <a data-type="xref" href="#bayesian_predict_vol">Figure 4-17</a>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">79</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">realized_vol</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                  <code class="n">label</code><code class="o">=</code><code class="s1">'Realized Volatility'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">bayesian_prediction</code><code class="p">[</code><code class="s1">'Series'</code><code class="p">]</code> <code class="o">/</code> <code class="mi">100</code><code class="p">,</code>&#13;
                  <code class="n">label</code><code class="o">=</code><code class="s1">'Volatility Prediction-Bayesian'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'Volatility Prediction with M-H Approach'</code><code class="p">,</code> <code class="n">fontsize</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">()</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="bayesian_predict_vol">&#13;
<img alt="bayesian" src="assets/mlfr_0417.png"/>&#13;
<h6><span class="label">Figure 4-17. </span>Bayesian volatility prediction</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-type="xref" href="#bayesian_predict_vol">Figure 4-17</a> visualizes the volatility prediction based on an M-H–based Bayesian approach, and it seems to overshoot toward the end of 2020. The overall performance of this method shows that it is not among the best methods.<a data-primary="" data-startref="ix_bayes_volatil_predict" data-type="indexterm" id="idm45737235068944"/><a data-primary="" data-startref="ix_ml_bayes_approach_ch4" data-type="indexterm" id="idm45737235067984"/><a data-primary="" data-startref="ix_probab_volatil_predict" data-type="indexterm" id="idm45737235067024"/><a data-primary="" data-startref="ix_volatil_predict_bayesian" data-type="indexterm" id="idm45737235066064"/><a data-primary="" data-startref="ix_bayesian_volatil_predict_m-h" data-type="indexterm" id="idm45737235065104"/><a data-primary="" data-startref="ix_m-h_method" data-type="indexterm" id="idm45737235064144"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45737235062816">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>Volatility prediction is a key to understanding the dynamics of the financial market in the sense that it helps us to gauge uncertainty. With that being said, it is used as input in many financial models, including risk models. These facts emphasize the importance of having accurate volatility prediction. Traditionally, parametric methods such as ARCH, GARCH, and their extensions have been extensively used, but these &#13;
<span class="keep-together">models</span> suffer from being inflexible. To remedy this issue, data-driven models are &#13;
<span class="keep-together">promising</span>, and this chapter attempted to make use of these models, namely, SVMs, NNs, and deep learning-based models. It turns out that the data-driven models outperform the parametric models.<a data-primary="" data-startref="ix_volatil_predict_ch4" data-type="indexterm" id="idm45737235309728"/></p>&#13;
&#13;
<p>In the next chapter, market risk, a core financial risk topic, will be discussed both from theoretical and empirical standpoints, and the ML models will be incorporated to further improve the estimation of this risk.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="References" data-type="sect1"><div class="sect1" id="idm45737235307872">&#13;
<h1>References</h1>&#13;
&#13;
<p>Articles cited in this chapter:</p>&#13;
&#13;
<ul class="author-date-bib">&#13;
<li>&#13;
<p>Andersen, Torben G., Tim Bollerslev, Francis X. Diebold, and Paul Labys. 2003. “Modeling and Forecasting Realized Volatility.” <em>Econometrica</em> 71 (2): 579-625.</p>&#13;
</li>&#13;
<li>&#13;
<p>Andersen, Torben G., and Tim Bollerslev. 1997. “Intraday Periodicity And Volatility Persistence in Financial Markets.” <em>Journal of Empirical Finance</em> 4 (2-3): 115-158.</p>&#13;
</li>&#13;
<li>&#13;
<p>Black, Fischer. 1976. “Studies of Stock Market Volatility Changes.” <em>1976 Proceedings of the American Statistical Association Business and Economic Statistics Section</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Bollerslev, T. 1986. “Generalized Autoregressive Conditional  Heteroskedasticity.” <em>Journal of Econometrics</em> 31 (3): 307-327.&#13;
3): 542-547.</p>&#13;
</li>&#13;
<li>&#13;
<p>Burnham, Kenneth P., and David R. Anderson. 2004. “Multimodel Inference: Understanding AIC and BIC in Model Selection.” <em>Sociological Methods and Research</em> 33 (2): 261-304.</p>&#13;
</li>&#13;
<li>&#13;
<p>Eagle, Robert F. 1982. “Autoregressive Conditional Heteroskedasticity with Estimates of the Variance of UK Inflation.” <em>Econometrica</em> 50 (4): 987-1008.</p>&#13;
</li>&#13;
<li>&#13;
<p>De Stefani, Jacopo, Olivier Caelen, Dalila Hattab, and Gianluca Bontempi. 2017. “Machine Learning for Multi-step Ahead Forecasting of Volatility Proxies.” MIDAS@ PKDD/ECML, 17-28.</p>&#13;
</li>&#13;
<li>&#13;
<p>Dokuchaev, Nikolai. 2014. “Volatility Estimation from Short Time Series of Stock Prices.” Journal of Nonparametric Statistics 26 (2): 373-384.</p>&#13;
</li>&#13;
<li>&#13;
<p>Glosten, L. R., R. Jagannathan, and D. E. Runkle 1993. “On the Relation between the Expected Value and the Volatility of the Nominal Excess Return on Stocks.” <em>The Journal of Finance</em> 48 (5): 1779-1801.</p>&#13;
</li>&#13;
<li>&#13;
<p>Karasan, Abdullah, and Esma Gaygisiz. 2020. “Volatility Prediction and Risk Management: An SVR-GARCH Approach.” <em>The Journal of Financial Data Science</em> 2 (4): 85-104.</p>&#13;
</li>&#13;
<li>&#13;
<p>Mandelbrot, Benoit. 1963. “New Methods in Statistical Economics.” Journal of Political Economy 71 (5): 421-440.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<ul class="pagebreak-before less_space author-date-bib">&#13;
<li>&#13;
<p>Nelson, Daniel B. 1991. Conditional Heteroskedasticity in Asset Returns: A New Approach. <em>Econometrica</em> 59 (2): 347-370.</p>&#13;
</li>&#13;
<li>&#13;
<p>Raju, M. T., and Anirban Ghosh. 2004. “Stock Market Volatility: An International Comparison.” Securities and Exchange Board of India.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Books cited in this chapter:</p>&#13;
&#13;
<ul class="author-date-bib">&#13;
<li>&#13;
<p>Alpaydin, E. 2020. <em>Introduction to Machine Learning</em>. Cambridge: MIT press.</p>&#13;
</li>&#13;
<li>&#13;
<p>Burnham, Kenneth P., and David R. Anderson. 2002. <em>Model Selection and Multimodel Inference: A Practical Information-Theoretic Approach</em>. New York: Springer-Verlag.</p>&#13;
</li>&#13;
<li>&#13;
<p>Focardi, Sergio M. 1997. <em>Modeling the Market: New Theories and Techniques</em>. The Frank J. Fabozzi Series, Vol. 14. New York: John Wiley and Sons.</p>&#13;
</li>&#13;
<li>&#13;
<p>Rachev, Svetlozar T., John SJ Hsu, Biliana S. Bagasheva, and Frank J. Fabozzi. 2012. <em>Bayesian Methods in Finance</em>. New York: John Wiley and Sons.</p>&#13;
</li>&#13;
<li>&#13;
<p>Taylor, S. 1986. <em>Modeling Financial Time Series</em>. Chichester: Wiley.</p>&#13;
</li>&#13;
<li>&#13;
<p>Wilmott, Paul. 2019. <em>Machine Learning: An Applied Mathematics Introduction</em>. Panda Ohana Publishing.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45737244123312"><sup><a href="ch04.html#idm45737244123312-marker">1</a></sup> Conditional variance means that volatility estimation is a function of the past values of asset returns.</p><p data-type="footnote" id="idm45737239187584"><sup><a href="ch04.html#idm45737239187584-marker">2</a></sup> For more information on these functions, see Andrew Ng’s <a href="https://oreil.ly/sTWGj">lecture notes</a>.</p><p data-type="footnote" id="idm45737238525200"><sup><a href="ch04.html#idm45737238525200-marker">3</a></sup> Occam’s razor, also known as law of parsimony, states that given a set of explanations, simpler explanation is the most plausible and likely one.</p><p data-type="footnote" id="idm45737237868960"><sup><a href="ch04.html#idm45737237868960-marker">4</a></sup> Of these alternatives, TensorFlow, PyTorch, and NeuroLab are the most prominent libraries.</p><p data-type="footnote" id="idm45737237767616"><sup><a href="ch04.html#idm45737237767616-marker">5</a></sup> For more detailed information, please see the <a href="https://oreil.ly/HnrTk"><code>MLPClassifier</code> documentation</a>.</p></div></div></section></body></html>