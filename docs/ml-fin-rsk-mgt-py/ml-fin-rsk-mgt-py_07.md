# ç¬¬äº”ç« ã€‚å»ºæ¨¡å¸‚åœºé£é™©

> åŸºäºå†å²æ•°æ®é©±åŠ¨çš„é£é™©åº¦é‡å‡è®¾æœªæ¥ä¼šéµå¾ªè¿‡å»çš„æ¨¡å¼ã€‚ä½ éœ€è¦ç†è§£è¿™ç§å‡è®¾çš„å±€é™æ€§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦å»ºæ¨¡é‚£äº›è¿™ç§æ¨¡å¼ä¼šå´©æºƒçš„åœºæ™¯ã€‚
> 
> è¿ˆå°”æ–¯Â·è‚¯å°¼è¿ª

é£é™©åœ¨é‡‘èä¸­æ— å¤„ä¸åœ¨ï¼Œä½†éš¾ä»¥é‡åŒ–ã€‚é¦–è¦çš„æ˜¯è¦çŸ¥é“å¦‚ä½•åŒºåˆ†é‡‘èé£é™©çš„æ¥æºï¼Œå› ä¸ºä½¿ç”¨ç›¸åŒçš„å·¥å…·åº”å¯¹æ¥è‡ªä¸åŒæ¥æºçš„é£é™©å¯èƒ½å¹¶ä¸æ˜æ™ºã€‚

å› æ­¤ï¼ŒåŒºåˆ«å¯¹å¾…é‡‘èé£é™©çš„å„ç§æ¥æºè‡³å…³é‡è¦ï¼Œå› ä¸ºè¿™äº›ä¸åŒé£é™©çš„å½±å“ä»¥åŠç”¨äºå‡è½»å®ƒä»¬çš„å·¥å…·æ˜¯å®Œå…¨ä¸åŒçš„ã€‚å‡è®¾å…¬å¸é¢ä¸´ç€å¤§å¹…å¸‚åœºæ³¢åŠ¨ï¼Œé‚£ä¹ˆå…¶æŠ•èµ„ç»„åˆä¸­çš„æ‰€æœ‰èµ„äº§éƒ½å®¹æ˜“å—åˆ°è¿™äº›æ³¢åŠ¨å¸¦æ¥çš„é£é™©å½±å“ã€‚ç„¶è€Œï¼Œåº”å¼€å‘å‡ºä¸åŒçš„å·¥å…·æ¥åº”å¯¹æºè‡ªå®¢æˆ·èµ„æ–™çš„é£é™©ã€‚æ­¤å¤–ï¼Œè¯·è®°ä½ï¼Œä¸åŒçš„é£é™©å› ç´ å¯¹èµ„äº§ä»·æ ¼çš„è´¡çŒ®éå¸¸æ˜¾è‘—ã€‚æ‰€æœ‰è¿™äº›ä¾‹å­éƒ½è¡¨æ˜ï¼Œåœ¨é‡‘èé¢†åŸŸå¤„ç†é£é™©å› ç´ éœ€è¦ä»”ç»†è€ƒè™‘ã€‚

æ­£å¦‚å‰é¢ç®€è¦è®¨è®ºè¿‡çš„é‚£æ ·ï¼Œè¿™äº›é£é™©ä¸»è¦æ˜¯å¸‚åœºé£é™©ã€ä¿¡ç”¨é£é™©ã€æµåŠ¨æ€§é£é™©å’Œæ“ä½œé£é™©ã€‚æ˜¾ç„¶ï¼Œè¿˜å¯ä»¥æ·»åŠ å…¶ä»–ç±»å‹ï¼Œä½†å¯ä»¥å°†å®ƒä»¬è§†ä¸ºè¿™å››ç§ä¸»è¦é£é™©ç±»å‹çš„åˆ†æ”¯ï¼Œè¿™å°†æ˜¯æœ¬ç« çš„é‡ç‚¹ã€‚

*å¸‚åœºé£é™©*æ˜¯æŒ‡ç”±é‡‘èæŒ‡æ ‡å˜åŒ–å¼•èµ·çš„é£é™©ï¼Œä¾‹å¦‚æ±‡ç‡ã€åˆ©ç‡ã€é€šè´§è†¨èƒ€ç­‰ã€‚å¸‚åœºé£é™©å¯ä»¥è¢«å®šä¹‰ä¸ºåœ¨èµ„äº§è´Ÿå€ºè¡¨å’Œéèµ„äº§è´Ÿå€ºè¡¨å¤´å¯¸ä¸­ç”±å¸‚åœºä»·æ ¼æ³¢åŠ¨å¼•èµ·çš„æŸå¤±é£é™©ï¼ˆBIS 2020ï¼‰ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›å› ç´ å¦‚ä½•å½±å“å¸‚åœºé£é™©ã€‚å‡è®¾é€šè´§è†¨èƒ€ç‡ä¸Šå‡å¯¹é‡‘èæœºæ„å½“å‰çš„ç›ˆåˆ©èƒ½åŠ›æ„æˆå¨èƒï¼Œå› ä¸ºé€šè´§è†¨èƒ€ä¼šå¯¹åˆ©ç‡æ–½åŠ å‹åŠ›ï¼Œè¿™åè¿‡æ¥å½±å“å€Ÿæ¬¾äººçš„èµ„é‡‘æˆæœ¬ã€‚è¿™äº›å®ä¾‹å¯èƒ½ä¼šè¢«æ”¾å¤§ï¼Œä½†æˆ‘ä»¬è¿˜åº”æ³¨æ„è¿™äº›é‡‘èé£é™©æ¥æºä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªé‡‘èé£é™©æ¥æºå˜åŒ–æ—¶ï¼Œå…¶ä»–é£é™©æ¥æºä¸èƒ½ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œé‡‘èæŒ‡æ ‡æ˜¯ç›¸äº’å…³è”çš„ï¼Œè¿™æ„å‘³ç€è¿™äº›é£é™©æ¥æºçš„ç›¸äº’ä½œç”¨åº”è¯¥è¢«è€ƒè™‘è¿›å»ã€‚

å¦‚ä½ æ‰€æƒ³è±¡çš„é‚£æ ·ï¼Œæœ‰ä¸åŒçš„å·¥å…·æ¥ç®¡ç†å¸‚åœºé£é™©ã€‚å…¶ä¸­ï¼Œæœ€æ˜¾è‘—å’Œå¹¿æ³›æ¥å—çš„å·¥å…·æ˜¯ä»·å€¼-at-riskï¼ˆVaRï¼‰å’Œé¢„æœŸç¼ºå¤±ï¼ˆESï¼‰ã€‚æœ¬ç« çš„æœ€ç»ˆç›®æ ‡æ˜¯åˆ©ç”¨æœºå™¨å­¦ä¹ çš„æœ€æ–°å‘å±•æ¥å¢å¼ºè¿™äº›æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œå¼•äººå…¥èƒœåœ°æå‡ºä»¥ä¸‹é—®é¢˜å¯èƒ½ä¼šå¾ˆè¯±äººï¼š

+   ä¼ ç»Ÿæ¨¡å‹åœ¨é‡‘èä¸­å¤±è´¥äº†å—ï¼Ÿ

+   æœºå™¨å­¦ä¹ æ¨¡å‹çš„ç‹¬ç‰¹ä¹‹å¤„æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘å°†ä»è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜å¼€å§‹ã€‚ä¼ ç»Ÿæ¨¡å‹æ— æ³•è§£å†³çš„é¦–è¦æŒ‘æˆ˜æ˜¯é‡‘èç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ç”±äºæŸäº›å¼ºçƒˆçš„å‡è®¾æˆ–è€…ç®€å•åœ°æ— æ³•æ•æ‰æ•°æ®å¼•å…¥çš„å¤æ‚æ€§ï¼Œé•¿æœŸä»¥æ¥çš„ä¼ ç»Ÿæ¨¡å‹å¼€å§‹è¢«åŸºäºæœºå™¨å­¦ä¹ çš„æ¨¡å‹æ‰€å–ä»£ã€‚

Pradoï¼ˆ2020 å¹´ï¼‰ç”ŸåŠ¨åœ°è¡¨è¾¾äº†è¿™ä¸€äº‹å®ï¼š

> è€ƒè™‘åˆ°ç°ä»£é‡‘èç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œç ”ç©¶äººå‘˜ä¸å¤ªå¯èƒ½é€šè¿‡å¯¹æ•°æ®çš„è§†è§‰æ£€æŸ¥æˆ–è¿è¡Œå‡ ä¸ªå›å½’åˆ†ææ¥æ­ç¤ºç†è®ºçš„æ„æˆè¦ç´ ã€‚

è¦è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ™ºæ…§ä¹‹ä¸¾åº”æ˜¯æ€è€ƒæœºå™¨å­¦ä¹ æ¨¡å‹çš„å·¥ä½œé€»è¾‘ã€‚ä¸æ—§ç»Ÿè®¡æ–¹æ³•ç›¸å¯¹ï¼Œæœºå™¨å­¦ä¹ æ¨¡å‹è¯•å›¾æ­ç¤ºå˜é‡ä¹‹é—´çš„å…³è”ï¼Œè¯†åˆ«å…³é”®å˜é‡ï¼Œå¹¶ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‰¾å‡ºè¿™äº›å˜é‡å¯¹å› å˜é‡çš„å½±å“ï¼Œè€Œæ— éœ€ä¸€ä¸ªå®Œå¤‡çš„ç†è®ºæ”¯æŒã€‚è¿™å®é™…ä¸Šæ˜¯æœºå™¨å­¦ä¹ æ¨¡å‹ä¹‹ç¾ï¼Œå› ä¸ºå®ƒä»¬è®©æˆ‘ä»¬èƒ½å¤Ÿå‘ç°ç†è®ºï¼Œè€Œä¸æ˜¯ä¾èµ–äºç†è®ºï¼š

> ç»Ÿè®¡å­¦å’Œæœºå™¨å­¦ä¹ ä¸­çš„è®¸å¤šæ–¹æ³•ï¼ŒåŸåˆ™ä¸Šæ—¢å¯ç”¨äºé¢„æµ‹ä¹Ÿå¯ç”¨äºæ¨æ–­ã€‚ç„¶è€Œï¼Œç»Ÿè®¡æ–¹æ³•é•¿æœŸä»¥æ¥ä¸“æ³¨äºæ¨æ–­ï¼Œè¿™æ˜¯é€šè¿‡åˆ›å»ºå’Œæ‹Ÿåˆç‰¹å®šäºé¡¹ç›®çš„æ¦‚ç‡æ¨¡å‹æ¥å®ç°çš„...
> 
> ç›¸æ¯”ä¹‹ä¸‹ï¼Œæœºå™¨å­¦ä¹ é›†ä¸­äºåˆ©ç”¨é€šç”¨å­¦ä¹ ç®—æ³•åœ¨é€šå¸¸æ˜¯ä¸°å¯Œä¸”éš¾ä»¥å¤„ç†çš„æ•°æ®ä¸­æ‰¾å‡ºæ¨¡å¼æ¥è¿›è¡Œé¢„æµ‹ã€‚
> 
> Bzdokï¼ˆ2018 å¹´ï¼Œç¬¬ 232 é¡µï¼‰

åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†å¼€å§‹è®¨è®ºå¸‚åœºé£é™©æ¨¡å‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†è®¨è®º VaR å’Œ ES æ¨¡å‹çš„åº”ç”¨ã€‚åœ¨è®¨è®ºè¿™äº›ä¼ ç»Ÿæ¨¡å‹çš„åº”ç”¨åï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•é€šè¿‡é‡‡ç”¨åŸºäºæœºå™¨å­¦ä¹ çš„æ–¹æ³•æ¥æ”¹è¿›å®ƒä»¬ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

# é£é™©ä»·å€¼ï¼ˆVaRï¼‰

VaR æ¨¡å‹èµ·æºäºä¸€ä½ J.P.æ‘©æ ¹çš„é«˜ç®¡æå‡ºçš„è¦æ±‚ï¼Œä»–å¸Œæœ›æœ‰ä¸€ä»½æ±‡æ€»æŠ¥å‘Šï¼Œæ˜¾ç¤º J.P.æ‘©æ ¹åœ¨æŸä¸€å¤©å¯èƒ½é¢ä¸´çš„æŸå¤±ä»¥åŠé£é™©ã€‚è¿™ä»½æŠ¥å‘Šå°†å‘é«˜ç®¡ä»¬å±•ç¤ºæœºæ„æ‰¿æ‹…çš„èšåˆé£é™©ã€‚è®¡ç®—å¸‚åœºé£é™©çš„æ–¹æ³•è¢«ç§°ä¸º VaRã€‚è¿™ä»½æŠ¥å‘Šæ˜¯ VaR çš„èµ·ç‚¹ï¼Œç°åœ¨å®ƒå·²ç»å¦‚æ­¤æ™®åŠï¼Œä¸ä»…æœºæ„å–œæ¬¢ä½¿ç”¨ VaRï¼Œç›‘ç®¡æœºæ„ä¹Ÿè¦æ±‚å…¶é‡‡ç”¨ã€‚

VaR çš„é‡‡ç”¨å¯ä»¥è¿½æº¯åˆ°ä¸Šä¸–çºª 90 å¹´ä»£ï¼Œå°½ç®¡å®ƒå·²ç»æœ‰äº†è®¸å¤šæ‰©å±•å’Œæ–°æå‡ºçš„æ¨¡å‹ï¼Œä½†ä»åœ¨ä½¿ç”¨ä¸­ã€‚å®ƒæœ‰ä½•å¸å¼•åŠ›ï¼Ÿç­”æ¡ˆæ¥è‡ª Kevin Dowdï¼ˆ2002 å¹´ï¼Œç¬¬ 10 é¡µï¼‰ï¼š

> VaR æ•°å­—æœ‰ä¸¤ä¸ªé‡è¦ç‰¹å¾ã€‚é¦–å…ˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè·¨ä¸åŒå¤´å¯¸å’Œé£é™©å› ç´ çš„é£é™©çš„å¸¸è§ä¸€è‡´åº¦æµ‹é‡ã€‚å®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿè¡¡é‡ä¸å›ºå®šæ”¶ç›Šå¤´å¯¸ç›¸å…³çš„é£é™©ï¼Œæ¯”å¦‚ä»¥ä¸è‚¡ç¥¨å¤´å¯¸ç›¸å…³çš„é£é™©è¡¡é‡ç›¸æ¯”è¾ƒä¸”ä¿æŒä¸€è‡´ã€‚VaR ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¸¸è§çš„é£é™©æ ‡å°ºï¼Œè€Œè¿™ä¸ªæ ‡å°ºä½¿æœºæ„èƒ½å¤Ÿä»¥ä¹‹å‰ä¸å¯èƒ½çš„æ–°æ–¹å¼æ¥ç®¡ç†é£é™©ã€‚VaR çš„å¦ä¸€ä¸ªç‰¹å¾æ˜¯å®ƒè€ƒè™‘äº†ä¸åŒé£é™©å› ç´ ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å¦‚æœä¸¤ä¸ªé£é™©ç›¸äº’æŠµæ¶ˆï¼ŒVaR å…è®¸è¿™ç§æŠµæ¶ˆå¹¶å‘Šè¯‰æˆ‘ä»¬æ€»ä½“é£é™©ç›¸å½“ä½ã€‚

å®é™…ä¸Šï¼ŒVaR å›ç­”äº†æŠ•èµ„è€…æœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€ï¼š*æˆ‘çš„æŠ•èµ„çš„æœ€å¤§é¢„æœŸæŸå¤±æ˜¯å¤šå°‘ï¼Ÿ*

VaR ä¸ºè¿™ä¸ªé—®é¢˜æä¾›äº†ä¸€ä¸ªéå¸¸ç›´è§‚å’Œå®ç”¨çš„ç­”æ¡ˆã€‚åœ¨è¿™æ–¹é¢ï¼Œå®ƒç”¨äºè¡¡é‡å…¬å¸åœ¨ç»™å®šæœŸé—´å’Œé¢„å®šä¹‰ç½®ä¿¡åŒºé—´å†…çš„æœ€åé¢„æœŸæŸå¤±ã€‚å‡è®¾æŸé¡¹æŠ•èµ„çš„æ—¥ VaR ä¸º$1 millionï¼Œå¹¶ä¸”ç½®ä¿¡åŒºé—´ä¸º 95%ã€‚è¿™æ„å‘³ç€æœ‰ 5%çš„æœºä¼šï¼ŒæŠ•èµ„è€…å¯èƒ½ä¼šåœ¨ä¸€å¤©å†…é­å—è¶…è¿‡$1 million çš„æŸå¤±ã€‚

æ ¹æ®è¿™ä¸€å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®š VaR çš„ç»„æˆéƒ¨åˆ†æ˜¯ç½®ä¿¡åŒºé—´ã€æ—¶é—´æ®µã€èµ„äº§æˆ–æŠ•èµ„ç»„åˆçš„ä»·å€¼ä»¥åŠæ ‡å‡†åå·®ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨è°ˆè®ºé£é™©ã€‚

æ€»ç»“æ¥è¯´ï¼Œåœ¨ VaR åˆ†æä¸­éœ€è¦å¼ºè°ƒä¸€äº›é‡è¦ç‚¹ï¼š

+   VaR éœ€è¦ä¼°è®¡æŸå¤±çš„æ¦‚ç‡ã€‚

+   VaR é›†ä¸­åœ¨æ½œåœ¨çš„æŸå¤±ä¸Šã€‚æˆ‘ä»¬è°ˆè®ºçš„ä¸æ˜¯å®é™…çš„æˆ–å·²å®ç°çš„æŸå¤±ï¼›ç›¸åï¼ŒVaR æ˜¯ä¸€ç§æŸå¤±é¢„æµ‹ã€‚

+   VaR æœ‰ä¸‰ä¸ªå…³é”®è¦ç´ ï¼š

    +   å®šä¹‰æŸå¤±æ°´å¹³çš„æ ‡å‡†åå·®ã€‚

    +   å›ºå®šçš„æ—¶é—´è·¨åº¦ç”¨äºè¯„ä¼°é£é™©ã€‚

    +   ç½®ä¿¡åŒºé—´ã€‚

VaR å¯ä»¥é€šè¿‡ä¸‰ç§ä¸åŒçš„æ–¹æ³•æ¥è¡¡é‡ï¼š

+   æ–¹å·®-åæ–¹å·® VaR

+   å†å²æ¨¡æ‹Ÿ VaR

+   è’™ç‰¹å¡æ´› VaR

## æ–¹å·®-åæ–¹å·®æ–¹æ³•

æ–¹å·®-åæ–¹å·®æ–¹æ³•ä¹Ÿè¢«ç§°ä¸º*å‚æ•°*æ–¹æ³•ï¼Œå› ä¸ºå‡è®¾è§‚å¯Ÿå€¼æœä»æ­£æ€åˆ†å¸ƒã€‚æ–¹å·®-åæ–¹å·®æ–¹æ³•åœ¨å›æŠ¥è¢«è®¤ä¸ºæ˜¯æ­£æ€åˆ†å¸ƒæ—¶å¾ˆæ™®éã€‚å‚æ•°å½¢å¼çš„å‡è®¾ä½¿å¾—æ–¹å·®-åæ–¹å·®æ–¹æ³•çš„åº”ç”¨å˜å¾—å®¹æ˜“ã€‚

å°±åƒæ‰€æœ‰çš„ VaR æ–¹æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ä¸€èµ„äº§æˆ–æŠ•èµ„ç»„åˆã€‚ç„¶è€Œï¼Œä½¿ç”¨æŠ•èµ„ç»„åˆéœ€è¦ä»”ç»†å¤„ç†ï¼Œå› ä¸ºéœ€è¦ä¼°è®¡ç›¸å…³ç»“æ„å’ŒæŠ•èµ„ç»„åˆæ–¹å·®ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç›¸å…³æ€§å˜å¾—é‡è¦ï¼Œå¹¶ä¸”ä½¿ç”¨å†å²æ•°æ®æ¥è®¡ç®—ç›¸å…³æ€§ã€å‡å€¼å’Œæ ‡å‡†åå·®ã€‚åœ¨ç”¨ ML æ–¹æ³•å¢å¼ºæ—¶ï¼Œç›¸å…³ç»“æ„å°†æ˜¯æˆ‘ä»¬çš„ä¸»è¦å…³æ³¨ç‚¹ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”±å•ä¸€èµ„äº§ç»„æˆçš„æŠ•èµ„ç»„åˆï¼Œå¦‚å›¾ 5-1 æ‰€ç¤ºã€‚æ˜¾ç¤ºè¯¥èµ„äº§çš„å›æŠ¥ä¸ºé›¶ï¼Œæ ‡å‡†å·®ä¸º 1ï¼Œå¦‚æœæŒæœ‰æœŸä¸º 1ï¼Œåˆ™å¯ä»¥é€šè¿‡è¯¥èµ„äº§çš„ä»·å€¼å’Œç›¸åº”çš„ Z å€¼ä»¥åŠæ ‡å‡†å·®è®¡ç®—ç›¸åº”çš„ VaR å€¼ã€‚å› æ­¤ï¼Œæ­£æ€æ€§å‡è®¾ä½¿äº‹æƒ…å˜å¾—æ›´å®¹æ˜“ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¼ºå‡è®¾ï¼Œå› ä¸ºä¸èƒ½ä¿è¯èµ„äº§å›æŠ¥æœä»æ­£æ€åˆ†å¸ƒï¼›ç›¸åï¼Œå¤§å¤šæ•°èµ„äº§å›æŠ¥å¹¶ä¸æœä»æ­£æ€åˆ†å¸ƒã€‚æ­¤å¤–ï¼Œç”±äºæ­£æ€æ€§å‡è®¾ï¼Œå¯èƒ½æ— æ³•æ•æ‰åˆ°å°¾éƒ¨çš„æ½œåœ¨é£é™©ã€‚å› æ­¤ï¼Œæ­£æ€æ€§å‡è®¾æ˜¯æœ‰ä»£ä»·çš„ã€‚å‚è§ä»¥ä¸‹å†…å®¹ï¼š

```py
In [1]: import pandas as pd
        import numpy as np
        import matplotlib.pyplot as plt
        import datetime
        import yfinance as yf
        from scipy.stats import norm
        import requests
        from io import StringIO
        import seaborn as sns; sns.set()
        import warnings
        warnings.filterwarnings('ignore')
        plt.rcParams['figure.figsize'] = (10,6)

In [2]: mean = 0
        std_dev = 1
        x = np.arange(-5, 5, 0.01)
        y = norm.pdf(x, mean, std_dev)
        pdf = plt.plot(x, y)
        min_ylim, max_ylim = plt.ylim()
        plt.text(np.percentile(x, 5), max_ylim * 0.9, '95%:${:.4f}'
                 .format(np.percentile(x, 5)))
        plt.axvline(np.percentile(x, 5), color='r', linestyle='dashed',
                    linewidth=4)
        plt.title('Value at Risk Illustration')
        plt.show()
In [3]: mean = 0
        std_dev = 1
        x = np.arange(-5, 5, 0.01)
        y = norm.pdf(x, mean, std_dev) ![1](img/1.png)
        pdf = plt.plot(x, y)
        min_ylim, max_ylim = plt.ylim() ![2](img/2.png)
        plt.text(np.percentile(x, 5), max_ylim * 0.9, '95%:${:.4f}'
                 .format(np.percentile(x, 5))) ![3](img/3.png)
        plt.axvline(np.percentile(x, 5), color='r', linestyle='dashed',
                    linewidth=4)
        plt.title('Value at Risk Illustration')
        plt.show()
```

![1](img/#co_modeling_market_risk_CO1-1)

åŸºäºç»™å®šçš„`x`ã€å‡å€¼å’Œæ ‡å‡†å·®ç”Ÿæˆæ¦‚ç‡å¯†åº¦å‡½æ•°

![2](img/#co_modeling_market_risk_CO1-2)

é™åˆ¶ x è½´å’Œ y è½´

![3](img/#co_modeling_market_risk_CO1-3)

æŒ‡å®š`x`ä½äº`x`æ•°æ®çš„ 5%åˆ†ä½æ•°çš„ä½ç½®

![VaR_illustration](img/mlfr_0501.png)

###### å›¾ 5-1\. VaR æ’å›¾

###### æ³¨æ„

æ ¹æ® Famaï¼ˆ1965ï¼‰çš„ç ”ç©¶ï¼Œç”±äºåšå°¾å’Œä¸å¯¹ç§°æ€§ï¼Œè‚¡ç¥¨ä»·æ ¼å›æŠ¥å¹¶ä¸æœä»æ­£æ€åˆ†å¸ƒã€‚è¿™ä¸€å®è¯è§‚å¯Ÿæ„å‘³ç€è‚¡ç¥¨å›æŠ¥çš„å³°åº¦é«˜äºæ­£æ€åˆ†å¸ƒã€‚

é«˜å³°åº¦å¯¹åº”äºåšå°¾ï¼Œè¿™èƒ½å¤Ÿæ•æ‰æç«¯è´Ÿå›æŠ¥ã€‚ç”±äºæ–¹å·®-åæ–¹å·®æ–¹æ³•æ— æ³•æ•æ‰åšå°¾ï¼Œå› æ­¤æ— æ³•ä¼°è®¡å¯èƒ½å‘ç”Ÿçš„æç«¯è´Ÿå›æŠ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å±æœºæœŸé—´ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ Python ä¸­åº”ç”¨æ–¹å·®-åæ–¹å·® VaRã€‚ä¸ºäº†è¯´æ˜ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªåŒèµ„äº§ç»„åˆã€‚æ–¹å·®-åæ–¹å·® VaR çš„å…¬å¼å¦‚ä¸‹ï¼š

<math alttext="dollar-sign VaR equals upper V sigma Subscript p Baseline StartRoot t EndRoot upper Z Subscript alpha Baseline dollar-sign"><mrow><mtext>VaR</mtext> <mo>=</mo> <mi>V</mi> <msub><mi>Ïƒ</mi> <mi>p</mi></msub> <msqrt><mi>t</mi></msqrt> <msub><mi>Z</mi> <mi>Î±</mi></msub></mrow></math><math alttext="dollar-sign sigma Subscript p Baseline equals StartRoot w 1 squared sigma 1 squared plus w 2 squared sigma 2 squared plus rho w 1 w 2 sigma 1 sigma 2 EndRoot dollar-sign"><mrow><msub><mi>Ïƒ</mi> <mi>p</mi></msub> <mo>=</mo> <msqrt><mrow><msubsup><mi>w</mi> <mn>1</mn> <mn>2</mn></msubsup> <msubsup><mi>Ïƒ</mi> <mn>1</mn> <mn>2</mn></msubsup> <mo>+</mo> <msubsup><mi>w</mi> <mn>2</mn> <mn>2</mn></msubsup> <msubsup><mi>Ïƒ</mi> <mn>2</mn> <mn>2</mn></msubsup> <mo>+</mo> <mi>Ï</mi> <msub><mi>w</mi> <mn>1</mn></msub> <msub><mi>w</mi> <mn>2</mn></msub> <msub><mi>Ïƒ</mi> <mn>1</mn></msub> <msub><mi>Ïƒ</mi> <mn>2</mn></msub></mrow></msqrt></mrow></math><math alttext="dollar-sign sigma Subscript p Baseline equals StartRoot w 1 sigma 1 plus w 2 plus sigma plus 2 w 1 w 2 sigma-summation Underscript 1 comma 2 Endscripts EndRoot dollar-sign"><mrow><msub><mi>Ïƒ</mi> <mi>p</mi></msub> <mo>=</mo> <msqrt><mrow><msub><mi>w</mi> <mn>1</mn></msub> <msub><mi>Ïƒ</mi> <mn>1</mn></msub> <mo>+</mo> <msub><mi>w</mi> <mn>2</mn></msub> <mo>+</mo> <mi>Ïƒ</mi> <mo>+</mo> <mn>2</mn> <msub><mi>w</mi> <mn>1</mn></msub> <msub><mi>w</mi> <mn>2</mn></msub> <msub><mo>âˆ‘</mo> <mrow><mn>1</mn><mo>,</mo><mn>2</mn></mrow></msub></mrow></msqrt></mrow></math>

è¦åœ¨ä»£ç ä¸­åº”ç”¨æ­¤æ–¹æ³•ï¼Œæˆ‘ä»¬ä»ä»¥ä¸‹å†…å®¹å¼€å§‹ï¼š

```py
In [4]: def getDailyData(symbol):
                parameters = {'function': 'TIME_SERIES_DAILY_ADJUSTED',
                              'symbol': symbol,
                               'outputsize':'full',
                               'datatype': 'csv',
                               'apikey': 'insert your api key here'} ![1](img/1.png)

                response = requests.get('https://www.alphavantage.co/query',
                                        params=parameters) ![2](img/2.png)

                csvText = StringIO(response.text) ![3](img/3.png)
                data = pd.read_csv(csvText, index_col='timestamp')
                return data

In [5]: symbols = ["IBM", "MSFT", "INTC"]
        stock3 = []
        for symbol in symbols:
            stock3.append(getDailyData(symbol)[::-1]['close']
                          ['2020-01-01': '2020-12-31']) ![4](img/4.png)
        stocks = pd.DataFrame(stock3).T
        stocks.columns = symbols

In [6]: stocks.head()
Out[6]:                IBM    MSFT   INTC
        timestamp
        2020-01-02  135.42  160.62  60.84
        2020-01-03  134.34  158.62  60.10
        2020-01-06  134.10  159.03  59.93
        2020-01-07  134.19  157.58  58.93
        2020-01-08  135.31  160.09  58.97
```

![1](img/#co_modeling_market_risk_CO2-1)

ç¡®å®šä» Alpha Vantage æå–æ•°æ®æ—¶è¦ä½¿ç”¨çš„å‚æ•°ã€‚

![2](img/#co_modeling_market_risk_CO2-2)

å‘ Alpha Vantage ç½‘ç«™å‘å‡ºè¯·æ±‚ã€‚

![3](img/#co_modeling_market_risk_CO2-3)

æ‰“å¼€å“åº”æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä»¥æ–‡æœ¬æ ¼å¼å­˜åœ¨ã€‚

![4](img/#co_modeling_market_risk_CO2-4)

åè½¬æ¶µç›– 2019-01 è‡³ 2019-12 æœŸé—´çš„æ•°æ®ï¼Œå¹¶é™„åŠ  IBMã€MSFT å’Œ INTC çš„æ¯æ—¥è‚¡ä»·ã€‚

###### æ³¨æ„

Alpha Vantage æ˜¯ä¸€å®¶ä¸ä¸»è¦äº¤æ˜“æ‰€å’Œæœºæ„åˆä½œçš„æ•°æ®æä¾›å…¬å¸ã€‚åˆ©ç”¨ Alpha Vantage çš„ APIï¼Œå¯ä»¥è·å–å„ç§æ—¶é—´é—´éš”ï¼ˆæ—¥å†…ã€æ—¥å¸¸ã€æ¯å‘¨ç­‰ï¼‰çš„è‚¡ç¥¨ä»·æ ¼ã€è‚¡ç¥¨åŸºæœ¬é¢å’Œå¤–æ±‡ä¿¡æ¯ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®[Alpha Vantage çš„ç½‘ç«™](https://oreil.ly/ByZYD)ã€‚

ç„¶åæˆ‘ä»¬è¿›è¡Œè®¡ç®—ï¼š

```py
In [7]: stocks_returns = (np.log(stocks) - np.log(stocks.shift(1))).dropna() ![1](img/1.png)
        stocks_returns
Out[7]:                  IBM      MSFT      INTC
        timestamp
        2020-01-03 -0.008007 -0.012530 -0.012238
        2020-01-06 -0.001788  0.002581 -0.002833
        2020-01-07  0.000671 -0.009160 -0.016827
        2020-01-08  0.008312  0.015803  0.000679
        2020-01-09  0.010513  0.012416  0.005580
        ...              ...       ...       ...
        2020-12-24  0.006356  0.007797  0.010679
        2020-12-28  0.001042  0.009873  0.000000
        2020-12-29 -0.008205 -0.003607  0.048112
        2020-12-30  0.004352 -0.011081 -0.013043
        2020-12-31  0.012309  0.003333  0.021711

        [252 rows x 3 columns]

In [8]: stocks_returns_mean = stocks_returns.mean()
        weights  = np.random.random(len(stocks_returns.columns)) ![2](img/2.png)
        weights /= np.sum(weights) ![3](img/3.png)
        cov_var = stocks_returns.cov() ![4](img/4.png)
        port_std = np.sqrt(weights.T.dot(cov_var).dot(weights)) ![5](img/5.png)

In [9]: initial_investment = 1e6
        conf_level = 0.95

In [10]: def VaR_parametric(initial_investment, conf_level):
             alpha = norm.ppf(1 - conf_level, stocks_returns_mean, port_std) ![6](img/6.png)
             for i, j in zip(stocks.columns, range(len(stocks.columns))):
                 VaR_param = (initial_investment - initial_investment *
                              (1 + alpha))[j] ![7](img/7.png)
                 print("Parametric VaR result for {} is {} "
                       .format(i, VaR_param))
             VaR_param = (initial_investment - initial_investment * (1 + alpha))
             print('--' * 25)
             return VaR_param

In [11]: VaR_param = VaR_parametric(initial_investment, conf_level)
         VaR_param
         Parametric VaR result for IBM is 42606.16125893139
         Parametric VaR result for MSFT is 41024.50194348814
         Parametric VaR result for INTC is 43109.25240851776
         --------------------------------------------------

Out[11]: array([42606.16125893, 41024.50194349, 43109.25240852])
```

![1](img/#co_modeling_market_risk_CO3-1)

è®¡ç®—å¯¹æ•°æ”¶ç›Šç‡ã€‚

![2](img/#co_modeling_market_risk_CO3-2)

ç»˜åˆ¶æƒé‡çš„éšæœºæ•°ã€‚

![3](img/#co_modeling_market_risk_CO3-3)

ç”Ÿæˆæƒé‡ã€‚

![4](img/#co_modeling_market_risk_CO3-4)

è®¡ç®—åæ–¹å·®çŸ©é˜µã€‚

![5](img/#co_modeling_market_risk_CO3-5)

æŸ¥æ‰¾æŠ•èµ„ç»„åˆæ ‡å‡†åå·®ã€‚

![6](img/#co_modeling_market_risk_CO3-6)

ä½¿ç”¨ç™¾åˆ†ç‚¹å‡½æ•° (`ppf`) è®¡ç®—ç‰¹å®šå€¼çš„ Z åˆ†æ•°

![7](img/#co_modeling_market_risk_CO3-7)

ä¼°ç®—æ–¹å·®-åæ–¹å·® VaR æ¨¡å‹

VaR éšæ—¶é—´è·¨åº¦å˜åŒ–ï¼Œè¿™æ„å‘³ç€æŒæœ‰èµ„äº§çš„æ—¶é—´è¶Šé•¿ï¼ŒæŠ•èµ„è€…è¶Šå®¹æ˜“å—åˆ°é£é™©çš„å½±å“ã€‚å¦‚å›¾ 5-2 æ‰€ç¤ºï¼ŒVaR éšæŒæœ‰æ—¶é—´çš„å¢åŠ è€Œå¢åŠ ã€‚æ­¤å¤–ï¼ŒæŒæœ‰æœŸæ˜¯æŠ•èµ„ç»„åˆæ¸…ç®—çš„æœ€é•¿æœŸé™ã€‚è€ƒè™‘åˆ°æŠ¥å‘Šç›®çš„ï¼Œ30 å¤©å¯èƒ½æ›´é€‚åˆæŠ•èµ„è€…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ä»£ç ä¸­è¯´æ˜è¯¥æœŸé™ï¼Œåœ¨å…¶ä¸­ç”Ÿæˆå›¾ 5-2ã€‚

```py
In [12]: var_horizon = []
         time_horizon = 30
         for j in range(len(stocks_returns.columns)):
             for i in range(1, time_horizon + 1):
                 var_horizon.append(VaR_param[j] * np.sqrt(i))
         plt.plot(var_horizon[:time_horizon], "o",
                  c='blue', marker='*', label='IBM')
         plt.plot(var_horizon[time_horizon:time_horizon + 30], "o",
                  c='green', marker='o', label='MSFT')
         plt.plot(var_horizon[time_horizon + 30:time_horizon + 60], "o",
                  c='red', marker='v', label='INTC')
         plt.xlabel("Days")
         plt.ylabel("USD")
         plt.title("VaR over 30-day period")
         plt.legend()
         plt.show()
```

æ–¹å·®-åæ–¹å·®æ–¹æ³•çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š

ä¼˜åŠ¿

+   æ˜“äºè®¡ç®—

+   ä¸éœ€è¦å¤§é‡æ ·æœ¬

ç¼ºç‚¹

+   è§‚å¯Ÿå€¼å‘ˆæ­£æ€åˆ†å¸ƒ

+   åœ¨éçº¿æ€§ç»“æ„ä¸‹æ•ˆæœä¸ä½³

+   éœ€è¦è®¡ç®—åæ–¹å·®çŸ©é˜µ

![VaR_horizon](img/mlfr_0502.png)

###### å›¾ 5-2\. ä¸åŒæ—¶é—´è·¨åº¦ä¸‹çš„ VaR

å› æ­¤ï¼Œå³ä½¿å‡è®¾æ­£æ€æ€§å¬èµ·æ¥å¾ˆå¸å¼•äººï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ä¼°ç®— VaR çš„æœ€ä½³æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å½“èµ„äº§å›æŠ¥ä¸ç¬¦åˆæ­£æ€åˆ†å¸ƒæ—¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰å¦ä¸€ç§ä¸éœ€è¦æ­£æ€æ€§å‡è®¾çš„æ–¹æ³•ï¼Œå³å†å²æ¨¡æ‹Ÿ VaR æ¨¡å‹ã€‚

## å†å²æ¨¡æ‹Ÿæ–¹æ³•

å¼ºå‡è®¾ï¼Œå¦‚æ­£æ€åˆ†å¸ƒï¼Œå¯èƒ½å¯¼è‡´ä¼°ç®—ä¸å‡†ç¡®ã€‚è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•æ˜¯å†å²æ¨¡æ‹Ÿ VaRã€‚è¿™æ˜¯ä¸€ç§ç»éªŒæ–¹æ³•ï¼šæˆ‘ä»¬ä¸ä½¿ç”¨å‚æ•°åŒ–æ–¹æ³•ï¼Œè€Œæ˜¯æ‰¾åˆ°ç™¾åˆ†ä½æ•°ï¼Œè¿™ç›¸å½“äºæ–¹å·®-åæ–¹å·®æ–¹æ³•ä¸­çš„ Z è¡¨ç­‰æ•ˆç‰©ã€‚å‡è®¾ç½®ä¿¡åŒºé—´ä¸º 95%ï¼Œåˆ™ä½¿ç”¨ 5% ä»£æ›¿ Z è¡¨çš„å€¼ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†è¯¥ç™¾åˆ†ä½æ•°ä¹˜ä»¥åˆå§‹æŠ•èµ„ã€‚

å†å²æ¨¡æ‹Ÿ VaR çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1.  è·å–æŠ•èµ„ç»„åˆï¼ˆæˆ–å•ä¸ªèµ„äº§ï¼‰çš„èµ„äº§å›æŠ¥

1.  æ ¹æ®ç½®ä¿¡åŒºé—´æ‰¾åˆ°ç›¸åº”çš„è¿”å›ç™¾åˆ†ä½æ•°

1.  å°†è¯¥ç™¾åˆ†ä½æ•°ä¹˜ä»¥åˆå§‹æŠ•èµ„

è‹¥è¦åœ¨ä»£ç ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä»¥ä¸‹å‡½æ•°ï¼š

```py
In [13]: def VaR_historical(initial_investment, conf_level): ![1](img/1.png)
             Hist_percentile95 = []
             for i, j in zip(stocks_returns.columns,
                             range(len(stocks_returns.columns))):
                 Hist_percentile95.append(np.percentile(stocks_returns.loc[:, i],
                                                        5))
                 print("Based on historical values 95% of {}'s return is {:.4f}"
                       .format(i, Hist_percentile95[j]))
                 VaR_historical = (initial_investment - initial_investment *
                                   (1 + Hist_percentile95[j]))
                 print("Historical VaR result for {} is {:.2f} "
                       .format(i, VaR_historical))
                 print('--' * 35)

In [14]: VaR_historical(initial_investment,conf_level) ![2](img/2.png)
         Based on historical values 95% of IBM's return is -0.0371
         Historical VaR result for IBM is 37081.53
         ----------------------------------------------------------------------
         Based on historical values 95% of MSFT's return is -0.0426
         Historical VaR result for MSFT is 42583.68
         ----------------------------------------------------------------------
         Based on historical values 95% of INTC's return is -0.0425
         Historical VaR result for INTC is 42485.39
         ----------------------------------------------------------------------
```

![1](img/#co_modeling_market_risk_CO4-1)

è®¡ç®—è‚¡ç¥¨å›æŠ¥çš„ 95% ç™¾åˆ†ä½æ•°

![2](img/#co_modeling_market_risk_CO4-2)

ä¼°ç®—å†å²æ¨¡æ‹Ÿ VaR

å†å²æ¨¡æ‹Ÿ VaR æ–¹æ³•éšå«åœ°å‡è®¾å†å²ä»·æ ¼å˜åŠ¨å…·æœ‰ç±»ä¼¼çš„æ¨¡å¼ï¼Œå³ä¸å­˜åœ¨ç»“æ„æ€§æ–­è£‚ã€‚æ­¤æ–¹æ³•çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š

ä¼˜åŠ¿

+   æ— åˆ†å¸ƒå‡è®¾

+   é€‚ç”¨äºéçº¿æ€§ç»“æ„

+   æ˜“äºè®¡ç®—

ç¼ºç‚¹

+   éœ€è¦å¤§æ ·æœ¬

+   éœ€è¦é«˜è®¡ç®—èƒ½åŠ›

## è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ VaR

åœ¨æ·±å…¥æ¢è®¨è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿ VaR ä¼°è®¡ä¹‹å‰ï¼Œç®€è¦ä»‹ç»ä¸€ä¸‹è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä¼šå¾ˆæœ‰å¥½å¤„ã€‚è’™ç‰¹å¡ç½—æ˜¯ä¸€ç§è®¡ç®—æ•°å€¼é€¼è¿‘çš„é«˜æ•ˆå·¥å…·ï¼Œç”¨äºæ²¡æœ‰é—­å¼è§£çš„æƒ…å†µä¸‹è¿›è¡Œä¼°è®¡ã€‚è’™ç‰¹å¡ç½—ä¾èµ–äºä»ç»™å®šåˆ†å¸ƒä¸­é‡å¤ç”Ÿæˆçš„éšæœºæ ·æœ¬ã€‚

è’™ç‰¹å¡ç½—èƒŒåçš„é€»è¾‘ç”± Glassermanï¼ˆ2003, p. 11ï¼‰å®šä¹‰å¦‚ä¸‹ï¼š

> è’™ç‰¹å¡ç½—æ–¹æ³•åŸºäºæ¦‚ç‡ä¸ä½“ç§¯çš„ç±»æ¯”ã€‚æµ‹åº¦çš„æ•°å­¦å½¢å¼åŒ–äº†æ¦‚ç‡çš„ç›´è§‚æ¦‚å¿µï¼Œå°†äº‹ä»¶ä¸ä¸€ç»„ç»“æœç›¸å…³è”ï¼Œå¹¶å°†äº‹ä»¶çš„æ¦‚ç‡å®šä¹‰ä¸ºå…¶ç›¸å¯¹äºå¯èƒ½ç»“æœå®‡å®™çš„ä½“ç§¯æˆ–æµ‹åº¦ã€‚è’™ç‰¹å¡ç½—ä»¥åå‘æ–¹å¼ä½¿ç”¨æ­¤æ ‡è¯†ï¼Œé€šè¿‡è§£é‡Šä½“ç§¯ä¸ºæ¦‚ç‡æ¥è®¡ç®—é›†åˆçš„ä½“ç§¯ã€‚

ä»åº”ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œè’™ç‰¹å¡ç½—ä¸å†å²æ¨¡æ‹Ÿ VaR éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒä¸ä½¿ç”¨å†å²è§‚å¯Ÿå€¼ã€‚ç›¸åï¼Œå®ƒä»ç»™å®šåˆ†å¸ƒä¸­ç”Ÿæˆéšæœºæ ·æœ¬ã€‚è’™ç‰¹å¡ç½—é€šè¿‡æä¾›å¯èƒ½ç»“æœå’Œæ¦‚ç‡ä¹‹é—´çš„è”ç³»æ¥å¸®åŠ©å†³ç­–è€…ï¼Œä½¿å…¶æˆä¸ºé‡‘èä¸­é«˜æ•ˆå’Œé€‚ç”¨çš„å·¥å…·ã€‚

æ•°å­¦è’™ç‰¹å¡ç½—å¯ä»¥å¦‚ä¸‹å®šä¹‰ï¼š

è®© <math alttext="upper X 1 comma upper X 2 comma ellipsis comma upper X Subscript n Baseline"><mrow><msub><mi>X</mi> <mn>1</mn></msub> <mo>,</mo> <msub><mi>X</mi> <mn>2</mn></msub> <mo>,</mo> <mo>â‹¯</mo> <mo>,</mo> <msub><mi>X</mi> <mi>n</mi></msub></mrow></math> ä¸ºç‹¬ç«‹åŒåˆ†å¸ƒçš„éšæœºå˜é‡ï¼Œå¹¶ä¸” f(x) æ˜¯å®å€¼å‡½æ•°ã€‚å¤§æ•°æ³•åˆ™è¡¨æ˜ï¼š

<math alttext="sans-serif upper E left-parenthesis f left-parenthesis upper X right-parenthesis right-parenthesis almost-equals StartFraction 1 Over upper N EndFraction sigma-summation Underscript i Overscript upper N Endscripts f left-parenthesis upper X Subscript i Baseline right-parenthesis" display="block"><mrow><mi>ğ–¤</mi> <mrow><mo>(</mo> <mi>f</mi> <mrow><mo>(</mo> <mi>X</mi> <mo>)</mo></mrow> <mo>)</mo></mrow> <mo>â‰ˆ</mo> <mfrac><mn>1</mn> <mi>N</mi></mfrac> <munderover><mo>âˆ‘</mo> <mi>i</mi> <mi>N</mi></munderover> <mi>f</mi> <mrow><mo>(</mo> <msub><mi>X</mi> <mi>i</mi></msub> <mo>)</mo></mrow></mrow></math>

ç®€è€Œè¨€ä¹‹ï¼Œè’™ç‰¹å¡ç½—æ¨¡æ‹Ÿä»€ä¹ˆéƒ½åœ¨åšéšæœºç”Ÿæˆæ ·æœ¬å¹¶è®¡ç®—å®ƒä»¬çš„å‡å€¼ã€‚åœ¨è®¡ç®—ä¸Šï¼Œå®ƒéµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1.  å®šä¹‰åŸŸ

1.  ç”Ÿæˆéšæœºæ•°

1.  è¿­ä»£å’Œæ±‡æ€»ç»“æœ

ç¡®å®šæ•°å­¦ <math alttext="pi"><mi>Ï€</mi></math> çš„æ–¹æ³•æ˜¯è’™ç‰¹å¡ç½—åº”ç”¨çš„ç®€å•ä½†æœ‰è¯´æ˜æ€§çš„ä¾‹å­ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŠå¾„ä¸º *r* = 1 çš„åœ†ï¼Œé¢ç§¯ä¸º 4\. åœ†çš„é¢ç§¯æ˜¯ <math alttext="pi"><mi>Ï€</mi></math> ï¼Œè€Œè¯•å›¾å°†åœ†æ”¾å…¥çš„æ­£æ–¹å½¢çš„é¢ç§¯æ˜¯ 4\. æ¯”ç‡ç»“æœå¦‚ä¸‹ï¼š

<math alttext="dollar-sign StartFraction pi Over 4 EndFraction dollar-sign"><mfrac><mi>Ï€</mi> <mn>4</mn></mfrac></math>

ç•™ä¸‹ <math alttext="pi"><mi>Ï€</mi></math> ä¸å˜ï¼Œåœ†å’Œé¢ç§¯ä¹‹é—´çš„æ¯”ä¾‹å¯ä»¥å®šä¹‰ä¸ºï¼š

<math alttext="dollar-sign StartFraction upper C i r c u m f e r e n c e Subscript c i r c l e Baseline Over upper A r e a Subscript s q u a r e Baseline EndFraction equals StartFraction m Over n EndFraction dollar-sign"><mrow><mfrac><mrow><mi>C</mi><mi>i</mi><mi>r</mi><mi>c</mi><mi>u</mi><mi>m</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>c</mi><msub><mi>e</mi> <mrow><mi>c</mi><mi>i</mi><mi>r</mi><mi>c</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow> <mrow><mi>A</mi><mi>r</mi><mi>e</mi><msub><mi>a</mi> <mrow><mi>s</mi><mi>q</mi><mi>u</mi><mi>a</mi><mi>r</mi><mi>e</mi></mrow></msub></mrow></mfrac> <mo>=</mo> <mfrac><mi>m</mi> <mi>n</mi></mfrac></mrow></math>

ä¸€æ—¦æˆ‘ä»¬å¹³è¡¡è¿™äº›æ–¹ç¨‹å¼ï¼Œç»“æœæ˜¯ï¼š

<math alttext="dollar-sign pi equals 4 x StartFraction m Over n EndFraction dollar-sign"><mrow><mi>Ï€</mi> <mo>=</mo> <mn>4</mn> <mi>x</mi> <mfrac><mi>m</mi> <mi>n</mi></mfrac></mrow></math>

å¦‚æœæˆ‘ä»¬é€æ­¥è¿›è¡Œï¼Œé¦–å…ˆæ˜¯å®šä¹‰åŸŸï¼Œå³ [-1, 1]ã€‚å› æ­¤ï¼Œåœ†å†…éƒ¨çš„æ•°å­—æ»¡è¶³ <math alttext="x squared plus y squared less-than-or-equal-to 1"><mrow><msup><mi>x</mi> <mn>2</mn></msup> <mo>+</mo> <msup><mi>y</mi> <mn>2</mn></msup> <mo>â‰¤</mo> <mn>1</mn></mrow></math> ã€‚

ç¬¬äºŒæ­¥æ˜¯ç”Ÿæˆéšæœºæ•°ä»¥æ»¡è¶³è¿™ä¸€ç»™å®šæ¡ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦å…·æœ‰å‡åŒ€åˆ†å¸ƒçš„éšæœºæ ·æœ¬ï¼Œåœ¨ Python ä¸­è¿™æ˜¯ä¸€é¡¹ç›¸å½“ç®€å•çš„ä»»åŠ¡ã€‚ä¸ºäº†ç»ƒä¹ ï¼Œæˆ‘å°†ä½¿ç”¨ NumPy åº“ç”Ÿæˆ 100 ä¸ªå‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ï¼š

```py
In [15]: x = np.random.uniform(-1, 1, 100) ![1](img/1.png)
         y = np.random.uniform(-1, 1, 100)

In [16]: sample = 100
         def pi_calc(x, y):
             point_inside_circle = 0
             for i in range(sample):
                 if np.sqrt(x[i] ** 2 + y[i] ** 2) <= 1: ![2](img/2.png)
                     point_inside_circle += 1
             print('pi value is {}'.format(4 * point_inside_circle/sample))

In [17]: pi_calc(x,y)
         pi value is 3.2

In [18]: x = np.random.uniform(-1, 1, 1000000)
         y = np.random.uniform(-1, 1, 1000000)

In [19]: sample = 1000000

         def pi_calc(x, y):
             point_inside_circle = 0
             for i in range(sample):
                 if np.sqrt(x[i] ** 2 + y[i] ** 2) < 1:
                     point_inside_circle += 1
             print('pi value is {:.2f}'.format(4 * point_inside_circle/sample))

In [20]: pi_calc(x,y)
         pi value is 3.14

In [21]: sim_data = pd.DataFrame([])
         num_reps = 1000
         n = 100
         for i in range(len(stocks.columns)):
             mean = np.random.randn(n).mean()
             std = np.random.randn(n).std()
             temp = pd.DataFrame(np.random.normal(mean, std, num_reps))
             sim_data = pd.concat([sim_data, temp], axis=1)
         sim_data.columns = ['Simulation 1', 'Simulation 2', 'Simulation 3']

In [22]: sim_data
Out[22]:      Simulation 1  Simulation 2  Simulation 3
         0        1.587297     -0.256668      1.137718
         1        0.053628     -0.177641     -1.642747
         2       -1.636260     -0.626633      0.393466
         3        1.088207      0.847237      0.453473
         4       -0.479977     -0.114377     -2.108050
         ..            ...           ...           ...
         995      1.615190      0.940931      0.172129
         996     -0.015111     -1.149821     -0.279746
         997     -0.806576     -0.141932     -1.246538
         998      1.609327      0.582967     -1.879237
         999     -0.943749     -0.286847      0.777052

         [1000 rows x 3 columns]

In [23]: def MC_VaR(initial_investment, conf_level):
             MC_percentile95 = []
             for i, j in zip(sim_data.columns, range(len(sim_data.columns))):
                 MC_percentile95.append(np.percentile(sim_data.loc[:, i], 5)) ![3](img/3.png)
                 print("Based on simulation 95% of {}'s return is {:.4f}"
                       .format(i, MC_percentile95[j]))
                 VaR_MC = (initial_investment - initial_investment *
                           (1 + MC_percentile95[j])) ![4](img/4.png)
                 print("Simulation VaR result for {} is {:.2f} "
                       .format(i, VaR_MC))
                 print('--' * 35)

In [24]: MC_VaR(initial_investment, conf_level)
         Based on simulation 95% of Simulation 1's return is -1.7880
         Simulation VaR result for Simulation 1 is 1787990.69
         ----------------------------------------------------------------------
         Based on simulation 95% of Simulation 2's return is -1.6290
         Simulation VaR result for Simulation 2 is 1628976.68
         ----------------------------------------------------------------------
         Based on simulation 95% of Simulation 3's return is -1.5156
         Simulation VaR result for Simulation 3 is 1515623.93
         ----------------------------------------------------------------------
```

![1](img/#co_modeling_market_risk_CO5-1)

ä»å‡åŒ€åˆ†å¸ƒç”Ÿæˆéšæœºæ•°

![2](img/#co_modeling_market_risk_CO5-2)

æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨åŠå¾„ä¸º 1 çš„åœ†å†…

![3](img/#co_modeling_market_risk_CO5-3)

è®¡ç®—æ¯ä¸ªè‚¡ç¥¨å›æŠ¥çš„ 95%å¹¶å°†ç»“æœé™„åŠ åˆ°åä¸º `MC_percentile95` çš„åˆ—è¡¨ä¸­

![4](img/#co_modeling_market_risk_CO5-4)

ä¼°è®¡è’™ç‰¹å¡ç½— VaR

# é™å™ª

æ³¢åŠ¨æ€§æ— å¤„ä¸åœ¨ï¼Œä½†æ‰¾å‡ºå“ªç§æ³¢åŠ¨æ€§æœ€æœ‰ä»·å€¼å´æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¸‚åœºä¸Šå­˜åœ¨ä¸¤ç§ä¿¡æ¯ï¼š*å™ªéŸ³* å’Œ *ä¿¡å·*ã€‚å‰è€…ä»…äº§ç”Ÿéšæœºä¿¡æ¯ï¼Œè€Œåè€…é€šè¿‡æä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ä½¿æŠ•èµ„è€…èƒ½å¤Ÿèµšé’±ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè€ƒè™‘å¸‚åœºä¸Šçš„ä¸¤ä¸ªä¸»è¦å‚ä¸è€…ï¼šä¸€ä¸ªä½¿ç”¨å˜ˆæ‚ä¿¡æ¯çš„å™ªéŸ³äº¤æ˜“è€…ï¼Œä»¥åŠåˆ©ç”¨ä¿¡å·æˆ–å†…å¹•ä¿¡æ¯çš„çŸ¥æƒ…äº¤æ˜“è€…ã€‚å™ªéŸ³äº¤æ˜“è€…çš„äº¤æ˜“åŠ¨æœºå—åˆ°éšæœºè¡Œä¸ºçš„é©±åŠ¨ã€‚å› æ­¤ï¼Œå¸‚åœºä¸­çš„ä¿¡æ¯æµè¢«è®¤ä¸ºæ˜¯æŸäº›å™ªéŸ³äº¤æ˜“è€…çš„ä¹°å…¥ä¿¡å·å’Œå…¶ä»–äººçš„å–å‡ºä¿¡å·ã€‚

ç„¶è€Œï¼ŒçŸ¥æƒ…äº¤æ˜“è€…è¢«è®¤ä¸ºæ˜¯ç†æ€§çš„ï¼Œå› ä¸ºä»–ä»¬èƒ½å¤Ÿè¯„ä¼°ä¿¡å·ï¼Œå› ä¸ºä»–ä»¬çŸ¥é“è¿™æ˜¯ç§äººä¿¡æ¯ã€‚

å› æ­¤ï¼Œè¿ç»­çš„ä¿¡æ¯æµåº”è¯¥è°¨æ…å¤„ç†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ¥è‡ªå™ªéŸ³äº¤æ˜“è€…çš„ä¿¡æ¯å¯ä»¥è§†ä¸ºå™ªéŸ³ï¼Œè€Œæ¥è‡ªå†…éƒ¨äººå£«çš„ä¿¡æ¯åˆ™å¯è§†ä¸ºä¿¡å·ï¼Œè€Œè¿™æ‰æ˜¯é‡è¦çš„ä¿¡æ¯ã€‚ä¸èƒ½åŒºåˆ†å™ªéŸ³å’Œä¿¡å·çš„æŠ•èµ„è€…å¯èƒ½ä¼šæœªèƒ½è·åˆ©å’Œ/æˆ–æ­£ç¡®è¯„ä¼°é£é™©ã€‚

ç°åœ¨é—®é¢˜è½¬å˜ä¸ºå¦‚ä½•åŒºåˆ†é‡‘èå¸‚åœºä¸­ä¿¡æ¯æµçš„ä¸åŒã€‚æˆ‘ä»¬å¦‚ä½•åŒºåˆ†å™ªéŸ³å’Œä¿¡å·ï¼Ÿæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Ÿ

ç°åœ¨æ˜¯è®¨è®ºé©¬å°”ç´ç§‘-å¸•æ–¯å›¾å°”å®šç†çš„æ—¶å€™äº†ï¼Œè¿™æœ‰åŠ©äºæœ‰å‡åŒ€åæ–¹å·®çŸ©é˜µã€‚é©¬å°”ç´ç§‘-å¸•æ–¯å›¾å°”å®šç†å…è®¸æˆ‘ä»¬åˆ©ç”¨åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ä»å™ªéŸ³ä¸­æå–ä¿¡å·ã€‚

###### æ³¨æ„

è®¾ <math alttext="upper A element-of double-struck upper R Superscript n x n"><mrow><mi>A</mi> <mo>âˆˆ</mo> <msup><mi>â„</mi> <mrow><mi>n</mi><mi>x</mi><mi>n</mi></mrow></msup></mrow></math> æ˜¯ä¸€ä¸ªæ–¹é˜µã€‚é‚£ä¹ˆï¼Œ<math alttext="lamda element-of double-struck upper R"><mrow><mi>Î»</mi> <mo>âˆˆ</mo> <mi>â„</mi></mrow></math> æ˜¯ *A* çš„ç‰¹å¾å€¼ï¼Œ<math alttext="x element-of double-struck upper R Superscript n"><mrow><mi>x</mi> <mo>âˆˆ</mo> <msup><mi>â„</mi> <mi>n</mi></msup></mrow></math> æ˜¯å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œå¦‚æœ

<math alttext="dollar-sign upper A x equals lamda x dollar-sign"><mrow><mi>A</mi> <mi>x</mi> <mo>=</mo> <mi>Î»</mi> <mi>x</mi></mrow></math>

å…¶ä¸­ <math alttext="x å±äºåŒç­’ä¸Š R ä¸Šæ ‡ n åŸºçº¿ ä¸ç­‰äº 0"><mrow><mi>x</mi> <mo>âˆˆ</mo> <msup><mi>â„</mi> <mi>n</mi></msup> <mo>â‰ </mo> <mn>0</mn></mrow></math> .

*ç‰¹å¾å€¼* å’Œ *ç‰¹å¾å‘é‡* åœ¨é‡‘èä¸Šä¸‹æ–‡ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ã€‚ç‰¹å¾å‘é‡è¡¨ç¤ºåæ–¹å·®çŸ©é˜µçš„æ–¹å·®ï¼Œè€Œç‰¹å¾å€¼æ˜¾ç¤ºç‰¹å¾å‘é‡çš„å¤§å°ã€‚å…·ä½“æ¥è¯´ï¼Œæœ€å¤§ç‰¹å¾å‘é‡å¯¹åº”æœ€å¤§æ–¹å·®ï¼Œå…¶å¤§å°ç­‰äºç›¸åº”çš„ç‰¹å¾å€¼ã€‚ç”±äºæ•°æ®ä¸­å­˜åœ¨å™ªå£°ï¼ŒæŸäº›ç‰¹å¾å€¼å¯ä»¥è¢«è§†ä¸ºéšæœºçš„ï¼Œå› æ­¤æœ‰å¿…è¦æ£€æµ‹å¹¶è¿‡æ»¤è¿™äº›ç‰¹å¾å€¼ï¼Œä»¥ä¿ç•™ä¿¡å·ã€‚

ä¸ºäº†åŒºåˆ†å™ªå£°å’Œä¿¡å·ï¼Œæˆ‘ä»¬å°† Marchenkoâ€“Pastur å®šç†çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼‰æ‹Ÿåˆåˆ°å˜ˆæ‚çš„åæ–¹å·®ä¸­ã€‚Marchenkoâ€“Pastur å®šç†çš„ PDF å–ä»¥ä¸‹å½¢å¼ï¼ˆPrado 2020ï¼‰ï¼š

<math mode="display"><mrow><mi>f</mi> <mrow><mo>(</mo> <mi>Î»</mi> <mo>)</mo></mrow> <mo>=</mo> <mfenced close="" open="{" separators=""><mtable><mtr><mtd columnalign="left"><mrow><mfrac><mi>T</mi> <mi>N</mi></mfrac> <msqrt><mrow><mrow><mo>(</mo> <msub><mi>Î»</mi> <mi>t</mi></msub> <mo>-</mo> <mi>Î»</mi> <mo>)</mo></mrow> <mrow><mo>(</mo> <mi>Î»</mi> <mo>-</mo> <msub><mi>Î»</mi> <mo>-</mo></msub> <mo>)</mo></mrow></mrow></msqrt></mrow></mtd> <mtd columnalign="right"><mrow><mtext>if</mtext> <mi>Î»</mi> <mo>âˆˆ</mo> <mo>[</mo> <mi>Î»</mi> <mo>-</mo> <msub><mi>Î»</mi> <mo>-</mo></msub> <mo>]</mo></mrow></mtd></mtr> <mtr><mtd columnalign="left"><mrow><mn>0</mn> <mo>,</mo></mrow></mtd> <mtd columnalign="right"><mrow><mtext>if</mtext> <mi>Î»</mi> <mo>âˆ‰</mo> <mo>[</mo> <mi>Î»</mi> <mo>-</mo> <msub><mi>Î»</mi> <mo>-</mo></msub> <mo>]</mo></mrow></mtd></mtr></mtable></mfenced></mrow></math>

å…¶ä¸­ <math alttext="lamda ä¸‹æ ‡ plus åŸºçº¿ å’Œ lamda ä¸‹æ ‡ minus åŸºçº¿"><mrow><msub><mi>Î»</mi> <mo>+</mo></msub> <mtext>å’Œ</mtext> <msub><mi>Î»</mi> <mo>-</mo></msub></mrow></math> åˆ†åˆ«ä¸ºæœ€å¤§å’Œæœ€å°ç‰¹å¾å€¼ã€‚

åœ¨ä»¥ä¸‹ä»£ç å—ä¸­ï¼Œè¿™æ˜¯å¯¹ Prado (2020) æä¾›çš„ä»£ç ç¨ä½œä¿®æ”¹ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆ Marchenkoâ€“Pastur åˆ†å¸ƒå’Œæ ¸å¯†åº¦çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬ä»¥éå‚æ•°åŒ–çš„æ–¹å¼å¯¹éšæœºå˜é‡è¿›è¡Œå»ºæ¨¡ã€‚ç„¶åï¼Œå°† Marchenkoâ€“Pastur åˆ†å¸ƒæ‹Ÿåˆåˆ°æ•°æ®ä¸­ï¼š

```py
In [25]: def mp_pdf(sigma2, q, obs):
             lambda_plus = sigma2 * (1 + q ** 0.5) ** 2 ![1](img/1.png)
             lambda_minus = sigma2 * (1 - q ** 0.5) ** 2 ![2](img/2.png)
             l = np.linspace(lambda_minus, lambda_plus, obs)
             pdf_mp = 1 / (2 * np.pi * sigma2 * q * l) \
                      * np.sqrt((lambda_plus  - l)
                      *  (l - lambda_minus)) ![3](img/3.png)
             pdf_mp = pd.Series(pdf_mp, index=l)
             return pdf_mp

In [26]: from sklearn.neighbors import KernelDensity

         def kde_fit(bandwidth,obs,x=None):
             kde = KernelDensity(bandwidth, kernel='gaussian') ![4](img/4.png)
             if len(obs.shape) == 1:
                 kde_fit=kde.fit(np.array(obs).reshape(-1, 1)) ![5](img/5.png)
             if x is None:
                 x=np.unique(obs).reshape(-1, 1)
             if len(x.shape) == 1:
                 x = x.reshape(-1, 1)
             logprob = kde_fit.score_samples(x) ![6](img/6.png)
             pdf_kde = pd.Series(np.exp(logprob), index=x.flatten())
             return pdf_kde

In [27]: corr_mat = np.random.normal(size=(10000, 1000)) ![7](img/7.png)
         corr_coef = np.corrcoef(corr_mat, rowvar=0) ![8](img/8.png)
         sigma2 = 1
         obs = corr_mat.shape[0]
         q = corr_mat.shape[0] / corr_mat.shape[1]

         def plotting(corr_coef, q):
             ev, _ = np.linalg.eigh(corr_coef) ![9](img/9.png)
             idx = ev.argsort()[::-1]
             eigen_val = np.diagflat(ev[idx]) ![10](img/10.png)
             pdf_mp = mp_pdf(1., q=corr_mat.shape[1] / corr_mat.shape[0],
                             obs=1000) ![11](img/11.png)
             kde_pdf = kde_fit(0.01, np.diag(eigen_val)) ![12](img/12.png)
             ax = pdf_mp.plot(title="Marchenko-Pastur Theorem",
                              label="M-P", style='r--')
             kde_pdf.plot(label="Empirical Density", style='o-', alpha=0.3)
             ax.set(xlabel="Eigenvalue", ylabel="Frequency")
             ax.legend(loc="upper right")
             plt.show()
             return plt

In [28]: plotting(corr_coef, q);
```

![1](img/#co_modeling_market_risk_CO6-1)

è®¡ç®—æœ€å¤§æœŸæœ›ç‰¹å¾å€¼

![2](img/#co_modeling_market_risk_CO6-2)

è®¡ç®—æœ€å°æœŸæœ›ç‰¹å¾å€¼

![3](img/#co_modeling_market_risk_CO6-3)

ç”Ÿæˆ Marchenko-Pastur åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°

![4](img/#co_modeling_market_risk_CO6-4)

åˆå§‹åŒ–æ ¸å¯†åº¦ä¼°è®¡

![5](img/#co_modeling_market_risk_CO6-5)

å°†æ ¸å¯†åº¦æ‹Ÿåˆåˆ°è§‚æµ‹å€¼

![6](img/#co_modeling_market_risk_CO6-6)

è¯„ä¼°è§‚æµ‹æ•°æ®ä¸Šçš„å¯¹æ•°å¯†åº¦æ¨¡å‹

![7](img/#co_modeling_market_risk_CO6-7)

ä»æ­£æ€åˆ†å¸ƒç”Ÿæˆéšæœºæ ·æœ¬

![8](img/#co_modeling_market_risk_CO6-8)

å°†åæ–¹å·®çŸ©é˜µè½¬æ¢ä¸ºç›¸å…³çŸ©é˜µ

![9](img/#co_modeling_market_risk_CO6-9)

è®¡ç®—ç›¸å…³çŸ©é˜µçš„ç‰¹å¾å€¼

![10](img/#co_modeling_market_risk_CO6-10)

å°† NumPy æ•°ç»„è½¬æ¢ä¸ºå¯¹è§’çŸ©é˜µ

![11](img/#co_modeling_market_risk_CO6-11)

è°ƒç”¨ `mp_pdf` ä¼°ç®— Marchenkoâ€“Pastur åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°

![12](img/#co_modeling_market_risk_CO6-12)

è°ƒç”¨ `kde_fit` å¯¹æ•°æ®è¿›è¡Œæ ¸åˆ†å¸ƒæ‹Ÿåˆ

ç»“æœæ˜¾ç¤ºçš„å›¾ 5-3 è¡¨æ˜ Marchenkoâ€“Pastur åˆ†å¸ƒå¾ˆå¥½åœ°é€‚é…äº†æ•°æ®ã€‚å¤šäºäº† Marchenkoâ€“Pastur å®šç†ï¼Œæˆ‘ä»¬èƒ½åŒºåˆ†å™ªå£°å’Œä¿¡å·ï¼›ç°åœ¨æˆ‘ä»¬å¯ä»¥ç§°ç»è¿‡å™ªå£°è¿‡æ»¤çš„æ•°æ®ä¸º*å»å™ª*æ•°æ®ã€‚

![M_P](img/mlfr_0503.png)

###### å›¾ 5-3\. æ‹Ÿåˆ Marchenkoâ€“Pastur åˆ†å¸ƒ

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†å»å™ªåæ–¹å·®çŸ©é˜µçš„ä¸»è¦æ­¥éª¤ï¼Œä»¥ä¾¿å°†å…¶æ’å…¥ VaR æ¨¡å‹ä¸­ï¼Œè¿™è¢«ç§°ä¸º*å»å™ª VaR*ä¼°è®¡ã€‚å»å™ªåæ–¹å·®çŸ©é˜µçš„æ„ä¹‰åœ¨äºä»æ•°æ®ä¸­å‰”é™¤ä¸å¿…è¦çš„ä¿¡æ¯ï¼ˆå™ªéŸ³ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åªåˆ©ç”¨å¸‚åœºçš„ä¿¡å·ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åœ¨é‡è¦çš„äº‹ä»¶ä¸Šã€‚

å»å™ªåæ–¹å·®çŸ©é˜µåŒ…æ‹¬ä»¥ä¸‹é˜¶æ®µï¼š^(1)

1.  åŸºäºç›¸å…³çŸ©é˜µè®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ã€‚

1.  ä½¿ç”¨æ ¸å¯†åº¦ä¼°è®¡ï¼Œæ‰¾åˆ°ç‰¹å®šç‰¹å¾å€¼çš„ç‰¹å¾å‘é‡ã€‚

1.  å°† Marchenkoâ€“Pastur åˆ†å¸ƒæ‹Ÿåˆåˆ°æ ¸å¯†åº¦ä¼°è®¡ä¸­ã€‚

1.  ä½¿ç”¨ Marchenkoâ€“Pastur åˆ†å¸ƒæ‰¾åˆ°æœ€å¤§ç†è®ºç‰¹å¾å€¼ã€‚

1.  è®¡ç®—å¤§äºç†è®ºå€¼çš„ç‰¹å¾å€¼çš„å¹³å‡å€¼ã€‚

1.  ä½¿ç”¨è¿™äº›æ–°çš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡æ¥è®¡ç®—å»å™ªç›¸å…³çŸ©é˜µã€‚

1.  é€šè¿‡æ–°çš„ç›¸å…³çŸ©é˜µè®¡ç®—å»å™ªåæ–¹å·®çŸ©é˜µã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Python ä¸­çš„`portfoliolab`åº“å‡ è¡Œä»£ç å°±å¯ä»¥åº”ç”¨æ‰¾åˆ°å»å™ªåæ–¹å·®çŸ©é˜µï¼š

```py
In [29]: import portfoliolab as pl

In [30]: risk_estimators = pl.estimators.RiskEstimators()

In [31]: stock_prices = stocks.copy()

In [32]: cov_matrix = stocks_returns.cov()
         cov_matrix
Out[32]:            IBM      MSFT      INTC
         IBM   0.000672  0.000465  0.000569
         MSFT  0.000465  0.000770  0.000679
         INTC  0.000569  0.000679  0.001158

In [33]: tn_relation = stock_prices.shape[0] / stock_prices.shape[1] ![1](img/1.png)
         kde_bwidth = 0.25 ![2](img/2.png)
         cov_matrix_denoised = risk_estimators.denoise_covariance(cov_matrix,
                                                                  tn_relation,
                                                                  kde_bwidth) ![3](img/3.png)
         cov_matrix_denoised = pd.DataFrame(cov_matrix_denoised,
                                            index=cov_matrix.index,
                                            columns=cov_matrix.columns)
         cov_matrix_denoised
Out[33]:            IBM      MSFT      INTC
         IBM   0.000672  0.000480  0.000589
         MSFT  0.000480  0.000770  0.000638
         INTC  0.000589  0.000638  0.001158

In [34]: def VaR_parametric_denoised(initial_investment, conf_level):
             port_std = np.sqrt(weights.T.dot(cov_matrix_denoised)
                                .dot(weights)) ![4](img/4.png)
             alpha = norm.ppf(1 - conf_level, stocks_returns_mean, port_std)
             for i, j in zip(stocks.columns,range(len(stocks.columns))):
                 print("Parametric VaR result for {} is {} ".format(i,VaR_param))
             VaR_params = (initial_investment - initial_investment * (1 + alpha))
             print('--' * 25)
             return VaR_params

In [35]: VaR_parametric_denoised(initial_investment, conf_level)
         Parametric VaR result for IBM is [42606.16125893 41024.50194349
          43109.25240852]
         Parametric VaR result for MSFT is [42606.16125893 41024.50194349
          43109.25240852]
         Parametric VaR result for INTC is [42606.16125893 41024.50194349
          43109.25240852]
         --------------------------------------------------

Out[35]: array([42519.03744155, 40937.37812611, 43022.12859114])

In [36]: symbols = ["IBM", "MSFT", "INTC"]
         stock3 = []
         for symbol in symbols:
             stock3.append(getDailyData(symbol)[::-1]['close']
                           ['2007-04-01': '2009-02-01'])
         stocks_crisis = pd.DataFrame(stock3).T
         stocks_crisis.columns = symbols

In [37]: stocks_crisis
Out[37]:               IBM   MSFT   INTC
         timestamp
         2007-04-02  95.21  27.74  19.13
         2007-04-03  96.10  27.87  19.31
         2007-04-04  96.21  28.50  19.38
         2007-04-05  96.52  28.55  19.58
         2007-04-09  96.62  28.57  20.10
         ...           ...    ...    ...
         2009-01-26  91.60  17.63  13.38
         2009-01-27  91.66  17.66  13.81
         2009-01-28  94.82  18.04  14.01
         2009-01-29  92.51  17.59  13.37
         2009-01-30  91.65  17.10  12.90

         [463 rows x 3 columns]

In [38]: stock_prices = stocks_crisis.copy()

In [39]: stocks_returns = (np.log(stocks) - np.log(stocks.shift(1))).dropna()

In [40]: cov_matrix = stocks_returns.cov()

In [41]: VaR_parametric(initial_investment, conf_level)
         Parametric VaR result for IBM is 42606.16125893139
         Parametric VaR result for MSFT is 41024.50194348814
         Parametric VaR result for INTC is 43109.25240851776
         --------------------------------------------------

Out[41]: array([42606.16125893, 41024.50194349, 43109.25240852])

In [42]: VaR_parametric_denoised(initial_investment, conf_level)
         Parametric VaR result for IBM is [42606.16125893 41024.50194349
          43109.25240852]
         Parametric VaR result for MSFT is [42606.16125893 41024.50194349
          43109.25240852]
         Parametric VaR result for INTC is [42606.16125893 41024.50194349
          43109.25240852]
         --------------------------------------------------

Out[42]: array([42519.03744155, 40937.37812611, 43022.12859114])
```

![1](img/#co_modeling_market_risk_CO7-1)

å°†è§‚æµ‹æ•°`T`ä¸å˜é‡æ•°`N`ç›¸å…³è”

![2](img/#co_modeling_market_risk_CO7-2)

ç¡®å®šæ ¸å¯†åº¦ä¼°è®¡çš„å¸¦å®½

![3](img/#co_modeling_market_risk_CO7-3)

ç”Ÿæˆå»å™ªåæ–¹å·®çŸ©é˜µ

![4](img/#co_modeling_market_risk_CO7-4)

å°†å»å™ªåæ–¹å·®çŸ©é˜µæ•´åˆåˆ° VaR å…¬å¼ä¸­

ä¼ ç»Ÿåº”ç”¨çš„ VaR ä¸å»å™ª VaR ä¹‹é—´çš„å·®å¼‚åœ¨å±æœºæœŸé—´æ›´åŠ æ˜¾è‘—ã€‚åœ¨å±æœºæœŸé—´ï¼Œèµ„äº§ä¹‹é—´çš„ç›¸å…³æ€§å¢åŠ ï¼Œæœ‰æ—¶è¢«ç§°ä¸º*ç›¸å…³æ€§å´©æºƒ*ã€‚æˆ‘ä»¬å°†è¯„ä¼°å±æœºçš„å½±å“ä»¥éªŒè¯è¿™ä¸€ç°è±¡ï¼Œå¹¶ä¸ºæ­¤ä½¿ç”¨ 2017 å¹´è‡³ 2018 å¹´çš„å±æœºã€‚ç„¶è€Œï¼Œè¿è¡Œæ­¤åˆ†æéœ€è¦å±æœºçš„ç¡®åˆ‡å¼€å§‹å’Œç»“æŸæ—¥æœŸï¼›æˆ‘ä»¬å°†ä»å›½å®¶ç»æµç ”ç©¶å±€ï¼ˆNBERï¼‰è·å–æ­¤ä¿¡æ¯ï¼Œè¯¥æœºæ„å®£å¸ƒå•†ä¸šå‘¨æœŸã€‚

ç»“æœè¡¨æ˜ï¼Œåœ¨å±æœºæœŸé—´ï¼Œç›¸å…³æ€§å’Œå› æ­¤ VaR å€¼å˜å¾—æ›´é«˜ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä½¿ç”¨äº†ç»è¿‡å»å™ªçš„åæ–¹å·®çŸ©é˜µæ¥è·å¾—åŸºäºæœºå™¨å­¦ä¹ çš„é£é™©ä»·å€¼ï¼ˆVaRï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»æ•°æ®è®¡ç®—å¾—åˆ°çš„ç»éªŒçŸ©é˜µã€‚å°½ç®¡ VaR å…·æœ‰å¸å¼•åŠ›å¹¶ä¸”æ˜“äºä½¿ç”¨ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªä¸€è‡´çš„é£é™©åº¦é‡ï¼Œè¿™éœ€è¦æ»¡è¶³æŸäº›æ¡ä»¶æˆ–å…¬ç†ã€‚ä½ å¯ä»¥æŠŠè¿™äº›å…¬ç†çœ‹ä½œæ˜¯é£é™©åº¦é‡çš„æŠ€æœ¯è¦æ±‚ã€‚

è®©<math alttext="alpha element-of left-parenthesis 0 comma 1 right-parenthesis"><mrow><mi>Î±</mi> <mo>âˆˆ</mo> <mo>(</mo> <mn>0</mn> <mo>,</mo> <mn>1</mn> <mo>)</mo></mrow></math>æˆä¸ºä¸€ä¸ªå›ºå®šçš„ç½®ä¿¡æ°´å¹³ï¼Œè€Œï¼ˆ<math alttext="omega"><mi>Ï‰</mi></math>ï¼Œ<math alttext="script upper F"><mi>â„±</mi></math>ï¼Œ<math alttext="sans-serif upper P"><mi>ğ–¯</mi></math>ï¼‰åˆ™æ˜¯ä¸€ä¸ªæ¦‚ç‡ç©ºé—´ï¼Œå…¶ä¸­<math alttext="omega"><mi>Ï‰</mi></math>ä»£è¡¨æ ·æœ¬ç©ºé—´ï¼Œ<math alttext="script upper F"><mi>â„±</mi></math>è¡¨ç¤ºæ ·æœ¬ç©ºé—´çš„å­é›†ï¼Œè€Œ<math alttext="sans-serif upper P"><mi>ğ–¯</mi></math>åˆ™æ˜¯æ¦‚ç‡åº¦é‡ã€‚

###### æ³¨æ„

ä¸ºäº†è¯´æ˜ï¼Œå‡è®¾<math alttext="omega"><mi>Ï‰</mi></math>æ˜¯æŠ•æ·ç¡¬å¸äº‹ä»¶ä¸­æ‰€æœ‰å¯èƒ½ç»“æœçš„é›†åˆï¼Œ<math alttext="omega"><mi>Ï‰</mi></math> = {H, T}ã€‚ <math alttext="script upper F"><mi>â„±</mi></math> å¯ä»¥çœ‹ä½œæ˜¯è¿ç»­ä¸¤æ¬¡æŠ•æ·ç¡¬å¸ï¼Œ<math alttext="script upper F equals 2 Superscript omega"><mrow><mi>â„±</mi> <mo>=</mo> <msup><mn>2</mn> <mi>Ï‰</mi></msup></mrow></math> = <math alttext="2 squared"><msup><mn>2</mn> <mn>2</mn></msup></math>ã€‚æœ€åï¼Œæ¦‚ç‡åº¦é‡ï¼Œ<math alttext="sans-serif upper P"><mi>ğ–¯</mi></math>ï¼Œæ˜¯å¾—åˆ°å°¾å·´ï¼ˆ0.5ï¼‰çš„å‡ ç‡ã€‚

è¿™é‡Œæ˜¯ä¸€è‡´é£é™©åº¦é‡çš„å››ä¸ªå…¬ç†ï¼š

å¹³ç§»ä¸å˜æ€§

å¯¹äºæ‰€æœ‰ç»“æœ*Y*å’Œå¸¸æ•°<math alttext="a element-of double-struck upper R"><mrow><mi>a</mi> <mo>âˆˆ</mo> <mi>â„</mi></mrow></math>ï¼Œæˆ‘ä»¬æœ‰

<math alttext="dollar-sign upper V a upper R left-parenthesis upper Y plus a right-parenthesis equals upper V a upper R left-parenthesis upper Y right-parenthesis plus a dollar-sign"><mrow><mi>V</mi> <mi>a</mi> <mi>R</mi> <mo>(</mo> <mi>Y</mi> <mo>+</mo> <mi>a</mi> <mo>)</mo> <mo>=</mo> <mi>V</mi> <mi>a</mi> <mi>R</mi> <mo>(</mo> <mi>Y</mi> <mo>)</mo> <mo>+</mo> <mi>a</mi></mrow></math>

è¿™æ„å‘³ç€å¦‚æœå°†æ— é£é™©é‡‘é¢*a*æ·»åŠ åˆ°æŠ•èµ„ç»„åˆä¸­ï¼Œåˆ™ä¼šé™ä½*a*çš„ VaRã€‚

å­å¯åŠ æ€§

å¯¹äºæ‰€æœ‰<math alttext="upper Y 1"><msub><mi>Y</mi> <mn>1</mn></msub></math>å’Œ<math alttext="upper Y 2"><msub><mi>Y</mi> <mn>2</mn></msub></math>ï¼Œæˆ‘ä»¬æœ‰

<math alttext="dollar-sign upper V a upper R left-parenthesis upper Y 1 plus upper Y 2 right-parenthesis less-than-or-equal-to upper V a upper R left-parenthesis upper Y 1 right-parenthesis plus upper V a upper R left-parenthesis upper Y 2 right-parenthesis dollar-sign"><mrow><mi>V</mi> <mi>a</mi> <mi>R</mi> <mrow><mo>(</mo> <msub><mi>Y</mi> <mn>1</mn></msub> <mo>+</mo> <msub><mi>Y</mi> <mn>2</mn></msub> <mo>)</mo></mrow> <mo>â‰¤</mo> <mi>V</mi> <mi>a</mi> <mi>R</mi> <mrow><mo>(</mo> <msub><mi>Y</mi> <mn>1</mn></msub> <mo>)</mo></mrow> <mo>+</mo> <mi>V</mi> <mi>a</mi> <mi>R</mi> <mrow><mo>(</mo> <msub><mi>Y</mi> <mn>2</mn></msub> <mo>)</mo></mrow></mrow></math>

æ­¤å…¬ç†å¼ºè°ƒäº†åœ¨é£é™©ç®¡ç†ä¸­åˆ†æ•£åŒ–çš„é‡è¦æ€§ã€‚å‡è®¾<math alttext="upper Y 1"><msub><mi>Y</mi> <mn>1</mn></msub></math>å’Œ<math alttext="upper Y 2"><msub><mi>Y</mi> <mn>2</mn></msub></math>ä½œä¸ºä¸¤ä¸ªèµ„äº§ï¼šå¦‚æœå®ƒä»¬éƒ½åŒ…å«åœ¨æŠ•èµ„ç»„åˆä¸­ï¼Œåˆ™ç»“æœçš„ VaR æ¯”åˆ†å¼€æŒæœ‰å®ƒä»¬ä½ã€‚è®©æˆ‘ä»¬æ£€æŸ¥ VaR æ˜¯å¦æ»¡è¶³å­å¯åŠ æ€§å‡è®¾ï¼š

```py
In [43]: asset1 = [-0.5, 0, 0.1, 0.4] ![1](img/1.png)
         VaR1 = np.percentile(asset1, 90)
         print('VaR for the Asset 1 is {:.4f}'.format(VaR1))
         asset2 = [0, -0.5, 0.01, 0.4] ![2](img/2.png)
         VaR2 = np.percentile(asset2, 90)
         print('VaR for the Asset 2 is {:.4f}'.format(VaR2))
         VaR_all = np.percentile(asset1 + asset2, 90)
         print('VaR for the portfolio is {:.4f}'.format(VaR_all))
         VaR for the Asset 1 is 0.3100
         VaR for the Asset 2 is 0.2830
         VaR for the portfolio is 0.4000

In [44]: asset1 = [-0.5, 0, 0.05, 0.03] ![1](img/1.png)
         VaR1 = np.percentile(asset1, 90)
         print('VaR for the Asset 1 is {:.4f}'.format(VaR1))
         asset2 = [0, -0.5, 0.02, 0.8] ![2](img/2.png)
         VaR2 = np.percentile(asset2,90)
         print('VaR for the Asset 2 is {:.4f}'.format(VaR2))
         VaR_all = np.percentile(asset1 + asset2 , 90)
         print('VaR for the portfolio is {:.4f}'.format(VaR_all))
         VaR for the Asset 1 is 0.0440
         VaR for the Asset 2 is 0.5660
         VaR for the portfolio is 0.2750
```

![1](img/#co_modeling_market_risk_CO8-1)

ç¬¬ä¸€ä¸ªèµ„äº§çš„èµ„äº§å›æŠ¥ç‡

![2](img/#co_modeling_market_risk_CO8-2)

ç¬¬äºŒèµ„äº§çš„èµ„äº§å›æŠ¥ç‡

ç»“æœè¡¨æ˜ï¼ŒæŠ•èµ„ç»„åˆçš„ VaR æ¯”å„ä¸ªå•ç‹¬çš„ VaR ä¹‹å’Œè¦ä½ï¼Œè¿™æ˜¯ç”±äºåˆ†æ•£åŒ–é€šè¿‡é™ä½é£é™©æ¥å‡å°‘æŠ•èµ„ç»„åˆçš„ VaRã€‚

æ­£é½æ¬¡æ€§

å¯¹äºæ‰€æœ‰ç»“æœ *Y* å’Œ *a* > 0ï¼Œæˆ‘ä»¬æœ‰

<math alttext="dollar-sign upper V a upper R left-parenthesis a upper Y right-parenthesis equals a upper V a upper R left-parenthesis upper Y right-parenthesis dollar-sign"><mrow><mi>V</mi> <mi>a</mi> <mi>R</mi> <mo>(</mo> <mi>a</mi> <mi>Y</mi> <mo>)</mo> <mo>=</mo> <mi>a</mi> <mi>V</mi> <mi>a</mi> <mi>R</mi> <mo>(</mo> <mi>Y</mi> <mo>)</mo></mrow></math>

è¿™æ„å‘³ç€æŠ•èµ„ç»„åˆçš„é£é™©å’Œä»·å€¼æ˜¯åŒæ­¥å˜åŒ–çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŠ•èµ„ç»„åˆçš„ä»·å€¼å¢åŠ äº† *a*ï¼Œé£é™©ä¹Ÿä¼šå¢åŠ  *a*ã€‚

å•è°ƒæ€§

å¯¹äºä»»æ„ä¸¤ä¸ªç»“æœ <math alttext="upper Y 1"><msub><mi>Y</mi> <mn>1</mn></msub></math> å’Œ <math alttext="upper Y 2"><msub><mi>Y</mi> <mn>2</mn></msub></math> ï¼Œå¦‚æœ <math alttext="upper Y 1 less-than-or-equal-to upper Y 2"><mrow><msub><mi>Y</mi> <mn>1</mn></msub> <mo>â‰¤</mo> <msub><mi>Y</mi> <mn>2</mn></msub></mrow></math> ï¼Œé‚£ä¹ˆï¼š

<math alttext="dollar-sign upper V a upper R left-parenthesis upper Y 2 right-parenthesis less-than-or-equal-to upper V a upper R left-parenthesis upper Y 1 right-parenthesis dollar-sign"><mrow><mi>V</mi> <mi>a</mi> <mi>R</mi> <mrow><mo>(</mo> <msub><mi>Y</mi> <mn>2</mn></msub> <mo>)</mo></mrow> <mo>â‰¤</mo> <mi>V</mi> <mi>a</mi> <mi>R</mi> <mrow><mo>(</mo> <msub><mi>Y</mi> <mn>1</mn></msub> <mo>)</mo></mrow></mrow></math>

èµ·åˆï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥ä»¤äººå›°æƒ‘ï¼Œä½†ä»å•è°ƒæ€§æ¥çœ‹ï¼Œè¿™åœ¨æ›´é«˜èµ„äº§å›æŠ¥æƒ…å†µä¸‹æš—ç¤ºç€æ›´ä½çš„ VaRã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“ VaR ä¸æ˜¯ä¸€ä¸ªä¸€è‡´çš„é£é™©åº¦é‡ã€‚ç„¶è€Œï¼ŒVaR å¹¶ä¸æ˜¯æˆ‘ä»¬ä¼°ç®—å¸‚åœºé£é™©çš„å”¯ä¸€å·¥å…·ã€‚é¢„æœŸç¼ºå¤±æ˜¯å¦ä¸€ç§ä¸€è‡´çš„å¸‚åœºé£é™©åº¦é‡ã€‚

# é¢„æœŸç¼ºå¤±

ä¸ VaR ä¸åŒï¼ŒES å…³æ³¨çš„æ˜¯åˆ†å¸ƒçš„å°¾éƒ¨ã€‚æ›´å…·ä½“åœ°è¯´ï¼ŒES ä½¿æˆ‘ä»¬èƒ½å¤Ÿè€ƒè™‘å¸‚åœºä¸Šçš„æ„å¤–é£é™©ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€ ES å’Œ VaR æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚ç›¸åï¼Œå®ƒä»¬æ˜¯ç›¸å…³çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç”¨ VaR æ¥è¡¨è¾¾ ESã€‚

è®©æˆ‘ä»¬å‡è®¾æŸå¤±åˆ†å¸ƒæ˜¯è¿ç»­çš„ï¼›ç„¶å ES å¯ä»¥æ•°å­¦ä¸Šå®šä¹‰ä¸ºï¼š

<math alttext="dollar-sign upper E upper S Subscript alpha Baseline equals StartFraction 1 Over 1 minus alpha EndFraction integral Subscript alpha Superscript 1 Baseline q Subscript u Baseline d u dollar-sign"><mrow><mi>E</mi> <msub><mi>S</mi> <mi>Î±</mi></msub> <mo>=</mo> <mfrac><mn>1</mn> <mrow><mn>1</mn><mo>-</mo><mi>Î±</mi></mrow></mfrac> <msubsup><mo>âˆ«</mo> <mi>Î±</mi> <mn>1</mn></msubsup> <msub><mi>q</mi> <mi>u</mi></msub> <mi>d</mi> <mi>u</mi></mrow></math>

å…¶ä¸­ *q* è¡¨ç¤ºæŸå¤±åˆ†å¸ƒçš„åˆ†ä½æ•°ã€‚ES å…¬å¼è¡¨æ˜ï¼Œå®ƒä¸è¿‡æ˜¯æŸå¤±çš„åŠ æƒå¹³å‡å€¼ï¼Œ<math alttext="left-parenthesis 1 minus alpha right-parenthesis percent-sign"><mrow><mo>(</mo> <mn>1</mn> <mo>-</mo> <mi>Î±</mi> <mo>)</mo> <mo>%</mo></mrow></math>ã€‚

è®©æˆ‘ä»¬ç”¨ <math alttext="q Subscript u"><msub><mi>q</mi> <mi>u</mi></msub></math> å’Œ VaR è¿›è¡Œæ›¿ä»£ï¼Œå¾—åˆ°ä»¥ä¸‹æ–¹ç¨‹ï¼š

<math alttext="dollar-sign upper E upper S Subscript alpha Baseline equals StartFraction 1 Over 1 minus alpha EndFraction integral Subscript alpha Superscript 1 Baseline upper V a upper R Subscript u Baseline d u dollar-sign"><mrow><mi>E</mi> <msub><mi>S</mi> <mi>Î±</mi></msub> <mo>=</mo> <mfrac><mn>1</mn> <mrow><mn>1</mn><mo>-</mo><mi>Î±</mi></mrow></mfrac> <msubsup><mo>âˆ«</mo> <mi>Î±</mi> <mn>1</mn></msubsup> <mi>V</mi> <mi>a</mi> <msub><mi>R</mi> <mi>u</mi></msub> <mi>d</mi> <mi>u</mi></mrow></math>

æˆ–è€…ï¼Œå®ƒæ˜¯è¶…è¿‡ VaR çš„æŸå¤±çš„å‡å€¼ï¼š

<math alttext="dollar-sign upper E upper S Subscript alpha Baseline equals sans-serif upper E left-parenthesis upper L vertical-bar upper L greater-than upper V a upper R Subscript alpha Baseline right-parenthesis dollar-sign"><mrow><mi>E</mi> <msub><mi>S</mi> <mi>Î±</mi></msub> <mo>=</mo> <mi>ğ–¤</mi> <mrow><mo>(</mo> <mi>L</mi> <mo>|</mo> <mi>L</mi> <mo>></mo> <mi>V</mi> <mi>a</mi> <msub><mi>R</mi> <mi>Î±</mi></msub> <mo>)</mo></mrow></mrow></math>

æŸå¤±åˆ†å¸ƒå¯ä»¥æ˜¯è¿ç»­çš„æˆ–ç¦»æ•£çš„ï¼Œä½ å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ˜¯ç¦»æ•£å½¢å¼ï¼ŒES ä¼šä¸åŒï¼Œæ¯”å¦‚

<math alttext="dollar-sign upper E upper S Subscript alpha Baseline equals StartFraction 1 Over 1 minus alpha EndFraction sigma-summation Underscript n equals 0 Overscript 1 Endscripts max left-parenthesis upper L Subscript n Baseline right-parenthesis probability left-parenthesis upper L Subscript n Baseline right-parenthesis dollar-sign"><mrow><mi>E</mi> <msub><mi>S</mi> <mi>Î±</mi></msub> <mo>=</mo> <mfrac><mn>1</mn> <mrow><mn>1</mn><mo>-</mo><mi>Î±</mi></mrow></mfrac> <msubsup><mo>âˆ‘</mo> <mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow> <mn>1</mn></msubsup> <mtext>max</mtext> <mrow><mo>(</mo> <msub><mi>L</mi> <mi>n</mi></msub> <mo>)</mo></mrow> <mo form="prefix">Pr</mo> <mrow><mo>(</mo> <msub><mi>L</mi> <mi>n</mi></msub> <mo>)</mo></mrow></mrow></math>

å…¶ä¸­ <math alttext="m a x left-parenthesis upper L Subscript n Baseline right-parenthesis"><mrow><mi>m</mi> <mi>a</mi> <mi>x</mi> <mo>(</mo> <msub><mi>L</mi> <mi>n</mi></msub> <mo>)</mo></mrow></math> è¡¨ç¤ºæœ€å¤§çš„ç¬¬ <math alttext="n Superscript t h"><msup><mi>n</mi> <mrow><mi>t</mi><mi>h</mi></mrow></msup></math> æŸå¤±ï¼Œè€Œ <math alttext="probability left-parenthesis upper L Subscript n Baseline right-parenthesis"><mrow><mo form="prefix">Pr</mo> <mo>(</mo> <msub><mi>L</mi> <mi>n</mi></msub> <mo>)</mo></mrow></math> è¡¨ç¤ºç¬¬ <math alttext="n Superscript t h"><msup><mi>n</mi> <mrow><mi>t</mi><mi>h</mi></mrow></msup></math> æœ€é«˜æŸå¤±çš„æ¦‚ç‡ã€‚åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å…¬å¼åŒ–ä¸ºï¼š

```py
In [45]: def ES_parametric(initial_investment , conf_level):
             alpha = - norm.ppf(1 - conf_level,stocks_returns_mean,port_std)
             for i, j in zip(stocks.columns, range(len(stocks.columns))):
                 VaR_param = (initial_investment * alpha)[j] ![1](img/1.png)
                 ES_param = (1 / (1 - conf_level)) \
                            * initial_investment \
                            * norm.expect(lambda x: x,
                                          lb = norm.ppf(conf_level,
                                                        stocks_returns_mean[j],
                                                        port_std),
                                          loc = stocks_returns_mean[j],
                                          scale = port_std) ![2](img/2.png)
                 print(f"Parametric ES result for {i} is {ES_param}")

In [46]: ES_parametric(initial_investment, conf_level)
         Parametric ES result for IBM is 52776.42396231898
         Parametric ES result for MSFT is 54358.083277762125
         Parametric ES result for INTC is 52273.33281273264
```

![1](img/#co_modeling_market_risk_CO9-1)

ä¼°ç®—æ–¹å·®-åæ–¹å·® VaR

![2](img/#co_modeling_market_risk_CO9-2)

ç»™å®šç½®ä¿¡åŒºé—´ï¼ŒåŸºäº VaR ä¼°ç®— ES

ES ä¹Ÿå¯ä»¥åŸºäºå†å²è§‚å¯Ÿå€¼è®¡ç®—ã€‚ä¸å†å²æ¨¡æ‹Ÿ VaR æ–¹æ³•ç±»ä¼¼ï¼Œå¯ä»¥æ”¾å®½å‚æ•°å‡è®¾ã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆæ‰¾åˆ°å¯¹åº”äº 95%çš„ç¬¬ä¸€ä¸ªæ”¶ç›Šï¼ˆæˆ–æŸå¤±ï¼‰ï¼Œç„¶åå¤§äº 95%çš„è§‚å¯Ÿå€¼çš„å‡å€¼ç»™å‡ºæˆ‘ä»¬çš„ç»“æœã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰€åšçš„äº‹æƒ…ï¼š

```py
In [47]: def ES_historical(initial_investment, conf_level):
             for i, j in zip(stocks_returns.columns,
                             range(len(stocks_returns.columns))):
                 ES_hist_percentile95 = np.percentile(stocks_returns.loc[:, i],
                                                      5) ![1](img/1.png)
                 ES_historical = stocks_returns[str(i)][stocks_returns[str(i)] <=
                                                        ES_hist_percentile95]\
                                                        .mean() ![2](img/2.png)
                 print("Historical ES result for {} is {:.4f} "
                       .format(i, initial_investment * ES_historical))

In [48]: ES_historical(initial_investment, conf_level)
         Historical ES result for IBM is -64802.3898
         Historical ES result for MSFT is -65765.0848
         Historical ES result for INTC is -88462.7404
```

![1](img/#co_modeling_market_risk_CO10-1)

è®¡ç®—æ”¶ç›Šçš„ 95%

![2](img/#co_modeling_market_risk_CO10-2)

åŸºäºå†å²è§‚å¯Ÿå€¼ä¼°ç®— ES

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä»¥ä¼ ç»Ÿæ–¹å¼å»ºæ¨¡é¢„æœŸç¼ºå¤±ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™å¼•å…¥åŸºäºæœºå™¨å­¦ä¹ çš„æ–¹æ³•ï¼Œè¿›ä¸€æ­¥æå‡ ES æ¨¡å‹çš„ä¼°ç®—æ€§èƒ½å’Œå¯é æ€§äº†ã€‚

# æµåŠ¨æ€§å¢å¼ºçš„é¢„æœŸç¼ºå¤±

æ­£å¦‚è®¨è®ºçš„é‚£æ ·ï¼ŒES ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿è´¯çš„é£é™©åº¦é‡æ¥è¡¡é‡å¸‚åœºé£é™©ã€‚ç„¶è€Œï¼Œå°½ç®¡æˆ‘ä»¬å°†é‡‘èé£é™©åŒºåˆ†ä¸ºå¸‚åœºã€ä¿¡ç”¨ã€æµåŠ¨æ€§å’Œæ“ä½œé£é™©ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€è¿™äº›é£é™©å®Œå…¨æ— å…³ã€‚ç›¸åï¼Œå®ƒä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯ç›¸å…³çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦é‡‘èå±æœºå†²å‡»å¸‚åœºï¼Œå¸‚åœºé£é™©éšç€ä¿¡è´·é¢åº¦çš„ä¸‹é™è€Œä¸Šå‡ï¼Œè¿›è€Œå¢åŠ æµåŠ¨æ€§é£é™©ã€‚

å®‰ä¸œå°¼äºšå¾·æ–¯ï¼ˆ2014 å¹´ï¼Œç¬¬ 6 é¡µï¼‰æ”¯æŒè¿™ä¸€è§‚ç‚¹ï¼š

> å…¬å…±æµåŠ¨æ€§èµ„äº§æ± æ˜¯æµåŠ¨æ€§é£é™©å¯èƒ½å½±å“æŠµæŠ¼ä¿¡è´·ä¾›ç»™çš„èµ„æºçº¦æŸã€‚
> 
> åœ¨ 2007 å¹´è‡³ 2008 å¹´çš„é‡‘èå±æœºæœŸé—´ï¼Œé“¶è¡Œèèµ„æ¡ä»¶å—åˆ°å‹åŠ›çš„ä¸»è¦æ¥æºæ¥è‡ªæ‰¹å‘èèµ„å¸‚åœºä¸­ç»å†çš„èµ„é‡‘æµåŠ¨æ€§ä¸è¶³ã€‚

å¿½è§†é£é™©çš„æµåŠ¨æ€§ç»´åº¦å¯èƒ½å¯¼è‡´ä½ä¼°å¸‚åœºé£é™©ã€‚å› æ­¤ï¼Œå°† ES ä¸æµåŠ¨æ€§é£é™©ç»“åˆèµ·æ¥å¯èƒ½ä¼šæ›´å‡†ç¡®å’Œå¯é åœ°ä¼°ç®—ã€‚å¬èµ·æ¥å¾ˆå¸å¼•äººï¼Œä½†æˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°æµåŠ¨æ€§çš„ä»£ç†å‘¢ï¼Ÿ

æ–‡çŒ®ä¸­ï¼ŒæŠ¥ä»·ä»·å·®æ˜¯å¸¸ç”¨äºæµåŠ¨æ€§å»ºæ¨¡çš„è¡¡é‡æ ‡å‡†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ*æŠ¥ä»·ä»·å·®* æ˜¯ä¹°æ–¹æ„¿æ„æ”¯ä»˜çš„æœ€é«˜å¯ç”¨ä»·æ ¼ï¼ˆä¹°ä»·ï¼‰ä¸å–æ–¹æ„¿æ„æ¥å—çš„æœ€ä½ä»·æ ¼ï¼ˆå–ä»·ï¼‰ä¹‹é—´çš„å·®å¼‚ã€‚å› æ­¤ï¼ŒæŠ¥ä»·ä»·å·®æä¾›äº†è¡¡é‡äº¤æ˜“æˆæœ¬çš„å·¥å…·ã€‚

###### æ³¨æ„

*æµåŠ¨æ€§* å¯ä»¥å®šä¹‰ä¸ºåœ¨æçŸ­çš„æ—¶é—´å†…è¿›è¡Œäº¤æ˜“å¹¶ä¸”ä¸å¯¹å¸‚åœºä»·æ ¼äº§ç”Ÿæ˜¾è‘—å½±å“çš„ä¾¿åˆ©æ€§ã€‚ä¸»è¦æœ‰ä¸¤ç§æµåŠ¨æ€§çš„ä¸»è¦åº¦é‡ï¼š

å¸‚åœºæµåŠ¨æ€§

èµ„äº§äº¤æ˜“çš„ä¾¿åˆ©ç¨‹åº¦ã€‚

èµ„é‡‘æµåŠ¨æ€§

æŠ•èµ„è€…å¯ä»¥è·å–èµ„é‡‘çš„ä¾¿åˆ©ç¨‹åº¦ã€‚

æµåŠ¨æ€§åŠå…¶æ‰€å¸¦æ¥çš„é£é™©å°†åœ¨ç¬¬ä¸ƒç« ä¸­è¯¦ç»†è®¨è®ºã€‚

åœ¨æŸç§ç¨‹åº¦ä¸Šï¼ŒæŠ¥ä»·ä»·å·®æ˜¯äº¤æ˜“æˆæœ¬çš„è‰¯å¥½æŒ‡æ ‡ï¼Œä¹Ÿæ˜¯æµåŠ¨æ€§çš„è‰¯å¥½ä»£ç†ï¼Œå› ä¸ºäº¤æ˜“æˆæœ¬æ˜¯æµåŠ¨æ€§çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚æ ¹æ®å…¶å…³æ³¨ç‚¹çš„ä¸åŒï¼Œå¯ä»¥ä»¥å¤šç§æ–¹å¼å®šä¹‰ä»·å·®ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†ç”¨æ¥å°†æµåŠ¨æ€§é£é™©çº³å…¥ ES æ¨¡å‹çš„æŠ¥ä»·ä»·å·®ï¼š

æœ‰æ•ˆå·®ä»·

<math alttext="dollar-sign Effective spread equals 2 StartAbsoluteValue left-parenthesis upper P Subscript t Baseline minus upper P Subscript m i d Baseline right-parenthesis EndAbsoluteValue dollar-sign"><mrow><mtext>Effective</mtext> <mtext>spread</mtext> <mo>=</mo> <mn>2</mn> <mo>|</mo> <mo>(</mo> <msub><mi>P</mi> <mi>t</mi></msub> <mo>-</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub> <mo>)</mo> <mo>|</mo></mrow></math>

å…¶ä¸­ <math alttext="upper P Subscript t"><msub><mi>P</mi> <mi>t</mi></msub></math> æ˜¯æ—¶é—´ *t* æ—¶çš„äº¤æ˜“ä»·æ ¼ï¼Œ<math alttext="upper P Subscript m i d"><msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></math> æ˜¯æŠ¥ä»·ä¸­ç‚¹ï¼ˆ <math alttext="left-parenthesis upper P Subscript a s k Baseline minus upper P Subscript b i d Baseline right-parenthesis slash 2"><mrow><mo>(</mo> <msub><mi>P</mi> <mrow><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub> <mo>-</mo> <msub><mi>P</mi> <mrow><mi>b</mi><mi>i</mi><mi>d</mi></mrow></msub> <mo>)</mo> <mo>/</mo> <mn>2</mn></mrow></math> )ã€‚

æ¯”ä¾‹æŠ¥ä»·å·®ä»·

<math alttext="dollar-sign Proportional quoted spread equals left-parenthesis upper P Subscript a s k Baseline minus upper P Subscript b i d Baseline right-parenthesis slash upper P Subscript m i d Baseline dollar-sign"><mrow><mtext>Proportional</mtext> <mtext>quoted</mtext> <mtext>spread</mtext> <mo>=</mo> <mrow><mo>(</mo> <msub><mi>P</mi> <mrow><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub> <mo>-</mo> <msub><mi>P</mi> <mrow><mi>b</mi><mi>i</mi><mi>d</mi></mrow></msub> <mo>)</mo></mrow> <mo>/</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow></math>

å…¶ä¸­ <math alttext="upper P Subscript a s k"><msub><mi>P</mi> <mrow><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub></math> æ˜¯å–å‡ºä»·æ ¼ï¼Œ<math alttext="upper P Subscript b i d"><msub><mi>P</mi> <mrow><mi>b</mi><mi>i</mi><mi>d</mi></mrow></msub></math> å’Œ <math alttext="upper P Subscript m i d"><msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></math> åˆ†åˆ«æ˜¯ä¹°å…¥ä»·æ ¼å’Œä¸­é—´ä»·æ ¼ã€‚

æŠ¥ä»·å·®ä»·

<math alttext="dollar-sign Quoted spread equals upper P Subscript a s k Baseline minus upper P Subscript b i d Baseline dollar-sign"><mrow><mtext>Quoted</mtext> <mtext>spread</mtext> <mo>=</mo> <msub><mi>P</mi> <mrow><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub> <mo>-</mo> <msub><mi>P</mi> <mrow><mi>b</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow></math>

æ¯”ä¾‹æœ‰æ•ˆä¼ æ’­

<math alttext="dollar-sign Proportional effective spread equals 2 left-parenthesis StartAbsoluteValue upper P Subscript t Baseline minus upper P Subscript m i d Baseline EndAbsoluteValue right-parenthesis slash upper P Subscript m i d Baseline dollar-sign"><mrow><mtext>Proportional</mtext> <mtext>effective</mtext> <mtext>spread</mtext> <mo>=</mo> <mrow><mn>2</mn> <mo>(</mo> <mo>|</mo></mrow> <msub><mi>P</mi> <mi>t</mi></msub> <mo>-</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub> <mrow><mo>|</mo> <mo>)</mo></mrow> <mo>/</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub></mrow></math>

# æœ‰æ•ˆæˆæœ¬

å½“äº¤æ˜“ä»¥é«˜äºæŠ¥ä»·ä¸­ç‚¹çš„ä»·æ ¼æ‰§è¡Œæ—¶ï¼Œä¹°æ–¹å‘èµ·çš„äº¤æ˜“å‘ç”Ÿã€‚åŒæ ·ï¼Œå½“äº¤æ˜“ä»¥ä½äºæŠ¥ä»·ä¸­ç‚¹çš„ä»·æ ¼æ‰§è¡Œæ—¶ï¼Œå–æ–¹å‘èµ·çš„äº¤æ˜“å‘ç”Ÿã€‚ç„¶åæˆ‘ä»¬å¯ä»¥æè¿°*æœ‰æ•ˆæˆæœ¬*å¦‚ä¸‹ï¼š

<math mode="display"><mrow><mtext>Effective</mtext> <mtext>cost</mtext> <mo>=</mo> <mfenced close="" open="{" separators=""><mtable><mtr><mtd columnalign="left"><mrow><mrow><mo>(</mo> <msub><mi>P</mi> <mi>t</mi></msub> <mo>-</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub> <mo>)</mo></mrow> <mo>/</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub> <mtext>for</mtext> <mtext>buyer-initiated</mtext></mrow></mtd></mtr> <mtr><mtd columnalign="left"><mrow><mrow><mo>(</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub> <mo>/</mo> <msub><mi>P</mi> <mi>t</mi></msub> <mo>)</mo></mrow> <mo>/</mo> <msub><mi>P</mi> <mrow><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub> <mtext>for</mtext> <mtext>seller-initiated</mtext></mrow></mtd></mtr></mtable></mfenced></mrow></math>

ç°åœ¨æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•å°†è¿™äº›ä¹°å–å·®ä»·çº³å…¥ ES æ¨¡å‹ä¸­ï¼Œä»¥ä¾¿èƒ½å¤Ÿè€ƒè™‘æµåŠ¨æ€§é£é™©å’Œå¸‚åœºé£é™©ã€‚æˆ‘ä»¬å°†é‡‡ç”¨ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é‡‡ç”¨ä¹°å–å·®ä»·çš„æ¨ªæˆªé¢å‡å€¼ï¼Œå¦‚ Chordia ç­‰äººæ‰€å»ºè®®çš„ï¼ˆ2000 å¹´ï¼‰å’Œ PÃ¡stor å’Œ Stambaughï¼ˆ2003 å¹´ï¼‰ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯åº”ç”¨ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼Œå¦‚ Mancini ç­‰äººï¼ˆ2013 å¹´ï¼‰æ‰€æå‡ºçš„ã€‚

æ¨ªæˆªé¢å‡å€¼åªæ˜¯ä¹°å–å·®ä»·çš„é€è¡Œå¹³å‡ã€‚ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç”Ÿæˆå¸‚åœºèŒƒå›´å†…çš„æµåŠ¨æ€§åº¦é‡ã€‚å¹³å‡å…¬å¼å¦‚ä¸‹ï¼š

<math alttext="dollar-sign upper L Subscript upper M comma t Baseline equals StartFraction 1 Over upper N EndFraction sigma-summation Underscript i Overscript upper N Endscripts upper L Subscript i comma t dollar-sign"><mrow><msub><mi>L</mi> <mrow><mi>M</mi><mo>,</mo><mi>t</mi></mrow></msub> <mo>=</mo> <mfrac><mn>1</mn> <mi>N</mi></mfrac> <msubsup><mo>âˆ‘</mo> <mi>i</mi> <mi>N</mi></msubsup> <msub><mi>L</mi> <mrow><mi>i</mi><mo>,</mo><mi>t</mi></mrow></msub></mrow></math>

å…¶ä¸­ <math alttext="upper L Subscript upper M comma t"><msub><mi>L</mi> <mrow><mi>M</mi><mo>,</mo><mi>t</mi></mrow></msub></math> æ˜¯å¸‚åœºæµåŠ¨æ€§ï¼Œ<math alttext="upper L Subscript i comma t"><msub><mi>L</mi> <mrow><mi>i</mi><mo>,</mo><mi>t</mi></mrow></msub></math> æ˜¯ä¸ªä½“æµåŠ¨æ€§åº¦é‡ï¼Œå³æˆ‘ä»¬çš„ä¹°å–å·®ä»·ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥è®¡ç®—

<math alttext="dollar-sign upper E upper S Subscript upper L Baseline equals upper E upper S plus Liquidity cost dollar-sign"><mrow><mi>E</mi> <msub><mi>S</mi> <mi>L</mi></msub> <mo>=</mo> <mi>E</mi> <mi>S</mi> <mo>+</mo> <mtext>Liquidity</mtext> <mtext>cost</mtext></mrow></math><math alttext="dollar-sign upper E upper S Subscript upper L Baseline equals StartFraction 1 Over 1 minus alpha EndFraction integral Subscript alpha Superscript 1 Baseline upper V a upper R Subscript u Baseline d u plus one-half upper P Subscript l a s t Baseline left-parenthesis mu plus k sigma right-parenthesis dollar-sign"><mrow><mi>E</mi> <msub><mi>S</mi> <mi>L</mi></msub> <mo>=</mo> <mfrac><mn>1</mn> <mrow><mn>1</mn><mo>-</mo><mi>Î±</mi></mrow></mfrac> <msubsup><mo>âˆ«</mo> <mi>Î±</mi> <mn>1</mn></msubsup> <mi>V</mi> <mi>a</mi> <msub><mi>R</mi> <mi>u</mi></msub> <mi>d</mi> <mi>u</mi> <mo>+</mo> <mfrac><mn>1</mn> <mn>2</mn></mfrac> <msub><mi>P</mi> <mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub> <mrow><mo>(</mo> <mi>Î¼</mi> <mo>+</mo> <mi>k</mi> <mi>Ïƒ</mi> <mo>)</mo></mrow></mrow></math>

where

+   <math alttext="upper P Subscript l a s t"><msub><mi>P</mi> <mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub></math> æ˜¯æ”¶ç›˜è‚¡ä»·

+   <math alttext="mu"><mi>Î¼</mi></math> æ˜¯ä¼ æ’­çš„å¹³å‡å€¼

+   *k* æ˜¯ç”¨äºå®¹çº³å°¾éƒ¨åšå°¾çš„ç¼©æ”¾å› å­

+   <math alttext="sigma"><mi>Ïƒ</mi></math> æ˜¯ä¼ æ’­çš„æ ‡å‡†å·®

è¦å°†è¿™äº›æ–¹æ³•è½¬æ¢ä¸ºä»£ç ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

```py
In [49]: bid_ask = pd.read_csv('bid_ask.csv') ![1](img/1.png)

In [50]: bid_ask['mid_price'] = (bid_ask['ASKHI'] + bid_ask['BIDLO']) / 2 ![2](img/2.png)
         buyer_seller_initiated = []
         for i in range(len(bid_ask)):
             if bid_ask['PRC'][i] > bid_ask['mid_price'][i]: ![3](img/3.png)
                 buyer_seller_initiated.append(1) ![4](img/4.png)
             else:
                 buyer_seller_initiated.append(0) ![5](img/5.png)

         bid_ask['buyer_seller_init'] = buyer_seller_initiated

In [51]: effective_cost = []
         for i in range(len(bid_ask)):
             if bid_ask['buyer_seller_init'][i] == 1:
                 effective_cost.append((bid_ask['PRC'][i] -
                                        bid_ask['mid_price'][i]) /
                                        bid_ask['mid_price'][i]) ![6](img/6.png)
             else:
                 effective_cost.append((bid_ask['mid_price'][i] -
                                        bid_ask['PRC'][i])/
                                        bid_ask['mid_price'][i]) ![7](img/7.png)
         bid_ask['effective_cost'] = effective_cost

In [52]: bid_ask['quoted'] = bid_ask['ASKHI'] - bid_ask['BIDLO'] ![8](img/8.png)
         bid_ask['prop_quoted'] = (bid_ask['ASKHI'] - bid_ask['BIDLO']) /\
                                  bid_ask['mid_price'] ![8](img/8.png)
         bid_ask['effective'] = 2 * abs(bid_ask['PRC'] - bid_ask['mid_price']) ![8](img/8.png)
         bid_ask['prop_effective'] = 2 * abs(bid_ask['PRC'] -
                                             bid_ask['mid_price']) /\
                                             bid_ask['PRC'] ![8](img/8.png)

In [53]: spread_meas = bid_ask.iloc[:, -5:]
         spread_meas.corr()
Out[53]:                 effective_cost    quoted  prop_quoted  effective  \
         effective_cost        1.000000  0.441290     0.727917   0.800894
         quoted                0.441290  1.000000     0.628526   0.717246
         prop_quoted           0.727917  0.628526     1.000000   0.514979
         effective             0.800894  0.717246     0.514979   1.000000
         prop_effective        0.999847  0.442053     0.728687   0.800713

                         prop_effective
         effective_cost        0.999847
         quoted                0.442053
         prop_quoted           0.728687
         effective             0.800713
         prop_effective        1.000000

In [54]: spread_meas.describe()
Out[54]:     effective_cost      quoted  prop_quoted   effective  prop_effective
      count      756.000000  756.000000   756.000000  756.000000      756.000000
      mean         0.004247    1.592583     0.015869    0.844314        0.008484
      std          0.003633    0.921321     0.007791    0.768363        0.007257
      min          0.000000    0.320000     0.003780    0.000000        0.000000
      25%          0.001517    0.979975     0.010530    0.300007        0.003029
      50%          0.003438    1.400000     0.013943    0.610000        0.006874
      75%          0.005854    1.962508     0.019133    1.180005        0.011646
      max          0.023283    8.110000     0.055451    6.750000        0.047677

In [55]: high_corr = spread_meas.corr().unstack()\
                     .sort_values(ascending=False).drop_duplicates() ![9](img/9.png)
         high_corr[(high_corr > 0.80) & (high_corr != 1)] ![10](img/10.png)
Out[55]: effective_cost  prop_effective    0.999847
         effective       effective_cost    0.800894
         prop_effective  effective         0.800713
         dtype: float64

In [56]: sorted_spread_measures = bid_ask.iloc[:, -5:-2]

In [57]: cross_sec_mean_corr = sorted_spread_measures.mean(axis=1).mean() ![11](img/11.png)
         std_corr = sorted_spread_measures.std().sum() / 3 ![12](img/12.png)

In [58]: df = pd.DataFrame(index=stocks.columns)
         last_prices = []
         for i in symbols:
             last_prices.append(stocks[i].iloc[-1]) ![13](img/13.png)
         df['last_prices'] = last_prices

In [59]: def ES_parametric(initial_investment, conf_level):
             ES_params = [ ]
             alpha = - norm.ppf(1 - conf_level, stocks_returns_mean, port_std)
             for i,j in zip(stocks.columns,range(len(stocks.columns))):
                 VaR_param = (initial_investment * alpha)[j]
                 ES_param = (1 / (1 - conf_level)) \
                            * norm.expect(lambda x: VaR_param, lb = conf_level)
                 ES_params.append(ES_param)
             return ES_params

In [60]: ES_params = ES_parametric(initial_investment, conf_level)
         for i in range(len(symbols)):
             print(f'The ES result for {symbols[i]} is {ES_params[i]}')
         The ES result for IBM is 145760.89803654602
         The ES result for MSFT is 140349.84772375744
         The ES result for INTC is 147482.03450111256

In [61]: k = 1.96

         for i, j in zip(range(len(symbols)), symbols):
             print('The liquidity Adjusted ES of {} is {}'
                   .format(j, ES_params[i] + (df.loc[j].values[0] / 2) *
                           (cross_sec_mean_corr + k * std_corr))) ![14](img/14.png)
         The liquidity Adjusted ES of IBM is 145833.08767607837
         The liquidity Adjusted ES of MSFT is 140477.40110495212
         The liquidity Adjusted ES of INTC is 147510.60526566216
```

![1](img/#co_modeling_market_risk_CO11-1)

å¯¼å…¥ `bid_ask` æ•°æ®

![2](img/#co_modeling_market_risk_CO11-2)

è®¡ç®—ä¸­é—´ä»·æ ¼

![3](img/#co_modeling_market_risk_CO11-3)

å®šä¹‰ä¹°æ–¹å’Œå–æ–¹å‘èµ·äº¤æ˜“çš„æ¡ä»¶

![4](img/#co_modeling_market_risk_CO11-4)

å¦‚æœæ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œåˆ™è¿”å› 1ï¼Œå¹¶å°†å…¶é™„åŠ åˆ° `buyer_seller_initiated` åˆ—è¡¨ä¸­

![5](img/#co_modeling_market_risk_CO11-5)

å¦‚æœä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œåˆ™è¿”å› 0ï¼Œå¹¶å°†å…¶é™„åŠ åˆ° `buyer_seller_initiated` åˆ—è¡¨ä¸­

![6](img/#co_modeling_market_risk_CO11-6)

å¦‚æœ `buyer_seller_initiated` å˜é‡å–å€¼ä¸º 1ï¼Œåˆ™è¿è¡Œç›¸åº”çš„æœ‰æ•ˆæˆæœ¬å…¬å¼

![7](img/#co_modeling_market_risk_CO11-7)

å¦‚æœ `buyer_seller_initiated` å˜é‡å–å€¼ä¸º 0ï¼Œåˆ™è¿è¡Œç›¸åº”çš„æœ‰æ•ˆæˆæœ¬å…¬å¼

![8](img/#co_modeling_market_risk_CO11-8)

è®¡ç®—æŠ¥ä»·ã€æ¯”ä¾‹æŠ¥ä»·ã€æœ‰æ•ˆå’Œæ¯”ä¾‹æœ‰æ•ˆä¼ æ’­

![9](img/#co_modeling_market_risk_CO11-12)

è·å¾—ç›¸å…³çŸ©é˜µå¹¶æŒ‰åˆ—åˆ—å‡ºå®ƒä»¬

![10](img/#co_modeling_market_risk_CO11-13)

å¯¹ç›¸å…³æ€§å¤§äº 80% çš„æ’åº

![11](img/#co_modeling_market_risk_CO11-14)

è®¡ç®—ä¼ æ’­æµ‹é‡çš„æ¨ªæˆªé¢å‡å€¼

![12](img/#co_modeling_market_risk_CO11-15)

è·å–ä»·å·®çš„æ ‡å‡†åå·®

![13](img/#co_modeling_market_risk_CO11-16)

ä»`stocks`æ•°æ®ä¸­è¿‡æ»¤æœ€åè§‚å¯Ÿåˆ°çš„è‚¡ç¥¨ä»·æ ¼

![14](img/#co_modeling_market_risk_CO11-17)

ä¼°ç®—è°ƒæ•´åçš„ ESï¼ˆé¢„æœŸæŸå¤±ï¼‰

PCA æ˜¯ç”¨äºå‡å°‘ç»´åº¦çš„æ–¹æ³•ã€‚å®ƒç”¨å°½å¯èƒ½å°‘çš„ç»„ä»¶æå–å°½å¯èƒ½å¤šçš„ä¿¡æ¯ã€‚å¦‚æœæˆ‘ä»¬ä»¥å›¾ 5-4 ä¸ºä¾‹ï¼Œä»äº”ä¸ªç‰¹å¾ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½é€‰æ‹©ä¸¤ä¸ªç»„ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡é€‰æ‹©ç»„ä»¶æ•°æ¥å‡å°‘ç»´åº¦ï¼Œç‰ºç‰²äº†ä¿¡æ¯ï¼Œå› ä¸ºå–å†³äºæˆ‘ä»¬é€‰æ‹©çš„æˆªæ­¢ç‚¹ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ç»„ä»¶æ•°é‡ï¼Œä¸¢æ‰äº†å¤šå°‘ç»„ä»¶å°±ä¸¢æ‰äº†å¤šå°‘ä¿¡æ¯ã€‚

æ›´å…·ä½“åœ°è¯´ï¼Œå½“å›¾ 5-4 å˜å¾—å¹³å¦æ—¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¿ç•™çš„ä¿¡æ¯è¾ƒå°‘ï¼Œè¿™æ˜¯ PCA çš„æˆªæ­¢ç‚¹ã€‚ä½†æ˜¯ï¼Œé€‰æ‹©åˆé€‚çš„ç»„ä»¶æ•°é‡å¹¶ä¸å®¹æ˜“ï¼Œå› ä¸ºåœ¨æˆªæ­¢ç‚¹å’Œä¿ç•™ä¿¡æ¯ä¹‹é—´å­˜åœ¨æƒè¡¡ã€‚ä¸€æ–¹é¢ï¼Œæˆªæ­¢ç‚¹è¶Šé«˜ï¼ˆæˆ‘ä»¬æœ‰æ›´å¤šçš„ç»„ä»¶ï¼‰ï¼Œæˆ‘ä»¬ä¿ç•™çš„ä¿¡æ¯å°±è¶Šå¤šï¼ˆæˆ‘ä»¬å‡å°‘çš„ç»´åº¦å°±è¶Šå°‘ï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆªæ­¢ç‚¹è¶Šä½ï¼ˆæˆ‘ä»¬æœ‰æ›´å°‘çš„ç»„ä»¶ï¼‰ï¼Œæˆ‘ä»¬ä¿ç•™çš„ä¿¡æ¯å°±è¶Šå°‘ï¼ˆæˆ‘ä»¬å‡å°‘çš„ç»´åº¦å°±è¶Šé«˜ï¼‰ã€‚å¾—åˆ°å¹³å¦çš„å±å¹•å›¾å¹¶ä¸æ˜¯é€‰æ‹©åˆé€‚ç»„ä»¶æ•°é‡çš„å”¯ä¸€æ ‡å‡†ï¼Œé‚£ä¹ˆé€‰æ‹©é€‚å½“çš„ç»„ä»¶æ•°é‡çš„å¯èƒ½æ ‡å‡†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»¥ä¸‹æ˜¯ PCA é€‰æ‹©åˆé€‚ç»„ä»¶æ•°é‡çš„å¯èƒ½æ ‡å‡†ï¼š

+   è§£é‡Šæ–¹å·®å¤§äº 80%

+   å¤šä¸ªç‰¹å¾å€¼

+   å½“å±å¹•å›¾å˜å¾—å¹³å¦æ—¶

###### æ³¨æ„

è¯·æ³¨æ„ï¼ŒæµåŠ¨æ€§è°ƒæ•´ä¹Ÿå¯ä»¥åº”ç”¨äº VaRã€‚ VaR çš„ç›¸åŒè¿‡ç¨‹ä¹Ÿé€‚ç”¨ã€‚ä»æ•°å­¦ä¸Šè®²ï¼Œ

<math alttext="dollar-sign upper V a upper R Subscript upper L Baseline equals sigma Subscript p Baseline StartRoot t EndRoot upper Z Subscript alpha Baseline plus one-half upper P Subscript l a s t Baseline left-parenthesis mu plus k sigma right-parenthesis dollar-sign"><mrow><mi>V</mi> <mi>a</mi> <msub><mi>R</mi> <mi>L</mi></msub> <mo>=</mo> <msub><mi>Ïƒ</mi> <mi>p</mi></msub> <msqrt><mi>t</mi></msqrt> <msub><mi>Z</mi> <mi>Î±</mi></msub> <mo>+</mo> <mfrac><mn>1</mn> <mn>2</mn></mfrac> <msub><mi>P</mi> <mrow><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi></mrow></msub> <mrow><mo>(</mo> <mi>Î¼</mi> <mo>+</mo> <mi>k</mi> <mi>Ïƒ</mi> <mo>)</mo></mrow></mrow></math>

æ­¤åº”ç”¨ç•™ç»™è¯»è€…ã€‚

ç„¶è€Œï¼Œå‡å°‘ç»´åº¦å¹¶ä¸æ˜¯æˆ‘ä»¬å”¯ä¸€å¯ä»¥åˆ©ç”¨çš„ä¸œè¥¿ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åº”ç”¨ PCA æ˜¯ä¸ºäº†è·å¾—æµåŠ¨æ€§çš„ç‹¬ç‰¹ç‰¹å¾ï¼Œå› ä¸º PCA ä¸ºæˆ‘ä»¬ä»æ•°æ®ä¸­è¿‡æ»¤å‡ºæœ€é‡è¦çš„ä¿¡æ¯ï¼š

```py
In [62]: from sklearn.decomposition import PCA
         from sklearn.preprocessing import StandardScaler

In [63]: scaler = StandardScaler()
         spread_meas_scaled = scaler.fit_transform(np.abs(spread_meas)) ![1](img/1.png)
         pca = PCA(n_components=5) ![2](img/2.png)
         prin_comp = pca.fit_transform(spread_meas_scaled) ![3](img/3.png)

In [64]: var_expl = np.round(pca.explained_variance_ratio_, decimals=4) ![4](img/4.png)
         cum_var = np.cumsum(np.round(pca.explained_variance_ratio_,
                                      decimals=4)) ![5](img/5.png)
         print('Individually Explained Variances are:\n{}'.format(var_expl))
         print('=='*30)
         print('Cumulative Explained Variances are: {}'.format(cum_var))
         Individually Explained Variances are:
         [0.7494 0.1461 0.0983 0.0062 0.    ]
         ============================================================
         Cumulative Explained Variances are: [0.7494 0.8955 0.9938 1.     1.    ]

In [65]: plt.plot(pca.explained_variance_ratio_) ![6](img/6.png)
         plt.xlabel('Number of Components')
         plt.ylabel('Variance Explained')
         plt.title('Scree Plot')
         plt.show()
In [66]: pca = PCA(n_components=2) ![7](img/7.png)
         pca.fit(np.abs(spread_meas_scaled))
         prin_comp = pca.transform(np.abs(spread_meas_scaled))
         prin_comp = pd.DataFrame(np.abs(prin_comp), columns = ['Component 1',
                                                                'Component 2'])
         print(pca.explained_variance_ratio_*100)
         [65.65640435 19.29704671]

In [67]: def myplot(score, coeff, labels=None):
             xs = score[:, 0]
             ys = score[:, 1]
             n = coeff.shape[0]
             scalex = 1.0 / (xs.max() - xs.min())
             scaley = 1.0 / (ys.max() - ys.min())
             plt.scatter(xs * scalex * 4, ys * scaley * 4, s=5)
             for i in range(n):
                 plt.arrow(0, 0, coeff[i, 0], coeff[i, 1], color = 'r',
                           alpha=0.5)
                 if labels is None:
                     plt.text(coeff[i, 0], coeff[i, 1], "Var"+str(i),
                              color='black')
                 else:
                     plt.text(coeff[i,0 ], coeff[i, 1], labels[i],
                              color='black')

             plt.xlabel("PC{}".format(1))
             plt.ylabel("PC{}".format(2))
             plt.grid()

In [68]: spread_measures_scaled_df = pd.DataFrame(spread_meas_scaled,
                                                  columns=spread_meas.columns)

In [69]: myplot(np.array(spread_measures_scaled_df)[:, 0:2],
                np.transpose(pca.components_[0:2,:]),
                list(spread_measures_scaled_df.columns)) ![8](img/8.png)
         plt.show()
```

![1](img/#co_modeling_market_risk_CO12-1)

æ ‡å‡†åŒ–ä»·å·®æµ‹é‡å€¼

![2](img/#co_modeling_market_risk_CO12-2)

å°†ä¸»æˆåˆ†æ•°ç¡®å®šä¸º 5

![3](img/#co_modeling_market_risk_CO12-3)

å°†ä¸»æˆåˆ†åº”ç”¨äº*spread_measures_scaled*

![4](img/#co_modeling_market_risk_CO12-4)

è§‚å¯Ÿäº”ä¸ªä¸»æˆåˆ†çš„è§£é‡Šæ–¹å·®

![5](img/#co_modeling_market_risk_CO12-5)

è§‚å¯Ÿäº”ä¸ªä¸»æˆåˆ†çš„ç´¯ç§¯è§£é‡Šæ–¹å·®

![6](img/#co_modeling_market_risk_CO12-6)

ç»˜åˆ¶*å±å¹•å›¾*ï¼ˆå›¾ 5-4ï¼‰

![7](img/#co_modeling_market_risk_CO12-7)

æ ¹æ®å±å¹•å›¾ï¼Œç¡®å®šä½¿ç”¨ä¸¤ä¸ªç»„ä»¶è¿›è¡Œ PCA åˆ†æ

![8](img/#co_modeling_market_risk_CO12-8)

ç»˜åˆ¶*åŒæ ‡å›¾*ï¼ˆå›¾ 5-5ï¼‰ä»¥è§‚å¯Ÿç»„ä»¶å’Œç‰¹å¾ä¹‹é—´çš„å…³ç³»

![mlfr 0504](img/mlfr_0504.png)

###### å›¾ 5-4\. PCA å±å¹•å›¾

![mlfr 0505](img/mlfr_0505.png)

###### å›¾ 5-5\. PCA åŒæ ‡å›¾

ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ï¼Œå¹¶é€šè¿‡æ•´åˆè¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—æµåŠ¨æ€§è°ƒæ•´çš„ ESã€‚æ¯«ä¸å¥‡æ€ªï¼Œä¸‹é¢çš„ä»£ç æ˜¾ç¤ºï¼Œä¸æ ‡å‡† ES åº”ç”¨ç›¸æ¯”ï¼ŒæµåŠ¨æ€§è°ƒæ•´çš„ ES æä¾›äº†æ›´å¤§çš„å€¼ã€‚è¿™æ„å‘³ç€åœ¨æˆ‘ä»¬çš„ ES ä¼°è®¡ä¸­åŒ…å«äº†æµåŠ¨æ€§ç»´åº¦ï¼Œå¯¼è‡´äº†æ›´é«˜çš„é£é™©ï¼š

```py
In [70]: prin_comp1_rescaled = prin_comp.iloc[:,0] * prin_comp.iloc[:,0].std()\
                               + prin_comp.iloc[:, 0].mean() ![1](img/1.png)
         prin_comp2_rescaled = prin_comp.iloc[:,1] * prin_comp.iloc[:,1].std()\
                               + prin_comp.iloc[:, 1].mean() ![2](img/2.png)
         prin_comp_rescaled = pd.concat([prin_comp1_rescaled,
                                         prin_comp2_rescaled],
                                        axis=1)
         prin_comp_rescaled.head()
Out[70]:    Component 1  Component 2
         0     1.766661     1.256192
         1     4.835170     1.939466
         2     3.611486     1.551059
         3     0.962666     0.601529
         4     0.831065     0.734612

In [71]: mean_pca_liq = prin_comp_rescaled.mean(axis=1).mean() ![3](img/3.png)
         mean_pca_liq
Out[71]: 1.0647130086973815

In [72]: k = 1.96
         for i, j in zip(range(len(symbols)), symbols):
             print('The liquidity Adjusted ES of {} is {}'
                   .format(j, ES_params[i] + (df.loc[j].values[0] / 2) *
                           (mean_pca_liq + k * std_corr))) ![4](img/4.png)
         The liquidity Adjusted ES of IBM is 145866.2662997893
         The liquidity Adjusted ES of MSFT is 140536.02510785797
         The liquidity Adjusted ES of INTC is 147523.7364940803
```

![1](img/#co_modeling_market_risk_CO13-1)

è®¡ç®—æµåŠ¨æ€§è°ƒæ•´ ES å…¬å¼çš„æµåŠ¨æ€§éƒ¨åˆ†ï¼Œç”¨äºç¬¬ä¸€ä¸»æˆåˆ†

![2](img/#co_modeling_market_risk_CO13-2)

è®¡ç®—æµåŠ¨æ€§è°ƒæ•´ ES å…¬å¼çš„æµåŠ¨æ€§éƒ¨åˆ†ï¼Œç”¨äºç¬¬äºŒä¸»æˆåˆ†

![3](img/#co_modeling_market_risk_CO13-3)

è®¡ç®—ä¸¤ä¸ªä¸»æˆåˆ†çš„æ¨ªæˆªé¢å‡å€¼

![4](img/#co_modeling_market_risk_CO13-4)

ä¼°ç®—æµåŠ¨æ€§è°ƒæ•´çš„ ES

# ç»“è®º

å¸‚åœºé£é™©ä¸€ç›´å—åˆ°å…³æ³¨ï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºäº†å…¬å¸åœ¨å¸‚åœºäº‹ä»¶å¸¦æ¥çš„é£é™©æ–¹é¢çš„è„†å¼±ç¨‹åº¦ã€‚åœ¨é‡‘èé£é™©ç®¡ç†æ•™æä¸­ï¼Œå¾€å¾€ä¼šæ‰¾åˆ° VaR å’Œ ES æ¨¡å‹ï¼Œè¿™ä¸¤ä¸ªæ¨¡å‹åœ¨ç†è®ºå’Œå®è·µä¸­éƒ½æ˜¯çªå‡ºå’Œå¸¸ç”¨çš„æ¨¡å‹ã€‚åœ¨æœ¬ç« ä¸­ï¼Œåœ¨ä»‹ç»è¿™äº›æ¨¡å‹ä¹‹åï¼Œä»‹ç»äº†é‡æ–°å®¡è§†å’Œæ”¹è¿›æ¨¡å‹ä¼°è®¡çš„æ¨¡å‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå°è¯•åŒºåˆ†å™ªå£°å’Œä¿¡å·çš„ä¿¡æ¯æµï¼Œè¿™è¢«ç§°ä¸ºå»å™ªã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨å»å™ªçš„åæ–¹å·®çŸ©é˜µæ¥æ”¹è¿› VaR ä¼°è®¡ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¨è®ºäº† ES æ¨¡å‹ä½œä¸ºä¸€ä¸ªè¿è´¯çš„é£é™©åº¦é‡ã€‚æˆ‘ä»¬ç”¨æ¥æ”¹è¿›è¿™ä¸ªæ¨¡å‹çš„æ–¹æ³•æ˜¯åŸºäºæµåŠ¨æ€§çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬é‡æ–°å®¡è§†äº† ES æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨æµåŠ¨æ€§ç»„ä»¶å¢å¼ºäº†å®ƒï¼Œä»¥ä¾¿èƒ½å¤Ÿè€ƒè™‘æµåŠ¨æ€§é£é™©æ¥ä¼°è®¡ ESã€‚

å¸‚åœºé£é™©ä¼°è®¡çš„è¿›ä¸€æ­¥æ”¹è¿›æ˜¯å¯èƒ½çš„ï¼Œä½†æˆ‘ä»¬åœ¨è¿™é‡Œçš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªä¸€èˆ¬çš„æ¦‚å¿µå’Œå¿…è¦çš„å·¥å…·ï¼Œä»¥ä¸ºåŸºäº ML çš„å¸‚åœºé£é™©æ–¹æ³•æä¾›ä¸€ä¸ªä½“é¢çš„åŸºç¡€ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥è¿›ä¸€æ­¥åº”ç”¨ä¸åŒçš„å·¥å…·ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºåƒå·´å¡å°”é“¶è¡Œç›‘ç£å§”å‘˜ä¼šï¼ˆBCBSï¼‰ç­‰ç›‘ç®¡æœºæ„å»ºè®®çš„ä¿¡è´·é£é™©å»ºæ¨¡ï¼Œç„¶åä½¿ç”¨åŸºäº ML çš„æ–¹æ³•ä¸°å¯Œè¿™ä¸ªæ¨¡å‹ã€‚

# å‚è€ƒèµ„æ–™

æœ¬ç« å¼•ç”¨çš„æ–‡ç« ï¼š

+   Antoniades, Adonis. 2016\. â€œæµåŠ¨æ€§é£é™©ä¸ 2007-2008 å¹´ä¿¡è´·ç´§ç¼©: åŸºäºæŠµæŠ¼è´·æ¬¾ç”³è¯·çš„å¾®è§‚æ•°æ®çš„è¯æ®ã€‚â€ *é‡‘èä¸æ•°é‡åˆ†ææ‚å¿—* 51 (6): 1795-1822ã€‚

+   Bzdok, D., N. Altman, and M. Krzywinski. 2018\. â€œè¦ç‚¹: ç»Ÿè®¡å­¦ä¸æœºå™¨å­¦ä¹ ã€‚â€ *è‡ªç„¶æ–¹æ³•* 15 (4): 233-234.

+   BISï¼Œå¸‚åœºé£é™© RWA çš„è®¡ç®—ï¼Œ2020 å¹´ã€‚

+   Chordia, Tarun, Richard Roll, å’Œ Avanidhar Subrahmanyam. 2000\. â€œæµåŠ¨æ€§çš„å…±æ€§ã€‚â€ é‡‘èç»æµå­¦æ‚å¿— 56 (1): 3-28ã€‚

+   Mancini, Loriano, Angelo Ranaldo, å’Œ Jan Wrampelmeyer. 2013\. â€œå¤–æ±‡å¸‚åœºæµåŠ¨æ€§ï¼šæµ‹é‡ã€å…±æ€§å’Œé£é™©æº¢ä»·ã€‚â€ *é‡‘èå­¦æ‚å¿—* 68 (5): 1805-1841ã€‚

+   PÃ¡stor, Ä½uboÅ¡, å’Œ Robert F. Stambaugh. 2003\. â€œæµåŠ¨æ€§é£é™©ä¸é¢„æœŸè‚¡ç¥¨å›æŠ¥ã€‚â€ *æ”¿æ²»ç»æµå­¦æ‚å¿—* 111 (3): 642-685ã€‚

æœ¬ç« å¼•ç”¨çš„ä¹¦ç±æœ‰ï¼š

+   Dowd, Kevin. 2003\. *å¸‚åœºé£é™©æµ‹é‡å¯¼è®º*. Hoboken, NJ: John Wiley and Sons.

+   Glasserman, Paul. *é‡‘èå·¥ç¨‹ä¸­çš„è’™ç‰¹å¡ç½—æ–¹æ³•*. 2013\. éšæœºå»ºæ¨¡ä¸åº”ç”¨æ¦‚ç‡ç³»åˆ—ï¼Œç¬¬ 53 å·ã€‚çº½çº¦ï¼šSpringer Science & Business Mediaã€‚

+   M. LÃ³pez De Prado. 2020\. *èµ„äº§ç®¡ç†çš„æœºå™¨å­¦ä¹ *. å‰‘æ¡¥ï¼šå‰‘æ¡¥å¤§å­¦å‡ºç‰ˆç¤¾ã€‚

^(1) æ­¤è¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯å¯åœ¨[Hudson and Thames](https://oreil.ly/gkQjX)æ‰¾åˆ°ã€‚

^(2) æ›´å¤šä¿¡æ¯è¯·å‚é˜…[NBER çš„ç½‘ç«™](https://oreil.ly/07s71)ã€‚
