<html><head></head><body><section data-pdf-bookmark="Chapter 6. Introductory Python for Data Science" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch06">&#13;
<h1><span class="label">Chapter 6. </span>Introductory Python for Data Science</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="data science" data-secondary="Python for" data-type="indexterm" id="Chapter_6.html0"/><a contenteditable="false" data-primary="Python" data-type="indexterm" id="Chapter_6.html1"/><a contenteditable="false" data-primary="Python" data-secondary="basics for data science" data-type="indexterm" id="Chapter_6.html2"/>This is the final chapter before we dive into the realm of machine and deep learning. This chapter is optional for experienced Python developers but is important for anyone without a solid programming background. Understanding the intuition behind the algorithms is a great advantage, but that knowledge will not get you far if you fail to properly implement the algorithms. After all, these algorithms need to be coded to work and do not function manually, so you need to understand the basic syntax and how to manipulate and transform data.</p>&#13;
&#13;
<p>As the book is not meant to be an A–Z guide to programming in Python, this chapter only focuses on some of the essentials and a few additional techniques that should help you smoothly navigate the subsequent chapters.</p>&#13;
&#13;
<section data-pdf-bookmark="Downloading Python" data-type="sect1"><div class="sect1" id="id39">&#13;
<h1>Downloading Python</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="Python" data-secondary="downloading" data-type="indexterm" id="Chapter_6.html3"/><em>Code</em> is defined as a set of instructions designed to be executed by a computer. Generally, specific syntax is required so that the computer applies the set of instructions without errors. There are many coding languages, and they are divided into two broad categories:</p>&#13;
&#13;
<dl>&#13;
	<dt>Low-level coding languages</dt>&#13;
	<dd><p>These are machine languages usually used to write operating systems and firmware. They are very difficult to read. These languages have a sizable level of control over hardware. Assembly language is an example of a low-level language.</p></dd>&#13;
</dl>&#13;
&#13;
<dl>&#13;
	<dt>High-level coding languages</dt>&#13;
	<dd><p>These are user-friendly languages (with a high level of abstraction). They are generally used to code programs and software. Examples of high-level languages include Python and Julia.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The coding language used in this book is Python, a popular and versatile language with many advantages and wide adoption in the research and professional trading communities. As you have probably gathered from the chapter’s title, you will get an introduction to Python and to the tools you need to start building your own scripts. But before that, you need to download Python.</p>&#13;
&#13;
<p><a contenteditable="false" data-primary="Python interpreter" data-type="indexterm" id="id553"/><a contenteditable="false" data-primary="Spyder interface" data-type="indexterm" id="id554"/>A <em>Python interpreter</em> is software used to write and execute code written using Python syntax. I use Spyder. Some people may be more familiar with other interpreters such as Jupyter and PyCharm, but the process is the same. You can download Spyder from the <a href="https://oreil.ly/Vlh4c">official website</a> or, even better, download it as part of a bigger package called <a href="https://oreil.ly/nI8Ed">Anaconda</a>, which facilitates installation and offers more tools. Note that Spyder is open source and free to use.</p>&#13;
&#13;
<p><a data-type="xref" href="#figure-6-1">Figure 6-1</a> shows Python’s console, where the output of the code appears.</p>&#13;
&#13;
<figure><div class="figure" id="figure-6-1"><img alt="" class="iimagesdlf_0601png" src="assets/dlff_0601.png"/>&#13;
<h6><span class="label">Figure 6-1. </span>Spyder’s console</h6>&#13;
</div></figure>&#13;
&#13;
<p>Python files have the extension <em>.py</em>, and they allow you to save the code and refer to it at a later stage. You can also open multiple files of code and navigate between them.</p>&#13;
&#13;
<p>The outline of this chapter is as follows:</p>&#13;
&#13;
<ul>&#13;
	<li>Understand the language of Python and how to write error-free code</li>&#13;
	<li>Understand how to use control flow and its importance with time series analysis</li>&#13;
	<li>Understand libraries and functions and their role in facilitating coding</li>&#13;
	<li class="pagebreak-before less_space">Understand different types of errors and how to handle them</li>&#13;
	<li>Understand how to use data manipulation libraries such as <em>numpy</em> and <em>pandas</em></li>&#13;
	<li>Finally, see how to import historical financial time series data into Python so that it gets analyzed with the proper tools (those we already discussed as well as those we will discuss in coming chapters)<a contenteditable="false" data-primary="" data-startref="Chapter_6.html3" data-type="indexterm" id="id555"/></li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Basic Operations and Syntax" data-type="sect1"><div class="sect1" id="id40">&#13;
<h1>Basic Operations and Syntax</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="Python" data-secondary="basic operations and syntax" data-type="indexterm" id="Chapter_6.html4"/><em>Syntax</em> <a contenteditable="false" data-primary="syntax, defined" data-type="indexterm" id="id556"/>is the set of rules that define the structure of statements needed to write code that functions. When you are communicating with a computer, you have to make sure it understands you, so having a solid understanding of syntax is important.</p>&#13;
&#13;
<p><a contenteditable="false" data-primary="comments, in Python" data-type="indexterm" id="id557"/><em>Comments </em>are nonexecutable code used to explain the executable code that follows. Comments are used so that other programmers understand the code. Comments in Python are preceded by a hash sign (<strong>#</strong>):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># This is a comment. Comments are ignored by the interpreter</code>&#13;
<code class="c1"># Comments explain the code or give more details about its use</code>&#13;
<code class="c1"># Comments are written on one line; otherwise, you have to rewrite '#'</code></pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Make sure you understand that comments are nonexecutable. This means that when you run (execute) the code, they will be ignored by the interpreter and will not return an error.</p>&#13;
</div>&#13;
&#13;
<p class="fix_tracking">Sometimes you need to write documentation for your code, which may require multiple lines of code (even paragraphs, in some instances). Writing the hash sign at every line can be tedious and cluttersome. This is why there is a way to write long comments. To do this, write your comment between three single quotation marks as follows:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="sd">'''</code>&#13;
<code class="sd">Python was created in the late 1980s by Guido van Rossum</code>&#13;
<code class="sd">The name "Python" was inspired by the comedy group Monty Python</code>&#13;
<code class="sd">'''</code>&#13;
</pre>&#13;
&#13;
<p>It is worth noting that triple quotes are called <em>docstrings </em>and are not really comments (according to the official Python documentation).</p>&#13;
&#13;
<p class="pagebreak-after"><a contenteditable="false" data-primary="constants" data-type="indexterm" id="id558"/><a contenteditable="false" data-primary="variables (Python)" data-type="indexterm" id="id559"/>Let’s discuss variables and constants. A <em>constant </em>is a fixed value that does not change, whereas a <em>variable </em>takes on different values given an event. A constant can be the number 6, while a variable can be the letter <em>x</em>, which takes on any number given a set of conditions or a state. A variable is defined using the <code>=</code> operator:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining a variable</code>&#13;
<code class="n">x</code> <code class="o">=</code> <code class="mi">10</code>&#13;
<code class="c1"># Writing a constant</code>&#13;
<code class="mi">6</code>&#13;
</pre>&#13;
&#13;
<p>Running (executing) the previous code will store the variable <code>x</code> with its respective value in the variable explorer. Simultaneously, the output of the code will be <code>6</code>. Variables are case sensitive. Therefore:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Declaring my_variable</code>&#13;
<code class="n">my_variable</code> <code class="o">=</code> <code class="mi">1</code>&#13;
<code class="c1"># Declaring My_variable</code>&#13;
<code class="n">My_variable</code> <code class="o">=</code> <code class="mi">2</code>&#13;
<code class="c1"># The variable my_variable is different from My_variable</code></pre>&#13;
&#13;
<p>A variable declaration cannot start with a number, but a number can be included in the middle or the end of a variable declaration:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Returns a SyntaxError</code>&#13;
<code class="mi">1</code><code class="n">x</code> <code class="o">=</code> <code class="mi">5</code>&#13;
<code class="c1"># Valid declaration</code>&#13;
<code class="n">x1</code> <code class="o">=</code> <code class="mi">5</code>&#13;
<code class="c1"># Valid declaration</code>&#13;
<code class="n">x1x</code> <code class="o">=</code> <code class="mi">5</code>&#13;
</pre>&#13;
&#13;
<p>Variables can also contain underscores but nothing else:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Returns a SyntaxError</code>&#13;
<code class="n">x</code><code class="err">–</code><code class="n">y</code> <code class="o">=</code> <code class="mi">5</code>&#13;
<code class="c1"># Valid declaration</code>&#13;
<code class="n">x_y</code> <code class="o">=</code> <code class="mi">5</code>&#13;
</pre>&#13;
&#13;
<p>It is highly recommended that variables have short and straightforward names. For example, consider creating a variable that holds the lookback period of a certain moving average (a technical indicator introduced in <a data-type="xref" href="ch05.html#ch05">Chapter 5</a>):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Recommended name</code>&#13;
<code class="n">ma_lookback</code> <code class="o">=</code> <code class="mi">10</code>&#13;
<code class="c1"># Not recommended name</code>&#13;
<code class="n">the_lookback_on_that_moving_average</code> <code class="o">=</code> <code class="mi">10</code>&#13;
</pre>&#13;
&#13;
<p><a contenteditable="false" data-primary="data types, Python" data-type="indexterm" id="Chapter_6.html5"/><a contenteditable="false" data-primary="Python" data-secondary="data types" data-type="indexterm" id="Chapter_6.html6"/>There are several different data types with different characteristics:</p>&#13;
&#13;
<dl>&#13;
	<dt><em>Numerical data types</em></dt>&#13;
	<dd><p><a contenteditable="false" data-primary="numerical data types (Python)" data-type="indexterm" id="id560"/>This is the simplest data type, formed exclusively from numbers. Numerical data types are divided into integers, float numbers, and complex numbers. <em>Integers </em>are simple whole numbers (positive or negative), such as 6 and –19. <em>Float numbers</em> are more precise than integers as they incorporate the values after the comma, for example, 2.7 and –8.09. <em>Complex numbers</em> include imaginary numbers.<sup><a data-type="noteref" href="ch06.html#id561" id="id561-marker">1</a></sup></p></dd>&#13;
</dl>&#13;
&#13;
<dl>&#13;
	<dt><em>Strings</em></dt>&#13;
	<dd><p><a contenteditable="false" data-primary="strings, in Python" data-type="indexterm" id="id562"/>As you saw previously with comments and docstrings, it is possible to write text next to the code without it interfering with the execution process. <em>Strings </em>are text structures that represent sequences of characters. Strings can be inputs and arguments of functions and not necessarily just comments.</p></dd>&#13;
</dl>&#13;
&#13;
<dl>&#13;
	<dt><em>Booleans</em></dt>&#13;
	<dd><p><a contenteditable="false" data-primary="Booleans, in Python" data-type="indexterm" id="id563"/>A Boolean is a binary (true or false) data type used to evaluate the truth value of the given expression or condition. For example, you can use Booleans to evaluate whether the market price is above or below the 100-period moving average.</p></dd>&#13;
</dl>&#13;
&#13;
<dl>&#13;
	<dt><em>Data collection</em></dt>&#13;
	<dd><p><a contenteditable="false" data-primary="data collection, in Python" data-type="indexterm" id="id564"/>These are sequences that contain multiple datasets, each having a different and unique usage. <a contenteditable="false" data-primary="arrays, in Python" data-type="indexterm" id="id565"/>An <em>array </em>is a sequence of elements of the same type (mostly numerical). Arrays will be used frequently in this book (with a Python library called <em>numpy</em> that is discussed in this chapter). <a contenteditable="false" data-primary="dataframe, in Python" data-type="indexterm" id="id566"/>A <em>dataframe</em> is a two-dimensional table of structured data that is also frequently used in this book (with a Python library called <em>pandas</em> also discussed in this chapter). <a contenteditable="false" data-primary="set, in Python" data-type="indexterm" id="id567"/>A <em>set </em>is a sequence of unordered elements. <a contenteditable="false" data-primary="lists, in Python" data-type="indexterm" id="id568"/>A <em>list </em>is an ordered collection of elements that can be of different data types. A <a contenteditable="false" data-primary="tuple, in Python" data-type="indexterm" id="id569"/><em>tuple </em>is an ordered, immutable collection of elements that may be of different data types. It is used for storing a fixed sequence of values. A <a contenteditable="false" data-primary="dictionaries, in Python" data-type="indexterm" id="id570"/><em>dictionary </em>represents a collection of key-value pairs grouped together.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The following code snippet shows a few examples of the numerical data type:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Creating a variable that holds an integer</code>&#13;
<code class="n">my_integer</code> <code class="o">=</code> <code class="mi">1</code>&#13;
<code class="c1"># Creating a variable that holds a float number</code>&#13;
<code class="n">my_float_number</code> <code class="o">=</code> <code class="mf">1.2</code>&#13;
<code class="c1"># Using the built-in Python function type() to verify the variables</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">my_integer</code><code class="p">)</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">my_float_number</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>The output should be as follows (note that the two created variables will appear in the variable explorer):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="nb">int</code> <code class="c1"># The output of type(my_integer)</code>&#13;
<code class="nb">float</code> <code class="c1"># The output of type(my_float_number)</code>&#13;
</pre>&#13;
&#13;
<p>Strings are simply text. The most commonly used example to explain a string is the phrase “Hello World”:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Outputting the phrase Hello World</code>&#13;
<code class="nb">print</code><code class="p">(</code><code class="s1">'Hello World'</code><code class="p">)</code></pre>&#13;
&#13;
<p>The output should be as follows:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">Hello</code> <code class="n">World</code></pre>&#13;
&#13;
<p class="fix_tracking">Strings can also be used as arguments in functions, as you will see later in this chapter.</p>&#13;
&#13;
<p>Booleans are either true or false values. The following code snippet shows an example of using them:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Make a statement that the type of my_integer is integer</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">my_integer</code><code class="p">)</code> <code class="ow">is</code> <code class="nb">int</code>&#13;
<code class="c1"># Make a statement that the type of my_float_number is float</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">my_float_number</code><code class="p">)</code> <code class="ow">is</code> <code class="nb">float</code>&#13;
<code class="c1"># Make a statement that the type of my_integer is float</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">my_integer</code><code class="p">)</code> <code class="ow">is</code> <code class="nb">float</code>&#13;
<code class="sd">'''</code>&#13;
<code class="sd">Intuitively, the two first statements will return True as they are </code>&#13;
<code class="sd">indeed true. The third statement is False as the variable my_integer</code>&#13;
<code class="sd">is an integer and not a float number</code>&#13;
<code class="sd">'''</code>&#13;
</pre>&#13;
&#13;
<p>The output of the previous code is as follows:<a contenteditable="false" data-primary="" data-startref="Chapter_6.html6" data-type="indexterm" id="id571"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html5" data-type="indexterm" id="id572"/></p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="kc">True</code>&#13;
<code class="kc">True</code>&#13;
<code class="kc">False</code>&#13;
</pre>&#13;
&#13;
<p>Let’s discuss how operators work. You already saw an example of an operator: the assignment operator <code>=</code> used to define variables. <a contenteditable="false" data-primary="operators, in Python" data-type="indexterm" id="id573"/><em>Operators </em>perform special mathematical and other tasks between variables, constants, and even data structures. There are different types of operators. <a contenteditable="false" data-primary="arithmetic operators, in Python" data-type="indexterm" id="id574"/>Let’s start with <em>arithmetic operators</em>, as shown in the <span class="keep-together">following</span> snippet:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Arithmetic operator - Addition</code>&#13;
<code class="mi">1</code> <code class="o">+</code> <code class="mi">1</code> <code class="c1"># The line outputs 2</code>&#13;
<code class="c1"># Arithmetic operator - Subtraction</code>&#13;
<code class="mi">1</code> <code class="err">–</code> <code class="mi">1</code> <code class="c1"># The line outputs 0</code>&#13;
<code class="c1"># Arithmetic operator - Multiplication</code>&#13;
<code class="mi">2</code> <code class="o">*</code> <code class="mi">2</code> <code class="c1"># The line outputs 4</code>&#13;
<code class="c1"># Arithmetic operator - Division</code>&#13;
<code class="mi">4</code> <code class="o">/</code> <code class="mi">2</code> <code class="c1"># The line outputs 2.0 as a float number</code>&#13;
<code class="c1"># Arithmetic operator - Exponents</code>&#13;
<code class="mi">2</code> <code class="o">**</code> <code class="mi">4</code> <code class="c1"># The line outputs 16</code>&#13;
</pre>&#13;
&#13;
<p><a contenteditable="false" data-primary="comparison operators, in Python" data-type="indexterm" id="id575"/>The next type of operator is the <em>comparison operators</em>. These are used to compare different elements. They are mostly used in control flow events, as explained in the next section of this chapter. The following snippet shows a few comparison operators:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Comparison operator - Equality</code>&#13;
<code class="mi">2</code> <code class="o">==</code> <code class="mi">2</code> <code class="c1"># The line outputs True</code>&#13;
<code class="c1"># Comparison operator - Non equality</code>&#13;
<code class="mi">2</code> <code class="o">!=</code> <code class="mi">3</code> <code class="c1"># The line outputs True</code>&#13;
<code class="c1"># Comparison operator - Greater than</code>&#13;
<code class="mi">2</code> <code class="o">&gt;</code> <code class="mi">3</code> <code class="c1"># The line outputs False</code>&#13;
<code class="c1"># Comparison operator - Greater than or equal to</code>&#13;
<code class="mi">2</code> <code class="o">&gt;=</code> <code class="mi">2</code> <code class="c1"># The line outputs True</code>&#13;
<code class="c1"># Comparison operator - Less than</code>&#13;
<code class="mi">2</code> <code class="o">&lt;</code> <code class="mi">3</code> <code class="c1"># The line outputs True</code>&#13;
<code class="c1"># Comparison operator - Less than or equal to</code>&#13;
<code class="mi">2</code> <code class="o">&lt;=</code> <code class="mi">2</code> <code class="c1"># The line outputs True</code>&#13;
</pre>&#13;
&#13;
<p><a contenteditable="false" data-primary="logical operators, in Python" data-type="indexterm" id="id576"/><em>Logical operators</em> combine two or more conditions that are later evaluated. There are three logical operators: <code>and</code>, <code>or</code>, and <code>not</code>. The following code block shows an example of logical operators:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Logical operator - and</code>&#13;
<code class="mi">2</code> <code class="ow">and</code> <code class="mi">1</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="c1"># The line outputs True</code>&#13;
<code class="mi">2</code> <code class="ow">and</code> <code class="mi">5</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="c1"># The line outputs False</code>&#13;
<code class="c1"># Logical operator - or</code>&#13;
<code class="mi">2</code> <code class="ow">or</code> <code class="mi">5</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="c1"># The line outputs 2, which is the integer less than 4</code>&#13;
</pre>&#13;
&#13;
<p>Data collection structures (arrays and dataframes) are discussed in a later section, as they require an in-depth presentation due to their complexity and unique tools. Let’s end this section with code that combines what has been discussed so far:<a contenteditable="false" data-primary="" data-startref="Chapter_6.html4" data-type="indexterm" id="id577"/></p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Declaring two variables x and y and assigning them values</code>&#13;
<code class="n">x</code> <code class="o">=</code> <code class="mi">10</code>&#13;
<code class="n">y</code> <code class="o">=</code> <code class="mf">2.5</code>&#13;
<code class="c1"># Checking the types of the variables</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">x</code><code class="p">)</code> <code class="c1"># Returns int</code>&#13;
<code class="nb">type</code><code class="p">(</code><code class="n">y</code><code class="p">)</code> <code class="c1"># Returns float</code>&#13;
<code class="c1"># Taking x to the power of y and storing it in a variable z</code>&#13;
<code class="n">z</code> <code class="o">=</code> <code class="n">x</code> <code class="o">**</code> <code class="n">y</code> <code class="c1"># Returns 316.22</code>&#13;
<code class="c1"># Checking if the result is greater than or equal to 100</code>&#13;
<code class="n">z</code> <code class="o">&gt;=</code> <code class="mi">100</code> <code class="c1"># Returns True as 316.22 &gt;= 100</code></pre>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Control Flow" data-type="sect1"><div class="sect1" id="id41">&#13;
<h1>Control Flow</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="control flow, in Python" data-type="indexterm" id="Chapter_6.html7"/><a contenteditable="false" data-primary="Python" data-secondary="control flow" data-type="indexterm" id="Chapter_6.html8"/>Conditional <a contenteditable="false" data-primary="conditional statements" data-type="indexterm" id="id578"/>statements form the first part of what is known as <em>control flow</em> (the second part is <em>loops</em>, discussed shortly). <em>Conditional statements</em> are the ancestors of today’s artificial intelligence as they only execute code if certain conditions are met.</p>&#13;
&#13;
<p>Conditional statements are managed using <code>if</code>, <code>elif</code>, and <code>else</code>. Take the following code snippet as an example:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Declaring the variables</code>&#13;
<code class="n">a</code> <code class="o">=</code> <code class="mi">9</code>&#13;
<code class="n">b</code> <code class="o">=</code> <code class="mi">2</code>&#13;
<code class="c1"># First condition (specific)</code>&#13;
<code class="k">if</code> <code class="n">a</code> <code class="o">&gt;</code> <code class="n">b</code><code class="p">:</code>  &#13;
    <code class="nb">print</code><code class="p">(</code><code class="s1">'a is greater than b'</code><code class="p">)</code>&#13;
<code class="c1"># Second condition (specific)    </code>&#13;
<code class="k">elif</code> <code class="n">a</code> <code class="o">&lt;</code> <code class="n">b</code><code class="p">:</code>  &#13;
    <code class="nb">print</code><code class="p">(</code><code class="s1">'a is less than b'</code><code class="p">)</code>&#13;
<code class="c1"># Third condition (general)    </code>&#13;
<code class="k">else</code><code class="p">:</code>  &#13;
    <code class="nb">print</code><code class="p">(</code><code class="s1">'a is equal to b'</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>Therefore, conditional statements start with <code>if</code>. Then, for every new unique and specific condition, <code>elif</code> is used (which is a fusion of <em>else if</em>), until it makes sense to use the rest of the probability universe as a condition on its own, which is used by the <code>else</code> statement. Note that the <code>else</code> statement does not need a condition, as it exists to cover the rest of the uncovered universe.</p>&#13;
&#13;
<p><a contenteditable="false" data-primary="loops, in Python" data-type="indexterm" id="Chapter_6.html9"/><em>Loops </em>are used to execute blocks of code repeatedly until a predefined condition is met. Loops are heavily used with time series to calculate indicators, verify states, and backtest trading strategies.</p>&#13;
&#13;
<p>Loops are managed using <code>for</code> (for iterating over a finite and defined sequence or a range of elements) and <code>while</code> (used to continue the iteration until a condition is met) statements. For example, the following code prints the values <code>{1, 2, 3, 4}</code> using a loop:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Using a for loop</code>&#13;
<code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">5</code><code class="p">):</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="n">i</code><code class="p">)</code> &#13;
<code class="c1"># Using a while loop  </code>&#13;
<code class="n">i</code> <code class="o">=</code> <code class="mi">1</code>    &#13;
<code class="k">while</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">5</code><code class="p">:</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="n">i</code><code class="p">)</code>&#13;
    <code class="n">i</code> <code class="o">=</code> <code class="n">i</code> <code class="o">+</code> <code class="mi">1</code>&#13;
</pre>&#13;
&#13;
<p>The <code>for</code> loop when translated is simply saying that for every element called <code>i</code> (or any other letter depending on the coder) in the range that starts at 1 and ends at 5 (excluded), print the value of <code>i</code> at every loop (hence, in the first loop the value of <code>i</code> is equal to 1, and in the second loop it is equal to 2).</p>&#13;
&#13;
<p>The <code>while</code> loop says that, starting from a value of <code>i = 1</code>, while looping, print its value and then add 1 to it before finishing the first loop. End the loop when <code>i</code> becomes greater than 4.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Theoretically, a <code>while</code> loop is infinite until told otherwise.</p>&#13;
</div>&#13;
&#13;
<p>It is worth noting that <code>i = i + 1</code> can also be expressed as <code>i += 1</code>. The goal of an algorithm is the ability to apply many operations recursively in an objective way, which makes loops extremely useful, especially when combined with conditional statements. Let’s look at an example of a financial time series:</p>&#13;
&#13;
<ol>&#13;
	<li class="pagebreak-before less_space">Create a range of values to simulate hypothetical prices.</li>&#13;
	<li>Loop through the range of the data while creating the condition that if the price rose since the preceding period, print 1. Similarly, if the price fell since the preceding period, print –1. Last, print 0 if the price didn’t change from the preceding period.</li>&#13;
</ol>&#13;
&#13;
<p>This can be done with the following code block:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Creating the time series</code>&#13;
<code class="n">time_series</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">6</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">]</code>&#13;
<code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">time_series</code><code class="p">)):</code>&#13;
    <code class="c1"># The condition where the current price rose</code>&#13;
    <code class="k">if</code> <code class="n">time_series</code><code class="p">[</code><code class="n">i</code><code class="p">]</code> <code class="o">&gt;</code> <code class="n">time_series</code><code class="p">[</code><code class="n">i</code> <code class="err">–</code> <code class="mi">1</code><code class="p">]:</code>  &#13;
        <code class="nb">print</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>&#13;
    <code class="c1"># The condition where the current price fell</code>&#13;
    <code class="k">elif</code> <code class="n">time_series</code><code class="p">[</code><code class="n">i</code><code class="p">]</code> <code class="o">&lt;</code> <code class="n">time_series</code><code class="p">[</code><code class="n">i</code> <code class="err">–</code> <code class="mi">1</code><code class="p">]:</code>&#13;
        <code class="nb">print</code><code class="p">(</code><code class="err">–</code><code class="mi">1</code><code class="p">)</code> &#13;
    <code class="c1"># The condition where the current price hasn't changed</code>&#13;
    <code class="k">else</code><code class="p">:</code> &#13;
        <code class="nb">print</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>The code defines a list of values (in this case, a time series called <code>time_series</code>), then loops around its length using the <code>len()</code> function to apply the conditions. Notice how at every loop, the current time step is referred to as <code>i</code>, thus making the previous time step <code>i – 1</code><a contenteditable="false" data-primary="" data-startref="Chapter_6.html9" data-type="indexterm" id="id579"/>.<a contenteditable="false" data-primary="" data-startref="Chapter_6.html8" data-type="indexterm" id="id580"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html7" data-type="indexterm" id="id581"/></p>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Libraries and Functions" data-type="sect1"><div class="sect1" id="id42">&#13;
<h1>Libraries and Functions</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="functions, Python" data-type="indexterm" id="Chapter_6.html10"/><a contenteditable="false" data-primary="libraries, Python" data-type="indexterm" id="Chapter_6.html11"/><a contenteditable="false" data-primary="Python" data-secondary="libraries and functions" data-type="indexterm" id="Chapter_6.html12"/>A <em>library </em>in Python is a group of prewritten code that offers functionality to facilitate the creation of applications. <a contenteditable="false" data-primary="modules, in Python" data-type="indexterm" id="id582"/><em>Modules</em>, which are individual Python files with reusable code and data that can be imported and used in other Python code, are commonly found in libraries. A module is therefore a single Python file that contains functions and other types of code that may be used and imported by other Python programs. Large codebases are often easier to manage and maintain by using modules to divide similar code into different files.</p>&#13;
&#13;
<p>Coding is all about simplifying tasks and making them clearer. Functions are essential in this regard. A <em>function</em> is a block of reusable code that performs a specific task when called. It only needs to be defined once. When you have a recurring task such as calculating a moving average of a time series, you can use a function so that you do not have to write the moving-average code all over again every time you want to use it. Instead, you define the function with the original code and then call it whenever you need to calculate the moving average.</p>&#13;
&#13;
<p class="keep-together">Multiple functions form a module, and multiple modules form a library. A library is generally theme oriented. For example, in this book the <em>sklearn</em> library will be used with machine learning models. Similarly, data manipulation and importing are done using <em>numpy</em> and <em>pandas</em>, two libraries discussed in a later section of this chapter. Plotting and charting are done using the <em>matplotlib</em> library.</p>&#13;
&#13;
<p class="fix_tracking">Libraries must be imported to the Python interpreter before you can use them (this is the equivalent of acknowledging their existence). The syntax for doing this is as follows:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># The import statement must be followed by the name of the library</code>&#13;
<code class="kn">import</code> <code class="nn">numpy</code>&#13;
<code class="c1"># Optionally, you can give the library a shortcut for easier reference</code>&#13;
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>&#13;
</pre>&#13;
&#13;
<p>Sometimes you need to import just one function or module from a library. For this, you don’t need to import the entire library:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Importing one function from a library</code>&#13;
<code class="kn">from</code> <code class="nn">math</code> <code class="kn">import</code> <code class="n">sqrt</code>&#13;
</pre>&#13;
&#13;
<p>The preceding code says that <em>math</em> is a Python library that harbors many mathematical functions, namely the <code>sqrt</code> function, which is used to find the square root of a given number.</p>&#13;
&#13;
<p>Let’s see how to define a function. A function is defined using <code>def</code> followed by the name of the function and any optional arguments. The following example creates a function that sums any two given variables:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining the function sum_operation and giving it two arguments</code>&#13;
<code class="k">def</code> <code class="nf">sum_operation</code><code class="p">(</code><code class="n">first_variable</code><code class="p">,</code> <code class="n">second_variable</code><code class="p">):</code>&#13;
    <code class="c1"># Outputting the sum of the two variables</code>&#13;
    <code class="nb">print</code><code class="p">(</code><code class="n">first_variable</code> <code class="o">+</code> <code class="n">second_variable</code><code class="p">)</code>&#13;
<code class="c1"># Calling the function with 1 and 3 as arguments</code>&#13;
<code class="n">sum_operation</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">3</code><code class="p">)</code> <code class="c1"># The output of this line is 4</code>&#13;
</pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><em>Calling </em>a function means executing what it’s supposed to do. In other words, calling a function is simply using it. The timeline of a function is getting defined and then getting called.</p>&#13;
</div>&#13;
&#13;
<p>Let’s see how to import a function from a library and use its functions:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Importing the library    </code>&#13;
<code class="kn">import</code> <code class="nn">math</code>&#13;
<code class="c1"># Using the natural logarithm function</code>&#13;
<code class="n">math</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code>&#13;
<code class="c1"># Using the exponential function (e)</code>&#13;
<code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code>&#13;
<code class="c1"># Using the factorial function</code>&#13;
<code class="n">math</code><code class="o">.</code><code class="n">factorial</code><code class="p">(</code><code class="mi">50</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>As a side note, the <em>factorial </em>operation is a mathematical operation that is used to calculate the product of all positive integers from 1 up to a certain number (which is the argument requested in <code>math.factorial()</code>).</p>&#13;
&#13;
<p>Libraries may not be as easy as one plus one. Sometimes external libraries require installation first before they can be imported to the Python interpreter. Installation can be done through the prompt using the following syntax:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">pip</code> <code class="n">install</code> <code class="n">library_name</code></pre>&#13;
&#13;
<p>Recall <a data-type="xref" href="ch03.html#ch03">Chapter 3</a>, where the maximal information coefficient (MIC) was discussed. To calculate the MIC, you can use the following code (after having defined the sine and cosine waves):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Importing the library</code>&#13;
<code class="kn">from</code> <code class="nn">minepy</code> <code class="kn">import</code> <code class="n">MINE</code>&#13;
<code class="c1"># Calculating the MIC</code>&#13;
<code class="n">mine</code> <code class="o">=</code> <code class="n">MINE</code><code class="p">(</code><code class="n">alpha</code> <code class="o">=</code> <code class="mf">0.6</code><code class="p">,</code> <code class="n">c</code> <code class="o">=</code> <code class="mi">15</code><code class="p">)</code>&#13;
<code class="n">mine</code><code class="o">.</code><code class="n">compute_score</code><code class="p">(</code><code class="n">sine</code><code class="p">,</code> <code class="n">cosine</code><code class="p">)</code>&#13;
<code class="n">MIC</code> <code class="o">=</code> <code class="n">mine</code><code class="o">.</code><code class="n">mic</code><code class="p">()</code>&#13;
<code class="nb">print</code><code class="p">(</code><code class="s1">'Correlation | MIC: '</code><code class="p">,</code> <code class="nb">round</code><code class="p">(</code><code class="n">MIC</code><code class="p">,</code> <code class="mi">3</code><code class="p">))</code></pre>&#13;
&#13;
<p>Importing the library directly will likely lead to an error as it has not been <code>pip</code> installed. Therefore, you must install the library first using the following syntax at the prompt (not in the Python interpreter):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">pip</code> <code class="n">install</code> <code class="n">minepy</code>&#13;
</pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You may need to update Microsoft Visual C++ (to version 14.0 or greater) to avoid any errors in trying to run the <em>minepy</em> library.</p>&#13;
</div>&#13;
&#13;
<p>It is also important to read the documentation that comes with libraries in order to use them correctly. A library’s documentation will explain the aim of the functions as well as what types of arguments each function can accept (e.g., strings or numerics).</p>&#13;
&#13;
<p>Let’s return now to the topic of functions. A function can have a <code>return</code> statement that allows the result to be stored in a variable so that it can be used in other parts of the code.</p>&#13;
&#13;
<p>Let’s take two simple examples and then discuss them step by step:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining a function to sum two variables and return the result</code>&#13;
<code class="k">def</code> <code class="nf">sum_operation</code><code class="p">(</code><code class="n">first_variable</code><code class="p">,</code> <code class="n">second_variable</code><code class="p">):</code>&#13;
    <code class="c1"># The summing operation is stored in a variable called final_sum</code>&#13;
    <code class="n">final_sum</code> <code class="o">=</code> <code class="n">first_variable</code> <code class="o">+</code> <code class="n">second_variable</code>&#13;
    <code class="c1"># The result is returned</code>&#13;
    <code class="k">return</code> <code class="n">final_sum</code>&#13;
<code class="c1"># Create a new variable that holds the result of the function    </code>&#13;
<code class="n">summed_value</code> <code class="o">=</code> <code class="n">sum_operation</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>&#13;
<code class="c1"># Use the new variable in a new mathematical operation</code>&#13;
<code class="n">double_summed_value</code> <code class="o">=</code> <code class="n">summed_value</code> <code class="o">*</code> <code class="mi">2</code>&#13;
</pre>&#13;
&#13;
<p>The previous code defines the <code>sum_operation</code> function with two arguments, then stores the operation in a variable called <code>final_sum</code> before returning it so that it can be stored externally. Next, a new variable called <code>summed_value</code> is defined as the output of the function. Finally, another variable is created, <code>double_summed_value</code>, that is the result of <code>summed_value</code> multiplied by 2. This is an example of how to use results from functions as variables in external operations. Now let’s consider an example of a nested function (while keeping in mind the previously defined <code>sum_operation</code> <span class="keep-together">function</span>):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining a function to square the result gotten from sum_operation()</code>&#13;
<code class="k">def</code> <code class="nf">square_summed_value</code><code class="p">(</code><code class="n">first_variable</code><code class="p">,</code> <code class="n">second_variable</code><code class="p">):</code>&#13;
    <code class="c1"># Calling the nested sum_operation function and storing its result</code>&#13;
    <code class="n">final_sum</code> <code class="o">=</code> <code class="n">sum_operation</code><code class="p">(</code><code class="n">first_variable</code><code class="p">,</code> <code class="n">second_variable</code><code class="p">)</code> &#13;
    <code class="c1"># Creating a variable that stores the square of final_sum</code>&#13;
    <code class="n">squared_sum</code> <code class="o">=</code> <code class="n">final_sum</code> <code class="o">**</code> <code class="mi">2</code>&#13;
    <code class="c1"># The result is returned    </code>&#13;
    <code class="k">return</code> <code class="n">squared_sum</code>&#13;
<code class="c1"># Create a new variable that holds the result of the function   </code>&#13;
<code class="n">squared_summed_value</code> <code class="o">=</code> <code class="n">square_summed_value</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>The preceding code snippet defines a function called <code>square_summed_value</code>, which takes on two arguments. Furthermore, it uses a nested function, which in this case is <code>sum_operation</code>. The result of the nested function is once again stored in a variable called <code>final_sum</code>, which is used as an input in finding the <code>squared_sum</code> variable. The variable is found as <code>final_sum</code> to the power of two.</p>&#13;
&#13;
<p>Let’s end the section with common libraries in Python and machine learning (other than <em>numpy</em> and <em>pandas</em>):</p>&#13;
&#13;
<ul>&#13;
 <li><em>matplotlib</em>: For plotting and visualizing data</li>&#13;
 <li><em>sklearn</em>: For machine learning models</li>&#13;
 <li><em>scipy</em>: For scientific computing and optimization</li>&#13;
 <li><em>keras</em>: For neural networks</li>&#13;
 <li><em>math</em>: For using mathematical tools such as square roots</li>&#13;
 <li><em>random</em>: For generating random variables</li>&#13;
 <li><em>requests</em>: For making HTTP requests used in web scraping<a contenteditable="false" data-primary="" data-startref="Chapter_6.html12" data-type="indexterm" id="id583"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html11" data-type="indexterm" id="id584"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html10" data-type="indexterm" id="id585"/></li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
<section class="pagebreak-before" data-pdf-bookmark="Exception Handling and Errors" data-type="sect1"><div class="sect1" id="id43">&#13;
<h1 class="less_space">Exception Handling and Errors</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="exception handling, in Python" data-type="indexterm" id="Chapter_6.html13"/><a contenteditable="false" data-primary="Python" data-secondary="exception handling and errors" data-type="indexterm" id="Chapter_6.html14"/>Quite often, errors occur when the code is executed and the interpreter finds an obstacle that prevents it from continuing further. The most basic error is the <code>SyntaxError</code>, which occurs when there are misspelled words or missing elements that make the code unintelligible:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Will not output a SyntaxError if executed</code>&#13;
<code class="n">my_range</code> <code class="o">=</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">10</code><code class="p">)</code>&#13;
<code class="c1"># Will output a SyntaxError if executed</code>&#13;
<code class="n">my_range</code> <code class="o">=</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">10</code>&#13;
</pre>&#13;
&#13;
<p>As you can see from the previous code, there is a missing parenthesis at the end of the second code line, which is not understood by the interpreter. This type of error is likely to be your most common one. Another common error is the <code>NameError</code>, which occurs when failing to define a variable before executing a code that contains it. Consider the following example:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">x</code> <code class="o">+</code> <code class="n">y</code></pre>&#13;
&#13;
<p>The previous code will give you a <code>NameError</code> because the interpreter does not know the value of <code>x</code> and <code>y</code> since they were not defined.</p>&#13;
&#13;
<p>The <code>ModuleNotFoundError</code> occurs when the interpreter cannot find the library or module you are trying to import. This generally occurs when the module or library is installed in a bad directory or when it is not properly installed. Common fixes for this issue include:</p>&#13;
&#13;
<ul>&#13;
	<li>Verifying that the module’s name was written correctly</li>&#13;
	<li>Verifying that the module was correctly <code>pip</code> installed</li>&#13;
	<li>Verifying that the module was installed in the correct location</li>&#13;
</ul>&#13;
&#13;
<p>Another type of common error is the <code>TypeError</code>, and it occurs when you apply a certain operation on an incompatible element, such as summing an integer with a string. The following operation raises a <code>TypeError</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining variable x</code>&#13;
<code class="n">x</code> <code class="o">=</code> <code class="mi">1</code>&#13;
<code class="c1"># Defining variable y</code>&#13;
<code class="n">y</code> <code class="o">=</code> <code class="s1">'Hello</code><code class="w"/>&#13;
<code class="c1"># Summing the two variables, which will raise a TypeError</code>&#13;
<code class="n">x</code> <code class="o">+</code> <code class="n">y</code>&#13;
</pre>&#13;
&#13;
<p>In time series analysis, you will likely to encounter these four errors:</p>&#13;
&#13;
<dl>&#13;
	<dt class="pagebreak-before less_space"><code>IndexError</code></dt>&#13;
	<dd><p>This is raised when referring to an index that is out of range regarding the current array or dataframe. Imagine having an array of 300 values (rows). If you want to loop through them and, at each loop, input the number 1 in the next cell (time step + 1), the interpreter will raise an <code>IndexError</code> because in the last loop there is no next cell.</p></dd>&#13;
	<dt><code>ValueError</code></dt>&#13;
	<dd><p>This is raised when you try to call a function with an invalid argument. An example of this would be trying to pass an integer element as a string when calling a function.</p></dd>&#13;
	<dt><code>KeyError</code></dt>&#13;
	<dd><p>This occurs when trying to access an element in a dataframe that does not exist. For example, if you have three columns in the dataframe and you refer to one that does not exist (maybe due to a syntax issue), you are likely to run into a <code>KeyError</code>.</p></dd>&#13;
	<dt><code>ZeroDivisionError</code></dt>&#13;
	<dd><p>This error is intuitive and occurs when trying to divide a number by zero.</p></dd>&#13;
</dl>&#13;
&#13;
<p>There are other types of errors that you may encounter. It is important to understand what they refer to so that you are able to fix them and get the code running again.</p>&#13;
&#13;
<p><em>Exceptions </em>are errors that may not be fatal to the code in the sense that they only show a warning but don’t necessarily terminate the code. Therefore, exceptions occur during code execution (as opposed to errors, which occur because the interpreter is unable to execute the code). To ignore certain exceptions (and errors), the <code>try</code>  and <code>except</code> keywords are used. This is useful when you are certain that handling the exception will not alter the output of the code.</p>&#13;
&#13;
<p>Let’s take an example of creating a function that divides the first column of a time series by the next value of the second column. The first step is to define the time series as a dataframe or as an array (or any other data collection structure):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Importing the required library to create an array</code>&#13;
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>&#13;
<code class="c1"># Creating a two-column list with 8 rows</code>&#13;
<code class="n">my_time_series</code> <code class="o">=</code> <code class="p">[(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">3</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">4</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">4</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">4</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">2</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">),</code> &#13;
                  <code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">6</code><code class="p">)]</code>&#13;
<code class="c1"># Transforming the list into an array</code>&#13;
<code class="n">my_time_series</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">my_time_series</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p class="pagebreak-before">Now let’s write the division function that will take any value in the first column and divide it by the next value in the second column:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining the function</code>&#13;
<code class="k">def</code> <code class="nf">division</code><code class="p">(</code><code class="n">first_column</code><code class="p">,</code> <code class="n">second_column</code><code class="p">):</code>&#13;
    <code class="c1"># Looping through the length of the created array</code>&#13;
    <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">my_time_series</code><code class="p">)):</code>&#13;
        <code class="c1"># Division operation and storing it in the variable x</code>&#13;
        <code class="n">x</code> <code class="o">=</code> <code class="n">my_time_series</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">first_column</code><code class="p">]</code> <code class="o">/</code> &#13;
            <code class="n">my_time_series</code><code class="p">[</code><code class="n">i</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code> <code class="n">second_column</code><code class="p">]</code>&#13;
        <code class="c1"># Outputting the result</code>&#13;
        <code class="nb">print</code><code class="p">(</code><code class="n">x</code><code class="p">)</code>&#13;
<code class="c1"># Calling the function</code>&#13;
<code class="n">division</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p class="fix_tracking">Running the two previous code blocks will give an <code>IndexError</code> because in the last loop, the function cannot find the next value of the second column since it does not exist:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="ne">IndexError</code><code class="p">:</code> <code class="n">index</code> <code class="mi">8</code> <code class="ow">is</code> <code class="n">out</code> <code class="n">of</code> <code class="n">bounds</code> <code class="k">for</code> <code class="n">axis</code> <code class="mi">0</code> <code class="k">with</code> <code class="n">size</code> <code class="mi">8</code></pre>&#13;
&#13;
<p>Fixing this through <code>try</code> and <code>except</code> will ignore the last calculation that is causing the problem and will return the expected results:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining the function</code>&#13;
<code class="k">def</code> <code class="nf">division</code><code class="p">(</code><code class="n">first_column</code><code class="p">,</code> <code class="n">second_column</code><code class="p">):</code> &#13;
    <code class="c1"># Looping through the length of the created array    </code>&#13;
    <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">my_time_series</code><code class="p">)):</code> &#13;
        <code class="c1"># First part of the exception handling</code>&#13;
        <code class="k">try</code><code class="p">:</code>&#13;
            <code class="c1"># Division operation and storing it in the variable x</code>&#13;
            <code class="n">x</code> <code class="o">=</code> <code class="n">my_time_series</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">first_column</code><code class="p">]</code> <code class="o">/</code> &#13;
                <code class="n">my_time_series</code><code class="p">[</code><code class="n">i</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code> <code class="n">second_column</code><code class="p">]</code> &#13;
            <code class="c1"># Outputting the result            </code>&#13;
            <code class="nb">print</code><code class="p">(</code><code class="n">x</code><code class="p">)</code>       &#13;
        <code class="c1"># Exception handling of a specific error     </code>&#13;
        <code class="k">except</code> <code class="ne">IndexError</code><code class="p">:</code>&#13;
            <code class="c1"># Ignoring (passing) the error</code>&#13;
            <code class="k">pass</code>&#13;
<code class="c1"># Calling the function</code>&#13;
<code class="n">division</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>The output is as follows:<a contenteditable="false" data-primary="" data-startref="Chapter_6.html14" data-type="indexterm" id="id586"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html13" data-type="indexterm" id="id587"/></p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="mf">0.25</code>&#13;
<code class="mf">0.25</code>&#13;
<code class="mf">0.16</code>&#13;
<code class="mf">0.25</code>&#13;
<code class="mf">0.50</code>&#13;
<code class="mf">0.00</code>&#13;
<code class="mf">0.16</code>&#13;
</pre>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Data Structures in numpy and pandas" data-type="sect1"><div class="sect1" id="id44">&#13;
<h1>Data Structures in numpy and pandas</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="data structures, numpy and pandas" data-type="indexterm" id="Chapter_6.html15"/><a contenteditable="false" data-primary="numpy, data structures in" data-type="indexterm" id="Chapter_6.html16"/><a contenteditable="false" data-primary="pandas, data structures in" data-type="indexterm" id="Chapter_6.html17"/><a contenteditable="false" data-primary="Python" data-secondary="data structures in numpy and pandas" data-type="indexterm" id="Chapter_6.html18"/>You now understand what a library is and know that <em>numpy</em> and <em>pandas</em>  are the go-to libraries to manipulate, handle, and import data in Python. This section discusses the differences between the two, along with key functions that are definitely a great addition to your data analysis toolbox. But first, let’s define these two libraries:</p>&#13;
&#13;
<dl>&#13;
	<dt><em>numpy</em></dt>&#13;
	<dd><p>Short for numerical Python, <em>numpy</em> is a Python library that allows working with multidimensional arrays and matrices. It provides a powerful  interface for performing various operations on arrays and matrices.</p></dd>&#13;
	<dt><em>pandas</em></dt>&#13;
	<dd><p>Short for panel data, <em>pandas</em> is a Python library that allows working with dataframes (a type of tabular data). It provides two main data structures: series and dataframes. A <em>series</em> is a one-dimensional array-like object that can hold any data type. A <em>dataframe</em> is a two-dimensional table-like structure that consists of rows and columns (similar to a spreadsheet).</p></dd>&#13;
</dl>&#13;
&#13;
<p>Both libraries are very useful in analyzing time series data. Arrays hold only numerical type data and therefore do not really hold date type data. This may be one of the advantages of using <em>pandas</em> over <em>numpy</em>, but both have strengths and relative weaknesses. In the end, it is a matter of choice. This book will prioritize using <em>numpy</em> due to its simplicity and the fact that the machine learning models in the next chapter use the <em>sklearn</em> library, which is applied on arrays.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Switching between <em>numpy</em> and <em>pandas</em> requires converting the time series type. This is a relatively easy task, but it can sometimes cause the loss of certain types of data (e.g., date data).</p>&#13;
</div>&#13;
&#13;
<p>Let’s import both libraries before discussing some of their potential:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code>&#13;
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>&#13;
</pre>&#13;
&#13;
<p>The following code creates two time series with two columns and three rows. The first time series is called <code>my_data_frame</code> and is created using the <em>pandas</em> library function <code>pd.DataFrame</code>. The second time series is called <code>my_array</code> and is created using the <em>numpy</em> library function <code>np.array</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Creating a dataframe</code>&#13;
<code class="n">my_data_frame</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'first_column'</code> <code class="p">:</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">],</code> &#13;
                              <code class="s1">'second_column'</code> <code class="p">:</code> <code class="p">[</code><code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">6</code><code class="p">]})</code>&#13;
<code class="c1"># Creating an array</code>&#13;
<code class="n">my_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">4</code><code class="p">],</code> <code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="mi">5</code><code class="p">],</code> <code class="p">[</code><code class="mi">3</code><code class="p">,</code> <code class="mi">6</code><code class="p">]])</code>&#13;
</pre>&#13;
&#13;
<p>As shown in <a data-type="xref" href="#figure-6-2">Figure 6-2</a>, dataframes have real indices and can have column names. Arrays can only hold one type of data.</p>&#13;
&#13;
<figure><div class="figure" id="figure-6-2"><img alt="" class="iimagesdlf_0506png" src="assets/dlff_0602.png"/>&#13;
<h6><span class="label">Figure 6-2. </span>A <em><span class="plain">pandas</span></em> dataframe (left) and a <em><span class="plain">numpy</span></em> array (right)</h6>&#13;
</div></figure>&#13;
&#13;
<p>To switch between the two types of data, you will be using the same two functions used in the previous code block:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># To transform my_data_frame into my_new_array</code>&#13;
<code class="n">my_new_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">my_data_frame</code><code class="p">)</code>&#13;
<code class="c1"># To transform my_array into my_new_data_frame</code>&#13;
<code class="n">my_new_data_frame</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">my_array</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>Let’s now take a look at useful functions that will come in handy when dealing with models. Slicing and concatenation are among the processes you must master to smoothly navigate through data analysis. Consider the following arrays:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">first_array</code>  <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([</code> <code class="mi">1</code><code class="p">,</code>  <code class="mi">2</code><code class="p">,</code>  <code class="mi">3</code><code class="p">,</code>  <code class="mi">5</code><code class="p">,</code>   <code class="mi">8</code><code class="p">,</code>  <code class="mi">13</code><code class="p">])</code>&#13;
<code class="n">second_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([</code><code class="mi">21</code><code class="p">,</code> <code class="mi">34</code><code class="p">,</code> <code class="mi">55</code><code class="p">,</code> <code class="mi">89</code><code class="p">,</code> <code class="mi">144</code><code class="p">,</code> <code class="mi">233</code><code class="p">])</code>&#13;
</pre>&#13;
&#13;
<p><a contenteditable="false" data-primary="concatenation" data-type="indexterm" id="id588"/><em>Concatenation </em>is the act of fusing two datasets together either through rows (axis = 0) or through columns (axis = 1). Let’s do both of them:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Reshaping the arrays so they become dimensionally compatible</code>&#13;
<code class="n">first_array</code>  <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="n">first_array</code><code class="p">,</code> <code class="p">(</code><code class="err">–</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">))</code>&#13;
<code class="n">second_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="n">second_array</code><code class="p">,</code> <code class="p">(</code><code class="err">–</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">))</code>&#13;
<code class="c1"># Concatenating both arrays by columns</code>&#13;
<code class="n">combined_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">concatenate</code><code class="p">((</code><code class="n">first_array</code><code class="p">,</code> <code class="n">second_array</code><code class="p">),</code> <code class="n">axis</code> <code class="o">=</code> <code class="mi">1</code><code class="p">)</code>&#13;
<code class="c1"># Concatenating both arrays by rows</code>&#13;
<code class="n">combined_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">concatenate</code><code class="p">((</code><code class="n">first_array</code><code class="p">,</code> <code class="n">second_array</code><code class="p">),</code> <code class="n">axis</code> <code class="o">=</code> <code class="mi">0</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>Now let’s do the same thing for dataframes. Consider the following dataframes:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">first_data_frame</code>  <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'first_column'</code>  <code class="p">:</code> <code class="p">[</code> <code class="mi">1</code><code class="p">,</code>  <code class="mi">2</code><code class="p">,</code>  <code class="mi">3</code><code class="p">],</code> &#13;
                                  <code class="s1">'second_column'</code> <code class="p">:</code> <code class="p">[</code> <code class="mi">4</code><code class="p">,</code>  <code class="mi">5</code><code class="p">,</code>  <code class="mi">6</code><code class="p">]})</code>&#13;
<code class="n">second_data_frame</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'first_column'</code>  <code class="p">:</code> <code class="p">[</code> <code class="mi">7</code><code class="p">,</code>  <code class="mi">8</code><code class="p">,</code>  <code class="mi">9</code><code class="p">],</code> &#13;
                                  <code class="s1">'second_column'</code> <code class="p">:</code> <code class="p">[</code><code class="mi">10</code><code class="p">,</code> <code class="mi">11</code><code class="p">,</code> <code class="mi">12</code><code class="p">]})</code></pre>&#13;
&#13;
<p>Concatenation is useful when you want to combine data into one structure. This is how it can be done with dataframes (notice that it’s simply a change of syntax and function source):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Concatenating both dataframes by columns</code>&#13;
<code class="n">combined_data_frame</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">([</code><code class="n">first_data_frame</code><code class="p">,</code> <code class="n">second_data_frame</code><code class="p">],</code> &#13;
                                <code class="n">axis</code> <code class="o">=</code> <code class="mi">1</code><code class="p">)</code>&#13;
<code class="c1"># Concatenating both dataframes by rows</code>&#13;
<code class="n">combined_data_frame</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">([</code><code class="n">first_data_frame</code><code class="p">,</code> <code class="n">second_data_frame</code><code class="p">],</code> &#13;
                                <code class="n">axis</code> <code class="o">=</code> <code class="mi">0</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>Remember that with time series, <em>rows </em>(horizontal cells) represent one time step (e.g., hourly) with all the data inside, while <em>columns </em>represent the different types of data (e.g., open price and close price of a financial instrument). Now let’s see slicing techniques for arrays:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining a one-dimensional array</code>&#13;
<code class="n">my_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">6</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">8</code><code class="p">,</code> <code class="mi">9</code><code class="p">,</code> <code class="mi">10</code><code class="p">])</code>&#13;
<code class="c1"># Referring to the first value of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="c1"># Outputs 1</code>&#13;
<code class="c1"># Referring to the last value of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="err">–</code><code class="mi">1</code><code class="p">]</code> <code class="c1"># Outputs 10</code>&#13;
<code class="c1"># Referring to the sixth value of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code> <code class="c1"># Outputs 7</code>&#13;
<code class="c1"># Referring to the first three values of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">3</code><code class="p">]</code> <code class="c1"># Outputs array([1, 2, 3])</code>&#13;
<code class="n">my_array</code><code class="p">[:</code><code class="mi">3</code><code class="p">]</code>  <code class="c1"># Outputs array([1, 2, 3])</code>&#13;
<code class="c1"># Referring to the last three values of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="err">–</code><code class="mi">3</code><code class="p">:]</code> <code class="c1"># Outputs array([8, 9, 10])</code>&#13;
<code class="c1"># Referring to all the values as of the second value</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="mi">1</code><code class="p">:]</code> <code class="c1"># Outputs array([2, 3, 4, 5, 6, 7, 8, 9, 10])</code>&#13;
<code class="c1"># Defining a multidimensional array</code>&#13;
<code class="n">my_array</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">([[</code> <code class="mi">1</code><code class="p">,</code>  <code class="mi">2</code><code class="p">,</code>  <code class="mi">3</code><code class="p">,</code>  <code class="mi">4</code><code class="p">,</code>  <code class="mi">5</code><code class="p">],</code> &#13;
                     <code class="p">[</code> <code class="mi">6</code><code class="p">,</code>  <code class="mi">7</code><code class="p">,</code>  <code class="mi">8</code><code class="p">,</code>  <code class="mi">9</code><code class="p">,</code> <code class="mi">10</code><code class="p">],</code> &#13;
                     <code class="p">[</code><code class="mi">11</code><code class="p">,</code> <code class="mi">12</code><code class="p">,</code> <code class="mi">13</code><code class="p">,</code> <code class="mi">14</code><code class="p">,</code> <code class="mi">15</code><code class="p">]])</code>&#13;
<code class="c1"># Referring to the first value and second column of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">]</code> <code class="c1"># Outputs 2</code>&#13;
<code class="c1"># Referring to the last value and last column of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="err">–</code><code class="mi">1</code><code class="p">,</code> <code class="err">–</code><code class="mi">1</code><code class="p">]</code> <code class="c1"># Outputs 15</code>&#13;
<code class="c1"># Referring to the third value and second-to-last column of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="err">–</code><code class="mi">2</code><code class="p">]</code> <code class="c1"># Outputs 14</code>&#13;
<code class="c1"># Referring to the first three values and fourth column of the array</code>&#13;
<code class="n">my_array</code><code class="p">[:,</code> <code class="mi">2</code><code class="p">:</code><code class="mi">4</code><code class="p">]</code> <code class="c1"># Outputs array([[3, 4], [8, 9], [13, 14]])</code>&#13;
<code class="c1"># Referring to the last two values and fifth column of the array</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="err">–</code><code class="mi">2</code><code class="p">:,</code> <code class="mi">4</code><code class="p">]</code> <code class="c1"># Outputs array([10, 15])</code>&#13;
<code class="c1"># Referring to all the values and all the columns up until the second row</code>&#13;
<code class="n">my_array</code><code class="p">[:</code><code class="mi">2</code><code class="p">,</code> <code class="p">]</code> <code class="c1"># Outputs array([[ 1, 2, 3, 4, 5], [6, 7, 8, 9, 10]])</code>&#13;
<code class="c1"># Referring to the last row with all the columns</code>&#13;
<code class="n">my_array</code><code class="p">[</code><code class="err">–</code><code class="mi">1</code><code class="p">:,</code> <code class="p">:]</code> <code class="c1"># Outputs array([[11, 12, 13, 14, 15]])</code>&#13;
</pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>It is important to know that Python indexing starts at zero. This means that to refer to the first element in a data structure, you refer to its index as index = 0. It is also worth noting that in ranges, the last element is excluded, which means that the first three elements in a data structure are referred to as <code>[0, 3]</code>, which will give the <span class="keep-together">elements</span> indexed at 0, 1, and 2.</p>&#13;
</div>&#13;
&#13;
<p>Let’s see the same thing for dataframes so that this section becomes a sort of mini reference whenever you want to manipulate data structures:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining a one-dimensional dataframe</code>&#13;
<code class="n">my_df</code><code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'first_column'</code><code class="p">:</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> &#13;
                                      <code class="mi">6</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">8</code><code class="p">,</code> <code class="mi">9</code><code class="p">,</code> <code class="mi">10</code><code class="p">]})</code>&#13;
<code class="c1"># Referring to the first value of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">][</code><code class="s1">'first_column'</code><code class="p">]</code> <code class="c1"># Outputs 1</code>&#13;
<code class="c1"># Referring to the last value of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="err">–</code><code class="mi">1</code><code class="p">][</code><code class="s1">'first_column'</code><code class="p">]</code> <code class="c1"># Outputs 10</code>&#13;
<code class="c1"># Referring to the sixth value of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">6</code><code class="p">][</code><code class="s1">'first_column'</code><code class="p">]</code> <code class="c1"># Outputs 7</code>&#13;
<code class="c1"># Referring to the first three values of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">3</code><code class="p">][</code><code class="s1">'first_column'</code><code class="p">]</code> <code class="c1"># Outputs ([1, 2, 3])</code>&#13;
<code class="c1"># Referring to the last three values of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="err">–</code><code class="mi">3</code><code class="p">:][</code><code class="s1">'first_column'</code><code class="p">]</code> <code class="c1"># Outputs ([8, 9, 10])</code>&#13;
<code class="c1"># Referring to all the values as of the second value</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">1</code><code class="p">:][</code><code class="s1">'first_column'</code><code class="p">]</code> <code class="c1"># Outputs ([2, 3, 4, 5, 6, 7, 8, 9, 10])</code>&#13;
<code class="c1"># Defining a multidimensional dataframe</code>&#13;
<code class="n">my_df</code>  <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'first_column'</code>  <code class="p">:</code> <code class="p">[</code> <code class="mi">1</code><code class="p">,</code>  <code class="mi">6</code><code class="p">,</code>  <code class="mi">11</code><code class="p">],</code> &#13;
                       <code class="s1">'second_column'</code> <code class="p">:</code> <code class="p">[</code> <code class="mi">2</code><code class="p">,</code>  <code class="mi">7</code><code class="p">,</code>  <code class="mi">12</code><code class="p">],</code>&#13;
                       <code class="s1">'third_column'</code>  <code class="p">:</code> <code class="p">[</code> <code class="mi">3</code><code class="p">,</code>  <code class="mi">8</code><code class="p">,</code>  <code class="mi">13</code><code class="p">],</code>&#13;
                       <code class="s1">'fourth_column'</code> <code class="p">:</code> <code class="p">[</code> <code class="mi">4</code><code class="p">,</code>  <code class="mi">9</code><code class="p">,</code>  <code class="mi">14</code><code class="p">],</code>&#13;
                       <code class="s1">'fifth_column'</code>  <code class="p">:</code> <code class="p">[</code> <code class="mi">5</code><code class="p">,</code>  <code class="mi">10</code><code class="p">,</code> <code class="mi">15</code><code class="p">]})</code>&#13;
<code class="c1"># Referring to the first value and second column of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">][</code><code class="s1">'second_column'</code><code class="p">]</code> <code class="c1"># Outputs 2</code>&#13;
<code class="c1"># Referring to the last value and last column of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="err">–</code><code class="mi">1</code><code class="p">][</code><code class="s1">'fifth_column'</code><code class="p">]</code> <code class="c1"># Outputs 15</code>&#13;
<code class="c1"># Referring to the third value and second-to-last column of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">2</code><code class="p">][</code><code class="s1">'fourth_column'</code><code class="p">]</code> <code class="c1"># Outputs 14</code>&#13;
<code class="c1"># Referring to the first three values and fourth column of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:][[</code><code class="s1">'third_column'</code><code class="p">,</code> <code class="s1">'fourth_column'</code><code class="p">]]</code>&#13;
<code class="c1"># Referring to the last two values and fifth column of the dataframe</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="err">–</code><code class="mi">2</code><code class="p">:][</code><code class="s1">'fifth_column'</code><code class="p">]</code> <code class="c1"># Outputs ([10, 15])</code>&#13;
<code class="c1"># Referring to all the values and all the columns up until the second row</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="mi">2</code><code class="p">,]</code> <code class="c1"># Outputs ([[ 1, 2, 3, 4, 5], [6, 7, 8, 9, 10]])</code>&#13;
<code class="c1"># Referring to the last row with all the columns</code>&#13;
<code class="n">my_df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="err">–</code><code class="mi">1</code><code class="p">:,]</code>  <code class="c1"># Outputs ([[11, 12, 13, 14, 15]])</code>&#13;
</pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Try going back to the earlier chapters to execute the code given there. You should have a more solid understanding by now.<a contenteditable="false" data-primary="" data-startref="Chapter_6.html18" data-type="indexterm" id="id589"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html17" data-type="indexterm" id="id590"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html16" data-type="indexterm" id="id591"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html15" data-type="indexterm" id="id592"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Importing Financial Time Series in Python" data-type="sect1"><div class="sect1" id="id45">&#13;
<h1>Importing Financial Time Series in Python</h1>&#13;
&#13;
<p><a contenteditable="false" data-primary="Python" data-secondary="importing financial time series in" data-type="indexterm" id="Chapter_6.html19"/><a contenteditable="false" data-primary="time series, importing in Python" data-type="indexterm" id="Chapter_6.html20"/>This section discusses a key aspect of deploying machine and deep learning algorithms. It deals with the historical OHLC data that is needed to run the models and evaluate their performance.</p>&#13;
&#13;
<p>The first step is to prepare the environment and everything else necessary for the success of the algorithms. For this, you need two programs:</p>&#13;
&#13;
<ul>&#13;
	<li>A Python interpreter that you use to write and execute code. You already completed this step.</li>&#13;
	<li>Charting and financial software that you use as a database. This part is covered in this section.</li>&#13;
</ul>&#13;
&#13;
<p>For charting benchmarks, I use MetaTrader 5, a program used by many traders around the globe. MetaTrader 5 works with Spyder, so you should start by downloading Spyder and familiarizing yourself with how it works.</p>&#13;
&#13;
<p>From the <a href="https://oreil.ly/YlNWu">official website</a>, download and install MetaTrader 5. You need to create a demo account, which is simply a virtual account with imaginary money. The word <em>demo</em> does not refer to a limited duration of use but to the fact that it is not using real money.</p>&#13;
&#13;
<p>To open an account, select File &gt; Open an Account, choose MetaQuotes Software Corp, and then click Next. Then choose the first option to open a demo account; this will let you trade virtual money. Finally, enter some basic information such as your name, email, and account type. You will not receive a verification request or any type of confirmation as the demo should launch directly, allowing you to see the charts.</p>&#13;
&#13;
<p><a data-type="xref" href="#figure-6-3">Figure 6-3</a> shows the platform’s interface. By default, MetaTrader 5 does not show all the markets it covers, so you need to make them accessible for import and visualization if necessary. Click View, click Market Watch, and then right-click any of the symbols shown in the new tab and choose Show All. This way, you can see the extended list with more markets.</p>&#13;
&#13;
&#13;
<p>Before you can start coding, you need to install the MetaTrader 5 Python integration library so that you can use it later in Spyder. This is easy and requires one step. Open the Anaconda prompt and type:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">pip</code> <code class="n">install</code> <code class="n">MetaTrader5</code></pre>&#13;
&#13;
<p>Installation is the bridge that allows you to use Python modules and functions designed for MetaTrader 5 in the interpreter.</p>&#13;
&#13;
<figure><div class="figure" id="figure-6-3"><img alt="" class="iimagesdlf_0603png" src="assets/dlff_0603.png"/>&#13;
<h6><span class="label">Figure 6-3. </span>MetaTrader 5 interface</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
<p>The following code block uses the <code>import</code> built-in statement, which calls for internal (self-created) or external (created by third parties) libraries. You’ll recall that a library is a store of functions, and thus, you need to import the libraries that are pertinent to what you want to do. For demonstration purposes, import the following modules, packages, and libraries:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="kn">import</code> <code class="nn">datetime</code> <code class="c1"># Gives tools for manipulating dates and time</code>&#13;
<code class="kn">import</code> <code class="nn">pytz</code> <code class="c1"># Offers cross-platform time zone calculations</code>&#13;
<code class="kn">import</code> <code class="nn">MetaTrader5</code> <code class="k">as</code> <code class="nn">mt5</code> <code class="c1"># Importing the software's library</code>&#13;
<code class="kn">import</code> <code class="nn">pandas</code> <code class="k">as</code> <code class="nn">pd</code>&#13;
<code class="kn">import</code> <code class="nn">numpy</code> <code class="k">as</code> <code class="nn">np</code> &#13;
</pre>&#13;
&#13;
<p>The next step is to create the universe of the time frames that you will be able to import. Even though I will be showing you how to analyze and backtest hourly data, you can define a wider universe, as shown in the following code snippet:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">frame_M15</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_M15</code>      <code class="c1"># 15-minute time frame</code>&#13;
<code class="n">frameframe_M30</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_M30</code> <code class="c1"># 30-minute time frame</code>&#13;
<code class="n">frame_H1</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_H1</code>        <code class="c1"># Hourly time frame</code>&#13;
<code class="n">frame_H4</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_H4</code>        <code class="c1"># 4-hour time frame</code>&#13;
<code class="n">frame_D1</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_D1</code>        <code class="c1"># Daily time frame</code>&#13;
<code class="n">frame_W1</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_W1</code>        <code class="c1"># Weekly time frame</code>&#13;
<code class="n">frame_M1</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">TIMEFRAME_MN1</code>       <code class="c1"># Monthly time frame</code>&#13;
</pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The full code is found in this book’s <a href="https://oreil.ly/5YGHI">GitHub repository</a> under the name <em>master_function.py.</em></p>&#13;
</div>&#13;
&#13;
<p><a contenteditable="false" data-primary="time frame" data-type="indexterm" id="id593"/>A <em>time frame</em> is the frequency with which you record the prices. With hourly data, you will record the last price printed every hour. This means that in a day, you can have up to 24 hourly prices. This allows you to see the intraday evolution of the price. The aim is to record the totality of the OHLC data within a specific period.</p>&#13;
&#13;
<p>The following code defines the current time, which is used so that the algorithm has a reference point when importing the data. Basically, you are creating a variable that stores the current time and date:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">now</code> <code class="o">=</code> <code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="o">.</code><code class="n">now</code><code class="p">()</code></pre>&#13;
&#13;
<p>Let’s now proceed to defining the universe of the financial instruments you want to backtest. In this book, the backtests will be done exclusively on the foreign exchange (FX) market. So let’s create a variable that stores some key currency pairs:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">assets</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'EURUSD'</code><code class="p">,</code> <code class="s1">'USDCHF'</code><code class="p">,</code> <code class="s1">'GBPUSD'</code><code class="p">,</code> <code class="s1">'USDCAD'</code><code class="p">]</code></pre>&#13;
&#13;
<p>Now that you have your time and asset variables ready, all you need to do is create the structure of the importing algorithm. The <code>get_quotes()</code> function does this:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="k">def</code> <code class="nf">get_quotes</code><code class="p">(</code><code class="n">time_frame</code><code class="p">,</code> <code class="n">year</code> <code class="o">=</code> <code class="mi">2005</code><code class="p">,</code> <code class="n">month</code> <code class="o">=</code> <code class="mi">1</code><code class="p">,</code> <code class="n">day</code> <code class="o">=</code> <code class="mi">1</code><code class="p">,</code> &#13;
               <code class="n">asset</code> <code class="o">=</code> <code class="s2">"EURUSD"</code><code class="p">):</code>&#13;
    <code class="k">if</code> <code class="ow">not</code> <code class="n">mt5</code><code class="o">.</code><code class="n">initialize</code><code class="p">():</code>   &#13;
        <code class="nb">print</code><code class="p">(</code><code class="s2">"initialize() failed, error code ="</code><code class="p">,</code> <code class="n">mt5</code><code class="o">.</code><code class="n">last_error</code><code class="p">())</code>&#13;
        <code class="n">quit</code><code class="p">()</code>&#13;
    <code class="n">timezone</code> <code class="o">=</code> <code class="n">pytz</code><code class="o">.</code><code class="n">timezone</code><code class="p">(</code><code class="s2">"Europe/Paris"</code><code class="p">)</code>&#13;
    <code class="n">time_from</code> <code class="o">=</code> <code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="n">year</code><code class="p">,</code> <code class="n">month</code><code class="p">,</code> <code class="n">day</code><code class="p">,</code> <code class="n">tzinfo</code> <code class="o">=</code> <code class="n">timezone</code><code class="p">)</code>   &#13;
    <code class="n">time_to</code> <code class="o">=</code> <code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="o">.</code><code class="n">now</code><code class="p">(</code><code class="n">timezone</code><code class="p">)</code> <code class="o">+</code> <code class="n">datetime</code><code class="o">.</code><code class="n">timedelta</code><code class="p">(</code><code class="n">days</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>&#13;
    <code class="n">rates</code> <code class="o">=</code> <code class="n">mt5</code><code class="o">.</code><code class="n">copy_rates_range</code><code class="p">(</code><code class="n">asset</code><code class="p">,</code> <code class="n">time_frame</code><code class="p">,</code> <code class="n">time_from</code><code class="p">,</code> <code class="n">time_to</code><code class="p">)</code>&#13;
    <code class="n">rates_frame</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">rates</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="n">rates_frame</code>&#13;
</pre>&#13;
&#13;
<p>Notice that in the <code>get_quotes()</code> function, you use the <em>pytz</em> and <em>pandas</em> libraries. The function starts by defining the Olson time zone,<sup><a data-type="noteref" href="ch06.html#id594" id="id594-marker">2</a></sup> which you can set yourself. Here is a brief, nonexhaustive list of what you can enter depending on your time zone:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="n">America</code><code class="o">/</code><code class="n">New_York</code>&#13;
<code class="n">Europe</code><code class="o">/</code><code class="n">London</code>&#13;
<code class="n">Europe</code><code class="o">/</code><code class="n">Paris</code>&#13;
<code class="n">Asia</code><code class="o">/</code><code class="n">Tokyo</code>&#13;
<code class="n">Australia</code><code class="o">/</code><code class="n">Sydney</code>&#13;
</pre>&#13;
&#13;
<p>Next define two variables called <code>time_from</code> and <code>time_to</code>:</p>&#13;
&#13;
<ul>&#13;
	<li>The <code>time_from</code> variable contains the <code>datetime</code> referring to the beginning of the import date (e.g., 01-01-2020).</li>&#13;
	<li>The <code>time_to</code> variable contains the <code>datetime</code> referring to the end of the import date, which uses the <code>now</code> variable to represent the current time and date.</li>&#13;
</ul>&#13;
&#13;
<p>The next step is to create a variable that imports the financial data using the time periods you have specified. This is done through the <code>rates</code> variable using the <code>mt5.copy_rates_range()</code> function. Finally, using <em>pandas</em>, transform the data into a dataframe. The final function required for the importing process is the <code>mass_import()</code> function. It lets you choose the time frame using the variable and then uses the <code>get_quotes()</code> function to import the data and format it to an array. The following code snippet defines the <code>mass_import()</code> function:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="k">def</code> <code class="nf">mass_import</code><code class="p">(</code><code class="n">asset</code><code class="p">,</code> <code class="n">time_frame</code><code class="p">):</code>               &#13;
    <code class="k">if</code> <code class="n">time_frame</code> <code class="o">==</code> <code class="s1">'H1'</code><code class="p">:</code>&#13;
        <code class="n">data</code> <code class="o">=</code> <code class="n">get_quotes</code><code class="p">(</code><code class="n">frame_H1</code><code class="p">,</code> <code class="mi">2013</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="n">asset</code> <code class="o">=</code> <code class="n">assets</code><code class="p">[</code><code class="n">asset</code><code class="p">])</code>&#13;
        <code class="n">data</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:,</code> <code class="mi">1</code><code class="p">:</code><code class="mi">5</code><code class="p">]</code><code class="o">.</code><code class="n">values</code>&#13;
        <code class="n">data</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="n">round</code><code class="p">(</code><code class="n">decimals</code> <code class="o">=</code> <code class="mi">5</code><code class="p">)</code>           &#13;
    <code class="k">return</code> <code class="n">data</code> &#13;
</pre>&#13;
&#13;
<p>The <code>mass_import()</code> function automatically converts the dataframe into an array, so you do not have to worry about conversion when using the automatic import.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You may need to adjust the year argument higher to get the data in case you have an empty array. For instance, if you get an empty array using the <code>mass_import()</code> function, try putting a more recent year in the <code>get_quotes()</code> function (“2014” instead of “2013”).</p>&#13;
</div>&#13;
&#13;
<p>To import the historical hourly EURUSD data from the beginning of 2014 to date, you may type the following (assuming <code>get_quotes()</code>, <code>now</code>, the frames, and the libraries are already defined):</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Defining the universe of currency pairs</code>&#13;
<code class="n">assets</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'EURUSD'</code><code class="p">,</code> <code class="s1">'USDCHF'</code><code class="p">,</code> <code class="s1">'GBPUSD'</code><code class="p">,</code> <code class="s1">'USDCAD'</code><code class="p">]</code>&#13;
<code class="c1"># Redefining the mass_import function to switch to a default 2014</code>&#13;
<code class="k">def</code> <code class="nf">mass_import</code><code class="p">(</code><code class="n">asset</code><code class="p">,</code> <code class="n">time_frame</code><code class="p">):</code>                &#13;
    <code class="k">if</code> <code class="n">time_frame</code> <code class="o">==</code> <code class="s1">'H1'</code><code class="p">:</code>&#13;
        <code class="n">data</code> <code class="o">=</code> <code class="n">get_quotes</code><code class="p">(</code><code class="n">frame_H1</code><code class="p">,</code> <code class="mi">2014</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="n">asset</code> <code class="o">=</code> <code class="n">assets</code><code class="p">[</code><code class="n">asset</code><code class="p">])</code>&#13;
        <code class="n">data</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:,</code> <code class="mi">1</code><code class="p">:</code><code class="mi">5</code><code class="p">]</code><code class="o">.</code><code class="n">values</code>&#13;
        <code class="n">data</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="n">round</code><code class="p">(</code><code class="n">decimals</code> <code class="o">=</code> <code class="mi">5</code><code class="p">)</code>  &#13;
<code class="c1"># Calling the mass_import function and storing it in a variable</code>&#13;
<code class="n">eurusd_data</code> <code class="o">=</code> <code class="n">mass_import</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="s1">'H1'</code><code class="p">)</code></pre>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Notice how the <code>return</code> statement is used in the <code>mass_import</code> function to store the historical data in chosen variables.</p>&#13;
</div>&#13;
&#13;
<p>Even though there is a macOS version of MetaTrader 5, the Python library only works on Windows. It requires a Windows emulator on macOS. For macOS or Linux users, you may want to try the manual import method (or the alternative way proposed in <a data-type="xref" href="ch07.html#ch07">Chapter 7</a> that uses a library called <em>pandas-datareader</em>).</p>&#13;
&#13;
<p>Automatic import is a huge time-saver, but even Windows users may run into frustrating errors. Therefore, I will show you the manual import method, which you can use as a fix. On the <a href="https://oreil.ly/5YGHI">Github page</a> for this book, you will find a folder called <em>Historical Data</em>. Inside the folder there is a selection of historical financial time series in Excel format that you can download.</p>&#13;
&#13;
<p>Manual import requires an Excel file with OHLC data that you have downloaded from a third party (such as the Excel files provided in this book’s GitHub repository). In this case, you can use the <em>pandas</em> library to import it and transform it into an array.</p>&#13;
&#13;
<p>Let’s take an example of <em>Daily_GBPUSD_Historical_Data.xlsx</em><i>. </i>Download the file from the repository (found in <em>Historical Data</em>) and store it on your desktop. The Spyder directory must be in the same place as the file. In layperson’s terms, this means Spyder must search your desktop for the Excel file. To choose the right directory, click the folder button next to the arrow. The Directory tab should look like <a data-type="xref" href="#figure-6-4">Figure 6-4</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure-6-4"><img alt="" class="iimagesdlf_0604png" src="assets/dlff_0604.png"/>&#13;
<h6><span class="label">Figure 6-4. </span>The Directory tab after choosing the correct folder</h6>&#13;
</div></figure>&#13;
&#13;
<p>You should get a separate window where you can choose the desktop location and then validate the choice. Having done this, the tab should look like <a data-type="xref" href="#figure-6-5">Figure 6-5</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure-6-5"><img alt="" class="iimagesdlf_0605png" src="assets/dlff_0605.png"/>&#13;
<h6><span class="label">Figure 6-5. </span>The Directory tab after choosing the correct desktop location</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before">You use the <code>read_excel()</code> function (built into <em>pandas</em> and accessible after importing it) to get the values inside the Excel file. Follow this syntax:</p>&#13;
&#13;
<pre data-code-language="python" data-executable="true" data-type="programlisting">&#13;
<code class="c1"># Importing the excel file into the Python interpreter</code>&#13;
<code class="n">my_data</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_excel</code><code class="p">(</code><code class="s1">'Daily_GBPUSD_Historical_Data.xlsx.xlsx'</code><code class="p">)</code>&#13;
</pre>&#13;
&#13;
<p>You should have a dataframe called <em>Daily_GBPUSD_Historical_Data.xlsx</em> with five different columns representing open, high, low, and close prices. You generally have to enter the library’s name before using a function that belongs to it; this is why <code>read_excel()</code> is preceded by <code>pd</code>.</p>&#13;
&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>I recommend using automatic import for Windows users and manual import for macOS users due to compatibility issues.<a contenteditable="false" data-primary="" data-startref="Chapter_6.html20" data-type="indexterm" id="id595"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html19" data-type="indexterm" id="id596"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="id46">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>Python, a major star among coding languages, enjoys widespread adoption by the developer community. Mastering it is key to unlocking huge potential in the data science world.<a contenteditable="false" data-primary="" data-startref="Chapter_6.html2" data-type="indexterm" id="id597"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html1" data-type="indexterm" id="id598"/><a contenteditable="false" data-primary="" data-startref="Chapter_6.html0" data-type="indexterm" id="id599"/></p>&#13;
&#13;
<p>The next chapter discusses machine learning and different prediction algorithms. The main aim is to be able to code the algorithms and run a backtest over financial data. You will see that once you start understanding the process, it becomes a matter of removing one algorithm and plugging another one in (in case they have the same assumptions). The warm-up chapters are over, and it’s time to start coding.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="id561"><sup><a href="ch06.html#id561-marker">1</a></sup> Imaginary numbers are a type of complex number that represents the square root of a negative number.</p><p data-type="footnote" id="id594"><sup><a href="ch06.html#id594-marker">2</a></sup> Named after its creator, Arthur David Olson, the Olson time zone addresses issues related to time zone data and daylight saving time rules. It has been an essential resource for developers and computer systems to <span class="keep-together">accurately</span> handle time-related functions and conversions.</p></div></div></section></body></html>