<html><head></head><body><section data-pdf-bookmark="Chapter 2. Introduction to Time Series Modeling" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_2">&#13;
<h1><span class="label">Chapter 2. </span>Introduction to Time Series Modeling</h1>&#13;
&#13;
<blockquote data-type="epigram">&#13;
<p> Market behavior is examined using large amounts of past data, such as high-frequency bid-ask quotes of currencies or stock prices. It is the abundance of data that makes possible the empirical study of the market. Although it is not possible to run controlled experiments, it is possible to extensively test on historical data.</p>&#13;
<p data-type="attribution"> Sergio Focardi (1997)</p>&#13;
</blockquote>&#13;
&#13;
<p><a data-primary="time series modeling" data-type="indexterm" id="ix_time_series_ch2"/>Some models account better for some phenomena; certain approaches capture the characteristics of an event in a solid way. Time series modeling is a good example of this because the vast majority of financial data has a time dimension, which makes time series applications a necessary tool for finance. In simple terms, the ordering of the data and its correlation is important.</p>&#13;
&#13;
<p>This chapter of the book will discuss classical time series models and compare the performance of these models. Deep learning–based time series analysis will be introduced in <a data-type="xref" href="ch03.html#chapter_3">Chapter 3</a>; this is an entirely different approach in terms of data preparation and model structure. The classical models include the <a data-primary="time series modeling" data-secondary="MA model" data-type="indexterm" id="idm45737256243696"/><a data-primary="MA (moving average) time series model" data-type="indexterm" id="idm45737256242752"/>moving average (MA), <a data-primary="time series modeling" data-secondary="AR model" data-type="indexterm" id="idm45737256241984"/><a data-primary="AR (autoregressive) model" data-type="indexterm" id="idm45737256241008"/>autoregressive (AR), and <a data-primary="ARIMA (autoregressive integrated moving average) model" data-type="indexterm" id="idm45737256240240"/><a data-primary="time series modeling" data-secondary="ARIMA model" data-type="indexterm" id="idm45737256239600"/>autoregressive integrated moving average (ARIMA) models. What is common across these models is the information carried by the historical observations. If these historical observations are obtained from error terms, we refer to this as a <em>moving average</em>; if these observations come out of time series itself, it is called <em>autoregressive</em>. The other model, ARIMA, is an extension of these models.</p>&#13;
&#13;
<p>Here is a formal definition of <em>time series</em> from Brockwell and Davis (2016):</p>&#13;
<blockquote>&#13;
<p>A time series is a set of observations <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math>, each one being recorded at a specific time <em>t</em>. A discrete-time time series… is one in which the set <math alttext="upper T 0">&#13;
  <msub><mi>T</mi> <mn>0</mn> </msub>&#13;
</math> of times at which observations are made is a discrete set, as is the case, for example, when observations are made at fixed time intervals. Continuous time series are obtained when observations are recorded continuously over some time interval.</p></blockquote>&#13;
&#13;
<p>Let’s observe what data with time dimension looks like. <a data-type="xref" href="#raw_oil_price">Figure 2-1</a> exhibits the oil prices for the period of 1980–2020, and the following Python code shows us a way of producing this plot:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">quandl</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">matplotlib.pyplot</code><code> </code><code class="kn">as</code><code> </code><code class="nn">plt</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">warnings</code><code>&#13;
</code><code>        </code><code class="n">warnings</code><code class="o">.</code><code class="n">filterwarnings</code><code class="p">(</code><code class="s1">'</code><code class="s1">ignore</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">oil</code><code> </code><code class="o">=</code><code> </code><code class="n">quandl</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="s2">"</code><code class="s2">NSE/OIL</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="n">authtoken</code><code class="o">=</code><code class="s2">"</code><code class="s2">insert you api token</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                         </code><code class="n">start_date</code><code class="o">=</code><code class="s2">"</code><code class="s2">1980-01-01</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                         </code><code class="n">end_date</code><code class="o">=</code><code class="s2">"</code><code class="s2">2020-01-01</code><code class="s2">"</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO1-1" id="co_introduction_to_time_series_modeling_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">oil</code><code class="o">.</code><code class="n">Close</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">$</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO1-1" id="callout_introduction_to_time_series_modeling_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Extracting data from Quandl database</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="raw_oil_price">&#13;
<img alt="raw_oil" src="assets/mlfr_0201.png"/>&#13;
<h6><span class="label">Figure 2-1. </span>Oil prices between 1980 and 2020</h6>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>An API is a tool designed for retrieving data using code. We will make use of different APIs throughout the book. <a data-primary="Quandl API" data-type="indexterm" id="idm45737256076880"/>In the preceding practice, Quandl API is used.</p>&#13;
&#13;
<p>Quandl API allows us to access financial, economic, and alternative data from the Quandl website. To get your Quandl API, please visit the <a href="https://oreil.ly/1IFDc">Quandl website</a> first and follow the necessary steps to get your own API key.</p>&#13;
</div>&#13;
&#13;
<p>As can be understood from the definition provided previously, time series models can be applicable to diverse areas such as:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Health care</p>&#13;
</li>&#13;
<li>&#13;
<p>Finance</p>&#13;
</li>&#13;
<li>&#13;
<p>Economics</p>&#13;
</li>&#13;
<li>&#13;
<p>Network analysis</p>&#13;
</li>&#13;
<li>&#13;
<p>Astronomy</p>&#13;
</li>&#13;
<li>&#13;
<p>Weather</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The superiority of the time series approach comes from the idea that correlations of observations in time better explain the current value. Having data with a correlated structure in time implies a violation of the famous identically and independently distributed (IID) assumption, which is at the heart of many models.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45737256063168">&#13;
<h5>The Definition of IID</h5>&#13;
<p><a data-primary="IID (identically and independently distributed) assumption" data-type="indexterm" id="idm45737256061968"/>IID assumption enables us to model joint probability of data as the product of &#13;
<span class="keep-together">probability</span> of observations.&#13;
The process <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> is said to be an IID with mean 0 and &#13;
<span class="keep-together">variance</span> <math alttext="sigma squared">&#13;
  <msup><mi>σ</mi> <mn>2</mn> </msup>&#13;
</math>:</p>&#13;
<div data-type="equation">&#13;
<math alttext="upper X Subscript t Baseline tilde upper I upper I upper D left-parenthesis 0 comma sigma squared right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>∼</mo>&#13;
    <mi>I</mi>&#13;
    <mi>I</mi>&#13;
    <mi>D</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mn>0</mn>&#13;
      <mo>,</mo>&#13;
      <msup><mi>σ</mi> <mn>2</mn> </msup>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
</div></aside>&#13;
&#13;
<p>So, due to the correlation in time, the dynamics of a contemporaneous stock price can be better understood by its own historical values. How can we comprehend the dynamics of the data? This is a question that we can address by elaborating the components of time series.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Time Series Components" data-type="sect1"><div class="sect1" id="idm45737256033824">&#13;
<h1>Time Series Components</h1>&#13;
&#13;
<p><a data-primary="time series" data-type="indexterm" id="ix_time_series_comp"/>Time series has four components: trend, seasonality, cyclicality, and residual. In Python, we can easily visualize the components of a time series with the <code>seasonal_decompose</code> function:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">yfinance</code><code> </code><code class="kn">as</code><code> </code><code class="nn">yf</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">datetime</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">statsmodels.api</code><code> </code><code class="kn">as</code><code> </code><code class="nn">sm</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">statsmodels.tsa.stattools</code><code> </code><code class="kn">import</code><code> </code><code class="n">adfuller</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">statsmodels.tsa.seasonal</code><code> </code><code class="kn">import</code><code> </code><code class="n">seasonal_decompose</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ticker</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">^GSPC</code><code class="s1">'</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO2-1" id="co_introduction_to_time_series_modeling_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">start</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2015</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO2-2" id="co_introduction_to_time_series_modeling_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2021</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO2-2" id="co_introduction_to_time_series_modeling_CO2-3"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">SP_prices</code><code> </code><code class="o">=</code><code> </code><code class="n">yf</code><code class="o">.</code><code class="n">download</code><code class="p">(</code><code class="n">ticker</code><code class="p">,</code><code> </code><code class="n">start</code><code class="o">=</code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code class="o">=</code><code class="n">end</code><code class="p">,</code><code> </code><code class="n">interval</code><code class="o">=</code><code class="s1">'</code><code class="s1">1mo</code><code class="s1">'</code><code class="p">)</code><code>\&#13;
</code><code>                    </code><code class="o">.</code><code class="n">Close</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO2-3" id="co_introduction_to_time_series_modeling_CO2-4"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="p">[</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="mi">100</code><code class="o">%</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="p">]</code><code>  </code><code class="mi">1</code><code> </code><code class="n">of</code><code> </code><code class="mi">1</code><code> </code><code class="n">completed</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">seasonal_decompose</code><code class="p">(</code><code class="n">SP_prices</code><code class="p">,</code><code> </code><code class="n">period</code><code class="o">=</code><code class="mi">12</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO2-1" id="callout_introduction_to_time_series_modeling_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Denoting ticker of S&amp;P 500</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO2-2" id="callout_introduction_to_time_series_modeling_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Identifying the start and end dates</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO2-4" id="callout_introduction_to_time_series_modeling_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Accessing the closing price of S&amp;P 500</p></dd>&#13;
</dl>&#13;
&#13;
<p>In the top panel of <a data-type="xref" href="#time_series_decompose">Figure 2-2</a>, we see the plot of raw data, and in the second panel, trend can be observed showing upward movement. In the third panel, seasonality is exhibited, and finally residual is presented showing erratic fluctuations. You might wonder where the cyclicality component is; noise and the cyclical component are put together under the residual component.</p>&#13;
&#13;
<p>Becoming familiar with time series components is important for further analysis so that we are able to understand characteristics of the data and propose a suitable model. Let’s start with the trend component.</p>&#13;
&#13;
<figure><div class="figure" id="time_series_decompose">&#13;
<img alt="decomp" src="assets/mlfr_0202.png"/>&#13;
<h6><span class="label">Figure 2-2. </span>Time series decomposition of S&amp;P 500</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Trend" data-type="sect2"><div class="sect2" id="idm45737255817936">&#13;
<h2>Trend</h2>&#13;
&#13;
<p><em>Trend</em> indicates a general tendency of an increase or decrease during a given time period. <a data-primary="trend, time series modeling" data-type="indexterm" id="ix_trend_time_series"/><a data-primary="time series" data-secondary="trend" data-type="indexterm" id="ix_time_series_trend"/>Generally speaking, trend is present when the starting and ending points are different or have upward/downward slope in a time series. The following code shows what a trend looks like:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">SP_prices</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO3-1" id="co_introduction_to_time_series_modeling_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">S&amp;P-500 Prices</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">$</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
&#13;
<p>Aside from the period in which the S&amp;P 500 index price plunges, we see a clear upward trend in <a data-type="xref" href="#raw_sp_price">Figure 2-3</a> between 2010 and 2020.</p>&#13;
&#13;
<figure><div class="figure" id="raw_sp_price">&#13;
<img alt="raw_sp" src="assets/mlfr_0203.png"/>&#13;
<h6><span class="label">Figure 2-3. </span>S&amp;P 500 price</h6>&#13;
</div></figure>&#13;
&#13;
<p>A line plot is not the only option for understanding trend. Rather, we have some other strong tools for this task. So, at this point, it is worthwhile to talk about two important statistical concepts:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Autocorrelation function</p>&#13;
</li>&#13;
<li>&#13;
<p>Partial autocorrelation function</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-primary="ACF (autocorrelation function)" data-type="indexterm" id="ix_ACF_func"/>The autocorrelation function (ACF) is a statistical tool to analyze the relationship between the current value of a time series and its lagged values. Graphing ACF enables us to readily observe the serial dependence in a time series:</p>&#13;
<div data-type="equation">&#13;
<math alttext="ModifyingAbove rho With caret left-parenthesis h right-parenthesis equals StartFraction Cov left-parenthesis upper X Subscript t Baseline comma upper X Subscript t minus h Baseline right-parenthesis Over Var left-parenthesis upper X Subscript t Baseline right-parenthesis EndFraction" display="block">&#13;
  <mrow>&#13;
    <mover accent="true"><mi>ρ</mi> <mo>^</mo></mover>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>h</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mfrac><mrow><mtext>Cov</mtext><mo>(</mo><msub><mi>X</mi> <mi>t</mi> </msub><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi></mrow> </msub><mo>)</mo></mrow> <mrow><mtext>Var</mtext><mo>(</mo><msub><mi>X</mi> <mi>t</mi> </msub><mo>)</mo></mrow></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p><a data-type="xref" href="#acf">Figure 2-4</a> denotes the ACF plot. The vertical lines represent the correlation coefficients; the first line denotes the correlation of the series with its 0 lag—that is, it is the correlation with itself. The second line indicates the correlation between series value at time <em>t</em> - 1 and <em>t</em>. In light of these, we can conclude that the S&amp;P 500 shows a serial dependence. There appears to be a strong dependence between the current value and lagged values of S&amp;P 500 data because the correlation coefficients, represented  by lines in the ACF plot, decay in a slow fashion.</p>&#13;
&#13;
<p>Here is how we can plot the ACF in Python:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_acf</code><code class="p">(</code><code class="n">SP_prices</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO3-1" id="co_introduction_to_time_series_modeling_CO3-2"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Number of Lags</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO3-1" id="callout_introduction_to_time_series_modeling_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Plotting ACF</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="acf">&#13;
<img alt="acf_sp" src="assets/mlfr_0204.png"/>&#13;
<h6><span class="label">Figure 2-4. </span>ACF plot of the S&amp;P 500</h6>&#13;
</div></figure>&#13;
&#13;
<p>Now the question is, what are the likely sources of autocorrelations? Here are some causes:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The primary source of autocorrelation is “carryover,” meaning that the preceding observation has an impact on the current one.</p>&#13;
</li>&#13;
<li>&#13;
<p>Model misspecification.</p>&#13;
</li>&#13;
<li>&#13;
<p>Measurement error, which is basically the difference between observed and actual values.</p>&#13;
</li>&#13;
<li>&#13;
<p>Dropping a variable, which has an explanatory power.<a data-primary="" data-startref="ix_ACF_func" data-type="indexterm" id="idm45737255613744"/></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p class="pagebreak-before less_space"><a data-primary="PACF (partial autocorrelation function)" data-type="indexterm" id="ix_partial_ACF_func"/>Partial autocorrelation function (PACF) is another method of examining the relationship between <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> and <math alttext="upper X Subscript t minus p Baseline comma p element-of double-struck upper Z">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>p</mi></mrow> </msub>&#13;
    <mo>,</mo>&#13;
    <mi>p</mi>&#13;
    <mo>∈</mo>&#13;
    <mi>ℤ</mi>&#13;
  </mrow>&#13;
</math>. ACF is commonly considered as a useful tool in the MA(q) model simply because PACF does not decay fast but approaches toward 0. However, the pattern of ACF is more applicable to MA. PACF, on the other hand, works well with the &#13;
<span class="keep-together">AR(p)</span> process.</p>&#13;
&#13;
<p>PACF provides information on the correlation between the current value of a time series and its lagged values, controlling for the other correlations.</p>&#13;
&#13;
<p>It is not easy to figure out what is going on at first glance. Let me give you an example. Suppose that we want to compute the partial correlation <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> and <math alttext="upper X Subscript t minus h">&#13;
  <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi></mrow> </msub>&#13;
</math>.</p>&#13;
&#13;
<p>Put mathematically:</p>&#13;
<div data-type="equation">&#13;
<math alttext="dollar-sign ModifyingAbove rho With caret left-parenthesis h right-parenthesis equals StartFraction Cov left-parenthesis upper X Subscript t Baseline comma upper X Subscript t minus h Baseline vertical-bar upper X Subscript t minus 1 Baseline comma upper X Subscript t minus 2 Baseline ellipsis upper X Subscript t minus h minus 1 Baseline right-parenthesis Over StartRoot Var left-parenthesis upper X Subscript t Baseline vertical-bar upper X Subscript t minus 1 Baseline comma upper X Subscript t minus 2 Baseline comma ellipsis comma upper X Subscript t minus h minus 1 Baseline right-parenthesis Var left-parenthesis upper X Subscript t minus h Baseline vertical-bar upper X Subscript t minus 1 Baseline comma upper X Subscript t minus 2 Baseline comma ellipsis comma upper X Subscript t minus h minus 1 Baseline right-parenthesis EndRoot EndFraction dollar-sign">&#13;
  <mrow>&#13;
    <mover accent="true"><mi>ρ</mi> <mo>^</mo></mover>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>h</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <mfrac><mrow><mtext>Cov</mtext><mo>(</mo><msub><mi>X</mi> <mi>t</mi> </msub><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi></mrow> </msub><mo>|</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub><mo>...</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi><mo>-</mo><mn>1</mn></mrow> </msub><mo>)</mo></mrow> <msqrt><mrow><mtext>Var</mtext><mrow><mo>(</mo><msub><mi>X</mi> <mi>t</mi> </msub><mo>|</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub><mo>,</mo><mo>...</mo><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi><mo>-</mo><mn>1</mn></mrow> </msub><mo>)</mo></mrow><mtext>Var</mtext><mrow><mo>(</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi></mrow> </msub><mo>|</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub><mo>,</mo><mo>...</mo><mo>,</mo><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>h</mi><mo>-</mo><mn>1</mn></mrow> </msub><mo>)</mo></mrow></mrow></msqrt></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>h</em> is the lag. Take a look at the Python code for a PACF plot of the &#13;
<span class="keep-together">S&amp;P 500</span> in the following snippet:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_pacf</code><code class="p">(</code><code class="n">SP_prices</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO4-1" id="co_introduction_to_time_series_modeling_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Number of Lags</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO4-1" id="callout_introduction_to_time_series_modeling_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Plotting PACF</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#pacf">Figure 2-5</a> exhibits the PACF of raw S&amp;P 500 data. In interpreting the PACF, we focus on the spikes outside the dark region representing confidence interval. <a data-type="xref" href="#pacf">Figure 2-5</a> exhibits some spikes at different lags, but lag 10 is outside the confidence interval. So it may be wise to select a model with 10 lags to include all the lags up to lag 10.</p>&#13;
&#13;
<p>As discussed, PACF measures the correlation between current values of series and lagged values in a way to isolate in-between effects.<a data-primary="" data-startref="ix_time_series_trend" data-type="indexterm" id="idm45737255492624"/><a data-primary="" data-startref="ix_trend_time_series" data-type="indexterm" id="idm45737255491648"/></p>&#13;
&#13;
<figure><div class="figure" id="pacf">&#13;
<img alt="partial autocorrelation SP" src="assets/mlfr_0205.png"/>&#13;
<h6><span class="label">Figure 2-5. </span>PACF plot of the S&amp;P 500</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Seasonality" data-type="sect2"><div class="sect2" id="idm45737255816992">&#13;
<h2>Seasonality</h2>&#13;
&#13;
<p><a data-primary="time series" data-secondary="seasonality" data-type="indexterm" id="ix_time_series_season"/><a data-primary="seasonality, time series modeling" data-type="indexterm" id="ix_season_time_series"/>Seasonality exists if there are regular fluctuations over a given period of time. For instance, energy usages can show a seasonality characteristic. To be more specific, energy usage goes up and down during certain periods over a year.</p>&#13;
&#13;
<p><a data-primary="FRED (Federal Reserve Economic Database)" data-type="indexterm" id="idm45737255456880"/>To show how we can detect the seasonality component, let’s use the Federal Reserve Economic Database (FRED), which includes more than 500,000 economic data series from over 80 sources covering many areas, such as banking, employment, exchange rates, gross domestic product, interest rates, trade and international transactions, and so on:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">fredapi</code><code> </code><code class="kn">import</code><code> </code><code class="n">Fred</code><code>&#13;
</code><code>         </code><code class="kn">import</code><code> </code><code class="nn">statsmodels.api</code><code> </code><code class="kn">as</code><code> </code><code class="nn">sm</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">fred</code><code> </code><code class="o">=</code><code> </code><code class="n">Fred</code><code class="p">(</code><code class="n">api_key</code><code class="o">=</code><code class="s1">'</code><code class="s1">insert you api key</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">energy</code><code> </code><code class="o">=</code><code> </code><code class="n">fred</code><code class="o">.</code><code class="n">get_series</code><code class="p">(</code><code class="s2">"</code><code class="s2">CAPUTLG2211A2S</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                                  </code><code class="n">observation_start</code><code class="o">=</code><code class="s2">"</code><code class="s2">2010-01-01</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                                  </code><code class="n">observation_end</code><code class="o">=</code><code class="s2">"</code><code class="s2">2020-12-31</code><code class="s2">"</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO5-1" id="co_introduction_to_time_series_modeling_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">energy</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">83.7028</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">02</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">84.9324</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">82.0379</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">04</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">79.5073</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">05</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">82.8055</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">84.4108</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">83.6338</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">83.7961</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mi">09</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">83.7459</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mi">10</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">80.8892</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mi">11</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">81.7758</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">85.9894</code><code>&#13;
</code><code>         </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">energy</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Energy Capacity Utilization</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">$</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_acf</code><code class="p">(</code><code class="n">energy</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Number of Lags</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO5-1" id="callout_introduction_to_time_series_modeling_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Accessing the energy capacity utilization from the FRED for the period of 2010–2020</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#energy_seasonality">Figure 2-6</a> indicates periodic ups and downs over a nearly 10-year period with high-capacity utilization during the first months of every year and then going down toward the end of year, confirming that there is seasonality in energy-capacity &#13;
<span class="keep-together">utilization</span>.</p>&#13;
&#13;
<figure class="width-80"><div class="figure" id="energy_seasonality">&#13;
<img alt="energy_seas" src="assets/mlfr_0206.png"/>&#13;
<h6><span class="label">Figure 2-6. </span>Seasonality in energy capacity utilization</h6>&#13;
</div></figure>&#13;
&#13;
<p>An ACF plot can also provide information about the seasonality as the periodic ups and downs can be observable using ACF, too. <a data-type="xref" href="#energy_acf">Figure 2-7</a> shows the correlation structure in the presence of seasonality.<a data-primary="" data-startref="ix_season_time_series" data-type="indexterm" id="idm45737255384192"/><a data-primary="" data-startref="ix_time_series_season" data-type="indexterm" id="idm45737255260944"/></p>&#13;
&#13;
<figure><div class="figure" id="energy_acf">&#13;
<img alt="energy_acf" src="assets/mlfr_0207.png"/>&#13;
<h6><span class="label">Figure 2-7. </span>ACF of energy capacity utilization</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Cyclicality" data-type="sect2"><div class="sect2" id="idm45737255406512">&#13;
<h2>Cyclicality</h2>&#13;
&#13;
<p><a data-primary="cyclicality, time series modeling" data-type="indexterm" id="idm45737255405312"/><a data-primary="time series" data-secondary="cyclicality" data-type="indexterm" id="idm45737255404544"/>What if data does not show fixed period movements? At this point, cyclicality comes into the picture.  It exists when higher periodic variation than the trend emerges. Some confuse cyclicality and seasonality in a sense that they both exhibit expansion and contraction. We can, however, think of cyclicality as business cycles, which take a long time to complete their cycles and the ups and downs are over a long horizon. So cyclicality is different from seasonality in the sense that there is no fluctuation in a fixed period. An example of cyclicality may be house purchases (or sales) depending on mortgage rate. That is, when a mortgage rate is cut (or raised), it leads to a boost for house purchases (or sales).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Residual" data-type="sect2"><div class="sect2" id="idm45737255417376">&#13;
<h2>Residual</h2>&#13;
&#13;
<p><a data-primary="time series" data-secondary="residual" data-type="indexterm" id="ix_time_series_residual"/><a data-primary="residuals, time series modeling" data-type="indexterm" id="ix_residual_time_series"/>Residual is known as an irregular component of time series. Technically speaking, residual is equal to the difference between observations and related fitted values. We can think of it as a leftover from the model.</p>&#13;
&#13;
<p>As we have discussed before, time series models lack some core assumptions, but this does not necessarily mean that time series models are free from assumptions. <a data-primary="stationarity and nonstationarity in time series" data-type="indexterm" id="ix_station_nonstation"/><a data-primary="nonstationarity and stationarity in time series" data-type="indexterm" id="ix_nonstation_station"/>I would like to stress the most prominent one, which is called <em>stationarity</em>.</p>&#13;
&#13;
<p>Stationarity means that statistical properties such as mean, variance, and covariance of the time series do not change over time.</p>&#13;
&#13;
<p>There are two forms of stationarity:</p>&#13;
<dl>&#13;
<dt>Weak stationarity</dt>&#13;
<dd>&#13;
<div class="openblock">&#13;
<p>Time series <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> is said to be stationarity if:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> has finite variance,  <math alttext="double-struck upper E left-parenthesis upper X Subscript t Superscript 2 Baseline right-parenthesis less-than normal infinity comma for-all t element-of double-struck upper Z">&#13;
  <mrow>&#13;
    <mi>𝔼</mi>&#13;
    <mo>(</mo>&#13;
    <msubsup><mi>X</mi> <mi>t</mi> <mn>2</mn> </msubsup>&#13;
    <mo>)</mo>&#13;
    <mo>&lt;</mo>&#13;
    <mi>∞</mi>&#13;
    <mo>,</mo>&#13;
    <mo>∀</mo>&#13;
    <mi>t</mi>&#13;
    <mo>∈</mo>&#13;
    <mi>ℤ</mi>&#13;
  </mrow>&#13;
</math></p>&#13;
</li>&#13;
<li>&#13;
<p>The mean value of  <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> is constant and does solely depend on time,  <math alttext="double-struck upper E left-parenthesis upper X Subscript t Baseline right-parenthesis equals mu comma t for-all element-of double-struck upper Z">&#13;
  <mrow>&#13;
    <mi>𝔼</mi>&#13;
    <mo>(</mo>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>)</mo>&#13;
    <mo>=</mo>&#13;
    <mi>μ</mi>&#13;
    <mo>,</mo>&#13;
    <mi>t</mi>&#13;
    <mo>∀</mo>&#13;
    <mo>∈</mo>&#13;
    <mi>ℤ</mi>&#13;
  </mrow>&#13;
</math></p>&#13;
</li>&#13;
<li>&#13;
<p>Covariance structure,  <math alttext="gamma left-parenthesis t comma t plus h right-parenthesis">&#13;
  <mrow>&#13;
    <mi>γ</mi>&#13;
    <mo>(</mo>&#13;
    <mi>t</mi>&#13;
    <mo>,</mo>&#13;
    <mi>t</mi>&#13;
    <mo>+</mo>&#13;
    <mi>h</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math>, depends on the time difference only:</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="equation">&#13;
<math alttext="dollar-sign gamma left-parenthesis h right-parenthesis equals gamma Subscript h Baseline plus gamma left-parenthesis t plus h comma t right-parenthesis dollar-sign">&#13;
  <mrow>&#13;
    <mi>γ</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>h</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>=</mo>&#13;
    <msub><mi>γ</mi> <mi>h</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>γ</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>t</mi>&#13;
      <mo>+</mo>&#13;
      <mi>h</mi>&#13;
      <mo>,</mo>&#13;
      <mi>t</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>In other words, time series should have finite variance with constant mean and a covariance structure that is a function of the time difference.</p>&#13;
</div>&#13;
&#13;
</dd>&#13;
<dt>Strong stationarity</dt>&#13;
<dd>&#13;
<p>If the joint distribution of  <math alttext="upper X Subscript t Baseline 1 Baseline comma upper X Subscript t Baseline 2 Baseline comma period period period upper X Subscript t k Baseline">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mn>1</mn></mrow> </msub>&#13;
    <mo>,</mo>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mn>2</mn></mrow> </msub>&#13;
    <mo>,</mo>&#13;
    <mo>.</mo>&#13;
    <mo>.</mo>&#13;
    <mo>.</mo>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mi>k</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math> is the same with the shifted version of set <math alttext="upper X Subscript t Baseline 1 plus h Baseline comma upper X Subscript t Baseline 2 plus h Baseline comma period period period upper X Subscript t k plus h Baseline">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mn>1</mn><mo>+</mo><mi>h</mi></mrow> </msub>&#13;
    <mo>,</mo>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mn>2</mn><mo>+</mo><mi>h</mi></mrow> </msub>&#13;
    <mo>,</mo>&#13;
    <mo>.</mo>&#13;
    <mo>.</mo>&#13;
    <mo>.</mo>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mi>k</mi><mo>+</mo><mi>h</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>, it is referred to as strong stationarity. Thus, strong stationarity implies that distribution of random variables of a random process is the same with a shifting time index.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The question is now why do we need stationarity? The reason is twofold.</p>&#13;
&#13;
<p>First, in the estimation process, it is essential to have some distribution as time goes on. In other words, if distribution of a time series changes over time, it becomes unpredictable and cannot be modeled.</p>&#13;
&#13;
<p>The ultimate aim of time series models is forecasting. To do that, we should estimate the coefficients first, which corresponds to learning in ML. Once we learn and conduct forecasting analysis, we assume that the distribution of the data in the estimation stays the same in a way that we have the same estimated coefficients. If this is not the case, we should reestimate the coefficients because we are unable to forecast with the previous estimated coefficients.</p>&#13;
&#13;
<p>Having structural breaks, such as a financial crisis, generates a shift in distribution. We need to take care of this period cautiously and separately.</p>&#13;
&#13;
<p>The other reason for having stationarity is, by assumption, some statistical models require stationary data, but that does not mean that some models requires stationary only. Instead, all models require stationarity but even if you feed the model with nonstationary data, some models, by design, turn it into stationary data and process it.</p>&#13;
&#13;
<p><a data-type="xref" href="#acf">Figure 2-4</a> showed the slow-decaying lags amounting to nonstationary because persistence of the high correlation between lags of the time series continues.</p>&#13;
&#13;
<p>There are, by and large, two ways to detect nonstationarity: visualization and statistical methods. The latter, of course, is a better and more robust way of detecting the nonstationarity. However, to improve our understanding, let’s start with the ACF. Slow-decaying ACF implies that the data is nonstationary because it presents a strong correlation in time. That is what I observe in &#13;
<span class="keep-together">S&amp;P 500</span> data.</p>&#13;
&#13;
<p>We first need to check and see if the data is stationary or not. Visualization is a good but ultimately inadequate tool for this task. Instead, a more powerful statistical method is needed, and the augmented Dickey-Fuller (ADF) test provides this. Assuming that the confidence interval is set to 95%, the following result indicates that the data is not stationary:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">stat_test</code><code> </code><code class="o">=</code><code> </code><code class="n">adfuller</code><code class="p">(</code><code class="n">SP_prices</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO6-1" id="co_introduction_to_time_series_modeling_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s2">"</code><code class="s2">The test statistic and p-value of ADF test are {}</code><code class="s2">"</code><code>&#13;
</code><code>               </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">stat_test</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO6-2" id="co_introduction_to_time_series_modeling_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">test</code><code> </code><code class="n">statistic</code><code> </code><code class="ow">and</code><code> </code><code class="n">p</code><code class="o">-</code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">ADF</code><code> </code><code class="n">test</code><code> </code><code class="n">are</code><code> </code><code class="p">(</code><code class="mf">0.030295120072926063</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="mf">0.9609669053518538</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO6-1" id="callout_introduction_to_time_series_modeling_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>ADF test for stationarity</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO6-2" id="callout_introduction_to_time_series_modeling_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Test statistic and p-value of ADF test</p></dd>&#13;
</dl>&#13;
&#13;
<p>Taking the difference is an efficient technique for removing the stationarity. This just means subtracting the current value of the series from its first lagged value, i.e., <math alttext="x Subscript t Baseline minus x Subscript t minus 1">&#13;
  <mrow>&#13;
    <msub><mi>x</mi> <mi>t</mi> </msub>&#13;
    <mo>-</mo>&#13;
    <msub><mi>x</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
  </mrow>&#13;
</math>, and the following Python code presents how to apply this technique (and creates Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#detrendedSP500">2-8</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#diff_acfSP500">2-9</a>):</p>&#13;
&#13;
<pre class="smaller-code" data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">diff_SP_price</code><code> </code><code class="o">=</code><code> </code><code class="n">SP_prices</code><code class="o">.</code><code class="n">diff</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO7-1" id="co_introduction_to_time_series_modeling_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_SP_price</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Differenced S&amp;P-500 Price</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">$</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_acf</code><code class="p">(</code><code class="n">diff_SP_price</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Number of Lags</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">stat_test2</code><code> </code><code class="o">=</code><code> </code><code class="n">adfuller</code><code class="p">(</code><code class="n">diff_SP_price</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO7-2" id="co_introduction_to_time_series_modeling_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s2">"</code><code class="s2">The test statistic and p-value of ADF test after differencing are {}</code><code class="s2">"</code><code>\&#13;
</code><code>               </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">stat_test2</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">test</code><code> </code><code class="n">statistic</code><code> </code><code class="ow">and</code><code> </code><code class="n">p</code><code class="o">-</code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">ADF</code><code> </code><code class="n">test</code><code> </code><code class="n">after</code><code> </code><code class="n">differencing</code><code> </code><code class="n">are</code><code>&#13;
</code><code>          </code><code class="p">(</code><code class="o">-</code><code class="mf">7.0951058730170855</code><code class="p">,</code><code> </code><code class="mf">4.3095548146405375e-10</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO7-1" id="callout_introduction_to_time_series_modeling_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Taking the difference of S&amp;P 500 prices</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO7-2" id="callout_introduction_to_time_series_modeling_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>ADF test result based on differenced S&amp;P 500 data</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="detrendedSP500">&#13;
<img alt="differenced SP" src="assets/mlfr_0208.png"/>&#13;
<h6><span class="label">Figure 2-8. </span>Detrended S&amp;P 500 price</h6>&#13;
</div></figure>&#13;
&#13;
<p>After taking the first difference, we rerun the ADF test to see if it worked, and yes, it does. The very low p-value of ADF tells me that S&amp;P 500 data is stationary now.</p>&#13;
&#13;
<p>This can be observed from the line plot provided in <a data-type="xref" href="#detrendedSP500">Figure 2-8</a>. Unlike the raw S&amp;P 500 plot, this plot exhibits fluctuations around the mean with similar volatility, meaning that we have a stationary series.</p>&#13;
&#13;
<p><a data-type="xref" href="#diff_acfSP500">Figure 2-9</a> shows that there is only one statistical significant correlation structure at lag 7.</p>&#13;
&#13;
<p>Needless to say, trend is not the only indicator of nonstationarity. Seasonality is another source of it, and now we are about to learn a method to deal with it.<a data-primary="" data-startref="ix_nonstation_station" data-type="indexterm" id="idm45737254709936"/><a data-primary="" data-startref="ix_station_nonstation" data-type="indexterm" id="idm45737254708960"/></p>&#13;
&#13;
<figure><div class="figure" id="diff_acfSP500">&#13;
<img alt="differenced_acf" src="assets/mlfr_0209.png"/>&#13;
<h6><span class="label">Figure 2-9. </span>Detrended S&amp;P 500 price</h6>&#13;
</div></figure>&#13;
&#13;
<p>First, take a look at the ACF of energy capacity utilization in&#13;
<a data-type="xref" href="#energy_acf">Figure 2-7</a>, which shows periodic ups and downs, a sign of nonstationarity.</p>&#13;
&#13;
<p>To get rid of seasonality, we first apply the <em>resample</em> method to calculate annual mean, which is used as the denominator in the following formula:</p>&#13;
<div data-type="equation">&#13;
<math alttext="Seasonal Index equals StartFraction Value of a Seasonal Time Series Over Seasonal Average EndFraction" display="block">&#13;
  <mrow>&#13;
    <mtext>Seasonal</mtext>&#13;
    <mspace width="4.pt"/>&#13;
    <mtext>Index</mtext>&#13;
    <mo>=</mo>&#13;
    <mfrac><mrow><mtext>Value</mtext><mspace width="4.pt"/><mtext>of</mtext><mspace width="4.pt"/><mtext>a</mtext><mspace width="4.pt"/><mtext>Seasonal</mtext><mspace width="4.pt"/><mtext>Time</mtext><mspace width="4.pt"/><mtext>Series</mtext></mrow> <mrow><mtext>Seasonal</mtext><mspace width="4.pt"/><mtext>Average</mtext></mrow></mfrac>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Thus, the result of the application, <em>seasonal index</em>, gives us the deseasonalized time series. The following code shows us how we code this formula in Python:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">seasonal_index</code><code> </code><code class="o">=</code><code> </code><code class="n">energy</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code class="s1">'</code><code class="s1">Q</code><code class="s1">'</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO8-1" id="co_introduction_to_time_series_modeling_CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dates</code><code> </code><code class="o">=</code><code> </code><code class="n">energy</code><code class="o">.</code><code class="n">index</code><code class="o">.</code><code class="n">year</code><code class="o">.</code><code class="n">unique</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO8-2" id="co_introduction_to_time_series_modeling_CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">deseasonalized</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="n">dates</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="k">for</code><code> </code><code class="n">j</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">13</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>                 </code><code class="n">deseasonalized</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="p">(</code><code class="n">energy</code><code class="p">[</code><code class="nb">str</code><code class="p">(</code><code class="n">i</code><code class="p">)</code><code class="p">]</code><code class="p">[</code><code class="n">energy</code><code class="p">[</code><code class="nb">str</code><code class="p">(</code><code class="n">i</code><code class="p">)</code><code class="p">]</code><code>\&#13;
</code><code>                                                       </code><code class="o">.</code><code class="n">index</code><code class="o">.</code><code class="n">month</code><code class="o">==</code><code class="n">j</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO8-3" id="co_introduction_to_time_series_modeling_CO8-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">concat_deseasonalized</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">concatenate</code><code class="p">(</code><code class="n">deseasonalized</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO8-4" id="co_introduction_to_time_series_modeling_CO8-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">deseason_energy</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code class="p">,</code><code class="n">s</code><code> </code><code class="ow">in</code><code> </code><code class="nb">zip</code><code class="p">(</code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">energy</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">)</code><code class="p">,</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">seasonal_index</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">deseason_energy</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">concat_deseasonalized</code><code class="p">[</code><code class="n">i</code><code class="p">:</code><code class="n">i</code><code class="o">+</code><code class="mi">3</code><code class="p">]</code><code> </code><code class="o">/</code><code>&#13;
</code><code>                                    </code><code class="n">seasonal_index</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">s</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO8-5" id="co_introduction_to_time_series_modeling_CO8-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>         </code><code class="n">concat_deseason_energy</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">concatenate</code><code class="p">(</code><code class="n">deseason_energy</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">deseason_energy</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">concat_deseason_energy</code><code class="p">,</code><code>&#13;
</code><code>                                        </code><code class="n">index</code><code class="o">=</code><code class="n">energy</code><code class="o">.</code><code class="n">index</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">deseason_energy</code><code class="o">.</code><code class="n">columns</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">Deaseasonalized Energy</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="n">deseason_energy</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code>             </code><code class="n">Deaseasonalized</code><code> </code><code class="n">Energy</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">01</code><code>                </code><code class="mf">1.001737</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">02</code><code class="o">-</code><code class="mo">01</code><code>                </code><code class="mf">1.016452</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mo">01</code><code>                </code><code class="mf">0.981811</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">04</code><code class="o">-</code><code class="mo">01</code><code>                </code><code class="mf">0.966758</code><code>&#13;
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">05</code><code class="o">-</code><code class="mo">01</code><code>                </code><code class="mf">1.006862</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_acf</code><code class="p">(</code><code class="n">deseason_energy</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="o">=</code><code class="mi">10</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Number of Lags</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_pacf</code><code class="p">(</code><code class="n">deseason_energy</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="o">=</code><code class="mi">10</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Number of Lags</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO8-1" id="callout_introduction_to_time_series_modeling_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Calculating quarterly mean of energy utilization</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO8-2" id="callout_introduction_to_time_series_modeling_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Defining the years in which seasonality analysis is run</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO8-3" id="callout_introduction_to_time_series_modeling_CO8-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Computing the numerator of <em>Seasonal Index</em> formula</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO8-4" id="callout_introduction_to_time_series_modeling_CO8-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Concatenating the deseasonalized energy utilization</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO8-5" id="callout_introduction_to_time_series_modeling_CO8-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Computing <em>Seasonal Index</em> using the predefined formula</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#deseasonalized_acf_energy">Figure 2-10</a> suggests that there is a statistically significant correlation at lag 1 and 2, but ACF does not show any periodic characteristics, which is another way of saying deseasonalization.</p>&#13;
&#13;
<p>Similarly, in <a data-type="xref" href="#deseasonalized_pacf_energy">Figure 2-11</a>, although there is a spike at some lags, PACF does not show any periodic ups and downs. So we can say that the data is deseasonalized using the Seasonal Index Formula.</p>&#13;
&#13;
<p>What we have now are the less periodic ups and down in energy-capacity utilization, meaning that the data turns out to be deseasonalized.<a data-primary="" data-startref="ix_time_series_comp" data-type="indexterm" id="idm45737254608560"/><a data-primary="" data-startref="ix_residual_time_series" data-type="indexterm" id="idm45737254607584"/><a data-primary="" data-startref="ix_time_series_residual" data-type="indexterm" id="idm45737254606640"/></p>&#13;
&#13;
<p>Finally, we are ready to move forward and discuss the time series models.</p>&#13;
&#13;
<figure class="width-90"><div class="figure" id="deseasonalized_acf_energy">&#13;
<img alt="deseasonalized energy acf" src="assets/mlfr_0210.png"/>&#13;
<h6><span class="label">Figure 2-10. </span>Deseasonalized ACF of energy utilization</h6>&#13;
</div></figure>&#13;
&#13;
<figure class="width-90"><div class="figure" id="deseasonalized_pacf_energy">&#13;
<img alt="deseasonalized energy pacf" src="assets/mlfr_0211.png"/>&#13;
<h6><span class="label">Figure 2-11. </span>Deseasonalized PACF of energy utilization</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Time Series Models" data-type="sect1"><div class="sect1" id="idm45737256033328">&#13;
<h1>Time Series Models</h1>&#13;
&#13;
<p><a data-primary="time series modeling" data-secondary="phases" data-type="indexterm" id="ix_time_series_phase"/>Traditional time series models are univariate models, and they follow these phases:</p>&#13;
<dl>&#13;
<dt><a data-primary="identification phase of time series modeling" data-type="indexterm" id="idm45737254600752"/>Identification</dt>&#13;
<dd>&#13;
<p>In this process, we explore the data using ACF and PACF, identifying patterns and conducting statistical tests.</p>&#13;
</dd>&#13;
<dt><a data-primary="estimation phase of time series modeling" data-type="indexterm" id="idm45737254429808"/>Estimation</dt>&#13;
<dd>&#13;
<p>We estimate coefficients via the proper optimization technique.</p>&#13;
</dd>&#13;
<dt><a data-primary="diagnostics phase of time series modeling" data-type="indexterm" id="idm45737254361616"/>Diagnostics</dt>&#13;
<dd>&#13;
<p>After estimation, we need to check if information criteria or ACF/PACF suggest that the model is valid. If so, we move on to the forecasting stage.</p>&#13;
</dd>&#13;
<dt><a data-primary="forecast phase of time series modeling" data-type="indexterm" id="idm45737254359504"/>Forecast</dt>&#13;
<dd>&#13;
<p>This part is more about the performance of the model. In forecasting, we predict future values based on our estimation.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#modeling1">Figure 2-12</a> shows the modeling process. Accordingly, subsequent to identifying the variables and the estimation process, the model is run. Only after running proper diagnostics are we able to perform the forecast analysis.</p>&#13;
&#13;
<figure><div class="figure" id="modeling1">&#13;
<img alt="modeling1" src="assets/mlfr_0212.png"/>&#13;
<h6><span class="label">Figure 2-12. </span>Modeling process</h6>&#13;
</div></figure>&#13;
&#13;
<p>In modeling data with a time dimension, we should consider correlation in adjacent points in time. This consideration takes us to time series modeling. My aim in modeling time series is to fit a model and comprehend statistical character of a time series, which fluctuates randomly in time.</p>&#13;
&#13;
<p><a data-primary="IID (identically and independently distributed) assumption" data-type="indexterm" id="idm45737254889312"/>Recall the discussion about the IID process, which is the most basic time series model and is sometimes referred to as <em>white noise</em>. Let’s touch on the concept of white noise.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="White Noise" data-type="sect1"><div class="sect1" id="idm45737254887984">&#13;
<h1>White Noise</h1>&#13;
&#13;
<p><a data-primary="time series modeling" data-secondary="white noise" data-type="indexterm" id="ix_time_series_white_noise"/><a data-primary="white noise" data-type="indexterm" id="ix_white_noise"/>The time series <math alttext="epsilon Subscript t">&#13;
  <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
</math> is said to be white noise if it satisfies the following:</p>&#13;
<div data-type="equation">&#13;
<math alttext="epsilon Subscript t Baseline tilde upper W upper N left-parenthesis 0 comma sigma Subscript epsilon Superscript 2 Baseline right-parenthesis" display="block">&#13;
  <mrow>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>∼</mo>&#13;
    <mi>W</mi>&#13;
    <mi>N</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mn>0</mn>&#13;
      <mo>,</mo>&#13;
      <msubsup><mi>σ</mi> <mrow><mi>ϵ</mi></mrow> <mn>2</mn> </msubsup>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math alttext="Corr left-parenthesis epsilon Subscript t Baseline comma epsilon Subscript s Baseline right-parenthesis equals 0 comma for-all t not-equals s" display="block">&#13;
  <mrow>&#13;
    <mtext>Corr</mtext>&#13;
    <mo>(</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>,</mo>&#13;
    <msub><mi>ϵ</mi> <mi>s</mi> </msub>&#13;
    <mo>)</mo>&#13;
    <mo>=</mo>&#13;
    <mn>0</mn>&#13;
    <mo>,</mo>&#13;
    <mo>∀</mo>&#13;
    <mi>t</mi>&#13;
    <mo>≠</mo>&#13;
    <mi>s</mi>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>In other words, <math alttext="epsilon Subscript t">&#13;
  <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
</math> has mean of 0 and a constant variance. Moreover, there is no correlation between successive terms of <math alttext="epsilon Subscript t">&#13;
  <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
</math>. Well, it is easy to say that the white noise process is stationary and that the plot of white noise exhibits fluctuations around mean in a random fashion in time.&#13;
However, as the white noise is formed by an uncorrelated sequence, it is not an appealing model from a forecasting standpoint.&#13;
Uncorrelated sequences prevent us from forecasting future values.</p>&#13;
&#13;
<p>As we can observe from the following code snippet and <a data-type="xref" href="#WN">Figure 2-13</a>, white noise oscillates around mean and is completely erratic:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">25</code><code class="p">]:</code> <code class="n">mu</code> <code class="o">=</code> <code class="mi">0</code>&#13;
         <code class="n">std</code> <code class="o">=</code> <code class="mi">1</code>&#13;
         <code class="n">WN</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">normal</code><code class="p">(</code><code class="n">mu</code><code class="p">,</code> <code class="n">std</code><code class="p">,</code> <code class="mi">1000</code><code class="p">)</code>&#13;
&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">WN</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'Number of Simulations'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure class="width-80"><div class="figure" id="WN">&#13;
<img alt="WN process" src="assets/mlfr_0213.png"/>&#13;
<h6><span class="label">Figure 2-13. </span>White noise process</h6>&#13;
</div></figure>&#13;
&#13;
<p>From this point on, we need to identify the optimum number of lags before running the time series model. As you can imagine, deciding the optimal number of lags is a challenging task. <a data-primary="ACF (autocorrelation function)" data-type="indexterm" id="idm45737254178944"/><a data-primary="information criteria" data-type="indexterm" id="idm45737254178272"/><a data-primary="PACF (partial autocorrelation function)" data-type="indexterm" id="idm45737254177600"/>The most widely used methods are ACF, PACF, and <em>information criteria</em>. ACF and PACF have already been discussed; see the following sidebar for more about information criteria, and specifically the Aikake information criterion (AIC).</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45737254176144">&#13;
<h5>Information Criteria</h5>&#13;
<p><a data-primary="AIC (Aikake information criteria)" data-type="indexterm" id="idm45737254174704"/>Determining the optimal number of lags is a cumbersome task. We need to have a criterion to decide which model fits best to the data as there may be numerous potentially good models. Cavanaugh and Neath (2019) describe the AIC as follows:</p>&#13;
<blockquote>&#13;
<p>AIC is introduced as an extension to the Maximum Likelihood Principle. Maximum likelihood is conventionally applied to estimate the parameters of a model once structure and dimension of the model have been formulated.</p></blockquote>&#13;
&#13;
<p>AIC can be mathematically defined as:</p>&#13;
<div data-type="equation">&#13;
<math alttext="dollar-sign upper A upper I upper C equals minus 2 l n left-parenthesis upper M a x i m u m upper L i k e l i h o o d right-parenthesis plus 2 d dollar-sign">&#13;
  <mrow>&#13;
    <mi>A</mi>&#13;
    <mi>I</mi>&#13;
    <mi>C</mi>&#13;
    <mo>=</mo>&#13;
    <mo>-</mo>&#13;
    <mn>2</mn>&#13;
    <mi>l</mi>&#13;
    <mi>n</mi>&#13;
    <mo>(</mo>&#13;
    <mi>M</mi>&#13;
    <mi>a</mi>&#13;
    <mi>x</mi>&#13;
    <mi>i</mi>&#13;
    <mi>m</mi>&#13;
    <mi>u</mi>&#13;
    <mi>m</mi>&#13;
    <mi>L</mi>&#13;
    <mi>i</mi>&#13;
    <mi>k</mi>&#13;
    <mi>e</mi>&#13;
    <mi>l</mi>&#13;
    <mi>i</mi>&#13;
    <mi>h</mi>&#13;
    <mi>o</mi>&#13;
    <mi>o</mi>&#13;
    <mi>d</mi>&#13;
    <mo>)</mo>&#13;
    <mo>+</mo>&#13;
    <mn>2</mn>&#13;
    <mi>d</mi>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>d</em> is the total number of parameters. The last term, 2<em>d</em>, aims at reducing the risk of overfitting. It is also called a <em>penalty term</em>, by which the unnecessary redundancy in the model can be filtered out.</p>&#13;
&#13;
<p>The Bayesian information criterion (BIC) is the other information criterion used to select the best model. The penalty term in BIC is larger than that of AIC:</p>&#13;
<div data-type="equation">&#13;
<math alttext="dollar-sign upper B upper I upper C equals minus 2 l n left-parenthesis upper M a x i m u m upper L i k e l i h o o d right-parenthesis plus l n left-parenthesis n right-parenthesis d dollar-sign">&#13;
  <mrow>&#13;
    <mi>B</mi>&#13;
    <mi>I</mi>&#13;
    <mi>C</mi>&#13;
    <mo>=</mo>&#13;
    <mo>-</mo>&#13;
    <mn>2</mn>&#13;
    <mi>l</mi>&#13;
    <mi>n</mi>&#13;
    <mo>(</mo>&#13;
    <mi>M</mi>&#13;
    <mi>a</mi>&#13;
    <mi>x</mi>&#13;
    <mi>i</mi>&#13;
    <mi>m</mi>&#13;
    <mi>u</mi>&#13;
    <mi>m</mi>&#13;
    <mi>L</mi>&#13;
    <mi>i</mi>&#13;
    <mi>k</mi>&#13;
    <mi>e</mi>&#13;
    <mi>l</mi>&#13;
    <mi>i</mi>&#13;
    <mi>h</mi>&#13;
    <mi>o</mi>&#13;
    <mi>o</mi>&#13;
    <mi>d</mi>&#13;
    <mo>)</mo>&#13;
    <mo>+</mo>&#13;
    <mi>l</mi>&#13;
    <mi>n</mi>&#13;
    <mo>(</mo>&#13;
    <mi>n</mi>&#13;
    <mo>)</mo>&#13;
    <mi>d</mi>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>n</em> is the number of observations.</p>&#13;
</div></aside>&#13;
&#13;
<p>Please note that you need to treat the AIC with caution if the proposed model is finite dimensional. This fact is well put by Hurvich and Tsai (1989):<a data-primary="" data-startref="ix_white_noise" data-type="indexterm" id="idm45737254135584"/><a data-primary="" data-startref="ix_time_series_white_noise" data-type="indexterm" id="idm45737254134608"/></p>&#13;
<blockquote>&#13;
<p>If the true model is infinite dimensional, a case which seems most realistic in practice, AIC provides an asymptotically efficient selection of a finite dimensional approximating model. If the true model is finite dimensional, however, the asymptotically efficient methods, e.g., Akaike’s FPE (Akaike 1970), AIC, and Parzen’s CAT (Parzen 1977), do not provide consistent model order selections.</p></blockquote>&#13;
&#13;
<p>Let’s get started visiting classical time series models with the moving average model.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Moving Average Model" data-type="sect2"><div class="sect2" id="idm45737254131904">&#13;
<h2>Moving Average Model</h2>&#13;
&#13;
<p><a data-primary="time series modeling" data-secondary="MA model" data-type="indexterm" id="ix_time_series_ma"/><a data-primary="residuals, time series modeling" data-type="indexterm" id="idm45737254128736"/><a data-primary="MA (moving average) time series model" data-type="indexterm" id="ix_ma_time_series"/>MA and residuals are closely related models. MA can be considered a smoothing model, as it tends to take into account the lag values of residual. For the sake of simplicity, let us start with MA(1):</p>&#13;
<div data-type="equation">&#13;
<math alttext="upper X Subscript t Baseline equals epsilon Subscript t Baseline plus alpha epsilon Subscript t minus 1" display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>As long as <math alttext="alpha not-equals 0">&#13;
  <mrow>&#13;
    <mi>α</mi>&#13;
    <mo>≠</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math>, it has nontrivial correlation structure. Intuitively, MA(1) tells us that the time series has been affected by <math alttext="epsilon Subscript t">&#13;
  <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
</math> and  <math alttext="epsilon Subscript t minus 1">&#13;
  <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
</math> only.</p>&#13;
&#13;
<p>In general form, MA(q) becomes:</p>&#13;
<div data-type="equation">&#13;
<math alttext="upper X Subscript t Baseline equals epsilon Subscript t Baseline plus alpha 1 epsilon Subscript t minus 1 Baseline plus alpha 2 epsilon Subscript t minus 2 Baseline ellipsis plus alpha Subscript q Baseline epsilon Subscript t minus q" display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mn>1</mn> </msub>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mn>2</mn> </msub>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>...</mo>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mi>q</mi> </msub>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mi>q</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>From this point on, to be consistent, we will model the data of two major tech companies, namely Apple and Microsoft. Yahoo Finance provides a convenient tool to access closing prices of the related stocks for the period between 01-01-2019 and 01-01-2021.</p>&#13;
&#13;
<p>As a first step, we dropped the missing values and checked if the data is stationary, and it turns out neither Apple’s nor Microsoft’s stock prices have a stationary structure as expected. Thus, taking the first difference to make these data stationary and splitting the data as <em>train</em> and <em>test</em> are the steps to take at this point. The following code (which produces <a data-type="xref" href="#acf_ma">Figure 2-14</a>) shows how we can do this in Python:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ticker</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="n">start</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2019</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2021</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">stock_prices</code><code> </code><code class="o">=</code><code> </code><code class="n">yf</code><code class="o">.</code><code class="n">download</code><code class="p">(</code><code class="n">ticker</code><code class="p">,</code><code> </code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code class="p">,</code><code> </code><code class="n">interval</code><code class="o">=</code><code class="s1">'</code><code class="s1">1d</code><code class="s1">'</code><code class="p">)</code><code>\&#13;
</code><code>                        </code><code class="o">.</code><code class="n">Close</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-1" id="co_introduction_to_time_series_modeling_CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="p">[</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="mi">100</code><code class="o">%</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="p">]</code><code>  </code><code class="mi">2</code><code> </code><code class="n">of</code><code> </code><code class="mi">2</code><code> </code><code class="n">completed</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">stock_prices</code><code> </code><code class="o">=</code><code> </code><code class="n">stock_prices</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="n">ticker</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">stat_test</code><code> </code><code class="o">=</code><code> </code><code class="n">adfuller</code><code class="p">(</code><code class="n">stock_prices</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code>&#13;
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="s2">"</code><code class="s2">The ADF test statistic and p-value of {} are {}</code><code class="s2">"</code><code>\&#13;
</code><code>                   </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">i</code><code class="p">,</code><code class="n">stat_test</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">ADF</code><code> </code><code class="n">test</code><code> </code><code class="n">statistic</code><code> </code><code class="ow">and</code><code> </code><code class="n">p</code><code class="o">-</code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">AAPL</code><code> </code><code class="n">are</code><code>  </code><code class="p">(</code><code class="mf">0.29788764759932335</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="mf">0.9772473651259085</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">ADF</code><code> </code><code class="n">test</code><code> </code><code class="n">statistic</code><code> </code><code class="ow">and</code><code> </code><code class="n">p</code><code class="o">-</code><code class="n">value</code><code> </code><code class="n">of</code><code> </code><code class="n">MSFT</code><code> </code><code class="n">are</code><code>  </code><code class="p">(</code><code class="o">-</code><code class="mf">0.8345360070598484</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="mf">0.8087663305296826</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">29</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">diff_stock_prices</code><code> </code><code class="o">=</code><code> </code><code class="n">stock_prices</code><code class="o">.</code><code class="n">diff</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">30</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">split</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">diff_stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mf">0.95</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-2" id="co_introduction_to_time_series_modeling_CO9-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">diff_train_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-3" id="co_introduction_to_time_series_modeling_CO9-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">diff_test_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-4" id="co_introduction_to_time_series_modeling_CO9-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>         </code><code class="n">diff_train_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-5" id="co_introduction_to_time_series_modeling_CO9-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>         </code><code class="n">diff_test_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-6" id="co_introduction_to_time_series_modeling_CO9-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">31</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">diff_train_aapl</code><code class="o">.</code><code class="n">to_csv</code><code class="p">(</code><code class="s1">'</code><code class="s1">diff_train_aapl.csv</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO9-7" id="co_introduction_to_time_series_modeling_CO9-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>         </code><code class="n">diff_test_aapl</code><code class="o">.</code><code class="n">to_csv</code><code class="p">(</code><code class="s1">'</code><code class="s1">diff_test_aapl.csv</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">diff_train_msft</code><code class="o">.</code><code class="n">to_csv</code><code class="p">(</code><code class="s1">'</code><code class="s1">diff_train_msft.csv</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">diff_test_msft</code><code class="o">.</code><code class="n">to_csv</code><code class="p">(</code><code class="s1">'</code><code class="s1">diff_test_msft.csv</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">32</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_acf</code><code class="p">(</code><code class="n">diff_train_aapl</code><code class="p">,</code><code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">,</code><code>&#13;
</code><code>                                  </code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">title</code><code class="o">=</code><code class="s1">'</code><code class="s1">ACF - Apple</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_acf</code><code class="p">(</code><code class="n">diff_train_msft</code><code class="p">,</code><code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">,</code><code>&#13;
</code><code>                                  </code><code class="n">ax</code><code class="o">=</code><code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">title</code><code class="o">=</code><code class="s1">'</code><code class="s1">ACF - Microsoft</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-1" id="callout_introduction_to_time_series_modeling_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Retrieving monthly closing stock prices</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-2" id="callout_introduction_to_time_series_modeling_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Splitting data as 95% and 5%</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-3" id="callout_introduction_to_time_series_modeling_CO9-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Assigning 95% of the Apple stock price data to the train set</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-4" id="callout_introduction_to_time_series_modeling_CO9-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Assigning 5% of the Apple stock price data to the test set</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-5" id="callout_introduction_to_time_series_modeling_CO9-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Assigning 95% of the Microsoft stock price data to the train set</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-6" id="callout_introduction_to_time_series_modeling_CO9-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Assigning 5% of the Microsoft stock price data to the test set</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO9-7" id="callout_introduction_to_time_series_modeling_CO9-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Saving the data for future use</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="acf_ma">&#13;
<img alt="acf all" src="assets/mlfr_0214.png"/>&#13;
<h6><span class="label">Figure 2-14. </span>ACF after first difference</h6>&#13;
</div></figure>&#13;
&#13;
<p>Looking at the top panel of <a data-type="xref" href="#acf_ma">Figure 2-14</a>, we can see that there are significant spikes at some lags and, therefore, we’ll choose lag 9 for the short MA model and 22 for the long MA for Apple. These imply that an order of 9 will be our short-term order and 22 will be our long-term order in modeling MA:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">short_moving_average_appl</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_train_aapl</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="o">=</code><code class="mi">9</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO10-1" id="co_introduction_to_time_series_modeling_CO10-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">long_moving_average_appl</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_train_aapl</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="o">=</code><code class="mi">22</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO10-2" id="co_introduction_to_time_series_modeling_CO10-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">34</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_train_aapl</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">diff_train_aapl</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">Stock Price</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">linestyle</code><code class="o">=</code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO10-3" id="co_introduction_to_time_series_modeling_CO10-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">short_moving_average_appl</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">short_moving_average_appl</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">label</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Short MA</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">linestyle</code><code class="o">=</code><code class="s1">'</code><code class="s1">solid</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO10-4" id="co_introduction_to_time_series_modeling_CO10-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>         </code><code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">long_moving_average_appl</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">long_moving_average_appl</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="n">label</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">Long MA</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">linestyle</code><code class="o">=</code><code class="s1">'</code><code class="s1">solid</code><code class="s1">'</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO10-5" id="co_introduction_to_time_series_modeling_CO10-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>         </code><code class="n">ax</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'</code><code class="s1">best</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ax</code><code class="o">.</code><code class="n">set_ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Price in $</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Stock Prediction-Apple</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO10-1" id="callout_introduction_to_time_series_modeling_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Moving average with short window for Apple stock</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO10-2" id="callout_introduction_to_time_series_modeling_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Moving average with long window for Apple stock</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO10-3" id="callout_introduction_to_time_series_modeling_CO10-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Line plot of first differenced Apple stock prices</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO10-4" id="callout_introduction_to_time_series_modeling_CO10-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Visualization of short-window MA result for Apple</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO10-5" id="callout_introduction_to_time_series_modeling_CO10-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Visualization of long-window MA result for Apple</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#ma_apple">Figure 2-15</a> exhibits the short-term MA model result with a solid line and the long-term MA model result with a dash-dot marker. As expected, it turns out that the short-term MA tends to be more responsive to daily changes in Apple’s stock price compared to the long-term MA. This makes sense because taking into account a long MA generates smoother predictions.</p>&#13;
&#13;
<figure><div class="figure" id="ma_apple">&#13;
<img alt="ma apple" src="assets/mlfr_0215.png"/>&#13;
<h6><span class="label">Figure 2-15. </span>MA model prediction result for Apple</h6>&#13;
</div></figure>&#13;
&#13;
<p>In the next step, we try to predict Microsoft’s stock price using an MA model with different window. But before proceeding, let me say that choosing the proper window for short and long MA analysis is key to good modeling. In the bottom panel of <a data-type="xref" href="#acf_ma">Figure 2-14</a>, there seem to be significant spikes at 2 and 22, so we’ll use these lags in our short and long MA analysis, respectively. After identifying the window length, we’ll fit data to the MA model with the following application:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">35</code><code class="p">]:</code> <code class="n">short_moving_average_msft</code> <code class="o">=</code> <code class="n">diff_train_msft</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code>&#13;
         <code class="n">long_moving_average_msft</code> <code class="o">=</code> <code class="n">diff_train_msft</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="o">=</code><code class="mi">22</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">36</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_train_msft</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code>&#13;
                 <code class="n">diff_train_msft</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">],</code>&#13;
                 <code class="n">label</code><code class="o">=</code><code class="s1">'Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">short_moving_average_msft</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code>&#13;
                 <code class="n">short_moving_average_msft</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">],</code>&#13;
                 <code class="n">label</code> <code class="o">=</code> <code class="s1">'Short MA'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">long_moving_average_msft</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">index</code><code class="p">,</code>&#13;
                 <code class="n">long_moving_average_msft</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">],</code>&#13;
                 <code class="n">label</code> <code class="o">=</code> <code class="s1">'Long MA'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'-.'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">set_ylabel</code><code class="p">(</code><code class="s1">'$'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">set_xlabel</code><code class="p">(</code><code class="s1">'Date'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Stock Prediction-Microsoft'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<p>Similarly, predictions based on short MA analysis tend to be more responsive than those of the long MA model, as shown in <a data-type="xref" href="#ma_msft">Figure 2-16</a>. But in Microsoft’s case, the short-term MA prediction appears to be very close to the real data. This is something we expect in time series models in that a window with a short-term horizon is able to better capture the dynamics of the data, and this, in turn, helps us obtain better predictive performance.<a data-primary="" data-startref="ix_ma_time_series" data-type="indexterm" id="idm45737253898336"/><a data-primary="" data-startref="ix_time_series_ma" data-type="indexterm" id="idm45737253897456"/></p>&#13;
&#13;
<figure><div class="figure" id="ma_msft">&#13;
<img alt="ma msft" src="assets/mlfr_0216.png"/>&#13;
<h6><span class="label">Figure 2-16. </span>MA model prediction result for Microsoft</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Autoregressive Model" data-type="sect2"><div class="sect2" id="idm45737254130960">&#13;
<h2>Autoregressive Model</h2>&#13;
&#13;
<p><a data-primary="time series modeling" data-secondary="AR model" data-type="indexterm" id="ix_time_series_ar"/><a data-primary="AR (autoregressive) model" data-type="indexterm" id="ix_ar_time_series"/>The dependence structure of successive terms is the most distinctive feature of the AR model, in the sense that current value is regressed over its own lag values in this model. So we basically forecast the current value of the time series <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> by using a linear combination of its past values. Mathematically, the general form of AR(p) can be written as:</p>&#13;
<div data-type="equation">&#13;
<math alttext="upper X Subscript t Baseline equals c plus alpha 1 upper X Subscript t minus 1 Baseline plus alpha 2 upper X Subscript t minus 2 Baseline ellipsis plus alpha Subscript p Baseline upper X Subscript t minus p Baseline plus epsilon Subscript t" display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <mi>c</mi>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mn>1</mn> </msub>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mn>2</mn> </msub>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>...</mo>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mi>p</mi> </msub>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>p</mi></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <math alttext="epsilon Subscript t">&#13;
  <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
</math> denotes the residuals and <em>c</em> is the&#13;
intercept term. The AR(p) model implies that past values up to order <em>p</em> have somewhat explanatory power on <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math>. If the relationship has shorter memory, then it is likely to model <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> with a fewer number of lags.</p>&#13;
&#13;
<p><a data-primary="stationarity and nonstationarity in time series" data-type="indexterm" id="idm45737252957952"/><a data-primary="nonstationarity and stationarity in time series" data-type="indexterm" id="idm45737252957152"/>We have discussed one of the main properties of time series, stationarity; <a data-primary="invertibility in time series" data-type="indexterm" id="idm45737252956320"/>the other important property is <em>invertibility</em>. After introducing the AR model, it is time to show the invertibility of the MA process. It is said to be invertible if it can be converted to an infinite AR model.</p>&#13;
&#13;
<p>Under some circumstances, MA can be written as an infinite AR process. These circumstances are having stationary covariance structure, deterministic part, and invertible MA process. In doing so, we have another model called <em>infinite AR</em> thanks to the assumption of <math alttext="StartAbsoluteValue alpha EndAbsoluteValue less-than 1">&#13;
  <mrow>&#13;
    <mo>|</mo>&#13;
    <mi>α</mi>&#13;
    <mo>|</mo>&#13;
    <mo>&lt;</mo>&#13;
    <mn>1</mn>&#13;
  </mrow>&#13;
</math>.</p>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
      <mo>-</mo>&#13;
      <mi>α</mi>&#13;
      <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>-</mo>&#13;
    <msup><mi>α</mi> <mn>2</mn> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>-</mo>&#13;
    <msup><mi>α</mi> <mn>2</mn> </msup>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
      <mo>+</mo>&#13;
      <mi>α</mi>&#13;
      <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>3</mn></mrow> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>α</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>-</mo>&#13;
    <msup><mi>α</mi> <mn>2</mn> </msup>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msup><mi>α</mi> <mn>3</mn> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>3</mn></mrow> </msub>&#13;
    <mrow>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <mo>...</mo>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <mi>α</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>-</mo>&#13;
    <msup><mi>α</mi> <mn>2</mn> </msup>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msup><mi>α</mi> <mn>3</mn> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>3</mn></mrow> </msub>&#13;
    <mo>-</mo>&#13;
    <msup><mi>α</mi> <mn>4</mn> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>4</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <mo>...</mo>&#13;
    <mo>-</mo>&#13;
    <msup><mrow><mo>(</mo><mo>-</mo><mi>α</mi><mo>)</mo></mrow> <mi>n</mi> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mi>n</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before less_space">After doing the necessary math, the equation gets the following form:</p>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <msup><mi>α</mi> <mi>n</mi> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mi>n</mi></mrow> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>-</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow> <mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow> </munderover>&#13;
    <msup><mi>α</mi> <mi>i</mi> </msup>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>i</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>In this case, if <math alttext="StartAbsoluteValue alpha EndAbsoluteValue less-than 1">&#13;
  <mrow>&#13;
    <mo>|</mo>&#13;
    <mi>α</mi>&#13;
    <mo>|</mo>&#13;
    <mo>&lt;</mo>&#13;
    <mn>1</mn>&#13;
  </mrow>&#13;
</math>, then <math alttext="n right-arrow normal infinity">&#13;
  <mrow>&#13;
    <mi>n</mi>&#13;
    <mo>→</mo>&#13;
    <mi>∞</mi>&#13;
  </mrow>&#13;
</math>:</p>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mi>𝔼</mi>&#13;
    <msup><mrow><mo>(</mo><msub><mi>ϵ</mi> <mi>t</mi> </msub><mo>-</mo><munderover><mo>∑</mo> <mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow> <mrow><mi>n</mi><mo>-</mo><mn>1</mn></mrow> </munderover><msup><mi>α</mi> <mi>i</mi> </msup><msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>i</mi></mrow> </msub><mo>)</mo></mrow> <mn>2</mn> </msup>&#13;
    <mo>=</mo>&#13;
    <mi>𝔼</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <msup><mi>α</mi> <mrow><mn>2</mn><mi>n</mi></mrow> </msup>&#13;
      <msubsup><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mi>n</mi></mrow> <mn>2</mn> </msubsup>&#13;
      <mo>→</mo>&#13;
      <mi>∞</mi>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Finally, the MA(1) process turns out to be:</p>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <munderover><mo>∑</mo> <mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow> <mi>∞</mi> </munderover>&#13;
    <msup><mi>α</mi> <mi>i</mi> </msup>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>i</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>Due to the duality between the AR and MA processes, it is possible to represent AR(1) as infinite MA, MA(<math alttext="normal infinity">&#13;
  <mi>∞</mi>&#13;
</math>). In other words, the AR(1) process can be expressed as a function of past values of innovations:</p>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>θ</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <mi>θ</mi>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>θ</mi>&#13;
      <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
      <mo>+</mo>&#13;
      <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mo>+</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <msup><mi>θ</mi> <mn>2</mn> </msup>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <mi>θ</mi>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <mo>=</mo>&#13;
    <msup><mi>θ</mi> <mn>2</mn> </msup>&#13;
    <mrow>&#13;
      <mo>(</mo>&#13;
      <mi>θ</mi>&#13;
      <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>3</mn></mrow> </msub>&#13;
      <mo>+</mo>&#13;
      <mi>θ</mi>&#13;
      <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
      <mo>)</mo>&#13;
    </mrow>&#13;
    <mi>θ</mi>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
<div data-type="equation">&#13;
<math display="block">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msup><mi>θ</mi> <mn>2</mn> </msup>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <mo>...</mo>&#13;
    <mo>+</mo>&#13;
    <msup><mi>θ</mi> <mi>t</mi> </msup>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>As <math alttext="n right-arrow normal infinity">&#13;
  <mrow>&#13;
    <mi>n</mi>&#13;
    <mo>→</mo>&#13;
    <mi>∞</mi>&#13;
  </mrow>&#13;
</math>, <math alttext="theta Superscript t Baseline right-arrow 0">&#13;
  <mrow>&#13;
    <msup><mi>θ</mi> <mi>t</mi> </msup>&#13;
    <mo>→</mo>&#13;
    <mn>0</mn>&#13;
  </mrow>&#13;
</math>, so I can represent AR(1) as an infinite MA process.</p>&#13;
&#13;
<p>In the following analysis, we run the AR model to predict Apple and Microsoft stock prices. Unlike MA, partial ACF is a useful tool to find out the optimum order in the AR model. This is because, in AR, we aim to find out the relationship of a time series between two different times, say <math alttext="upper X Subscript t">&#13;
  <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
</math> and <math alttext="upper X Subscript t minus k">&#13;
  <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>k</mi></mrow> </msub>&#13;
</math>, and to do that we need to filter out the effect of other lags in between, resulting in Figures&#13;
<a data-type="xref" data-xrefstyle="select:labelnumber" href="#pacf_appl">2-17</a>&#13;
and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#pacf_msft">2-18</a>:</p>&#13;
&#13;
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">37</code><code class="p">]:</code> <code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_pacf</code><code class="p">(</code><code class="n">diff_train_aapl</code><code class="p">,</code> <code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'PACF of Apple'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'Number of Lags'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">38</code><code class="p">]:</code> <code class="n">sm</code><code class="o">.</code><code class="n">graphics</code><code class="o">.</code><code class="n">tsa</code><code class="o">.</code><code class="n">plot_pacf</code><code class="p">(</code><code class="n">diff_train_msft</code><code class="p">,</code> <code class="n">lags</code><code class="o">=</code><code class="mi">30</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'PACF of Microsoft'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'Number of Lags'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="pacf_appl">&#13;
<img alt="pacf_appl" src="assets/mlfr_0217.png"/>&#13;
<h6><span class="label">Figure 2-17. </span>PACF for Apple</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="pacf_msft">&#13;
<img alt="pacf_msft" src="assets/mlfr_0218.png"/>&#13;
<h6><span class="label">Figure 2-18. </span>PACF for Microsoft</h6>&#13;
</div></figure>&#13;
&#13;
<p>In <a data-type="xref" href="#pacf_appl">Figure 2-17</a>, obtained from the first differenced Apple stock price, we observe a significant spike at lag 29, and in <a data-type="xref" href="#pacf_msft">Figure 2-18</a>, we have a similar spike at lag 26 for Microsoft. Thus, 29 and 26 are the lags that we are going to use in modeling AR for Apple and Microsoft, respectively:</p>&#13;
&#13;
<pre data-type="programlisting">In [39]: from statsmodels.tsa.ar_model import AutoReg&#13;
         import warnings&#13;
         warnings.filterwarnings('ignore')&#13;
&#13;
In [40]: ar_aapl = AutoReg(diff_train_aapl.values, lags=29)&#13;
         ar_fitted_aapl = ar_aapl.fit() <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-1" id="co_introduction_to_time_series_modeling_CO11-1"><img alt="1" src="assets/1.png"/></a>&#13;
&#13;
In [41]: ar_predictions_aapl = ar_fitted_aapl.predict(start=len(diff_train_aapl),&#13;
                                                      end=len(diff_train_aapl)\&#13;
                                                      + len(diff_test_aapl) - 1,&#13;
                                                      dynamic=False) <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-2" id="co_introduction_to_time_series_modeling_CO11-2"><img alt="2" src="assets/2.png"/></a>&#13;
&#13;
In [42]: for i in range(len(ar_predictions_aapl)):&#13;
             print('==' * 25)&#13;
             print('predicted values:{:.4f} &amp; actual values:{:.4f}'\&#13;
                   .format(ar_predictions_aapl[i], diff_test_aapl[i])) <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-3" id="co_introduction_to_time_series_modeling_CO11-3"><img alt="3" src="assets/3.png"/></a>&#13;
         ==================================================&#13;
         predicted values:1.6511 &amp; actual values:1.3200&#13;
         ==================================================&#13;
         predicted values:-0.8398 &amp; actual values:0.8600&#13;
         ==================================================&#13;
         predicted values:-0.9998 &amp; actual values:0.5600&#13;
         ==================================================&#13;
         predicted values:1.1379 &amp; actual values:2.4600&#13;
         ==================================================&#13;
         predicted values:-0.1123 &amp; actual values:3.6700&#13;
         ==================================================&#13;
         predicted values:1.7843 &amp; actual values:0.3600&#13;
         ==================================================&#13;
         predicted values:-0.9178 &amp; actual values:-0.1400&#13;
         ==================================================&#13;
         predicted values:1.7343 &amp; actual values:-0.6900&#13;
         ==================================================&#13;
         predicted values:-1.5103 &amp; actual values:1.5000&#13;
         ==================================================&#13;
         predicted values:1.8224 &amp; actual values:0.6300&#13;
         ==================================================&#13;
         predicted values:-1.2442 &amp; actual values:-2.6000&#13;
         ==================================================&#13;
         predicted values:-0.5438 &amp; actual values:1.4600&#13;
         ==================================================&#13;
         predicted values:-0.1075 &amp; actual values:-0.8300&#13;
         ==================================================&#13;
         predicted values:-0.6167 &amp; actual values:-0.6300&#13;
         ==================================================&#13;
         predicted values:1.3206 &amp; actual values:6.1000&#13;
         ==================================================&#13;
         predicted values:0.2464 &amp; actual values:-0.0700&#13;
         ==================================================&#13;
         predicted values:0.4489 &amp; actual values:0.8900&#13;
         ==================================================&#13;
         predicted values:-1.3101 &amp; actual values:-2.0400&#13;
         ==================================================&#13;
         predicted values:0.5863 &amp; actual values:1.5700&#13;
         ==================================================&#13;
         predicted values:0.2480 &amp; actual values:3.6500&#13;
         ==================================================&#13;
         predicted values:0.0181 &amp; actual values:-0.9200&#13;
         ==================================================&#13;
         predicted values:0.9913 &amp; actual values:1.0100&#13;
         ==================================================&#13;
         predicted values:0.2672 &amp; actual values:4.7200&#13;
         ==================================================&#13;
         predicted values:0.8258 &amp; actual values:-1.8200&#13;
         ==================================================&#13;
         predicted values:0.1502 &amp; actual values:-1.1500&#13;
         ==================================================&#13;
         predicted values:0.5560 &amp; actual values:-1.0300&#13;
&#13;
In [43]: ar_predictions_aapl = pd.DataFrame(ar_predictions_aapl) <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-4" id="co_introduction_to_time_series_modeling_CO11-4"><img alt="4" src="assets/4.png"/></a>&#13;
         ar_predictions_aapl.index = diff_test_aapl.index <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-5" id="co_introduction_to_time_series_modeling_CO11-5"><img alt="5" src="assets/5.png"/></a>&#13;
&#13;
In [44]: ar_msft = AutoReg(diff_train_msft.values, lags=26)&#13;
         ar_fitted_msft = ar_msft.fit() <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-6" id="co_introduction_to_time_series_modeling_CO11-6"><img alt="6" src="assets/6.png"/></a>&#13;
&#13;
In [45]: ar_predictions_msft = ar_fitted_msft.predict(start=len(diff_train_msft),&#13;
                                                      end=len(diff_train_msft)\&#13;
                                                      +len(diff_test_msft) - 1,&#13;
                                                      dynamic=False) <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-7" id="co_introduction_to_time_series_modeling_CO11-7"><img alt="7" src="assets/7.png"/></a>&#13;
&#13;
In [46]: ar_predictions_msft = pd.DataFrame(ar_predictions_msft) <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-8" id="co_introduction_to_time_series_modeling_CO11-8"><img alt="8" src="assets/8.png"/></a>&#13;
         ar_predictions_msft.index = diff_test_msft.index <a class="co" href="#callout_introduction_to_time_series_modeling_CO11-9" id="co_introduction_to_time_series_modeling_CO11-9"><img alt="9" src="assets/9.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-1" id="callout_introduction_to_time_series_modeling_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Fitting Apple stock data with AR model</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-2" id="callout_introduction_to_time_series_modeling_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Predicting the stock prices for Apple</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-3" id="callout_introduction_to_time_series_modeling_CO11-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Comparing the predicted and real observations</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-4" id="callout_introduction_to_time_series_modeling_CO11-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Turning array into dataframe to assign index</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-5" id="callout_introduction_to_time_series_modeling_CO11-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Assigning test data indices to predicted values</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-6" id="callout_introduction_to_time_series_modeling_CO11-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Fitting Microsoft stock data with AR model</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-7" id="callout_introduction_to_time_series_modeling_CO11-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Predicting the stock prices for Microsoft</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-8" id="callout_introduction_to_time_series_modeling_CO11-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Turning the array into a dataframe to assign index</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO11-9" id="callout_introduction_to_time_series_modeling_CO11-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Assigning test data indices to predicted values</p></dd>&#13;
</dl>&#13;
&#13;
<p>The following code, resulting in <a data-type="xref" href="#ar_all">Figure 2-19</a>, shows the predictions based on the AR model. The solid lines represent the Apple and Microsoft stock price predictions, and the dashed lines denote the real data. The result reveals that the MA model outperforms the AR model in capturing the stock price:<a data-primary="" data-startref="ix_ar_time_series" data-type="indexterm" id="idm45737252592224"/><a data-primary="" data-startref="ix_time_series_ar" data-type="indexterm" id="idm45737252591280"/></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">47</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code class="mi">1</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">18</code><code class="p">,</code> <code class="mi">15</code><code class="p">))</code>&#13;
&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_test_aapl</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Actual Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ar_predictions_aapl</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s2">"Prediction"</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Predicted Stock Price-Apple'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_test_msft</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Actual Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">ar_predictions_msft</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s2">"Prediction"</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Predicted Stock Price-Microsoft'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="k">for</code> <code class="n">ax</code> <code class="ow">in</code> <code class="n">ax</code><code class="o">.</code><code class="n">flat</code><code class="p">:</code>&#13;
             <code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">xlabel</code><code class="o">=</code><code class="s1">'Date'</code><code class="p">,</code> <code class="n">ylabel</code><code class="o">=</code><code class="s1">'$'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="ar_all">&#13;
<img alt="ar all" src="assets/mlfr_0219.png"/>&#13;
<h6><span class="label">Figure 2-19. </span>AR model prediction results</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Autoregressive Integrated Moving Average Model" data-type="sect2"><div class="sect2" id="idm45737252988512">&#13;
<h2>Autoregressive Integrated Moving Average Model</h2>&#13;
&#13;
<p><a data-primary="time series modeling" data-secondary="ARIMA model" data-type="indexterm" id="ix_time_series_arima"/><a data-primary="ARIMA (autoregressive integrated moving average) model" data-type="indexterm" id="ix_arima_time_series"/>The ARIMA is a function of past values of a time series and <a data-primary="white noise" data-type="indexterm" id="idm45737252377632"/>white noise. ARIMA has been proposed as a generalization of AR and MA, but they do not have an integration parameter, which helps us to feed the model with the raw data. In this respect, even if we include nonstationary data, ARIMA makes it stationary by properly defining the integration parameter.</p>&#13;
&#13;
<p>ARIMA has three parameters, namely <em>p</em>, <em>d</em>, and <em>q</em>. As should be familiar from previous time series models, <em>p</em> and <em>q</em> refer to the order of AR and MA, respectively. The <em>d</em> parameter controls for level difference. If <em>d</em> = 1, it amounts to first difference, and if it&#13;
has a value of 0, that means that the model is ARIMA.</p>&#13;
&#13;
<p>It is possible to have a <em>d</em> greater than 1, but it’s not as common as having a <em>d</em> of 1. The ARIMA (p, 1, q) equation has the following structure:</p>&#13;
<div class="pagebreak-before less_space" data-type="equation">&#13;
<math alttext="dollar-sign upper X Subscript t Baseline equals alpha 1 d upper X Subscript t minus 1 Baseline plus alpha 2 d upper X Subscript t minus 2 Baseline ellipsis plus alpha Subscript p Baseline d upper X Subscript t minus p Baseline plus epsilon Subscript t Baseline plus beta 1 epsilon Subscript t minus 1 Baseline plus beta 2 epsilon Subscript t minus 2 Baseline ellipsis plus beta Subscript q Baseline epsilon Subscript t minus q dollar-sign">&#13;
  <mrow>&#13;
    <msub><mi>X</mi> <mi>t</mi> </msub>&#13;
    <mo>=</mo>&#13;
    <msub><mi>α</mi> <mn>1</mn> </msub>&#13;
    <mi>d</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mn>2</mn> </msub>&#13;
    <mi>d</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>...</mo>&#13;
    <mo>+</mo>&#13;
    <msub><mi>α</mi> <mi>p</mi> </msub>&#13;
    <mi>d</mi>&#13;
    <msub><mi>X</mi> <mrow><mi>t</mi><mo>-</mo><mi>p</mi></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>ϵ</mi> <mi>t</mi> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>β</mi> <mn>1</mn> </msub>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>1</mn></mrow> </msub>&#13;
    <mo>+</mo>&#13;
    <msub><mi>β</mi> <mn>2</mn> </msub>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mn>2</mn></mrow> </msub>&#13;
    <mo>...</mo>&#13;
    <mo>+</mo>&#13;
    <msub><mi>β</mi> <mi>q</mi> </msub>&#13;
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>-</mo><mi>q</mi></mrow> </msub>&#13;
  </mrow>&#13;
</math>&#13;
</div>&#13;
&#13;
<p>where <em>d</em> refers to difference.</p>&#13;
&#13;
<p>As it is a widely embraced and applicable model, let’s discuss the pros and cons of the ARIMA model to get more familiar with it.</p>&#13;
<dl>&#13;
<dt>Pros</dt>&#13;
<dd>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>ARIMA allows us to work with raw data without considering if it is stationary.</p>&#13;
</li>&#13;
<li>&#13;
<p>It performs well with high-frequency data.</p>&#13;
</li>&#13;
<li>&#13;
<p>It is less sensitive to the fluctuation in the data compared to other models.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
<dt>Cons</dt>&#13;
<dd>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>ARIMA might fail in capturing seasonality.</p>&#13;
</li>&#13;
<li>&#13;
<p>It works better with long series and short-term (daily, hourly) data.</p>&#13;
</li>&#13;
<li>&#13;
<p>As no automatic updating occurs in ARIMA, no structural break during the analysis period should be observed.</p>&#13;
</li>&#13;
<li>&#13;
<p>Having no adjustment in the ARIMA process leads to instability.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Now, let’s see how ARIMA works using the same stocks, namely Apple and Microsoft. But this time, a different short-term lag structure is used to compare the result with the AR and MA models:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">statsmodels.tsa.arima_model</code><code> </code><code class="kn">import</code><code> </code><code class="n">ARIMA</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">split</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mf">0.95</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">train_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="n">test_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="n">train_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="n">test_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">50</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">ARIMA</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">,</code><code class="n">order</code><code class="o">=</code><code class="p">(</code><code class="mi">9</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">9</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-1" id="co_introduction_to_time_series_modeling_CO12-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_fit_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_aapl</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-2" id="co_introduction_to_time_series_modeling_CO12-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">51</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">ARIMA</code><code class="p">(</code><code class="n">train_msft</code><code class="p">,</code><code> </code><code class="n">order</code><code class="o">=</code><code class="p">(</code><code class="mi">6</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-3" id="co_introduction_to_time_series_modeling_CO12-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_fit_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_msft</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-4" id="co_introduction_to_time_series_modeling_CO12-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">52</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_predict_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_fit_aapl</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">end</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">)</code><code>\&#13;
</code><code>                                                           </code><code class="o">+</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">test_aapl</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">dynamic</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-5" id="co_introduction_to_time_series_modeling_CO12-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_predict_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_fit_msft</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_msft</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">end</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_msft</code><code class="p">)</code><code>\&#13;
</code><code>                                                           </code><code class="o">+</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">test_msft</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">dynamic</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-6" id="co_introduction_to_time_series_modeling_CO12-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">53</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_predict_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_predict_aapl</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">arima_predict_aapl</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_test_aapl</code><code class="o">.</code><code class="n">index</code><code>&#13;
</code><code>         </code><code class="n">arima_predict_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_predict_msft</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">arima_predict_msft</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_test_msft</code><code class="o">.</code><code class="n">index</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO12-7" id="co_introduction_to_time_series_modeling_CO12-7"><img alt="7" src="assets/7.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-1" id="callout_introduction_to_time_series_modeling_CO12-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Configuring the ARIMA model for Apple stock</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-2" id="callout_introduction_to_time_series_modeling_CO12-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Fitting the ARIMA model to Apple’s stock price</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-3" id="callout_introduction_to_time_series_modeling_CO12-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Configuring the ARIMA model for Microsoft stock</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-4" id="callout_introduction_to_time_series_modeling_CO12-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Fitting the ARIMA model to Microsoft’s stock price</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-5" id="callout_introduction_to_time_series_modeling_CO12-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Predicting the Apple stock prices based on ARIMA</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-6" id="callout_introduction_to_time_series_modeling_CO12-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Predicting the Microsoft stock prices based on ARIMA</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO12-7" id="callout_introduction_to_time_series_modeling_CO12-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Forming index for predictions</p></dd>&#13;
</dl>&#13;
&#13;
<p>The next snippet, resulting in <a data-type="xref" href="#arima_all">Figure 2-20</a>, shows the result of the prediction based on Apple’s and Microsoft’s stock price, and as we employ the short-term orders from the AR and MA model, the result is not completely different:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">18</code><code class="p">,</code> <code class="mi">15</code><code class="p">))</code>&#13;
&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_test_aapl</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Actual Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">arima_predict_aapl</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s2">"Prediction"</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Predicted Stock Price-Apple'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_test_msft</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Actual Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">arima_predict_msft</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s2">"Prediction"</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Predicted Stock Price-Microsoft'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="k">for</code> <code class="n">ax</code> <code class="ow">in</code> <code class="n">ax</code><code class="o">.</code><code class="n">flat</code><code class="p">:</code>&#13;
             <code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">xlabel</code><code class="o">=</code><code class="s1">'Date'</code><code class="p">,</code> <code class="n">ylabel</code><code class="o">=</code><code class="s1">'$'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="arima_all">&#13;
<img alt="arima all" src="assets/mlfr_0220.png"/>&#13;
<h6><span class="label">Figure 2-20. </span>ARIMA prediction results</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="AIC (Aikake information criteria)" data-type="indexterm" id="idm45737248355936"/>At this point, it is worthwhile to discuss an alternative method for optimum lag selection for time series models. AIC is the method that I apply here to select the proper number of lags. Please note that, even though the result of AIC suggests (4, 0, 4), the model does not converge with these orders. So, (4, 1, 4) is applied instead:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">55</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">itertools</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">56</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">q</code><code> </code><code class="o">=</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">9</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-1" id="co_introduction_to_time_series_modeling_CO13-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">d</code><code> </code><code class="o">=</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-2" id="co_introduction_to_time_series_modeling_CO13-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">pdq</code><code> </code><code class="o">=</code><code> </code><code class="nb">list</code><code class="p">(</code><code class="n">itertools</code><code class="o">.</code><code class="n">product</code><code class="p">(</code><code class="n">p</code><code class="p">,</code><code> </code><code class="n">d</code><code class="p">,</code><code> </code><code class="n">q</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-3" id="co_introduction_to_time_series_modeling_CO13-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_results_aapl</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-4" id="co_introduction_to_time_series_modeling_CO13-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">param_set</code><code> </code><code class="ow">in</code><code> </code><code class="n">pdq</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="k">try</code><code class="p">:</code><code>&#13;
</code><code>                 </code><code class="n">arima_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">ARIMA</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">,</code><code> </code><code class="n">order</code><code class="o">=</code><code class="n">param_set</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-5" id="co_introduction_to_time_series_modeling_CO13-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>                 </code><code class="n">arima_fitted_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_aapl</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-6" id="co_introduction_to_time_series_modeling_CO13-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>                 </code><code class="n">arima_results_aapl</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">arima_fitted_aapl</code><code class="o">.</code><code class="n">aic</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-7" id="co_introduction_to_time_series_modeling_CO13-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>             </code><code class="k">except</code><code class="p">:</code><code>&#13;
</code><code>                 </code><code class="k">continue</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">**</code><code class="s1">'</code><code class="o">*</code><code class="mi">25</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">The Lowest AIC score is</code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code>\&#13;
</code><code>               </code><code class="s1">'</code><code class="s1">{:.4f} and the corresponding parameters are {}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code> </code><code>\&#13;
</code><code>                   </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_results_aapl</code><code class="p">)</code><code class="o">.</code><code class="n">where</code><code class="p">(</code><code> </code><code>\&#13;
</code><code>                   </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_results_aapl</code><code class="p">)</code><code class="o">.</code><code class="n">T</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">all</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                   </code><code class="n">pdq</code><code class="p">[</code><code class="n">arima_results_aapl</code><code class="o">.</code><code class="n">index</code><code class="p">(</code><code class="nb">min</code><code class="p">(</code><code class="n">arima_results_aapl</code><code class="p">)</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-8" id="co_introduction_to_time_series_modeling_CO13-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>         </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">Lowest</code><code> </code><code class="n">AIC</code><code> </code><code class="n">score</code><code> </code><code class="ow">is</code><code> </code><code class="mf">1951.9810</code><code> </code><code class="ow">and</code><code> </code><code class="n">the</code><code> </code><code class="n">corresponding</code><code> </code><code class="n">parameters</code><code> </code><code class="n">are</code><code>&#13;
</code><code>         </code><code class="p">(</code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">57</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">ARIMA</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">,</code><code> </code><code class="n">order</code><code class="o">=</code><code class="p">(</code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-9" id="co_introduction_to_time_series_modeling_CO13-9"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_fit_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_aapl</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-9" id="co_introduction_to_time_series_modeling_CO13-10"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">58</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">q</code><code> </code><code class="o">=</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">d</code><code> </code><code class="o">=</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">pdq</code><code> </code><code class="o">=</code><code> </code><code class="nb">list</code><code class="p">(</code><code class="n">itertools</code><code class="o">.</code><code class="n">product</code><code class="p">(</code><code class="n">p</code><code class="p">,</code><code> </code><code class="n">d</code><code class="p">,</code><code> </code><code class="n">q</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">arima_results_msft</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">param_set</code><code> </code><code class="ow">in</code><code> </code><code class="n">pdq</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="k">try</code><code class="p">:</code><code>&#13;
</code><code>                 </code><code class="n">arima_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">ARIMA</code><code class="p">(</code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">order</code><code class="o">=</code><code class="n">param_set</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="n">arima_fitted_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_msft</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="n">arima_results_msft</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">arima_fitted_msft</code><code class="o">.</code><code class="n">aic</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="k">except</code><code class="p">:</code><code>&#13;
</code><code>                 </code><code class="k">continue</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">**</code><code class="s1">'</code><code> </code><code class="o">*</code><code> </code><code class="mi">25</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">The lowest AIC score is {:.4f} and parameters are {}</code><code class="s1">'</code><code>&#13;
</code><code>               </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_results_msft</code><code class="p">)</code><code>&#13;
</code><code>                       </code><code class="o">.</code><code class="n">where</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_results_msft</code><code class="p">)</code><code class="o">.</code><code class="n">T</code><code class="o">.</code><code class="n">notnull</code><code class="p">(</code><code class="p">)</code><code>\&#13;
</code><code>                              </code><code class="o">.</code><code class="n">all</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                       </code><code class="n">pdq</code><code class="p">[</code><code class="n">arima_results_msft</code><code class="o">.</code><code class="n">index</code><code class="p">(</code><code class="nb">min</code><code class="p">(</code><code class="n">arima_results_msft</code><code class="p">)</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-10" id="co_introduction_to_time_series_modeling_CO13-11"><img alt="10" src="assets/10.png"/></a><code>&#13;
</code><code>         </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>&#13;
</code><code>         </code><code class="n">The</code><code> </code><code class="n">Lowest</code><code> </code><code class="n">AIC</code><code> </code><code class="n">score</code><code> </code><code class="ow">is</code><code> </code><code class="mf">2640.6367</code><code> </code><code class="ow">and</code><code> </code><code class="n">the</code><code> </code><code class="n">corresponding</code><code> </code><code class="n">parameters</code><code> </code><code class="n">are</code><code>&#13;
</code><code>         </code><code class="p">(</code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">59</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">ARIMA</code><code class="p">(</code><code class="n">stock_prices</code><code class="p">[</code><code class="s1">'</code><code class="s1">MSFT</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">order</code><code class="o">=</code><code class="p">(</code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">2</code><code> </code><code class="p">,</code><code class="mi">4</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-11" id="co_introduction_to_time_series_modeling_CO13-12"><img alt="11" src="assets/11.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_fit_msft</code><code class="o">=</code><code> </code><code class="n">arima_msft</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-11" id="co_introduction_to_time_series_modeling_CO13-13"><img alt="11" src="assets/11.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">60</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_predict_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_fit_aapl</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">end</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_aapl</code><code class="p">)</code><code>\&#13;
</code><code>                                                           </code><code class="o">+</code><code class="nb">len</code><code class="p">(</code><code class="n">test_aapl</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">dynamic</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-12" id="co_introduction_to_time_series_modeling_CO13-14"><img alt="12" src="assets/12.png"/></a><code>&#13;
</code><code>         </code><code class="n">arima_predict_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">arima_fit_msft</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">start</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_msft</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">end</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">train_msft</code><code class="p">)</code><code>\&#13;
</code><code>                                                           </code><code class="o">+</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">test_msft</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code>&#13;
</code><code>                                                           </code><code class="n">dynamic</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code> </code><a class="co" href="#callout_introduction_to_time_series_modeling_CO13-12" id="co_introduction_to_time_series_modeling_CO13-15"><img alt="12" src="assets/12.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">61</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">arima_predict_aapl</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_predict_aapl</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">arima_predict_aapl</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_test_aapl</code><code class="o">.</code><code class="n">index</code><code>&#13;
</code><code>         </code><code class="n">arima_predict_msft</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">arima_predict_msft</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">arima_predict_msft</code><code class="o">.</code><code class="n">index</code><code> </code><code class="o">=</code><code> </code><code class="n">diff_test_msft</code><code class="o">.</code><code class="n">index</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-1" id="callout_introduction_to_time_series_modeling_CO13-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Defining a range for AR and MA orders</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-2" id="callout_introduction_to_time_series_modeling_CO13-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Defining a range difference term</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-3" id="callout_introduction_to_time_series_modeling_CO13-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Applying iteration over <em>p</em>, <em>d</em>, and <em>q</em></p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-4" id="callout_introduction_to_time_series_modeling_CO13-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Creating an empty list to store AIC values</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-5" id="callout_introduction_to_time_series_modeling_CO13-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Configuring the ARIMA model to fit Apple data</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-6" id="callout_introduction_to_time_series_modeling_CO13-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Running the ARIMA model with all possible lags</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-7" id="callout_introduction_to_time_series_modeling_CO13-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Storing AIC values into a list</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-8" id="callout_introduction_to_time_series_modeling_CO13-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>Printing the lowest AIC value for Apple data</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-9" id="callout_introduction_to_time_series_modeling_CO13-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Configuring and fitting the ARIMA model with optimum orders</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-11" id="callout_introduction_to_time_series_modeling_CO13-10"><img alt="10" src="assets/10.png"/></a></dt>&#13;
<dd><p>Running the ARIMA model with all possible lags for Microsoft data</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-12" id="callout_introduction_to_time_series_modeling_CO13-11"><img alt="11" src="assets/11.png"/></a></dt>&#13;
<dd><p>Fitting the ARIMA model to Microsoft data with optimum orders</p></dd>&#13;
<dt><a class="co" href="#co_introduction_to_time_series_modeling_CO13-14" id="callout_introduction_to_time_series_modeling_CO13-12"><img alt="12" src="assets/12.png"/></a></dt>&#13;
<dd><p>Predicting Apple and Microsoft stock prices</p></dd>&#13;
</dl>&#13;
&#13;
<p>Orders identified for Apple and Microsoft are (4, 1, 4) and (4, 2, 4), respectively. ARIMA does a good job in predicting the stock prices as shown below. However, please note that improper identification of the orders results in a poor fit, and this, in turn, produces predictions that are far from being satisfactory. The following code, resulting in <a data-type="xref" href="#arima_all_2">Figure 2-21</a>, shows these results:<a data-primary="" data-startref="ix_arima_time_series" data-type="indexterm" id="idm45737247739328"/><a data-primary="" data-startref="ix_time_series_arima" data-type="indexterm" id="idm45737247738352"/></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">62</code><code class="p">]:</code> <code class="n">fig</code><code class="p">,</code> <code class="n">ax</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">18</code><code class="p">,</code> <code class="mi">15</code><code class="p">))</code>&#13;
&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_test_aapl</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Actual Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">arima_predict_aapl</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s2">"Prediction"</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Predicted Stock Price-Apple'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">diff_test_msft</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'Actual Stock Price'</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'--'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">arima_predict_msft</code><code class="p">,</code> <code class="n">linestyle</code><code class="o">=</code><code class="s1">'solid'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s2">"Prediction"</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s1">'Predicted Stock Price-Microsoft'</code><code class="p">)</code>&#13;
         <code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="s1">'best'</code><code class="p">)</code>&#13;
         <code class="k">for</code> <code class="n">ax</code> <code class="ow">in</code> <code class="n">ax</code><code class="o">.</code><code class="n">flat</code><code class="p">:</code>&#13;
             <code class="n">ax</code><code class="o">.</code><code class="n">set</code><code class="p">(</code><code class="n">xlabel</code><code class="o">=</code><code class="s1">'Date'</code><code class="p">,</code> <code class="n">ylabel</code><code class="o">=</code><code class="s1">'$'</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="arima_all_2">&#13;
<img alt="arima all" src="assets/mlfr_0221.png"/>&#13;
<h6><span class="label">Figure 2-21. </span>ARIMA prediction results</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45737254887360">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>Time series analysis has a central role in financial analysis. This is simply because most financial data has a time dimension, and this type of data should be modeled cautiously. This chapter worked out a first attempt at modeling data with a time dimension, and to do so, we employed classical time series models, namely MA, AR, and finally, ARIMA. But do you think that’s the whole story? Absolutely not! In &#13;
<span class="keep-together">the next</span> chapter, we will see how a time series can be modeled using deep learning &#13;
<span class="keep-together">models</span>.<a data-primary="" data-startref="ix_time_series_ch2" data-type="indexterm" id="idm45737247096960"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="References" data-type="sect1"><div class="sect1" id="idm45737247095696">&#13;
<h1>References</h1>&#13;
&#13;
<p>Articles cited in this chapter:</p>&#13;
&#13;
<ul class="author-date-bib">&#13;
<li>&#13;
<p>Cavanaugh, J. E., and A. A. Neath. 2019. “The Akaike Information Criterion: Background, Derivation, Properties, Application, Interpretation, and Refinements.” <em>Wiley Interdisciplinary Reviews: Computational Statistics</em> 11 (3): e1460.</p>&#13;
</li>&#13;
<li>&#13;
<p>Hurvich, Clifford M., and Chih-Ling Tsai. 1989. “Regression and Time Series Model Selection in Small Samples.” <em>Biometrika</em> 76 (2): 297-30.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Books cited in this chapter:</p>&#13;
&#13;
<ul class="author-date-bib">&#13;
<li>&#13;
<p>Brockwell, Peter J., and Richard A. Davis. 2016. <em>Introduction to Time Series and Forecasting</em>. Springer.</p>&#13;
</li>&#13;
<li>&#13;
<p>Focardi, Sergio M. 1997. <em>Modeling the Market: New Theories and Techniques</em>. The Frank J. Fabozzi Series, Vol. 14. New York: John Wiley and Sons.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>