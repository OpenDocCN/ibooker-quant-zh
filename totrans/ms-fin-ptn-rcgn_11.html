<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 11. Candlestick-Based Contrarian Strategies" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter11">
<h1><span class="label">Chapter 11. </span>Candlestick-Based Contrarian Strategies</h1>
<p>This chapter<a contenteditable="false" data-primary="contrarian strategies" data-type="indexterm" id="ix_contra_strat_ch11"/> covers the contrarian part of candlestick pattern strategies. Remember that candlestick patterns on their own are unlikely to provide stable returns, as they must join forces with more sophisticated techniques and indicators in order to transform simple ideas and observations into actionable trade setups.</p>
<p>You should recognize some of the indicators used in this chapter as they have already shown that they can be useful in trend following. Notably, the RSI can provide not only the current market state (helpful in determining the trend) but also extreme levels that could point to a reversal (helpful in determining contrarian trades). In other words, depending on how you use it, the RSI can be a trend-following or a contrarian indicator.</p>
<p>Make<a contenteditable="false" data-primary="intuition of a pattern" data-type="indexterm" id="idm46762849780160"/> sure to focus on the intuition of combining patterns with indicators so that you can create your own combination of strategies. After all, the point of <a data-type="xref" href="ch10.xhtml#chapter10">Chapter 10</a> and <a data-type="xref" href="#chapter11">Chapter 11</a> is to help you design your own strategy.</p>
<section data-pdf-bookmark="Combining the Doji Pattern with the RSI" data-type="sect1"><div class="sect1" id="idm46762849839088">
<h1>Combining the Doji Pattern with the RSI</h1>
<p>This strategy<a contenteditable="false" data-primary="Doji pattern" data-secondary="RSI indicator combination" data-type="indexterm" id="ix_doji_rsi"/><a contenteditable="false" data-primary="relative strength index (RSI) indicator" data-secondary="with Doji pattern" data-secondary-sortas="Doji pattern" data-type="indexterm" id="ix_rsi_doji_combo"/><a contenteditable="false" data-primary="contrarian patterns" data-secondary="Doji pattern" data-type="indexterm" id="ix_contra_doji_ch11"/><a contenteditable="false" data-primary="contrarian strategies" data-secondary="Doji pattern and RSI indicators" data-type="indexterm" id="ix_contra_strat_doji"/><a contenteditable="false" data-primary="classic contrarian patterns" data-secondary="Doji pattern" data-type="indexterm" id="ix_class_contra_doji_ch11"/> may be the most familiar one that combines a candlestick pattern and a technical indicator. With the Doji being the simplest contrarian configuration and the RSI being the most commonly used and researched indicator, both can give a good confirmation for the expected contrarian move.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The RSI filter makes it possible to transform the Doji into a one-candlestick pattern instead of three. This is because the first and third candlesticks in the Doji pattern are used only to differentiate bullish from bearish Doji patterns. Therefore, the Doji is just the plus sign–looking candlestick.</p>
</div>
<p>The strategy<a contenteditable="false" data-primary="aggressive technique on RSI" data-type="indexterm" id="idm46762849169712"/> uses an aggressive technique on the RSI that awaits for its reading to be below the oversold level or above the overbought level. Oversold and overbought levels are variable and depend on the underlying market and on the lookback of the RSI.</p>
<p>Generally, with a 14-period RSI (the default version), traders tend to use 30 as the oversold level and 70 as the overbought level. This strategy uses a 3-period RSI with 20 as the oversold level and 80 as the overbought level. This aims to increase the frequency of the signals as it makes it more likely to have a simultaneous Doji pattern with a signal on the RSI.</p>
<p>The trading conditions are as follows:</p>
<ul>
<li>A long signal is generated whenever a bullish Doji pattern appears while the <span class="keep-together">3-period</span> RSI is below 20.</li>
<li>A short signal is generated whenever a bearish Doji pattern appears while the <span class="keep-together">3-period</span> RSI is above 80.</li>
</ul>
<p>The following code snippet shows how to code the signal function of the strategy:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="n">lower_barrier</code><code> </code><code class="o">=</code><code> </code><code class="mi">20</code><code>
</code><code class="n">upper_barrier</code><code> </code><code class="o">=</code><code> </code><code class="mi">80</code><code>
</code><code>
</code><code class="k">def</code><code> </code><code class="nf">signal</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">,</code><code> </code><code>
</code><code>           </code><code class="n">buy_column</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code>    </code><code>
</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">rounding</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code>  </code><code>
</code><code>    </code><code>
</code><code>    </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">data</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>  </code><code>
</code><code>        </code><code>
</code><code>       </code><code class="k">try</code><code class="p">:</code><code>
</code><code>           </code><code>
</code><code>       </code><strong><code>    </code><code class="c1"># Bullish setup</code></strong><code>
</code><code>           </code><code class="k">if</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">==</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">lower_barrier</code><code class="p">:</code><code>
</code><code>                  </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>        </code><strong><code>   </code><code class="c1"># Bearish setup</code></strong><code>
</code><code>           </code><code class="k">elif</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">==</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">upper_barrier</code><code class="p">:</code><code>
</code><code>                  </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>       </code><code class="k">except</code><code> </code><code class="ne">IndexError</code><code class="p">:</code><code>
</code><code>            </code><code>
</code><code>            </code><code class="k">pass</code><code>
</code><code>        </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code><code>
</code></pre>
<p><a data-type="xref" href="#figure11-1">Figure 11-1</a> shows a signal chart on AUDNZD showing the strategy in action. As you may have gathered from previous chapters, contrarian techniques work better in a flat (sideways) market, as there is an implied equilibrium between supply and demand and an excess in either is bound to return to normality. This excess is measured through contrarian tools.</p>
<figure><div class="figure" id="figure11-1"><img alt="" height="298" src="assets/mfpr_1101.png" width="600"/>
<h6><span class="label">Figure 11-1. </span>Signal chart of the strategy using the Doji pattern and the RSI</h6>
</div></figure>
<p>To sum up, the Doji pattern is versatile and is easily integrated with technical indicators due to its simplicity. The strategy is easy to grasp, and many other variations exist that tweak it to improve its frequency and profitability<a contenteditable="false" data-primary="" data-startref="ix_rsi_doji_combo" data-type="indexterm" id="idm46762849360896"/><a contenteditable="false" data-primary="" data-startref="ix_contra_strat_doji" data-type="indexterm" id="idm46762849359520"/><a contenteditable="false" data-primary="" data-startref="ix_doji_rsi" data-type="indexterm" id="idm46762849358144"/><a contenteditable="false" data-primary="" data-startref="ix_class_contra_doji_ch11" data-type="indexterm" id="idm46762849356768"/><a contenteditable="false" data-primary="" data-startref="ix_contra_doji_ch11" data-type="indexterm" id="idm46762849107632"/>.</p>
</div></section>
<section data-pdf-bookmark="Combining the Engulfing Pattern with Bollinger Bands" data-type="sect1"><div class="sect1" id="idm46762849838528">
<h1>Combining the Engulfing Pattern with Bollinger Bands</h1>
<p><a data-type="xref" href="ch10.xhtml#chapter10">Chapter 10</a> mentioned that Bollinger bands<a contenteditable="false" data-primary="contrarian strategies" data-secondary="Engulfing pattern and Bollinger bands" data-type="indexterm" id="ix_contra_strat_engulf"/><a contenteditable="false" data-primary="Engulfing pattern" data-type="indexterm" id="ix_engulf_patt_ch11"/><a contenteditable="false" data-primary="classic contrarian patterns" data-secondary="Engulfing pattern" data-type="indexterm" id="ix_class_contra_engulf_ch11"/><a contenteditable="false" data-primary="contrarian patterns" data-secondary="Engulfing pattern" data-type="indexterm" id="ix_contra_engulf_ch11"/><a contenteditable="false" data-primary="envelopment techniques" data-secondary="Bollinger bands" data-type="indexterm" id="idm46762849085344"/><a contenteditable="false" data-primary="Bollinger bands" data-type="indexterm" id="ix_boll_bands"/> are an envelopment technique that move with the market price and provide dynamic support and resistance levels using a statistical approach. This strategy couples the Engulfing pattern with the position of the market price relative to the lower or upper Bollinger band.</p>
<p>The trading conditions of the strategy are as follows:</p>
<ul>
<li>A long signal is generated whenever a bullish Engulfing pattern appears while the market price is below the lower Bollinger band.</li>
<li>A short signal is generated whenever a bearish Engulfing pattern appears while the market price is above the upper Bollinger band.</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A market price below its lower Bollinger band implies a statistically oversold event and suggests a bullish reaction, whereas a market price above its upper Bollinger band implies a statistically overbought event and suggests a bearish reaction.</p>
</div>
<p>The following code snippet shows how to code the signal function of the strategy:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="k">def</code><code> </code><code class="nf">signal</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">,</code><code> </code><code class="n">upper_band_column</code><code class="p">,</code><code> </code><code>
</code><code>           </code><code class="n">lower_band_column</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code>    </code><code>
</code><code>    </code><code>
</code><code>    </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">data</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>  </code><code>
</code><code>        </code><code>
</code><code>       </code><code class="k">try</code><code class="p">:</code><code>
</code><code>           </code><code>
</code><code>        </code><strong><code>   </code><code class="c1"># Bullish setup</code></strong><code>
</code><code>           </code><code class="k">if</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">lower_band_column</code><code class="p">]</code><code class="p">:</code><code>
</code><code>                  </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>         </code><strong><code>  </code><code class="c1"># Bearish setup</code></strong><code>
</code><code>           </code><code class="k">elif</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">upper_band_column</code><code class="p">]</code><code class="p">:</code><code>
</code><code>                 </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>       </code><code class="k">except</code><code> </code><code class="ne">IndexError</code><code class="p">:</code><code>
</code><code>            </code><code>
</code><code>            </code><code class="k">pass</code><code>
</code><code>        </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code><code>
</code></pre>
<p>Generally, Bollinger bands use a lookback period of 20 and a standard deviation of 2. But let’s review what this means one more time so you thoroughly understand how this great indicator is designed:</p>
<ul>
<li>The 20-period lookback period refers to a 20-period moving average calculated on the market price (close price). Similarly, a 20-period moving standard deviation measure is calculated on the market price (close price).</li>
<li>The standard deviation of 2 means that the rolling standard deviation measure is multiplied by two before adding it to the moving average or subtracting it.</li>
</ul>
<p>The following code snippet shows the function to calculate the Bollinger bands:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="k">def</code><code> </code><code class="nf">bollinger_bands</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">,</code><code> </code><code class="n">standard_deviation</code><code class="p">,</code><code> </code><code class="n">close</code><code class="p">,</code><code> </code><code class="n">position</code><code class="p">)</code><code class="p">:</code><code>
</code><code>       </code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">)</code><code>
</code><code> </code><strong><code>   </code><code>
</code><code>    </code><code class="c1"># Calculating the moving average</code></strong><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">ma</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">,</code><code> </code><code class="n">close</code><code class="p">,</code><code> </code><code class="n">position</code><code class="p">)</code><code>
</code><code>
</code><strong><code>    </code><code class="c1"># Calculating the standard deviation</code></strong><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">volatility</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">,</code><code> </code><code class="n">close</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">)</code><code>
</code><code>    </code><code>
</code><code>    </code><code class="n">data</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">2</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">data</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="n">position</code><code class="p">]</code><code> </code><code class="o">+</code><code> </code><code class="p">(</code><code class="n">standard_deviation</code><code> </code><code class="o">*</code><code> </code><code>
</code><code>                            </code><code class="n">data</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code>
</code><code>    </code><code class="n">data</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">3</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">data</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="n">position</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="p">(</code><code class="n">standard_deviation</code><code> </code><code class="o">*</code><code> </code><code>
</code><code>                            </code><code class="n">data</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code>
</code><code>    </code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">delete_row</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">)</code><code>
</code><code>    </code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">delete_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>
</code><code>        </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code><code>
</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The words <em>volatility </em>and <em>standard deviation</em> are used <span class="keep-together">interchangeably</span>.</p>
</div>
<p>The strategy uses 20-period Bollinger bands with a standard deviation of 1. This is to increase the frequency of signals just as you have seen with the previous strategy. <a data-type="xref" href="#figure11-2">Figure 11-2</a> shows a signal chart in USDCAD so you can see the strategy in action.</p>
<p>Notice how the bands are closer to the market price and are regularly broken or surpassed. Statistically speaking, if we assume that financial time series follow a normal distribution, then 68% of the market price should be contained within one standard deviation of the moving average (represented by the upper and lower bands).</p>
<p>The Engulfing pattern is not an abundant pattern on its own, and thus by adding an extra filter (Bollinger bands), the frequency goes down even further, which is why tweaking the parameters is important<a contenteditable="false" data-primary="" data-startref="ix_engulf_patt_ch11" data-type="indexterm" id="idm46762848901152"/><a contenteditable="false" data-primary="" data-startref="ix_contra_engulf_ch11" data-type="indexterm" id="idm46762848899776"/><a contenteditable="false" data-primary="" data-startref="ix_contra_strat_engulf" data-type="indexterm" id="idm46762848450512"/><a contenteditable="false" data-primary="" data-startref="ix_boll_bands" data-type="indexterm" id="idm46762848449136"/><a contenteditable="false" data-primary="" data-startref="ix_class_contra_engulf_ch11" data-type="indexterm" id="idm46762848447760"/>.</p>
<figure><div class="figure" id="figure11-2"><img alt="" height="297" src="assets/mfpr_1102.png" width="600"/>
<h6><span class="label">Figure 11-2. </span>Signal chart of the strategy using the Engulfing pattern and Bollinger bands</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Combining the Piercing Pattern with the Stochastic Oscillator" data-type="sect1"><div class="sect1" id="idm46762849105600">
<h1>Combining the Piercing Pattern with <span class="keep-together">the Stochastic Oscillator</span></h1>
<p>This strategy<a contenteditable="false" data-primary="Piercing pattern" data-type="indexterm" id="ix_pierce_patt_ch11"/><a contenteditable="false" data-primary="stochastic oscillator indicator" data-type="indexterm" id="ix_stoch_osc_indic_ch11"/><a contenteditable="false" data-primary="contrarian strategies" data-secondary="Piercing pattern and stochastic oscillator" data-type="indexterm" id="ix_contra_strat_pierce_ch11"/><a contenteditable="false" data-primary="classic contrarian patterns" data-secondary="Piercing pattern" data-type="indexterm" id="ix_class_contra_pierce_ch11"/> combines the Piercing pattern, a classic candlestick contrarian configuration, with the stochastic oscillator, a technical indicator discussed in <a data-type="xref" href="ch10.xhtml#chapter10">Chapter 10</a>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Remember that the stochastic oscillator uses the normalization function to create a rolling calculation trapped between 0 and 100 while taking into account the high and low prices. It resembles the RSI in the way it is interpreted and used.</p>
</div>
<p>The trading conditions of the strategy are as follows:</p>
<ul>
<li>A long signal is generated whenever a bullish Piercing pattern appears while the 14-period stochastic oscillator is below 20.</li>
<li>A short signal is generated whenever a bearish Piercing pattern appears while the 14-period stochastic oscillator is above 80.</li>
</ul>
<p>The following code snippet shows how to code the signal function of the strategy:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="n">lower_barrier</code><code> </code><code class="o">=</code><code> </code><code class="mi">20</code><code>
</code><code class="n">upper_barrier</code><code> </code><code class="o">=</code><code> </code><code class="mi">80</code><code>
</code><code>
</code><code class="k">def</code><code> </code><code class="nf">signal</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">,</code><code> </code><code>
</code><code>           </code><code class="n">buy_column</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code>    </code><code>
</code><code>    </code><code>
</code><code>    </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">data</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>  </code><code>
</code><code>        </code><code>
</code><code>       </code><code class="k">try</code><code class="p">:</code><code>
</code><strong><code>           </code><code>
</code><code>           </code><code class="c1"># Bullish setup</code></strong><code>
</code><code>           </code><code class="k">if</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">lower_barrier</code><code class="p">:</code><code>
</code><code>                  </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code> </code><code>
</code><code>      </code><strong><code>              </code><code>
</code><code>           </code><code class="c1"># Bearish setup</code></strong><code>
</code><code>           </code><code class="k">elif</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">upper_barrier</code><code class="p">:</code><code>
</code><code>                 </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>       </code><code class="k">except</code><code> </code><code class="ne">IndexError</code><code class="p">:</code><code>
</code><code>            </code><code>
</code><code>            </code><code class="k">pass</code><code>
</code><code>        </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code><code>
</code></pre>
<p><a data-type="xref" href="#figure11-3">Figure 11-3</a> shows a signal chart on USDCHF with bullish and bearish signals represented by upward-pointing arrows and downward-pointing arrows, respectively.</p>
<p>To sum up, combining the Piercing pattern with the stochastic oscillator offers an extra confirmation factor to the expected reversal. The stochastic oscillator can be tweaked as much as needed to calibrate the strategy to the desired frequency and profitability. Of course, no strategy works on all assets, but that’s the nature of these semi-random environments we call financial markets<a contenteditable="false" data-primary="" data-startref="ix_stoch_osc_indic_ch11" data-type="indexterm" id="idm46762848200560"/><a contenteditable="false" data-startref="ix_class_contra_pierce_ch11" data-type="indexterm" id="idm46762848199184"/><a contenteditable="false" data-startref="ix_contra_strat_pierce_ch11" data-type="indexterm" id="idm46762848236144"/><a contenteditable="false" data-primary="" data-startref="ix_pierce_patt_ch11" data-type="indexterm" id="idm46762848235056"/>.</p>
<figure><div class="figure" id="figure11-3"><img alt="" height="301" src="assets/mfpr_1103.png" width="600"/>
<h6><span class="label">Figure 11-3. </span>Signal chart of the strategy using the Piercing pattern and the stochastic oscillator</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Combining the Euphoria Pattern with K’s Envelopes" data-type="sect1"><div class="sect1" id="idm46762848443856">
<h1>Combining the Euphoria Pattern with K’s Envelopes</h1>
<p><em>K’s envelopes</em> are a couple<a contenteditable="false" data-primary="modern contrarian patterns" data-secondary="Euphoria pattern" data-type="indexterm" id="ix_mod_contra_euphoria_ch11"/><a contenteditable="false" data-primary="Euphoria pattern" data-type="indexterm" id="ix_euphoria_patt_ch11"/><a contenteditable="false" data-primary="K's envelopes" data-type="indexterm" id="ix_ks_envelope"/><a contenteditable="false" data-primary="contrarian strategies" data-secondary="Euphoria pattern and K’s envelopes" data-type="indexterm" id="ix_contra_strat_euphoria_ch11"/><a contenteditable="false" data-primary="envelopment techniques" data-secondary="K's envelopes" data-type="indexterm" id="ix_envelop_ks"/><a contenteditable="false" data-primary="moving averages" data-type="indexterm" id="idm46762848293648"/><a contenteditable="false" data-primary="contrarian patterns" data-secondary="Euphoria pattern" data-type="indexterm" id="ix_contra_euphoria_ch11"/> of simple 800-period moving averages where one is applied on the highs of the price and the other is applied on the lows of the price, thus creating a zone. Therefore, it is a dynamic support and resistance area that moves with the market price. An important characteristic of K’s envelopes is stability, which comes from the fact that the lookback period is significantly high, therefore making it relatively immune to short-term fluctuations or noise.</p>
<p>The indicator is extremely simple and is used in determining the current regime (bullish or bearish) or to find demand and supply zones whenever the market enters the zone. The following block of code shows the function of K’s envelopes:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="k">def</code><code> </code><code class="nf">k_envelopes</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">,</code><code> </code><code class="n">high</code><code class="p">,</code><code> </code><code class="n">low</code><code class="p">,</code><code> </code><code class="n">position</code><code class="p">)</code><code class="p">:</code><code>
</code><code>    </code><code>
</code><strong><code>    </code><code class="c1"># Calculating the upper moving average</code></strong><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">ma</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">,</code><code> </code><code class="n">high</code><code class="p">,</code><code> </code><code class="n">position</code><code class="p">)</code><code>
</code><code>    </code><code>
</code><strong><code>    </code><code class="c1"># Calculating the lower moving average</code></strong><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">ma</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">lookback</code><code class="p">,</code><code> </code><code class="n">low</code><code class="p">,</code><code> </code><code class="n">position</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">)</code><code>    </code><code>
</code><code>    </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code></pre>
<p><a data-type="xref" href="#figure11-4">Figure 11-4</a> shows USDCHF with K’s envelopes applied. Notice how the envelopes provide a dynamic support and resistance zone.</p>
<figure><div class="figure" id="figure11-4"><img alt="" height="294" src="assets/mfpr_1104.png" width="600"/>
<h6><span class="label">Figure 11-4. </span>USDCHF with K’s envelopes</h6>
</div></figure>
<p>Now, the idea is to combine K’s envelopes with a candlestick pattern. The trading conditions of the strategy are as follows:</p>
<ul>
<li>A long signal is generated whenever a bullish Euphoria pattern appears while the current market price is inside K’s envelopes.</li>
<li>A short signal is generated whenever a bearish Euphoria pattern appears while the current market price is inside K’s envelopes.</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>By being inside K’s envelopes, the market price is therefore pending an expecting reaction in the direction that is determined by the Euphoria pattern. In other words, the trigger and the direction are given by the Euphoria pattern, while the confirmation is given by K’s envelopes.</p>
</div>
<p>The following code snippet shows how to code the signal function of the strategy:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="k">def</code><code> </code><code class="nf">signal</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">,</code><code> </code><code class="n">upper_k_envelope</code><code class="p">,</code><code> </code><code>
</code><code>           </code><code class="n">lower_k_envelope</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code>  </code><code>
</code><code>    </code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">rounding</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code> </code><code class="c1"># Put 0 instead of 4 as of pair 4</code><code>
</code><code>    </code><code>
</code><code>    </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">data</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>  </code><code>
</code><code>        </code><code>
</code><code>       </code><code class="k">try</code><code class="p">:</code><code>
</code><code>     </code><strong><code>      </code><code>
</code><code>           </code><code class="c1"># Bullish setup</code></strong><code>
</code><code>           </code><code class="k">if</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code>
</code><code>              </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code>
</code><code>              </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">lower_k_envelope</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">upper_k_envelope</code><code class="p">]</code><code class="p">:</code><code> </code><code>
</code><code>                  </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>       </code><strong><code>    </code><code class="c1"># Bearish setup</code></strong><code>
</code><code>           </code><code class="k">elif</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code>\
</code><code>                </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code>\
</code><code>                </code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code class="p">)</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">lower_k_envelope</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">upper_k_envelope</code><code class="p">]</code><code class="p">:</code><code> </code><code>
</code><code>                 </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>       </code><code class="k">except</code><code> </code><code class="ne">IndexError</code><code class="p">:</code><code>
</code><code>            </code><code>
</code><code>            </code><code class="k">pass</code><code>
</code><code>        </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code><code>
</code></pre>
<p><a data-type="xref" href="#figure11-5">Figure 11-5</a> shows a signal chart with K’s envelopes visible on the chart. The signal has been generated due to the appearance of the Euphoria pattern within the <span class="keep-together">envelopes</span>.</p>
<p>The strategy borrows from the field of graphical analysis (support and resistance levels) and applies the Euphoria modern candlestick pattern to confirm the demand zone or the supply zone<a contenteditable="false" data-primary="" data-startref="ix_ks_envelope" data-type="indexterm" id="idm46762846320016"/><a contenteditable="false" data-primary="" data-startref="ix_mod_contra_euphoria_ch11" data-type="indexterm" id="idm46762846318640"/><a contenteditable="false" data-primary="" data-startref="ix_euphoria_patt_ch11" data-type="indexterm" id="idm46762846317200"/><a contenteditable="false" data-primary="" data-startref="ix_envelop_ks" data-type="indexterm" id="idm46762846377616"/><a contenteditable="false" data-primary="" data-startref="ix_contra_euphoria_ch11" data-type="indexterm" id="idm46762846376240"/><a contenteditable="false" data-primary="" data-startref="ix_contra_strat_euphoria_ch11" data-type="indexterm" id="idm46762846316496"/>.</p>
<figure><div class="figure" id="figure11-5"><img alt="" height="297" src="assets/mfpr_1105.png" width="600"/>
<h6><span class="label">Figure 11-5. </span>Signal chart of the strategy using K’s envelopes and the Euphoria pattern</h6>
</div></figure>
</div></section>
<section data-pdf-bookmark="Combining the Barrier Pattern with the RSI-ATR" data-type="sect1"><div class="sect1" id="idm46762848321616">
<h1>Combining the Barrier Pattern with the RSI-ATR</h1>
<p>What exactly<a contenteditable="false" data-primary="volatility" data-secondary="ATR indicator" data-type="indexterm" id="ix_volatil_atr_indic"/><a contenteditable="false" data-primary="relative strength index (RSI) indicator" data-secondary="with ATR and Barrier pattern" data-secondary-sortas="ATR and Barrier pattern" data-type="indexterm" id="ix_rsi_atr_barrier"/><a contenteditable="false" data-primary="RSI-ATR momentum-volatility indicators" data-type="indexterm" id="ix_rsi_atr_mom_vol"/><a contenteditable="false" data-primary="Barrier pattern" data-type="indexterm" id="ix_barrier_patt_ch11"/><a contenteditable="false" data-primary="contrarian strategies" data-secondary="Barrier pattern and RSI-ATR indicators" data-type="indexterm" id="ix_contra_strat_barr_rsi-atr"/><a contenteditable="false" data-primary="average true range (ATR)" data-type="indexterm" id="ix_av_true_rge_atr_ch11"/> is the RSI-ATR? Well, you already know that the RSI is a momentum indicator and that the ATR is a volatility indicator. You have also seen how to code them and use them accordingly. However, fusing them into one indicator is something you have not seen yet. The RSI-ATR is a structured indicator composed of the directional elements of the RSI and the deflating/inflating properties of the ATR. It is used in the same way as the RSI.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A <em>structured indicator</em> is a technical<a contenteditable="false" data-primary="structured indicator" data-type="indexterm" id="idm46762846332848"/> indicator composed of two or more indicators. Examples of a structured indicator are the RSI-ATR and the stochastic-RSI (an indicator that has the stochastic oscillator and the RSI as building blocks).</p>
</div>
<p>To calculate the RSI-ATR (by default, the lookback period is 14), follow these steps:</p>
<ol>
<li>Calculate an RSI on the market price. </li>
<li>Calculate an ATR on the market price using the formula as you know it.</li>
<li>Divide the RSI from the first step by the ATR from the second step.</li>
<li>Calculate an RSI on the results of the previous step.</li>
</ol>
<p>Hence, the RSI-ATR is an RSI calculated on the ratio between the RSI (applied on the market price) and the ATR. This is why it is a volatility-weighted indicator. The following snippet shows how to create the indicator in Python:</p>
<pre data-code-language="python" data-executable="true" data-type="programlisting">
<code class="k">def</code> <code class="nf">rsi_atr</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">lookback_rsi</code><code class="p">,</code> <code class="n">lookback_atr</code><code class="p">,</code> <code class="n">lookback_rsi_atr</code><code class="p">,</code> <code class="n">high</code><code class="p">,</code> 
            <code class="n">low</code><code class="p">,</code> <code class="n">close</code><code class="p">,</code> <code class="n">position</code><code class="p">):</code>
    
    <code class="n">data</code> <code class="o">=</code> <code class="n">rsi</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">lookback_rsi</code><code class="p">,</code> <code class="n">close</code><code class="p">,</code> <code class="n">position</code><code class="p">)</code>
    
    <code class="n">data</code> <code class="o">=</code> <code class="n">atr</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">lookback_atr</code><code class="p">,</code> <code class="n">high</code><code class="p">,</code> <code class="n">low</code><code class="p">,</code> <code class="n">close</code><code class="p">,</code> <code class="n">position</code> <code class="o">+</code> <code class="mi">1</code><code class="p">)</code>
    
    <code class="n">data</code> <code class="o">=</code> <code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>
    
    <code class="n">data</code><code class="p">[:,</code> <code class="n">position</code> <code class="o">+</code> <code class="mi">2</code><code class="p">]</code> <code class="o">=</code> <code class="n">data</code><code class="p">[:,</code> <code class="n">position</code><code class="p">]</code> <code class="o">/</code> <code class="n">data</code><code class="p">[:,</code> <code class="n">position</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code>
    
    <code class="n">data</code> <code class="o">=</code> <code class="n">rsi</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">lookback_rsi_atr</code><code class="p">,</code> <code class="n">position</code> <code class="o">+</code> <code class="mi">2</code><code class="p">,</code> <code class="n">position</code> <code class="o">+</code> <code class="mi">3</code><code class="p">)</code>
    
    <code class="n">data</code> <code class="o">=</code> <code class="n">delete_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">position</code><code class="p">,</code> <code class="mi">3</code><code class="p">)</code>
    
    <code class="k">return</code> <code class="n">data</code>
</pre>
<p><a data-type="xref" href="#figure11-6">Figure 11-6</a> shows the five-period RSI-ATR applied on USDCHF.</p>
<figure><div class="figure" id="figure11-6"><img alt="" height="298" src="assets/mfpr_1106.png" width="600"/>
<h6><span class="label">Figure 11-6. </span>USDCHF with the 14-period RSI-ATR</h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You must have noticed that there are three parameters when dealing with the RSI-ATR as opposed to one parameter with the RSI. The first parameter on the RSI-ATR is the lookback period of the RSI, the second parameter is the lookback of the ATR, and the third parameter is the lookback of the final RSI.</p>
</div>
<p>The RSI-ATR is characterized by more volatility and rate of change than the original RSI, thus making it much more reactive to market fluctuations. On the other hand, you use it the same way you would use the RSI.</p>
<p>Remember that the Barrier pattern is a modern configuration (see <a data-type="xref" href="ch07.xhtml#chapter7">Chapter 7</a>) and is simply an embodiment of the concept of support and resistance levels.</p>
<p>The trading conditions of the strategy are as follows:</p>
<ul>
<li>A long signal is generated whenever a bullish Barrier pattern appears while the <span class="keep-together">5-period</span> RSI-ATR is below 20.</li>
<li>A short signal is generated whenever a bearish Barrier pattern appears while the 5-period RSI-ATR is above 80.</li>
</ul>
<p>The following code snippet shows how to code the signal function of the strategy:</p>
<pre class="pre" data-code-language="python" data-executable="true" data-type="programlisting">
<code class="k">def</code><code> </code><code class="nf">signal</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">,</code><code> </code><code>
</code><code>           </code><code class="n">buy_column</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">)</code><code class="p">:</code><code>
</code><code>
</code><code>    </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">add_column</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code>    </code><code>
</code><code>    </code><code>
</code><code>    </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">data</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>  </code><code>
</code><code>        </code><code>
</code><code>       </code><code class="k">try</code><code class="p">:</code><code>
</code><code>           </code><code>
</code><code>    </code><strong><code>       </code><code class="c1"># Bullish setup</code></strong><code>
</code><code>           </code><code class="k">if</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>              </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">lower_barrier</code><code class="p">:</code><code>
</code><code>                  </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">buy_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code> </code><strong><code>          </code><code class="c1"># Bearish setup</code></strong><code>
</code><code>           </code><code class="k">elif</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code> </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">close_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">-</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">open_column</code><code class="p">]</code><code>  </code><code class="ow">and</code><code> </code><code>\
</code><code>                </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code> </code><code class="n">indicator_column</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="n">upper_barrier</code><code class="p">:</code><code>
</code><code>                 </code><code>
</code><code>                    </code><code class="n">data</code><code class="p">[</code><code class="n">i</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">sell_column</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code> </code><code>
</code><code>                    </code><code>
</code><code>       </code><code class="k">except</code><code> </code><code class="ne">IndexError</code><code class="p">:</code><code>
</code><code>            </code><code>
</code><code>            </code><code class="k">pass</code><code>
</code><code>        </code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">data</code><code>
</code></pre>
<p class="pagebreak-before"><a data-type="xref" href="#figure11-7">Figure 11-7</a> shows a signal chart on AUDNZD.</p>
<figure><div class="figure" id="figure11-7"><img alt="" height="294" src="assets/mfpr_1107.png" width="600"/>
<h6><span class="label">Figure 11-7. </span>Signal chart of the strategy using RSI-ATR with the Barrier pattern</h6>
</div></figure>
<p>To sum up, the RSI-ATR is an interesting indicator that offers volatility-weighted information of the RSI<a contenteditable="false" data-primary="" data-startref="ix_rsi_atr_mom_vol" data-type="indexterm" id="idm46762847360480"/><a contenteditable="false" data-primary="" data-startref="ix_volatil_atr_indic" data-type="indexterm" id="idm46762847790928"/><a contenteditable="false" data-primary="" data-startref="ix_contra_strat_barr_rsi-atr" data-type="indexterm" id="idm46762847789552"/><a contenteditable="false" data-primary="" data-startref="ix_rsi_atr_barrier" data-type="indexterm" id="idm46762847788160"/><a contenteditable="false" data-primary="" data-startref="ix_av_true_rge_atr_ch11" data-type="indexterm" id="idm46762847306672"/><a contenteditable="false" data-primary="" data-startref="ix_barrier_patt_ch11" data-type="indexterm" id="idm46762847305296"/><a contenteditable="false" data-primary="" data-startref="ix_contra_strat_ch11" data-type="indexterm" id="idm46762848127552"/>. Combining the indicator with a candlestick pattern that is based on the concept of support and resistance levels could yield strong trade <span class="keep-together">configurations</span>.</p>
</div></section>
</div></section></div></body></html>