- en: 'Chapter 5\. Supervised Learning: Regression (Including Time Series Models)'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第五章。监督学习：回归（包括时间序列模型）
- en: Supervised regression–based machine learning is a predictive form of modeling
    in which the goal is to model the relationship between a target and the predictor
    variable(s) in order to estimate a continuous set of possible outcomes. These
    are the most used machine learning models in finance.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 监督回归型机器学习是一种预测性建模形式，其目标是建立目标与预测变量之间的关系，以估计一组连续可能的结果。这些是金融中最常用的机器学习模型。
- en: One of the focus areas of analysts in financial institutions (and finance in
    general) is to predict investment opportunities, typically predictions of asset
    prices and asset returns. Supervised regression–based machine learning models
    are inherently suitable in this context. These models help investment and financial
    managers understand the properties of the predicted variable and its relationship
    with other variables, and help them identify significant factors that drive asset
    returns. This helps investors estimate return profiles, trading costs, technical
    and financial investment required in infrastructure, and thus ultimately the risk
    profile and profitability of a strategy or portfolio.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 金融机构（以及整个金融领域）分析师的关注重点之一是预测投资机会，通常是资产价格和资产回报的预测。在这种情况下，监督回归型机器学习模型天生适用。这些模型帮助投资和金融经理了解预测变量的特性及其与其他变量的关系，并帮助他们确定推动资产回报的重要因素。这有助于投资者估计回报概况、交易成本、基础设施所需的技术和金融投资，从而最终评估策略或投资组合的风险概况和盈利能力。
- en: With the availability of large volumes of data and processing techniques, supervised
    regression–based machine learning isn’t just limited to asset price prediction.
    These models are applied to a wide range of areas within finance, including portfolio
    management, insurance pricing, instrument pricing, hedging, and risk management.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 随着大量数据和处理技术的可用性，监督回归型机器学习不仅仅局限于资产价格预测。这些模型被应用于金融领域的广泛范围，包括投资组合管理、保险定价、工具定价、套期保值和风险管理等领域。
- en: In this chapter we cover three supervised regression–based case studies that
    span diverse areas, including asset price prediction, instrument pricing, and
    portfolio management. All of the case studies follow the standardized seven-step
    model development process presented in [Chapter 2](ch02.xhtml#Chapter2); those
    steps include defining the problem, loading the data, exploratory data analysis,
    data preparation, model evaluation, and model tuning.^([1](ch05.xhtml#idm45174931460040))
    The case studies are designed not only to cover a diverse set of topics from the
    finance standpoint but also to cover multiple machine learning and modeling concepts,
    including models from basic linear regression to advanced deep learning that were
    presented in [Chapter 4](ch04.xhtml#Chapter4).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们涵盖了三个基于监督回归的案例研究，涉及资产价格预测、工具定价和投资组合管理等多个领域。所有案例研究都遵循[第2章](ch02.xhtml#Chapter2)中介绍的标准化七步模型开发过程；这些步骤包括定义问题、加载数据、探索性数据分析、数据准备、模型评估和模型调优。这些案例研究的设计不仅涵盖了金融视角下的多个主题，还涵盖了多个机器学习和建模概念，包括从基本的线性回归到[第4章](ch04.xhtml#Chapter4)中介绍的高级深度学习模型。
- en: A substantial amount of asset modeling and prediction problems in the financial
    industry involve a time component and estimation of a continuous output. As such,
    it is also important to address *time series models*. In its broadest form, time
    series analysis is about inferring what has happened to a series of data points
    in the past and attempting to predict what will happen to it in the future. There
    have been a lot of comparisons and debates in academia and the industry regarding
    the differences between supervised regression and time series models. Most time
    series models are *parametric* (i.e., a known function is assumed to represent
    the data), while the majority of supervised regression models are *nonparametric*.
    Time series models primarily use historical data of the predicted variables for
    prediction, and supervised learning algorithms use *exogenous variables* as predictor
    variables.^([2](ch05.xhtml#idm45174931449640)) However, supervised regression
    can embed the historical data of the predicted variable through a time-delay approach
    (covered later in this chapter), and a time series model (such as ARIMAX, also
    covered later in this chapter) can use exogenous variables for prediction. Hence,
    time series and supervised regression models are similar in the sense that both
    can use exogenous variables as well as historical data of the predicted variable
    for forecasting. In terms of the final output, both supervised regression and
    time series models estimate a continuous set of possible outcomes of a variable.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在金融行业的资产建模和预测问题中，涉及时间成分和连续输出的估计是相当重要的。因此，也有必要讨论*时间序列模型*。在其最广泛的形式下，时间序列分析是关于推断过去一系列数据点的情况，并试图预测未来会发生什么。关于监督回归和时间序列模型之间的差异，学术界和行业中已经进行了大量的比较和辩论。大多数时间序列模型是*参数化*的（即假设已知函数表示数据），而大多数监督回归模型是*非参数化*的。时间序列模型主要利用预测变量的历史数据进行预测，而监督学习算法则使用*外生变量*作为预测变量。^([2](ch05.xhtml#idm45174931449640))
    然而，监督回归可以通过时间延迟方法嵌入预测变量的历史数据（本章后面会介绍），时间序列模型（如ARIMAX，也会在本章后面介绍）可以利用外生变量进行预测。因此，时间序列模型和监督回归模型在可以使用外生变量以及预测变量的历史数据进行预测方面是相似的。在最终输出方面，监督回归和时间序列模型都估计了变量的一组连续可能结果。
- en: In [Chapter 4](ch04.xhtml#Chapter4), we covered the concepts of models that
    are common between supervised regression and supervised classification. Given
    that time series models are more closely aligned with supervised regression than
    supervised classification, we will go through the concepts of time series models
    separately in this chapter. We will also demonstrate how we can use time series
    models on financial data to predict future values. Comparison of time series models
    against the supervised regression models will be presented in the case studies.
    Additionally, some machine learning and deep learning models (such as LSTM) can
    be directly used for time series forecasting, and those will be discussed as well.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第四章](ch04.xhtml#Chapter4)中，我们涵盖了在监督回归和监督分类之间共通的模型概念。考虑到时间序列模型更接近于监督回归而不是监督分类，我们将在本章节单独讨论时间序列模型的概念。我们还将演示如何在金融数据上使用时间序列模型来预测未来的数值。我们将在案例研究中呈现时间序列模型与监督回归模型的比较。此外，一些机器学习和深度学习模型（如LSTM）可以直接用于时间序列预测，我们也将对其进行讨论。
- en: 'In [“Case Study 1: Stock Price Prediction”](#CaseStudy1SR), we demonstrate
    one of the most popular prediction problems in finance, that of predicting stock
    returns. In addition to predicting future stock prices accurately, the purpose
    of this case study is to discuss the machine learning–based framework for general
    asset class price prediction in finance. In this case study we will discuss several
    machine learning and time series concepts, along with focusing on visualization
    and model tuning.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在[“案例研究1：股票价格预测”](#CaseStudy1SR)中，我们展示了金融领域中最流行的预测问题之一，即预测股票回报率。除了准确预测未来股票价格外，这个案例研究的目的是讨论基于机器学习的通用资产类价格预测框架。在这个案例研究中，我们将讨论几个机器学习和时间序列的概念，同时重点关注可视化和模型调整。
- en: 'In [“Case Study 2: Derivative Pricing”](#CaseStudy2SR), we will delve into
    derivative pricing using supervised regression and show how to deploy machine
    learning techniques in the context of traditional quant problems. As compared
    to traditional derivative pricing models, machine learning techniques can lead
    to faster derivative pricing without relying on the several impractical assumptions.
    Efficient numerical computation using machine learning can be increasingly beneficial
    in areas such as financial risk management, where a trade-off between efficiency
    and accuracy is often inevitable.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在[“案例研究2：衍生品定价”](#CaseStudy2SR)中，我们将深入探讨使用监督回归进行衍生品定价，并展示如何在传统量化问题背景下部署机器学习技术。与传统衍生品定价模型相比，机器学习技术可以在不依赖于多个不切实际假设的情况下更快地进行衍生品定价。在金融风险管理等领域，利用机器学习进行高效数值计算往往具有越来越多的好处，这些领域通常需要在效率与准确性之间进行权衡。
- en: 'In [“Case Study 3: Investor Risk Tolerance and Robo-Advisors”](#CaseStudy3SR),
    we illustrate supervised regression–based framework to estimate the risk tolerance
    of investors. In this case study, we build a robo-advisor dashboard in Python
    and implement this risk tolerance prediction model in the dashboard. We demonstrate
    how such models can lead to the automation of portfolio management processes,
    including the use of robo-advisors for investment management. The purpose is also
    to illustrate how machine learning can efficiently be used to overcome the problem
    of traditional risk tolerance profiling or risk tolerance questionnaires that
    suffer from several behavioral biases.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在[“案例研究3：投资者风险容忍度与智能顾问”](#CaseStudy3SR)中，我们展示了基于监督回归的框架来估计投资者的风险容忍度。在这个案例研究中，我们在Python中构建了一个智能顾问仪表板，并在该仪表板中实现了这个风险容忍度预测模型。我们展示了这类模型如何能够自动化投资组合管理流程，包括利用智能顾问进行投资管理。这也旨在说明机器学习如何有效地用于克服传统风险容忍度评估或风险容忍度问卷存在的多种行为偏差问题。
- en: 'In [“Case Study 4: Yield Curve Prediction”](#CaseStudy4SR), we use a supervised
    regression–based framework to forecast different yield curve tenors simultaneously.
    We demonstrate how we can produce multiple tenors at the same time to model the
    yield curve using machine learning models.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在[“案例研究4：收益率曲线预测”](#CaseStudy4SR)中，我们使用基于监督回归的框架同时预测不同收益率曲线期限。我们展示了如何使用机器学习模型同时生成多个期限，以建模收益率曲线。
- en: The models used for supervised regression were presented in Chapters [3](ch03.xhtml#Chapter3)
    and [4](ch04.xhtml#Chapter4). Prior to the case studies, we will discuss time
    series models. We highly recommend readers turn to *Time Series Analysis and Its
    Applications*, 4th Edition, by Robert H. Shumway and David S. Stoffer (Springer)
    for a more in-depth understanding of time series concepts, and to *Hands-On Machine
    Learning with Scikit-Learn, Keras, and TensorFlow*, 2nd Edition, by Aurélien Géron
    (O’Reilly) for more on concepts in supervised regression models.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 用于监督回归的模型见第[3](ch03.xhtml#Chapter3)章和第[4](ch04.xhtml#Chapter4)章。在案例研究之前，我们将讨论时间序列模型。我们强烈建议读者参考Robert
    H. Shumway和David S. Stoffer的《时间序列分析及其应用》，第4版（Springer），以深入理解时间序列概念，并参考Aurélien
    Géron的《Scikit-Learn、Keras和TensorFlow实战》，第2版（O’Reilly），了解监督回归模型中的更多概念。
- en: This Chapter’s Code Repository
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 本章代码库
- en: A Python-based master template for supervised regression, a time series model
    template, and the Jupyter notebook for all case studies presented in this chapter
    are included in the folder [*Chapter 5 - Sup. Learning - Regression and Time Series
    models*](https://oreil.ly/sJFV0) of the code repository for this book.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的代码库中包含了基于Python的监督回归主模板、时间序列模型模板以及本章中所有案例研究的Jupyter笔记本，位于[*第5章 - 监督学习 - 回归和时间序列模型*](https://oreil.ly/sJFV0)的文件夹中。
- en: For any new supervised regression–based case study, use the common template
    from the code repository, modify the elements specific to the case study, and
    borrow the concepts and insights from the case studies presented in this chapter.
    The template also includes the implementation and tuning of the ARIMA and LSTM
    models.^([3](ch05.xhtml#idm45174931422552)) The templates are designed to run
    on the cloud (i.e., Kaggle, Google Colab, and AWS). All the case studies have
    been designed on a uniform regression template.^([4](ch05.xhtml#idm45174931421656))
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何新的基于监督回归的案例研究，使用代码库中的通用模板，修改特定于案例研究的元素，并借鉴本章中提出的案例研究的概念和见解。该模板还包括ARIMA和LSTM模型的实现和调整。^([3](ch05.xhtml#idm45174931422552))这些模板设计用于在云端运行（即Kaggle、Google
    Colab和AWS）。所有案例研究都是根据统一的回归模板设计的。^([4](ch05.xhtml#idm45174931421656))
- en: Time Series Models
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列模型
- en: A *time series* is a sequence of numbers that are ordered by a time index.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '*时间序列*是按时间索引排序的数字序列。'
- en: 'In this section we will cover the following aspects of time series models,
    which we further leverage in the case studies:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍时间序列模型的以下方面，我们在案例研究中进一步利用这些方面：
- en: The components of a time series
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列的组成部分
- en: Autocorrelation and stationarity of time series
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间序列的自相关性和平稳性
- en: Traditional time series models (e.g., ARIMA)
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 传统的时间序列模型（例如ARIMA）
- en: Use of deep learning models for time series modeling
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用深度学习模型进行时间序列建模
- en: Conversion of time series data for use in a supervised learning framework
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将时间序列数据转换为用于监督学习框架的形式
- en: Time Series Breakdown
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间序列分解
- en: 'A time series can be broken down into the following components:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列可以分解为以下组件：
- en: Trend Component
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 趋势分量
- en: A trend is a consistent directional movement in a time series. These trends
    will be either *deterministic* or *stochastic*. The former allows us to provide
    an underlying rationale for the trend, while the latter is a random feature of
    a series that we will be unlikely to explain. Trends often appear in financial
    series, and many trading models use sophisticated trend identification algorithms.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 趋势是时间序列中的一致方向性运动。这些趋势将是*确定性*或*随机性*的。前者允许我们为趋势提供根本的解释，而后者是我们不太可能解释的系列的随机特征。趋势经常出现在金融系列中，并且许多交易模型使用复杂的趋势识别算法。
- en: Seasonal Component
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 季节性分量
- en: Many time series contain seasonal variation. This is particularly true in series
    representing business sales or climate levels. In quantitative finance we often
    see seasonal variation, particularly in series related to holiday seasons or annual
    temperature variation (such as natural gas).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 许多时间序列包含季节性变化。这在代表业务销售或气候水平的系列中特别真实。在量化金融中，我们经常看到季节性变化，特别是与假期季节或年度温度变化相关的系列（例如天然气）。
- en: We can write the components of a time series <math alttext="y Subscript t"><msub><mi>y</mi>
    <mi>t</mi></msub></math> as
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将时间序列<math alttext="y Subscript t"><msub><mi>y</mi> <mi>t</mi></msub></math>的组成部分写成
- en: <math alttext="y Subscript t Baseline equals upper S Subscript t Baseline plus
    upper T Subscript t Baseline plus upper R Subscript t" display="block"><mrow><msub><mi>y</mi>
    <mi>t</mi></msub> <mo>=</mo> <msub><mi>S</mi> <mi>t</mi></msub> <mo>+</mo> <msub><mi>T</mi>
    <mi>t</mi></msub> <mo>+</mo> <msub><mi>R</mi> <mi>t</mi></msub></mrow></math>
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: <math alttext="y Subscript t Baseline equals upper S Subscript t Baseline plus
    upper T Subscript t Baseline plus upper R Subscript t" display="block"><mrow><msub><mi>y</mi>
    <mi>t</mi></msub> <mo>=</mo> <msub><mi>S</mi> <mi>t</mi></msub> <mo>+</mo> <msub><mi>T</mi>
    <mi>t</mi></msub> <mo>+</mo> <msub><mi>R</mi> <mi>t</mi></msub></mrow></math>
- en: where <math alttext="upper S Subscript t"><msub><mi>S</mi> <mi>t</mi></msub></math>
    is the seasonal component, <math alttext="upper T Subscript t"><msub><mi>T</mi>
    <mi>t</mi></msub></math> is the trend component, and <math alttext="upper R Subscript
    t"><msub><mi>R</mi> <mi>t</mi></msub></math> represents the remainder component
    of the time series not captured by seasonal or trend component.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 其中<math alttext="upper S Subscript t"><msub><mi>S</mi> <mi>t</mi></msub></math>是季节性分量，<math
    alttext="upper T Subscript t"><msub><mi>T</mi> <mi>t</mi></msub></math>是趋势分量，<math
    alttext="upper R Subscript t"><msub><mi>R</mi> <mi>t</mi></msub></math>代表了时间序列中未被季节性或趋势分量捕获的剩余部分。
- en: 'The Python code for breaking down a time series (*Y*) into its component is
    as follows:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 将时间序列(*Y*)分解为其组件的Python代码如下：
- en: '[PRE0]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '[Figure 5-1](#TimeSeriesComponents) shows the time series broken down into
    trend, seasonality, and remainder components. Breaking down a time series into
    these components may help us better understand the time series and identify its
    behavior for better prediction.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-1](#TimeSeriesComponents)显示了时间序列分解为趋势、季节性和剩余部分组件。将时间序列分解为这些组件可能有助于我们更好地理解时间序列，并确定其行为以进行更好的预测。'
- en: The three time series components are shown separately in the bottom three panels.
    These components can be added together to reconstruct the actual time series shown
    in the top panel (shown as “observed”). Notice that the time series shows a trending
    component after 2017\. Hence, the prediction model for this time series should
    incorporate the information regarding the trending behavior after 2017\. In terms
    of seasonality there is some increase in the magnitude in the beginning of the
    calendar year. The residual component shown in the bottom panel is what is left
    over when the seasonal and trend components have been subtracted from the data.
    The residual component is mostly flat with some spikes and noise around 2018 and
    2019\. Also, each of the plots are on different scales, and the trend component
    has maximum range as shown by the scale on the plot.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 三个时间序列组件分别显示在底部的三个面板中。这些组件可以相加以重建顶部面板中显示的实际时间序列（标为“观察到”）。注意，时间序列在2017年后显示出趋势性组件。因此，该时间序列的预测模型应该包含有关2017年后趋势行为的信息。在季节性方面，每年的开始有一些幅度增加。底部面板中显示的残差分量是从数据中减去季节性和趋势组件后剩余的部分。残差分量在2018年和2019年左右有些尖峰和噪声，整体上是平坦的。此外，每个图的比例不同，趋势分量的范围最大，如图中的比例尺所示。
- en: '![mlbf 0501](Images/mlbf_0501.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0501](Images/mlbf_0501.png)'
- en: Figure 5-1\. Time series components
  id: totrans-37
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-1\. 时间序列组件
- en: Autocorrelation and Stationarity
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自相关和平稳性
- en: When we are given one or more time series, it is relatively straightforward
    to decompose the time series into trend, seasonality, and residual components.
    However, there are other aspects that come into play when dealing with time series
    data, particularly in finance.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 当给定一个或多个时间序列时，将时间序列分解为趋势、季节性和残差分量相对比较简单。然而，在处理时间序列数据时，特别是在金融领域，还有其他因素需要考虑。
- en: Autocorrelation
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自相关
- en: There are many situations in which consecutive elements of a time series exhibit
    correlation. That is, the behavior of sequential points in the series affect each
    other in a dependent manner. *Autocorrelation* is the similarity between observations
    as a function of the time lag between them. Such relationships can be modeled
    using an autoregression model. The term *autoregression* indicates that it is
    a regression of the variable against itself.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 许多情况下，时间序列的连续元素呈现相关性。即，序列中连续点的行为以一种依赖的方式相互影响。*自相关* 是观测值随时间滞后之间相似性的度量。可以使用自回归模型来建模这种关系。术语
    *自回归* 表示它是变量对自身的回归。
- en: In an autoregression model, we forecast the variable of interest using a linear
    combination of past values of the variable.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在自回归模型中，我们使用变量过去值的线性组合来预测感兴趣的变量。
- en: Thus, an autoregressive model of order <math alttext="p"><mi>p</mi></math> can
    be written as
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，*p* 阶自回归模型可以写成
- en: <math display="block"><mrow><msub><mi>y</mi> <mi>t</mi></msub> <mo>=</mo> <mi>c</mi>
    <mo>+</mo> <msub><mi>ϕ</mi> <mn>1</mn></msub> <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub>
    <mo>+</mo> <msub><mi>ϕ</mi> <mn>2</mn></msub> <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mn>2</mn></mrow></msub>
    <mo>+</mo> <mo>.</mo> <mo>.</mo> <mo>.</mo> <mo>.</mo> <msub><mi>ϕ</mi> <mi>p</mi></msub>
    <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mi>p</mi></mrow></msub> <mo>+</mo>
    <mi>ϵ</mi></mrow></math>
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="block"><mrow><msub><mi>y</mi> <mi>t</mi></msub> <mo>=</mo> <mi>c</mi>
    <mo>+</mo> <msub><mi>ϕ</mi> <mn>1</mn></msub> <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub>
    <mo>+</mo> <msub><mi>ϕ</mi> <mn>2</mn></msub> <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mn>2</mn></mrow></msub>
    <mo>+</mo> <mo>.</mo> <mo>.</mo> <mo>.</mo> <mo>.</mo> <msub><mi>ϕ</mi> <mi>p</mi></msub>
    <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mi>p</mi></mrow></msub> <mo>+</mo>
    <mi>ϵ</mi></mrow></math>
- en: where <math alttext="epsilon Subscript t"><msub><mi>ϵ</mi> <mi>t</mi></msub></math>
    is white noise.^([5](ch05.xhtml#idm45174931308056)) An autoregressive model is
    like a multiple regression but with lagged values of <math alttext="y Subscript
    t"><msub><mi>y</mi> <mi>t</mi></msub></math> as predictors. We refer to this as
    an AR(*p*) model, an autoregressive model of order *p*. Autoregressive models
    are remarkably flexible at handling a wide range of different time series patterns.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 <math alttext="epsilon Subscript t"><msub><mi>ϵ</mi> <mi>t</mi></msub></math>
    是白噪声。^([5](ch05.xhtml#idm45174931308056)) 自回归模型类似于多元回归，但使用滞后的 <math alttext="y
    Subscript t"><msub><mi>y</mi> <mi>t</mi></msub></math> 值作为预测因子。我们称之为AR(*p*)模型，即
    *p* 阶自回归模型。自回归模型在处理各种不同的时间序列模式时非常灵活。
- en: Stationarity
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 平稳性
- en: A time series is said to be stationary if its statistical properties do not
    change over time. Thus a time series with trend or with seasonality is not stationary,
    as the trend and seasonality will affect the value of the time series at different
    times. On the other hand, a white noise series is stationary, as it does not matter
    when you observe it; it should look similar at any point in time.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个时间序列的统计特性随时间不变，则称为平稳时间序列。因此，带有趋势或季节性的时间序列不是平稳的，因为趋势和季节性会在不同时间点影响时间序列的值。另一方面，白噪声序列是平稳的，因为无论何时观察，它看起来都应该是相似的。
- en: '[Figure 5-2](#NonStationaryPlots) shows some examples of nonstationary series.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-2](#NonStationaryPlots) 展示了一些非平稳序列的示例。'
- en: '![mlbf 0502](Images/mlbf_0502.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0502](Images/mlbf_0502.png)'
- en: Figure 5-2\. Nonstationary plots
  id: totrans-50
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-2\. 非平稳绘图
- en: In the first plot, we can clearly see that the mean varies (increases) with
    time, resulting in an upward trend. Thus this is a nonstationary series. For a
    series to be classified as stationary, it should not exhibit a trend. Moving on
    to the second plot, we certainly do not see a trend in the series, but the variance
    of the series is a function of time. A stationary series must have a constant
    variance; hence this series is a nonstationary series as well. In the third plot,
    the spread becomes closer as the time increases, which implies that the covariance
    is a function of time. The three examples shown in [Figure 5-2](#NonStationaryPlots)
    represent nonstationary time series. Now look at a fourth plot, as shown in [Figure 5-3](#StationaryPlots).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一个图中，我们可以清楚地看到均值随时间变化（增加），导致了上升趋势。因此，这是一个非平稳序列。要将序列分类为平稳序列，它不应该展示出趋势。转到第二个图，我们确实看不到序列中的趋势，但是序列的方差是时间的函数。平稳序列必须具有恒定的方差；因此，这个序列也是非平稳序列。在第三个图中，随着时间的增加，波动变得更接近，这意味着协方差是时间的函数。图 5-2 中显示的三个示例代表非平稳时间序列。现在看一下第四个图，如图 5-3 所示。
- en: '![mlbf 0503](Images/mlbf_0503.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0503](Images/mlbf_0503.png)'
- en: Figure 5-3\. Stationary plot
  id: totrans-53
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-3 。平稳图
- en: In this case, the mean, variance, and covariance are constant with time. This
    is what a stationary time series looks like. Predicting future values using this
    fourth plot would be easier. Most statistical models require the series to be
    stationary to make effective and precise predictions.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，均值、方差和协方差随时间保持不变。这就是平稳时间序列的样子。使用这个第四个图来预测未来值将更加容易。大多数统计模型要求序列是平稳的，才能进行有效和精确的预测。
- en: The two major reasons behind nonstationarity of a time series are trend and
    seasonality, as shown in [Figure 5-2](#NonStationaryPlots). In order to use time
    series forecasting models, we generally convert any nonstationary series to a
    stationary series, making it easier to model since statistical properties don’t
    change over time.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列的非平稳性主要由趋势和季节性导致，如图 5-2 所示。为了使用时间序列预测模型，通常将任何非平稳序列转换为平稳序列，这样更容易进行建模，因为统计属性随时间不变。
- en: Differencing
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 差分
- en: 'Differencing is one of the methods used to make a time series stationary. In
    this method, we compute the difference of consecutive terms in the series. Differencing
    is typically performed to get rid of the varying mean. Mathematically, differencing
    can be written as:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 差分是使时间序列平稳的方法之一。在这种方法中，我们计算序列中相邻项的差值。差分通常用于消除变化的均值。数学上，差分可以写成：
- en: <math><mrow><msubsup><mi>y</mi> <mi>t</mi> <mo>′</mo></msubsup> <mo>=</mo> <msub><mi>y</mi>
    <mi>t</mi></msub> <mo>–</mo> <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub></mrow></math>
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: <math><mrow><msubsup><mi>y</mi> <mi>t</mi> <mo>′</mo></msubsup> <mo>=</mo> <msub><mi>y</mi>
    <mi>t</mi></msub> <mo>–</mo> <msub><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub></mrow></math>
- en: where <math alttext="y Subscript t"><msub><mi>y</mi> <mi>t</mi></msub></math>
    is the value at a time *t*.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 <math alttext="y Subscript t"><msub><mi>y</mi> <mi>t</mi></msub></math> 是时间
    *t* 的值。
- en: When the differenced series is white noise, the original series is referred
    to as a nonstationary series of degree one.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 当差分后的序列为白噪声时，原始序列被称为一阶非平稳序列。
- en: Traditional Time Series Models (Including the ARIMA Model)
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 传统时间序列模型（包括ARIMA模型）
- en: There are many ways to model a time series in order to make predictions. Most
    of the time series models aim at incorporating the trend, seasonality, and remainder
    components while addressing the autocorrelation and stationarity embedded in the
    time series. For example, the autoregressive (AR) model discussed in the previous
    section addresses the autocorrelation in the time series.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多方法可以对时间序列建模以进行预测。大多数时间序列模型旨在同时考虑趋势、季节性和残差分量，并解决嵌入在时间序列中的自相关性和平稳性问题。例如，在前一节讨论的自回归（AR）模型中，解决了时间序列中的自相关性问题。
- en: One of the most widely used models in time series forecasting is the ARIMA model.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列预测中最广泛使用的模型之一是ARIMA模型。
- en: ARIMA
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ARIMA
- en: 'If we combine stationarity with autoregression and a moving average model (discussed
    further on in this section), we obtain an ARIMA model. *ARIMA* is an acronym for
    AutoRegressive Integrated Moving Average, and it has the following components:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将平稳性与自回归和移动平均模型结合起来（本节进一步讨论），我们就得到了ARIMA模型。*ARIMA* 是自回归积分移动平均的缩写，具有以下组成部分：
- en: AR(p)
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: AR(p)
- en: It represents autoregression, i.e., regression of the time series onto itself,
    as discussed in the previous section, with an assumption that current series values
    depend on its previous values with some lag (or several lags). The maximum lag
    in the model is referred to as *p*.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 它表示自回归，即将时间序列回归到自身，正如前一节中讨论的那样，假设当前系列值取决于其前几个值（或多个滞后）。模型中的最大滞后被称为*p*。
- en: I(d)
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: I(d)
- en: It represents order of integration. It is simply the number of differences needed
    to make the series stationary.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 它表示积分的阶数。它简单地是使系列平稳所需的差分次数。
- en: MA(q)
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: MA(q)
- en: It represents moving average. Without going into detail, it models the error
    of the time series; again, the assumption is that current error depends on the
    previous with some lag, which is referred to as *q*.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 它表示移动平均。不详细讨论，它对时间序列的误差进行建模；再次假设当前误差取决于以前的误差和一些滞后，这称为*q*。
- en: 'The moving average equation is written as:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 移动平均方程的写法如下：
- en: <math display="block"><mrow><msub><mi>y</mi> <mi>t</mi></msub> <mo>=</mo> <mi>c</mi>
    <mo>+</mo> <msub><mi>ϵ</mi> <mi>t</mi></msub> <mo>+</mo> <msub><mi>θ</mi> <mn>1</mn></msub>
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub> <mo>+</mo>
    <msub><mi>θ</mi> <mn>2</mn></msub> <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>–</mo><mn>2</mn></mrow></msub></mrow></math>
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="block"><mrow><msub><mi>y</mi> <mi>t</mi></msub> <mo>=</mo> <mi>c</mi>
    <mo>+</mo> <msub><mi>ϵ</mi> <mi>t</mi></msub> <mo>+</mo> <msub><mi>θ</mi> <mn>1</mn></msub>
    <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub> <mo>+</mo>
    <msub><mi>θ</mi> <mn>2</mn></msub> <msub><mi>ϵ</mi> <mrow><mi>t</mi><mo>–</mo><mn>2</mn></mrow></msub></mrow></math>
- en: where, <math alttext="epsilon Subscript t"><msub><mi>ϵ</mi> <mi>t</mi></msub></math>
    is white noise. We refer to this as an *MA(q)* model of order *q*.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，<math alttext="epsilon Subscript t"><msub><mi>ϵ</mi> <mi>t</mi></msub></math>是白噪声。我们将其称为*MA(q)*阶数为*q*的模型。
- en: 'Combining all the components, the full ARIMA model can be written as:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 结合所有组件，完整的ARIMA模型可以写成：
- en: <math display="block"><mrow><msubsup><mi>y</mi> <mi>t</mi> <mo>′</mo></msubsup>
    <mo>=</mo> <mi>c</mi> <mo>+</mo> <msub><mi>ϕ</mi> <mn>1</mn></msub> <msubsup><mi>y</mi>
    <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow> <mo>′</mo></msubsup> <mo>+</mo> <mo>⋯</mo>
    <mo>+</mo> <msub><mi>ϕ</mi> <mi>p</mi></msub> <msubsup><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mi>p</mi></mrow>
    <mo>′</mo></msubsup> <mo>+</mo> <msub><mi>θ</mi> <mn>1</mn></msub> <msub><mi>ε</mi>
    <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub> <mo>+</mo> <mo>⋯</mo> <mo>+</mo>
    <msub><mi>θ</mi> <mi>q</mi></msub> <msub><mi>ε</mi> <mrow><mi>t</mi><mo>–</mo><mi>q</mi></mrow></msub>
    <mo>+</mo> <msub><mi>ε</mi> <mi>t</mi></msub></mrow></math>
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="block"><mrow><msubsup><mi>y</mi> <mi>t</mi> <mo>′</mo></msubsup>
    <mo>=</mo> <mi>c</mi> <mo>+</mo> <msub><mi>ϕ</mi> <mn>1</mn></msub> <msubsup><mi>y</mi>
    <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow> <mo>′</mo></msubsup> <mo>+</mo> <mo>⋯</mo>
    <mo>+</mo> <msub><mi>ϕ</mi> <mi>p</mi></msub> <msubsup><mi>y</mi> <mrow><mi>t</mi><mo>–</mo><mi>p</mi></mrow>
    <mo>′</mo></msubsup> <mo>+</mo> <msub><mi>θ</mi> <mn>1</mn></msub> <msub><mi>ε</mi>
    <mrow><mi>t</mi><mo>–</mo><mn>1</mn></mrow></msub> <mo>+</mo> <mo>⋯</mo> <mo>+</mo>
    <msub><mi>θ</mi> <mi>q</mi></msub> <msub><mi>ε</mi> <mrow><mi>t</mi><mo>–</mo><mi>q</mi></mrow></msub>
    <mo>+</mo> <msub><mi>ε</mi> <mi>t</mi></msub></mrow></math>
- en: where <math alttext="y prime Subscript t"><msubsup><mi>y</mi> <mi>t</mi> <mo>'</mo></msubsup></math>
    is the differenced series (it may have been differenced more than once). The predictors
    on the right-hand side include both lagged values of <math alttext="y prime Subscript
    t"><msubsup><mi>y</mi> <mi>t</mi> <mo>'</mo></msubsup></math> and lagged errors.
    We call this an ARIMA(*p,d,q*) model, where *p* is the order of the autoregressive
    part, *d* is the degree of first differencing involved, and *q* is the order of
    the moving average part. The same stationarity and invertibility conditions that
    are used for autoregressive and moving average models also apply to an ARIMA model.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 其中<math alttext="y prime Subscript t"><msubsup><mi>y</mi> <mi>t</mi> <mo>'</mo></msubsup></math>是差分后的系列（可能进行了多次差分）。右侧的预测变量包括<math
    alttext="y prime Subscript t"><msubsup><mi>y</mi> <mi>t</mi> <mo>'</mo></msubsup></math>的滞后值和滞后误差。我们称之为ARIMA(*p,d,q*)模型，其中*p*是自回归部分的阶数，*d*是涉及的第一阶差分的程度，*q*是移动平均部分的阶数。用于自回归和移动平均模型的同样平稳性和可逆性条件也适用于ARIMA模型。
- en: 'The Python code to fit the ARIMA model of the order (1,0,0) is shown in the
    following:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 拟合ARIMA模型（1,0,0）的Python代码如下所示：
- en: '[PRE1]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The family of ARIMA models has several variants, and some of them are as follows:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: ARIMA模型有几个变体，其中一些如下：
- en: ARIMAX
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: ARIMAX
- en: ARIMA models with exogenous variables included. We will be using this model
    in case study 1.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 包括外生变量的ARIMA模型。我们将在案例研究1中使用这个模型。
- en: SARIMA
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: SARIMA
- en: “S” in this model stands for seasonal, and this model is targeted at modeling
    the seasonality component embedded in the time series, along with other components.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: “S”在这个模型中代表季节性，这个模型旨在对时间序列中嵌入的季节性组件进行建模，以及其他组件。
- en: VARMA
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: VARMA
- en: 'This is the extension of the model to multivariate case, when there are many
    variables to be predicted simultaneously. We predict many variables simultaneously
    in [“Case Study 4: Yield Curve Prediction”](#CaseStudy4SR).'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '这是将模型扩展到多元情况的方法，当有许多变量同时预测时，我们可以同时预测多个变量在[“案例研究4: 收益率曲线预测”](#CaseStudy4SR)中进行预测。'
- en: Deep Learning Approach to Time Series Modeling
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间序列建模的深度学习方法
- en: The traditional time series models such as ARIMA are well understood and effective
    on many problems. However, these traditional methods also suffer from several
    limitations. Traditional time series models are linear functions, or simple transformations
    of linear functions, and they require manually diagnosed parameters, such as time
    dependence, and don’t perform well with corrupt or missing data.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 传统的时间序列模型如ARIMA在许多问题上都被充分理解和有效。然而，这些传统方法也存在一些局限性。传统的时间序列模型是线性函数，或线性函数的简单变换，并且需要手动诊断参数，如时间依赖性，并且在数据损坏或缺失时表现不佳。
- en: If we look at the advancements in the field of deep learning for time series
    prediction, we see that *recurrent neural network* (RNN) has gained increasing
    attention in recent years. These methods can identify structure and patterns such
    as nonlinearity, can seamlessly model problems with multiple input variables,
    and are relatively robust to missing data. The RNN models can retain state from
    one iteration to the next by using their own output as input for the next step.
    These deep learning models can be referred to as time series models, as they can
    make future predictions using the data points in the past, similar to traditional
    time series models such as ARIMA. Therefore, there are a wide range of applications
    in finance where these deep learning models can be leveraged. Let us look at the
    deep learning models for time series forecasting.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们看一下时间序列预测领域的进展，我们会发现*循环神经网络*（RNN）近年来引起了越来越多的关注。这些方法可以识别结构和模式，如非线性，可以无缝地建模具有多个输入变量的问题，并且对缺失数据相对健壮。RNN模型可以通过使用它们自己的输出作为下一步的输入来保留一次迭代到下一次迭代的状态。这些深度学习模型可以被称为时间序列模型，因为它们可以使用过去的数据点进行未来预测，类似于传统的时间序列模型，如ARIMA。因此，在金融领域有广泛的应用，可以利用这些深度学习模型。让我们来看一下时间序列预测的深度学习模型。
- en: RNNs
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: RNNs
- en: Recurrent neural networks (RNNs) are called “recurrent” because they perform
    the same task for every element of a sequence, with the output being dependent
    on the previous computations. RNN models have a memory, which captures information
    about what has been calculated so far. As shown in [Figure 5-4](#RNN), a recurrent
    neural network can be thought of as multiple copies of the same network, each
    passing a message to a successor.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 循环神经网络（RNN）之所以被称为“循环”，是因为它们对序列中的每个元素执行相同的任务，输出取决于先前的计算。RNN模型具有一种记忆，它捕获了迄今为止计算的信息。正如在[图5-4](#RNN)中所示，循环神经网络可以被视为同一网络的多个副本，每个副本将消息传递给后续副本。
- en: '![mlbf 0504](Images/mlbf_0504.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0504](Images/mlbf_0504.png)'
- en: Figure 5-4\. Recurrent Neural Network
  id: totrans-93
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图5-4. 循环神经网络
- en: 'In [Figure 5-4](#RNN):'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图5-4](#RNN)中：
- en: '*X[t]* is the input at time step *t*.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*X[t]*是时间步*t*的输入。'
- en: '*O[t]* is the output at time step *t*.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*O[t]*是时间步*t*的输出。'
- en: '*S[t]* is the hidden state at time step *t*. It’s the memory of the network.
    It is calculated based on the previous hidden state and the input at the current
    step.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*S[t]*是时间步*t*的隐藏状态。它是网络的记忆。它是基于先前的隐藏状态和当前步骤的输入计算的。'
- en: The main feature of an RNN is this hidden state, which captures some information
    about a sequence and uses it accordingly whenever needed.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: RNN的主要特征是隐藏状态，它捕捉了序列的某些信息，并在需要时相应地使用它。
- en: Long short-term memory
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 长短期记忆网络
- en: '*Long short-term memory* (LSTM) is a special kind of RNN explicitly designed
    to avoid the long-term dependency problem. Remembering information for long periods
    of time is practically default behavior for an LSTM model.^([6](ch05.xhtml#idm45174931138088))
    These models are composed of a set of cells with features to memorize the sequence
    of data. These cells capture and store the data streams. Further, the cells interconnect
    one module of the past to another module of the present to convey information
    from several past time instants to the present one. Due to the use of gates in
    each cell, data in each cell can be disposed, filtered, or added for the next
    cells.'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '*长短期记忆*（LSTM）是一种专门设计的RNN，旨在避免长期依赖问题。长时间记忆信息对于LSTM模型来说几乎是默认行为。[^6] 这些模型由一组具有记忆数据序列特征的单元组成。这些单元捕获并存储数据流。此外，单元将过去的一个模块与当前一个模块相互连接，将信息从多个过去时间瞬间传递到当前时间瞬间。由于每个单元中使用了门控，每个单元中的数据可以被处理、过滤或添加到下一个单元中。'
- en: 'The *gates*, based on artificial neural network layers, enable the cells to
    optionally let data pass through or be disposed. Each layer yields numbers in
    the range of zero to one, depicting the amount of every segment of data that ought
    to be let through in each cell. More precisely, an estimation of zero value implies
    “let nothing pass through.” An estimation of one indicates “let everything pass
    through.” Three types of gates are involved in each LSTM, with the goal of controlling
    the state of each cell:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 基于人工神经网络层的*门*使单元能够选择性地通过或丢弃数据。每个层产生的数字范围从零到一，描述了每个数据段在每个单元中应该通过的数量。更确切地说，估计零值表示“不要让任何东西通过”。估计为一表示“让所有东西通过”。每个LSTM中涉及三种类型的门，旨在控制每个单元的状态：
- en: Forget Gate
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 遗忘门
- en: Outputs a number between zero and one, where one shows “completely keep this”
    and zero implies “completely ignore this.” This gate conditionally decides whether
    the past should be forgotten or preserved.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 输出介于零和一之间的数字，其中一表示“完全保留此内容”，零表示“完全忽略此内容”。该门有条件地决定过去是应该被遗忘还是保留。
- en: Input Gate
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 输入门
- en: Chooses which new data needs to be stored in the cell.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 选择需要存储在单元格中的新数据。
- en: Output Gate
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 输出门
- en: Decides what will yield out of each cell. The yielded value will be based on
    the cell state along with the filtered and newly added data.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 决定每个单元格将产生什么值。产生的值将基于单元格状态以及过滤和新添加的数据。
- en: Keras wraps the efficient numerical computation libraries and functions and
    allows us to define and train LSTM neural network models in a few short lines
    of code. In the following code, LSTM module from `keras.layers` is used for implementing
    LSTM network. The network is trained with the variable `X_train_LSTM`. The network
    has a hidden layer with 50 LSTM blocks or neurons and an output layer that makes
    a single value prediction. Also refer to [Chapter 3](ch03.xhtml#Chapter3) for
    a more detailed description of all the terms (i.e., sequential, learning rate,
    momentum, epoch, and batch size).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: Keras 封装了高效的数值计算库和函数，并允许我们用几行简短的代码定义和训练 LSTM 神经网络模型。在下面的代码中，使用 `keras.layers`
    中的 LSTM 模块来实现 LSTM 网络。网络使用变量 `X_train_LSTM` 进行训练。网络有一个包含 50 个 LSTM 块或神经元的隐藏层和一个输出层，用于进行单个值的预测。还可以参考[第
    3 章](ch03.xhtml#Chapter3)以获取对所有术语（即，sequential、learning rate、momentum、epoch 和
    batch size）的更详细描述。
- en: 'A sample Python code for implementing an LSTM model in Keras is shown below:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Keras 中实现 LSTM 模型的示例 Python 代码如下所示：
- en: '[PRE2]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: In terms of both learning and implementation, LSTM provides considerably more
    options for fine-tuning compared to ARIMA models. Although deep learning models
    have several advantages over traditional time series models, deep learning models
    are more complicated and difficult to train.^([7](ch05.xhtml#idm45174931122968))
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 就学习和实现而言，与 ARIMA 模型相比，LSTM 在微调方面提供了更多选择。尽管深度学习模型比传统时间序列模型有几个优点，但深度学习模型更复杂，训练起来更困难。^([7](ch05.xhtml#idm45174931122968))
- en: Modifying Time Series Data for Supervised Learning Models
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修改时间序列数据以用于监督学习模型
- en: A time series is a sequence of numbers that are ordered by a time index. Supervised
    learning is where we have input variables (*X*) and an output variable (*Y*).
    Given a sequence of numbers for a time series dataset, we can restructure the
    data into a set of predictor and predicted variables, just like in a supervised
    learning problem. We can do this by using previous time steps as input variables
    and using the next time step as the output variable. Let’s make this concrete
    with an example.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 时间序列是按时间索引排序的一系列数字。监督学习是指我们有输入变量（*X*）和一个输出变量（*Y*）。给定一个时间序列数据集的数字序列，我们可以将数据重构为一组预测变量和被预测变量，就像在监督学习问题中一样。我们可以通过使用先前的时间步作为输入变量，并使用下一个时间步作为输出变量来实现这一点。让我们通过一个例子来具体说明。
- en: We can restructure a time series shown in the left table in [Figure 5-5](#Ts2SL)
    as a supervised learning problem by using the value at the previous time step
    to predict the value at the next time step. Once we’ve reorganized the time series
    dataset this way, the data would look like the table on the right.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过使用上一个时间步的值来预测下一个时间步的值，将左表中显示的时间序列重组为一个监督学习问题。一旦我们以这种方式重新组织了时间序列数据集，数据将看起来像右边的表格。
- en: '![mlbf 0505](Images/mlbf_0505.png)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0505](Images/mlbf_0505.png)'
- en: Figure 5-5\. Modifying time series for supervised learning models
  id: totrans-116
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-5。修改时间序列以用于监督学习模型
- en: We can see that the previous time step is the input (*X*) and the next time
    step is the output (*Y*) in our supervised learning problem. The order between
    the observations is preserved and must continue to be preserved when using this
    dataset to train a supervised model. We will delete the first and last row while
    training our supervised model as we don’t have values for either *X* or *Y*.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，在我们的监督学习问题中，上一个时间步是输入（*X*），下一个时间步是输出（*Y*）。观察之间的顺序被保留，当使用这个数据集来训练一个监督模型时，必须继续保留这种顺序。在训练我们的监督模型时，我们将删除第一行和最后一行，因为我们既没有
    *X* 的值，也没有 *Y* 的值。
- en: In Python, the main function to help transform time series data into a supervised
    learning problem is the `shift()` function from the Pandas library. We will demonstrate
    this approach in the case studies. The use of prior time steps to predict the
    next time step is called the *sliding window*, *time delay*, or *lag* method.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在Python中，帮助将时间序列数据转换为监督学习问题的主要函数是来自Pandas库的`shift()`函数。我们将在案例研究中演示这种方法。使用先前时间步来预测下一个时间步称为*滑动窗口*、*时间延迟*或*滞后*方法。
- en: Having discussed all the concepts of supervised learning and time series models,
    let us move to the case studies.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论了监督学习和时间序列模型的所有概念后，让我们转向案例研究。
- en: 'Case Study 1: Stock Price Prediction'
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 案例研究1：股票价格预测
- en: One of the biggest challenges in finance is predicting stock prices. However,
    with the onset of recent advancements in machine learning applications, the field
    has been evolving to utilize nondeterministic solutions that learn what is going
    on in order to make more accurate predictions. Machine learning techniques naturally
    lend themselves to stock price prediction based on historical data. Predictions
    can be made for a single time point ahead or for a set of future time points.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 金融领域面临的最大挑战之一是预测股票价格。然而，随着最近机器学习应用的进展，这个领域已经在利用非确定性解决方案来学习当前情况，以做出更准确的预测。基于历史数据，机器学习技术自然而然地适用于股票价格预测。可以对单个时间点或未来一系列时间点进行预测。
- en: 'As a high-level overview, other than the historical price of the stock itself,
    the features that are generally useful for stock price prediction are as follows:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 作为高级概述，除了股票本身的历史价格外，通常用于股票价格预测的特征如下：
- en: Correlated assets
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 相关资产
- en: An organization depends on and interacts with many external factors, including
    its competitors, clients, the global economy, the geopolitical situation, fiscal
    and monetary policies, access to capital, and so on. Hence, its stock price may
    be correlated not only with the stock price of other companies but also with other
    assets such as commodities, FX, broad-based indices, or even fixed income securities.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 一个组织依赖并与许多外部因素互动，包括其竞争对手、客户、全球经济、地缘政治局势、财政和货币政策、资本获取等等。因此，其股票价格可能与其他公司的股票价格以及商品、外汇、广泛的指数甚至固定收益证券等其他资产相关。
- en: Technical indicators
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 技术指标
- en: A lot of investors follow technical indicators. Moving average, exponential
    moving average, and momentum are the most popular indicators.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 许多投资者关注技术指标。移动平均线、指数移动平均线和动量是最流行的指标。
- en: Fundamental analysis
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 基本分析
- en: 'Two primary data sources to glean features that can be used in fundamental
    analysis include:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 用于基本分析的两个主要数据源包括：
- en: Performance reports
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 绩效报告
- en: Annual and quarterly reports of companies can be used to extract or determine
    key metrics, such as ROE (Return on Equity) and P/E (Price-to-Earnings).
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 公司的年度和季度报告可用于提取或确定关键指标，如ROE（净资产收益率）和P/E（市盈率）。
- en: News
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 新闻
- en: News can indicate upcoming events that can potentially move the stock price
    in a certain direction.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 新闻可以指示即将发生的事件，这些事件有可能在某个方向上推动股票价格。
- en: In this case study, we will use various supervised learning–based models to
    predict the stock price of Microsoft using correlated assets and its own historical
    data. By the end of this case study, readers will be familiar with a general machine
    learning approach to stock prediction modeling, from gathering and cleaning data
    to building and tuning different models.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个案例研究中，我们将使用各种基于监督学习的模型来预测微软的股票价格，利用相关资产及其自身的历史数据。到案例研究结束时，读者将熟悉股票预测建模的一般机器学习方法，从数据收集和清洗到构建和调整不同的模型。
- en: '![](Images/bracket_top.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_top.png)'
- en: Blueprint for Using Supervised Learning Models to Predict a Stock Price
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用监督学习模型预测股票价格的蓝图
- en: 1\. Problem definition
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1\. 问题定义
- en: In the supervised regression framework used for this case study, the weekly
    return of Microsoft stock is the predicted variable. We need to understand what
    affects Microsoft stock price and incorporate as much information into the model.
    Out of correlated assets, technical indicators, and fundamental analysis (discussed
    in the section before), we will focus on correlated assets as features in this
    case study.^([8](ch05.xhtml#idm45174930951640))
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在本案例研究中使用的监督回归框架中，微软股票的每周回报是预测变量。我们需要理解什么影响微软股票价格，并将尽可能多的信息纳入模型中。在相关资产、技术指标和基本分析（在前面的部分中讨论）中，我们将专注于相关资产作为本案例研究中的特征。
- en: 'For this case study, other than the historical data of Microsoft, the independent
    variables used are the following potentially correlated assets:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 除了微软的历史数据外，本案例研究使用的独立变量包括以下潜在相关资产：
- en: Stocks
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 股票
- en: IBM (IBM) and Alphabet (GOOGL)
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: IBM (IBM) 和 Alphabet (GOOGL)
- en: Currency^([9](ch05.xhtml#idm45174930944792))
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 货币^([9](ch05.xhtml#idm45174930944792))
- en: USD/JPY and GBP/USD
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: USD/JPY 和 GBP/USD
- en: Indices
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 索引
- en: S&P 500, Dow Jones, and VIX
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 标准普尔500、道琼斯和VIX
- en: The dataset used for this case study is extracted from Yahoo Finance and [the
    FRED website](https://fred.stlouisfed.org). In addition to predicting the stock
    price accurately, this case study will also demonstrate the infrastructure and
    framework for each step of time series and supervised regression–based modeling
    for stock price prediction. We will use the daily closing price of the last 10
    years, from 2010 onward.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 用于本案例研究的数据集来自Yahoo Finance和[FRED网站](https://fred.stlouisfed.org)。除了准确预测股票价格外，本案例研究还将展示每一步时间序列和基于监督回归的股票价格预测建模的基础设施和框架。我们将使用自2010年以来最近10年的每日收盘价。
- en: 2\. Getting started—loading the data and Python packages
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2\. 开始——加载数据和Python包
- en: 2.1\. Loading the Python packages
  id: totrans-147
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.1\. 加载Python包
- en: The list of the libraries used for data loading, data analysis, data preparation,
    model evaluation, and model tuning are shown below. The packages used for different
    purposes have been segregated in the Python code that follows. The details of
    most of these packages and functions were provided in Chapters [2](ch02.xhtml#Chapter2)
    and [4](ch04.xhtml#Chapter4). The use of these packages will be demonstrated in
    different steps of the model development process.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 数据加载、数据分析、数据准备、模型评估和模型调优所使用的库列表如下所示。用于不同目的的包在接下来的Python代码中有所区分。这些包和函数的详细信息在第
    [2](ch02.xhtml#Chapter2) 章和第 [4](ch04.xhtml#Chapter4) 章中已经提供。这些包的使用将在模型开发过程的不同步骤中进行演示。
- en: '`Function and modules for the supervised regression models`'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '`监督回归模型的函数和模块`'
- en: '[PRE3]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '`Function and modules for data analysis and model evaluation`'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '`数据分析和模型评估的函数和模块`'
- en: '[PRE4]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '`Function and modules for deep learning models`'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '`深度学习模型的函数和模块`'
- en: '[PRE5]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '`Function and modules for time series models`'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '`时间序列模型的函数和模块`'
- en: '[PRE6]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '`Function and modules for data preparation and visualization`'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '`数据准备和可视化的函数和模块`'
- en: '[PRE7]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 2.2\. Loading the data
  id: totrans-159
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.2\. 加载数据
- en: One of the most important steps in machine learning and predictive modeling
    is gathering good data. The following steps demonstrate the loading of data from
    the Yahoo Finance and FRED websites using the Pandas `DataReader` function:^([10](ch05.xhtml#idm45174930595336))
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习和预测建模中最重要的步骤之一是收集好的数据。以下步骤演示了使用Pandas的`DataReader`函数从Yahoo Finance和FRED网站加载数据：
- en: '[PRE8]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Next, we define our dependent *(Y)* and independent *(X)* variables. The predicted
    variable is the weekly return of Microsoft (MSFT). The number of trading days
    in a week is assumed to be five, and we compute the return using five trading
    days. For independent variables we use the correlated assets and the historical
    return of MSFT at different frequencies.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们定义我们的因变量 *(Y)* 和独立变量 *(X)*。预测变量是微软（MSFT）的每周回报。一周的交易日数假定为五天，并使用五个交易日计算回报。作为独立变量，我们使用相关资产和不同频率下微软的历史回报。
- en: The variables used as independent variables are lagged five-day return of stocks
    (IBM and GOOG), currencies (USD/JPY and GBP/USD), and indices (S&P 500, Dow Jones,
    and VIX), along with lagged 5-day, 15-day, 30-day and 60-day return of MSFT.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 用作独立变量的变量是股票（IBM 和 GOOG）、货币（USD/JPY 和 GBP/USD）和指数（标准普尔500、道琼斯和VIX）的滞后五天回报，以及MSFT的滞后5天、15天、30天和60天回报。
- en: The lagged five-day variables embed the time series component by using a time-delay
    approach, where the lagged variable is included as one of the independent variables.
    This step is reframing the time series data into a supervised regression–based
    model framework.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 使用滞后五天变量通过时间延迟方法嵌入时间序列组件，其中滞后变量被包括为独立变量之一。这一步骤是将时间序列数据重构为基于监督回归的模型框架。
- en: '[PRE9]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 3\. Exploratory data analysis
  id: totrans-166
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 3\. 探索性数据分析
- en: We will look at descriptive statistics, data visualization, and time series
    analysis in this section.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将查看描述性统计、数据可视化和时间序列分析。
- en: 3.1\. Descriptive statistics
  id: totrans-168
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.1\. 描述性统计
- en: 'Let’s have a look at the dataset we have:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看我们拥有的数据集：
- en: '[PRE10]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '`Output`'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in01](Images/mlbf_05in01.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in01](Images/mlbf_05in01.png)'
- en: The variable MSFT_pred is the return of Microsoft stock and is the predicted
    variable. The dataset contains the lagged series of other correlated stocks, currencies,
    and indices. Additionally, it also consists of the lagged historical returns of
    MSFT.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 变量 MSFT_pred 是微软股票的回报并且是预测变量。数据集包含其他相关股票、货币和指数的滞后系列，以及 MSFT 的滞后历史回报。
- en: 3.2\. Data visualization
  id: totrans-174
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.2\. 数据可视化
- en: 'The fastest way to learn more about the data is to visualize it. The visualization
    involves independently understanding each attribute of the dataset. We will look
    at the scatterplot and the correlation matrix. These plots give us a sense of
    the interdependence of the data. Correlation can be calculated and displayed for
    each pair of the variables by creating a correlation matrix. Hence, besides the
    relationship between independent and dependent variables, it also shows the correlation
    among the independent variables. This is useful to know because some machine learning
    algorithms like linear and logistic regression can have poor performance if there
    are highly correlated input variables in the data:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 了解数据更多信息的最快方法是将其可视化。可视化涉及独立理解数据集的每个属性。我们将查看散点图和相关矩阵。这些图表让我们了解数据的相互依赖关系。通过创建相关矩阵，可以为每对变量计算和显示相关性。因此，除了独立和依赖变量之间的关系外，它还显示了数据中独立变量之间的相关性。了解这一点很有用，因为如果数据中存在高度相关的输入变量，一些机器学习算法如线性和逻辑回归的性能可能会较差：
- en: '[PRE11]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '`Output`'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in02](Images/mlbf_05in02.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in02](Images/mlbf_05in02.png)'
- en: Looking at the correlation plot (full-size version available on [GitHub](https://oreil.ly/g3wVU)),
    we see some correlation of the predicted variable with the lagged 5-day, 15-day,
    30-day, and 60-day returns of MSFT. Also, we see a higher negative correlation
    of many asset returns versus VIX, which is intuitive.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 查看相关性图（完整版可在 [GitHub](https://oreil.ly/g3wVU) 上查看），我们可以看到预测变量与 MSFT 滞后 5 天、15
    天、30 天和 60 天回报之间的某种相关性。此外，我们还看到许多资产回报与 VIX 的负相关性较高，这是直观的。
- en: 'Next, we can visualize the relationship between all the variables in the regression
    using the scatterplot matrix shown below:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们可以使用下面显示的散点图矩阵来可视化回归中所有变量之间的关系：
- en: '[PRE12]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '`Output`'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in03](Images/mlbf_05in03.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in03](Images/mlbf_05in03.png)'
- en: Looking at the scatterplot (full-size version available on [GitHub](https://oreil.ly/g3wVU)),
    we see some linear relationship of the predicted variable with the lagged 15-day,
    30-day, and 60-day returns of MSFT. Otherwise, we do not see any special relationship
    between our predicted variable and the features.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 查看散点图（完整版可在 [GitHub](https://oreil.ly/g3wVU) 上查看），我们可以看到预测变量与 MSFT 滞后 15 天、30
    天和 60 天回报之间的某种线性关系。否则，我们没有看到预测变量与特征之间的任何特殊关系。
- en: 3.3\. Time series analysis
  id: totrans-185
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.3\. 时间序列分析
- en: 'Next, we delve into the time series analysis and look at the decomposition
    of the time series of the predicted variable into trend and seasonality components:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们深入研究时间序列分析，并查看预测变量的时间序列分解为趋势和季节性组成部分：
- en: '[PRE13]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '`Output`'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in04](Images/mlbf_05in04.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in04](Images/mlbf_05in04.png)'
- en: We can see that for MSFT there has been a general upward trend in the return
    series. This may be due to the large run-up of MSFT in the recent years, causing
    more positive weekly return data points than negative.^([11](ch05.xhtml#idm45174929976312))
    The trend may show up in the constant/bias terms in our models. The residual (or
    white noise) term is relatively small over the entire time series.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，对于 MSFT，收益系列存在明显的上升趋势。这可能是由于 MSFT 近年来大幅上涨，导致正周回报数据点比负周回报数据点更多。^([11](ch05.xhtml#idm45174929976312))
    这种趋势可能在我们模型的常数/偏差项中显示出来。残差（或白噪声）项在整个时间序列中相对较小。
- en: 4\. Data preparation
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4\. 数据准备
- en: This step typically involves data processing, data cleaning, looking at feature
    importance, and performing feature reduction. The data obtained for this case
    study is relatively clean and doesn’t require further processing. Feature reduction
    might be useful here, but given the relatively small number of variables considered,
    we will keep all of them as is. We will demonstrate data preparation in some of
    the subsequent case studies in detail.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这一步通常涉及数据处理、数据清洗、查看特征重要性以及执行特征减少。这个案例研究中获取的数据相对清洁，不需要进一步处理。在这里，特征减少可能是有用的，但考虑到考虑的变量数量相对较少，我们将保留所有变量。我们将在一些后续的案例研究中详细演示数据准备。
- en: 5\. Evaluate models
  id: totrans-193
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5\. 评估模型
- en: 5.1\. Train-test split and evaluation metrics
  id: totrans-194
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.1\. 训练-测试分离和评估指标
- en: 'As described in [Chapter 2](ch02.xhtml#Chapter2), it is a good idea to partition
    the original dataset into a *training set* and a *test set*. The test set is a
    sample of the data that we hold back from our analysis and modeling. We use it
    right at the end of our project to confirm the performance of our final model.
    It is the final test that gives us confidence on our estimates of accuracy on
    unseen data. We will use 80% of the dataset for modeling and use 20% for testing.
    With time series data, the sequence of values is important. So we do not distribute
    the dataset into training and test sets in random fashion, but we select an arbitrary
    split point in the ordered list of observations and create two new datasets:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如[第二章](ch02.xhtml#Chapter2)所述，将原始数据集划分为*训练集*和*测试集*是一个好主意。测试集是我们在分析和建模过程中保留的数据样本。我们在项目的最后使用它来确认我们最终模型的性能。它是最终测试，为我们提供了对未见数据准确性估计的信心。我们将80%的数据集用于建模，将20%用于测试。对于时间序列数据，值的顺序是重要的。因此，我们不会随机分配数据集到训练集和测试集，而是选择在有序观察值列表中的任意拆分点，并创建两个新数据集：
- en: '[PRE14]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 5.2\. Test options and evaluation metrics
  id: totrans-197
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.2\. 测试选项和评估指标
- en: 'To optimize the various hyperparameters of the models, we use ten-fold cross
    validation (CV) and recalculate the results ten times to account for the inherent
    randomness in some of the models and the CV process. We will evaluate algorithms
    using the mean squared error metric. This metric gives an idea of the performance
    of the supervised regression models. All these concepts, including cross validation
    and evaluation metrics, have been described in [Chapter 4](ch04.xhtml#Chapter4):'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 为了优化模型的各种超参数，我们使用十折交叉验证（CV）并重新计算结果十次，以考虑部分模型和CV过程中的固有随机性。我们将使用均方误差度量来评估算法。这个度量给出了监督回归模型的性能的一个概念。所有这些概念，包括交叉验证和评估指标，都在[第四章](ch04.xhtml#Chapter4)中有描述：
- en: '[PRE15]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 5.3\. Compare models and algorithms
  id: totrans-200
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3\. 比较模型和算法
- en: Now that we have completed the data loading and designed the test harness, we
    need to choose a model.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了数据加载并设计了测试框架，我们需要选择一个模型。
- en: 5.3.1\. Machine learning models from Scikit-learn
  id: totrans-202
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.1\. 来自Scikit-learn的机器学习模型
- en: 'In this step, the supervised regression models are implemented using the sklearn
    package:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，使用sklearn包来实现监督回归模型：
- en: '`Regression and tree regression algorithms`'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '`回归和树回归算法`'
- en: '[PRE16]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '`Neural network algorithms`'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '`神经网络算法`'
- en: '[PRE17]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '`Ensemble models`'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '`集成模型`'
- en: '[PRE18]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Once we have selected all the models, we loop over each of them. First, we run
    the *k*-fold analysis. Next, we run the model on the entire training and testing
    dataset.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们选择了所有模型，我们就会对每个模型进行循环。首先，我们进行*k*次交叉验证分析。接下来，我们在整个训练和测试数据集上运行模型。
- en: 'All the algorithms use default tuning parameters. We will calculate the mean
    and standard deviation of the evaluation metric for each algorithm and collect
    the results for model comparison later:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 所有算法都使用默认调整参数。我们将计算每个算法的评估指标的平均值和标准差，并将结果收集起来以供后续模型比较使用：
- en: '[PRE19]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Let’s compare the algorithms by looking at the cross validation results:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过观察交叉验证结果来比较算法：
- en: '`Cross validation results`'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '`交叉验证结果`'
- en: '[PRE20]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '`Output`'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in05](Images/mlbf_05in05.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in05](Images/mlbf_05in05.png)'
- en: Although the results of a couple of the models look good, we see that the linear
    regression and the regularized regression including the lasso regression (LASSO)
    and elastic net (EN) seem to perform best. This indicates a strong linear relationship
    between the dependent and independent variables. Going back to the exploratory
    analysis, we saw a good correlation and linear relationship of the target variables
    with the different lagged MSFT variables.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管其中一些模型的结果看起来不错，我们看到线性回归和包括套索回归（LASSO）和弹性网络（EN）的正则化回归似乎表现最佳。这表明因变量和自变量之间存在强烈的线性关系。回到探索性分析，我们看到目标变量与不同滞后MSFT变量之间存在良好的相关性和线性关系。
- en: 'Let us look at the errors of the test set as well:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们也来看看测试集的误差：
- en: '`Training and test error`'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '`训练和测试误差`'
- en: '[PRE21]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '`Output`'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in06](Images/mlbf_05in06.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in06](Images/mlbf_05in06.png)'
- en: Examining the training and test error, we still see a stronger performance from
    the linear models. Some of the algorithms, such as the decision tree regressor
    (CART), overfit on the training data and produced very high error on the test
    set. Ensemble models such as gradient boosting regression (GBR) and random forest
    regression (RFR) have low bias but high variance. We also see that the artificial
    neural network algorithm (shown as MLP in the chart) shows higher errors in both
    the training and test sets. This is perhaps due to the linear relationship of
    the variables not captured accurately by ANN, improper hyperparameters, or insufficient
    training of the model. Our original intuition from the cross validation results
    and the scatterplots also seem to demonstrate a better performance of linear models.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 检查训练和测试误差，我们仍然看到线性模型表现更强。一些算法，如决策树回归器（CART），在训练数据上过拟合，并在测试集上产生非常高的误差。集成模型如梯度提升回归（GBR）和随机森林回归（RFR）具有低偏差但高方差。我们还看到人工神经网络算法（在图表中显示为MLP）在训练和测试集中显示出较高的误差。这可能是由于ANN未准确捕捉到变量之间的线性关系，超参数设置不正确或模型训练不足造成的。从交叉验证结果和散点图中，我们原始的直觉似乎也显示出线性模型的更好性能。
- en: We now look at some of the time series and deep learning models that can be
    used. Once we are done creating these, we will compare their performance against
    that of the supervised regression–based models. Due to the nature of time series
    models, we are not able to run a *k*-fold analysis. We can still compare our results
    to the other models based on the full training and testing results.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看一些可以使用的时间序列和深度学习模型。一旦我们创建了这些模型，我们将比较它们与基于监督回归的模型的性能。由于时间序列模型的性质，我们无法进行*k*-fold分析。尽管如此，我们仍然可以根据完整的训练和测试结果来比较我们的结果与其他模型的表现。
- en: '5.3.2\. Time series–based models: ARIMA and LSTM'
  id: totrans-226
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.3.2\. 时间序列模型：ARIMA和LSTM
- en: The models used so far already embed the time series component by using a time-delay
    approach, where the lagged variable is included as one of the independent variables.
    However, for the time series–based models we do not need the lagged variables
    of MSFT as the independent variables. Hence, as a first step we remove MSFT’s
    previous returns for these models. We use all other variables as the exogenous
    variables in these models.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止使用的模型已经通过使用时间延迟方法嵌入了时间序列组件，其中滞后变量被包括为一个独立变量之一。然而，对于基于时间序列的模型，我们不需要MSFT的滞后变量作为独立变量。因此，作为第一步，我们在这些模型中删除了MSFT的先前回报。我们将所有其他变量作为这些模型中的外生变量使用。
- en: 'Let us first prepare the dataset for ARIMA models by having only the correlated
    varriables as exogenous variables:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先通过只使用相关变量作为外生变量来为ARIMA模型准备数据集：
- en: '[PRE22]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'We now configure the ARIMA model with the order *(1,0,0)* and use the independent
    variables as the exogenous variables in the model. The version of the ARIMA model
    where the exogenous variables are also used is known as the *ARIMAX* model, where
    "*X*" represents exogenous variables:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们使用*(1,0,0)*的阶数配置ARIMA模型，并将独立变量作为模型中的外生变量。在这种使用外生变量的ARIMA模型版本中，被称为*ARIMAX*模型，其中"*X*"代表外生变量：
- en: '[PRE23]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Now we fit the ARIMA model:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们拟合ARIMA模型：
- en: '[PRE24]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '`Output`'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE25]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Error of this ARIMA model is reasonable.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 这个ARIMA模型的误差是合理的。
- en: Now let’s prepare the dataset for the LSTM model. We need the data in the form
    of arrays of all the input variables and the output variables.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们为LSTM模型准备数据集。我们需要将数据以所有输入变量和输出变量的数组形式准备好。
- en: 'The logic behind the LSTM is that data is taken from the previous day (the
    data of all the other features for that day—correlated assets and the lagged variables
    of MSFT) and we try to predict the next day. Then we move the one-day window with
    one day and again predict the next day. We iterate like this over the whole dataset
    (of course in batches). The code below will create a dataset in which *X* is the
    set of independent variables at a given time (*t*) and *Y* is the target variable
    at the next time (*t + 1*):'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: LSTM背后的逻辑是从前一天获取数据（当天的所有其他特征数据——相关资产和MSFT的滞后变量），然后试图预测下一天。然后我们将一天的窗口移动一天，并再次预测下一天。我们像这样在整个数据集上迭代（当然是以批次形式）。以下代码将创建一个数据集，其中*X*是给定时间(*t*)的自变量集合，*Y*是下一个时间(*t
    + 1*)的目标变量：
- en: '[PRE26]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'In the next step, we create the LSTM architecture. As we can see, the input
    of the LSTM is in `X_train_LSTM`, which goes into 50 hidden units in the LSTM
    layer and then is transformed to a single output—the stock return value. The hyperparameters
    (i.e., learning rate, optimizer, activation function, etc.) were discussed in
    [Chapter 3](ch03.xhtml#Chapter3) of the book:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建LSTM架构。正如我们所见，LSTM的输入为`X_train_LSTM`，进入LSTM层的50个隐藏单元，然后转换为单一输出——股票回报值。超参数（即学习率、优化器、激活函数等）详见书籍的[第3章](ch03.xhtml#Chapter3)：
- en: '[PRE27]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now we fit the LSTM model with the data and look at the change in the model
    performance metric over time simultaneously in the training set and the test set:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们用数据拟合LSTM模型，并同时查看训练集和测试集中模型性能指标的变化。
- en: '[PRE28]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '`Output`'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in07](Images/mlbf_05in07.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in07](Images/mlbf_05in07.png)'
- en: '[PRE29]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Now, in order to compare the time series and the deep learning models, we append
    the result of these models to the results of the supervised regression–based models:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了比较时间序列模型和深度学习模型，我们将这些模型的结果附加到基于监督回归的模型的结果中：
- en: '[PRE30]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '`Output`'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in08](Images/mlbf_05in08.png)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in08](Images/mlbf_05in08.png)'
- en: 'Looking at the chart, we find the time series–based ARIMA model comparable
    to the linear supervised regression models: linear regression (LR), lasso regression
    (LASSO), and elastic net (EN). This can primarily be due to the strong linear
    relationship as discussed before. The LSTM model performs decently; however, the
    ARIMA model outperforms the LSTM model in the test set. Hence, we select the ARIMA
    model for model tuning.'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 观察图表，我们发现基于时间序列的ARIMA模型与线性监督回归模型（如线性回归（LR）、套索回归（LASSO）和弹性网（EN））可相媲美。这主要是由于之前讨论过的强线性关系。LSTM模型表现良好；然而，在测试集中，ARIMA模型优于LSTM模型。因此，我们选择ARIMA模型进行模型调优。
- en: 6\. Model tuning and grid search
  id: totrans-252
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6\. 模型调优和网格搜索
- en: Let us perform the model tuning of the ARIMA model.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们进行ARIMA模型的模型调优。
- en: Model Tuning for the Supervised Learning or Time Series Models
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监督学习或时间序列模型的模型调优和网格搜索逻辑
- en: The detailed implementation of grid search for all the supervised learning–based
    models, along with the ARIMA and LSTM models, is provided in the Regression-Master
    template under the [GitHub repository for this book](https://oreil.ly/9S8h_).
    For the grid search of the ARIMA and LSTM models, refer to the “ARIMA and LSTM
    Grid Search” section of the Regression-Master template.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 关于所有基于监督学习模型的网格搜索详细实现，包括ARIMA和LSTM模型，在《Regression-Master》模板中的[GitHub存储库](https://oreil.ly/9S8h_)提供了信息。有关ARIMA和LSTM模型的网格搜索，请参考《Regression-Master》模板中的“ARIMA和LSTM网格搜索”部分。
- en: 'The ARIMA model is generally represented as ARIMA*(p,d,q)* model, where *p*
    is the order of the autoregressive part, *d* is the degree of first differencing
    involved, and *q* is the order of the moving average part. The order of the ARIMA
    model was set to *(1,0,0)*. So we perform a grid search with different *p*, *d*,
    and *q* combinations in the ARIMA model’s order and select the combination that
    minimizes the fitting error:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: ARIMA模型通常表示为ARIMA*(p,d,q)*模型，其中*p*为自回归部分的阶数，*d*为首次差分的程度，*q*为移动平均部分的阶数。ARIMA模型的阶数设置为*(1,0,0)*。因此，我们通过不同的*p*、*d*和*q*组合进行网格搜索，选择最小化拟合误差的组合：
- en: '[PRE31]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '`Output`'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE32]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: We see that the ARIMA model with the order *(2,0,1)* is the best performer out
    of all the combinations tested in the grid search, although there isn’t a significant
    difference in the mean squared error (MSE) with other combinations. This means
    that the model with the autoregressive lag of two and moving average of one yields
    the best result. We should not forget the fact that there are other exogenous
    variables in the model that influence the order of the best ARIMA model as well.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到，在网格搜索中测试的所有组合中，ARIMA模型的阶数为*(2,0,1)*时表现最佳，尽管与其他组合相比，均方误差（MSE）没有显著差异。这意味着具有自回归滞后两期和移动平均一期的模型能够产生最佳结果。我们不应忘记的是，模型中还有其他影响最佳ARIMA模型阶数的外生变量。
- en: 7\. Finalize the model
  id: totrans-261
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7\. 完成模型
- en: In the last step we will check the finalized model on the test set.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，我们将在测试集上检查最终的模型。
- en: 7.1\. Results on the test dataset
  id: totrans-263
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 7.1\. 测试数据集的结果
- en: '[PRE33]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '[PRE34]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '`Output`'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE35]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The MSE of the model on the test set looks good and is actually less than that
    of the training set.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 模型在测试集上的均方误差（MSE）看起来很好，实际上比训练集的要小。
- en: 'In the last step, we will visualize the output of the selected model and compare
    the modeled data against the actual data. In order to visualize the chart, we
    convert the return time series to a price time series. We also assume the price
    at the beginning of the test set as one for the sake of simplicity. Let us look
    at the plot of actual versus predicted data:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，我们将可视化所选模型的输出，并将建模数据与实际数据进行比较。为了可视化图表，我们将回报时间序列转换为价格时间序列。为了简化起见，我们假设测试集开始时的价格为一。让我们看一下实际数据与预测数据的图表：
- en: '[PRE36]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '![mlbf 05in09](Images/mlbf_05in09.png)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in09](Images/mlbf_05in09.png)'
- en: Looking at the chart, we clearly see the trend has been captured perfectly by
    the model. The predicted series is less volatile compared to the actual time series,
    and it aligns with the actual data for the first few months of the test set. A
    point to note is that the purpose of the model is to compute the next day’s return
    given the data observed up to the present day, and not to predict the stock price
    several days in the future given the current data. Hence, a deviation from the
    actual data is expected as we move away from the beginning of the test set. The
    model seems to perform well for the first few months, with deviation from the
    actual data increasing six to seven months after the beginning of the test set.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 从图表可以看出，模型完美地捕捉到了趋势。预测的系列波动性较实际时间序列较小，并且在测试集的前几个月与实际数据一致。需要注意的是，该模型的目的是根据截至当天观察到的数据计算第二天的回报，而不是根据当前数据预测未来数天的股票价格。因此，随着我们远离测试集开始时的时间点，预期会与实际数据有所偏差。该模型在开始后的几个月内表现良好，但在测试集开始后六到七个月，与实际数据的偏差逐渐增加。
- en: Conclusion
  id: totrans-273
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 结论
- en: We can conclude that simple models—linear regression, regularized regression
    (i.e., Lasso and elastic net)—along with the time series models, such as ARIMA,
    are promising modeling approaches for stock price prediction problems. This approach
    helps us deal with overfitting and underfitting, which are some of the key challenges
    in predicting problems in finance.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以得出结论，简单模型——如线性回归、正则化回归（即Lasso和弹性网络）——以及时间序列模型，例如ARIMA，是解决股票价格预测问题的有前途的建模方法。这种方法帮助我们应对在金融预测问题中的过拟合和欠拟合等一些关键挑战。
- en: We should also note that we can use a wider set of indicators, such as P/E ratio,
    trading volume, technical indicators, or news data, which might lead to better
    results. We will demonstrate this in some of the future case studies in the book.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还应该注意，我们可以使用更广泛的指标，如市盈率（P/E）、交易量、技术指标或新闻数据，这可能会带来更好的结果。我们将在本书的某些未来案例研究中演示这一点。
- en: Overall, we created a supervised-regression and time series modeling framework
    that allows us to perform stock price prediction using historical data. This framework
    generates results to analyze risk and profitability before risking any capital.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，我们创建了一个监督回归和时间序列建模框架，可以利用历史数据进行股票价格预测。这个框架在冒任何资本风险之前生成结果，以分析风险和盈利能力。
- en: '![](Images/bracket_bottom.png)'
  id: totrans-277
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_bottom.png)'
- en: 'Case Study 2: Derivative Pricing'
  id: totrans-278
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 案例研究2：衍生品定价
- en: In computational finance and risk management, several numerical methods (e.g.,
    finite differences, fourier methods, and Monte Carlo simulation) are commonly
    used for the valuation of financial derivatives.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 在计算金融和风险管理中，常用几种数值方法（例如有限差分、傅里叶方法和蒙特卡洛模拟）来估计金融衍生品的价值。
- en: The *Black-Scholes formula* is probably one of the most widely cited and used
    models in derivative pricing. Numerous variations and extensions of this formula
    are used to price many kinds of financial derivatives. However, the model is based
    on several assumptions. It assumes a specific form of movement for the derivative
    price, namely a *Geometric Brownian Motion* (GBM). It also assumes a conditional
    payment at maturity of the option and economic constraints, such as no-arbitrage.
    Several other derivative pricing models have similarly impractical model assumptions.
    Finance practitioners are well aware that these assumptions are violated in practice,
    and prices from these models are further adjusted using practitioner judgment.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '*布莱克-斯科尔斯公式* 可能是衍生品定价中被引用和使用最广泛的模型之一。该公式的许多变体和扩展被用来定价许多类型的金融衍生品。然而，该模型基于几个假设。它假设衍生品价格的特定运动形式，即*几何布朗运动*（GBM）。它还假设在期权到期时有条件支付和经济约束，例如无套利条件。几种其他衍生品定价模型也有类似不切实际的模型假设。金融从业者清楚这些假设在实践中是不符合的，因此从这些模型得出的价格会通过从业者的判断进一步调整。'
- en: Another aspect of the many traditional derivative pricing models is model calibration,
    which is typically done not by historical asset prices but by means of derivative
    prices (i.e., by matching the market prices of heavily traded options to the derivative
    prices from the mathematical model). In the process of model calibration, thousands
    of derivative prices need to be determined in order to fit the parameters of the
    model, and the overall process is time consuming. Efficient numerical computation
    is increasingly important in financial risk management, especially when we deal
    with real-time risk management (e.g., high frequency trading). However, due to
    the requirement of a highly efficient computation, certain high-quality asset
    models and methodologies are discarded during model calibration of traditional
    derivative pricing models.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 传统衍生品定价模型的另一个方面是模型校准，通常不是通过历史资产价格，而是通过衍生品价格（即通过将高交易量期权的市场价格与数学模型的衍生品价格进行匹配来进行）。在模型校准过程中，需要确定成千上万个衍生品价格以拟合模型的参数，整个过程非常耗时。在金融风险管理中，尤其是在处理实时风险管理（例如高频交易）时，高效的数值计算变得越来越重要。然而，由于需要高效的计算，某些高质量的资产模型和方法在传统衍生品定价模型的模型校准过程中被舍弃。
- en: Machine learning can potentially be used to tackle these drawbacks related to
    impractical model assumptions and inefficient model calibration. Machine learning
    algorithms have the ability to tackle more nuances with very few theoretical assumptions
    and can be effectively used for derivative pricing, even in a world with frictions.
    With the advancements in hardware, we can train machine learning models on high
    performance CPUs, GPUs, and other specialized hardware to achieve a speed increase
    of several orders of magnitude as compared to the traditional derivative pricing
    models.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习有望解决与不切实际的模型假设和低效的模型校准相关的这些缺点。机器学习算法具有在几乎没有理论假设的情况下处理更多微妙细节的能力，并且可以在包括摩擦力的世界中有效地用于衍生品定价。随着硬件的进步，我们可以在高性能CPU、GPU和其他专用硬件上训练机器学习模型，实现与传统衍生品定价模型相比几个数量级的速度提升。
- en: Additionally, market data is plentiful, so it is possible to train a machine
    learning algorithm to learn the function that is collectively generating derivative
    prices in the market. Machine learning models can capture subtle nonlinearities
    in the data that are not obtainable through other statistical approaches.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，市场数据丰富，因此可以训练机器学习算法来学习市场中生成衍生品价格的集体功能。机器学习模型能够捕捉数据中不可通过其他统计方法获取的微妙非线性关系。
- en: In this case study, we look at derivative pricing from a machine learning standpoint
    and use a supervised regression–based model to price an option from simulated
    data. The main idea here is to come up with a machine learning framework for derivative
    pricing. Achieving a machine learning model with high accuracy would mean that
    we can leverage the efficient numerical calculation of machine learning for derivative
    pricing with fewer underlying model assumptions.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个案例研究中，我们从机器学习的角度来看待衍生品定价，并使用基于监督回归的模型来从模拟数据中定价期权。这里的主要思想是建立一个用于衍生品定价的机器学习框架。实现高精度的机器学习模型意味着我们可以利用机器学习的高效数值计算来进行衍生品定价，减少底层模型假设。
- en: '![](Images/bracket_top.png)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_top.png)'
- en: Blueprint for Developing a Machine Learning Model for Derivative Pricing
  id: totrans-286
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 衍生品定价机器学习模型开发蓝图
- en: 1\. Problem definition
  id: totrans-287
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1\. 问题定义
- en: In the supervised regression framework we used for this case study, the predicted
    variable is the price of the option, and the predictor variables are the market
    data used as inputs to the Black-Scholes option pricing model.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们用于这个案例研究的监督回归框架中，预测变量是期权的价格，预测变量是作为输入用于布莱克-肖尔斯期权定价模型的市场数据。
- en: The variables selected to estimate the market price of the option are stock
    price, strike price, time to expiration, volatility, interest rate, and dividend
    yield. The predicted variable for this case study was generated using random inputs
    and feeding them into the well-known Black-Scholes model.^([12](ch05.xhtml#idm45174927997912))
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 选择用于估计期权市场价格的变量包括股票价格、行权价格、到期时间、波动率、利率和股息收益率。本案例研究的预测变量是使用随机输入生成，并将其输入到众所周知的布莱克-肖尔斯模型中得出的。
- en: The price of a call option per the Black-Scholes option pricing model is defined
    in [Equation 5-1](#BSEq).
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 根据布莱克-肖尔斯期权定价模型，看涨期权的价格被定义为[方程5-1](#BSEq)。
- en: Equation 5-1\. Black-Scholes equation for call option
  id: totrans-291
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 方程5-1\. 看涨期权的布莱克-肖尔斯方程
- en: <math display="block"><mrow><mi>S</mi> <msup><mi>e</mi> <mrow><mo>–</mo><mi>q</mi><mi>τ</mi></mrow></msup>
    <mi>Φ</mi> <mrow><mo>(</mo> <msub><mi>d</mi> <mn>1</mn></msub> <mo>)</mo></mrow>
    <mo>–</mo> <msup><mi>e</mi> <mrow><mo>–</mo><mi>r</mi><mi>τ</mi></mrow></msup>
    <mi>K</mi> <mi>Φ</mi> <mrow><mo>(</mo> <msub><mi>d</mi> <mn>2</mn></msub> <mo>)</mo></mrow></mrow></math>
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="block"><mrow><mi>S</mi> <msup><mi>e</mi> <mrow><mo>–</mo><mi>q</mi><mi>τ</mi></mrow></msup>
    <mi>Φ</mi> <mrow><mo>(</mo> <msub><mi>d</mi> <mn>1</mn></msub> <mo>)</mo></mrow>
    <mo>–</mo> <msup><mi>e</mi> <mrow><mo>–</mo><mi>r</mi><mi>τ</mi></mrow></msup>
    <mi>K</mi> <mi>Φ</mi> <mrow><mo>(</mo> <msub><mi>d</mi> <mn>2</mn></msub> <mo>)</mo></mrow></mrow></math>
- en: with
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 具体到
- en: <math display="inline"><mrow><msub><mi>d</mi> <mn>1</mn></msub> <mo>=</mo> <mfrac><mrow><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>S</mi><mo>/</mo><mi>K</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>–</mo><mi>q</mi><mo>+</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac></mrow></math>
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="inline"><mrow><msub><mi>d</mi> <mn>1</mn></msub> <mo>=</mo> <mfrac><mrow><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>S</mi><mo>/</mo><mi>K</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>–</mo><mi>q</mi><mo>+</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac></mrow></math>
- en: and
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 和
- en: <math display="inline"><mrow><msub><mi>d</mi> <mn>2</mn></msub> <mo>=</mo> <mfrac><mrow><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>S</mi><mo>/</mo><mi>K</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>–</mo><mi>q</mi><mo>–</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac>
    <mo>=</mo> <msub><mi>d</mi> <mn>1</mn></msub> <mo>–</mo> <mi>σ</mi> <msqrt><mi>τ</mi></msqrt></mrow></math>
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="inline"><mrow><msub><mi>d</mi> <mn>2</mn></msub> <mo>=</mo> <mfrac><mrow><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>S</mi><mo>/</mo><mi>K</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>–</mo><mi>q</mi><mo>–</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac>
    <mo>=</mo> <msub><mi>d</mi> <mn>1</mn></msub> <mo>–</mo> <mi>σ</mi> <msqrt><mi>τ</mi></msqrt></mrow></math>
- en: where we have stock price <math alttext="upper S"><mi>S</mi></math> ; strike
    price <math alttext="upper K"><mi>K</mi></math> ; risk-free rate <math alttext="r"><mi>r</mi></math>
    ; annual dividend yield <math alttext="q"><mi>q</mi></math> ; time to maturity
    <math display="inline"><mrow><mi>τ</mi> <mo>=</mo> <mi>T</mi> <mo>–</mo> <mi>t</mi></mrow></math>
    (represented as a unitless fraction of one year); and volatility <math alttext="sigma"><mi>σ</mi></math>
    .
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 其中我们有股票价格<math alttext="upper S"><mi>S</mi></math>；行权价格<math alttext="upper
    K"><mi>K</mi></math>；无风险利率<math alttext="r"><mi>r</mi></math>；年度股息收益率<math alttext="q"><mi>q</mi></math>；到期时间<math
    display="inline"><mrow><mi>τ</mi> <mo>=</mo> <mi>T</mi> <mo>–</mo> <mi>t</mi></mrow></math>（表示为一年的无量纲分数）；以及波动率<math
    alttext="sigma"><mi>σ</mi></math>。
- en: To make the logic simpler, we define moneyness as <math alttext="upper M equals
    upper K slash upper S"><mrow><mi>M</mi> <mo>=</mo> <mi>K</mi> <mo>/</mo> <mi>S</mi></mrow></math>
    and look at the prices in terms of per unit of current stock price. We also set
    <math alttext="q"><mi>q</mi></math> as 0.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化逻辑，我们将金钱度定义为<math alttext="upper M equals upper K slash upper S"><mrow><mi>M</mi>
    <mo>=</mo> <mi>K</mi> <mo>/</mo> <mi>S</mi></mrow></math>，并以每单位当前股票价格为单位查看价格。我们还将<math
    alttext="q"><mi>q</mi></math>设为0。
- en: 'This simplifies the formula to the following:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 这简化了以下公式：
- en: <math><mrow><msup><mi>e</mi> <mrow><mo>–</mo><mi>q</mi><mi>τ</mi></mrow></msup>
    <mi>Φ</mi> <mfenced separators="" open="(" close=")"><mfrac><mrow><mo>–</mo><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>M</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>+</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac></mfenced>
    <mo>–</mo> <msup><mi>e</mi> <mrow><mo>–</mo><mi>r</mi><mi>τ</mi></mrow></msup>
    <mi>M</mi> <mi>Φ</mi> <mfenced separators="" open="(" close=")"><mfrac><mrow><mo>–</mo><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>M</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>–</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac></mfenced></mrow></math>
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: <math><mrow><msup><mi>e</mi> <mrow><mo>–</mo><mi>q</mi><mi>τ</mi></mrow></msup>
    <mi>Φ</mi> <mfenced separators="" open="(" close=")"><mfrac><mrow><mo>–</mo><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>M</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>+</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac></mfenced>
    <mo>–</mo> <msup><mi>e</mi> <mrow><mo>–</mo><mi>r</mi><mi>τ</mi></mrow></msup>
    <mi>M</mi> <mi>Φ</mi> <mfenced separators="" open="(" close=")"><mfrac><mrow><mo>–</mo><mo
    form="prefix">ln</mo><mrow><mo>(</mo><mi>M</mi><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mi>r</mi><mo>–</mo><msup><mi>σ</mi>
    <mn>2</mn></msup> <mo>/</mo><mn>2</mn><mo>)</mo></mrow><mi>τ</mi></mrow> <mrow><mi>σ</mi><msqrt><mi>τ</mi></msqrt></mrow></mfrac></mfenced></mrow></math>
- en: Looking at the equation above, the parameters that feed into the Black-Scholes
    option pricing model are moneyness, risk-free rate, volatility, and time to maturity.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 观察上述方程，输入布莱克-肖尔斯期权定价模型的参数包括金钱度、无风险利率、波动率和到期时间。
- en: The parameter that plays the central role in derivative market is volatility,
    as it is directly related to the movement of the stock prices. With the increase
    in the volatility, the range of share price movements becomes much wider than
    that of a low volatility stock.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 在衍生品市场中起核心作用的参数是波动率，因为它直接与股票价格的波动相关。随着波动率的增加，股价波动的范围比低波动率股票要大得多。
- en: In the options market, there isn’t a single volatility used to price all the
    options. This volatility depends on the option moneyness and time to maturity.
    In general, the volatility increases with higher time to maturity and with moneyness.
    This behavior is referred to as volatility smile/skew. We often derive the volatility
    from the price of the options existing in the market, and this volatility is referred
    to as “implied” volatility. In this exercise, we assume the structure of the volatility
    surface and use function in [Equation 5-2](#VolEq), where volatility depends on
    the option moneyness and time to maturity to generate the option volatility surface.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 在期权市场上，没有一个单一的波动率用于定价所有期权。该波动率取决于期权的货币性和到期时间。一般来说，波动率随着到期时间的增加和货币性的增加而增加。这种行为被称为波动率微笑/偏斜。我们通常从市场上现有的期权价格中推导波动率，这种波动率称为“隐含”波动率。在本练习中，我们假设波动率曲面的结构，并使用方程[5-2](#VolEq)，其中波动率取决于期权的货币性和到期时间来生成期权波动率曲面。
- en: Equation 5-2\. Equation for vloatility
  id: totrans-304
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 方程5-2\. 波动率方程
- en: <math display="block"><mrow><mi>σ</mi> <mrow><mo>(</mo> <mi>M</mi> <mo>,</mo>
    <mi>τ</mi> <mo>)</mo></mrow> <mo>=</mo> <msub><mi>σ</mi> <mn>0</mn></msub> <mo>+</mo>
    <mi>α</mi> <mi>τ</mi> <mo>+</mo> <mi>β</mi> <msup><mrow><mo>(</mo><mi>M</mi><mo>–</mo><mn>1</mn><mo>)</mo></mrow>
    <mn>2</mn></msup></mrow></math>
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: <math display="block"><mrow><mi>σ</mi> <mrow><mo>(</mo> <mi>M</mi> <mo>,</mo>
    <mi>τ</mi> <mo>)</mo></mrow> <mo>=</mo> <msub><mi>σ</mi> <mn>0</mn></msub> <mo>+</mo>
    <mi>α</mi> <mi>τ</mi> <mo>+</mo> <mi>β</mi> <msup><mrow><mo>(</mo><mi>M</mi><mo>–</mo><mn>1</mn><mo>)</mo></mrow>
    <mn>2</mn></msup></mrow></math>
- en: 2\. Getting started—loading the data and Python packages
  id: totrans-306
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2\. 入门—加载数据和Python包
- en: 2.1\. Loading the Python packages
  id: totrans-307
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.1\. 加载Python包
- en: The loading of Python packages is similar to case study 1 in this chapter. Please
    refer to the Jupyter notebook of this case study for more details.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 加载Python包与本章第1个案例类似。有关详细信息，请参阅本案例研究的Jupyter笔记本。
- en: 2.2\. Defining functions and parameters
  id: totrans-309
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.2\. 定义函数和参数
- en: To generate the dataset, we need to simulate the input parameters and then create
    the predicted variable.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成数据集，我们需要模拟输入参数，然后创建预测变量。
- en: 'As a first step we define the constant parameters. The constant parameters
    required for the volatility surface are defined below. These parameters are not
    expected to have a significant impact on the option price; therefore, these parameters
    are set to some meaningful values:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 首先我们定义常量参数。用于波动率曲面的常量参数如下所示。这些参数不太可能对期权价格产生重大影响；因此，这些参数被设置为一些有意义的值：
- en: '[PRE37]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The risk-free rate, which is an input to the Black-Scholes option pricing model,
    is defined as follows:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 无风险利率，作为布莱克-斯科尔斯期权定价模型的输入，定义如下：
- en: '[PRE38]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Volatility and option pricing functions
  id: totrans-315
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 波动率和期权定价函数
- en: 'In this step we define the function to compute the volatility and price of
    a call option as per Equations [5-1](#BSEq) and [5-2](#VolEq):'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，我们定义函数来计算看涨期权的波动率和价格，如方程[5-1](#BSEq)和[5-2](#VolEq)所示：
- en: '[PRE39]'
  id: totrans-317
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 2.3\. Data generation
  id: totrans-318
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.3\. 数据生成
- en: 'We generate the input and output variables in the following steps:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 我们按以下步骤生成输入和输出变量：
- en: Time to maturity (*Ts*) is generated using the `np.random.random` function,
    which generates a uniform random variable between zero and one.
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 到期时间（*Ts*）使用`np.random.random`函数生成，该函数生成介于零和一之间的均匀随机变量。
- en: Moneyness (*Ks*) is generated using the `np.random.randn` function, which generates
    a normally distributed random variable. The random number multiplied by 0.25 generates
    the deviation of strike from spot price,^([13](ch05.xhtml#idm45174927663880))
    and the overall equation ensures that the moneyness is greater than zero.
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 货币性（*Ks*）使用`np.random.randn`函数生成，该函数生成一个正态分布的随机变量。随机数乘以0.25生成罢工价格偏离现货价格的偏差，^([13](ch05.xhtml#idm45174927663880))整体方程确保货币性大于零。
- en: Volatility (*sigma*) is generated as a function of time to maturity and moneyness
    using [Equation 5-2](#VolEq).
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 波动率（*sigma*）根据到期时间和货币性使用方程[5-2](#VolEq)生成。
- en: The option price is generated using [Equation 5-1](#BSEq) for the Black-Scholes
    option price.
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 期权价格使用[方程5-1](#BSEq)来生成布莱克-斯科尔斯期权价格。
- en: 'In total we generate 10,000 data points (*N*):'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 总共我们生成了10,000个数据点（*N*）：
- en: '[PRE40]'
  id: totrans-325
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Now we create the variables for predicted and predictor variables:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们创建预测和预测变量的变量：
- en: '[PRE41]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 3\. Exploratory data analysis
  id: totrans-328
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 3\. 探索性数据分析
- en: Let’s have a look at the dataset we have.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一下我们拥有的数据集。
- en: 3.1\. Descriptive statistics
  id: totrans-330
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.1\. 描述统计
- en: '[PRE42]'
  id: totrans-331
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '`Output`'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '|  | Price | Moneyness | Time | Vol |'
  id: totrans-333
  prefs: []
  type: TYPE_TB
  zh: '|  | 价格 | 货币性 | 时间 | 波动率 |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-334
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| 0 | 1.390e-01 | 0.898 | 0.221 | 0.223 |'
  id: totrans-335
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1.390e-01 | 0.898 | 0.221 | 0.223 |'
- en: '| 1 | 3.814e-06 | 1.223 | 0.052 | 0.210 |'
  id: totrans-336
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 3.814e-06 | 1.223 | 0.052 | 0.210 |'
- en: '| 2 | 1.409e-01 | 0.969 | 0.391 | 0.239 |'
  id: totrans-337
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 1.409e-01 | 0.969 | 0.391 | 0.239 |'
- en: '| 3 | 1.984e-01 | 0.950 | 0.628 | 0.263 |'
  id: totrans-338
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 1.984e-01 | 0.950 | 0.628 | 0.263 |'
- en: '| 4 | 2.495e-01 | 0.914 | 0.810 | 0.282 |'
  id: totrans-339
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 2.495e-01 | 0.914 | 0.810 | 0.282 |'
- en: The dataset contains *price*—which is the price of the option and is the predicted
    variable—along with *moneyness* (the ratio of strike and spot price), *time to
    maturity*, and *volatility*, which are the features in the model.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集包含*价格*—即期权的价格，也是预测变量—以及*货币性*（行权价与现价的比率）、*到期时间*和*波动率*，这些是模型中的特征。
- en: 3.2\. Data visualization
  id: totrans-341
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.2\. 数据可视化
- en: In this step we look at scatterplot to understand the interaction between different
    variables:^([14](ch05.xhtml#idm45174927344984))
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，我们查看散点图以理解不同变量之间的相互作用：^([14](ch05.xhtml#idm45174927344984))
- en: '[PRE43]'
  id: totrans-343
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '`Output`'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in10](Images/mlbf_05in10.png)'
  id: totrans-345
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in10](Images/mlbf_05in10.png)'
- en: The scatterplot reveals very interesting dependencies and relationships between
    the variables. Let us look at the first row of the chart to see the relationship
    of price to different variables. We observe that as moneyness decreases (i.e.,
    strike price decreases as compared to the stock price), there is an increase in
    the price, which is in line with the rationale described in the previous section.
    Looking at the price versus time to maturity, we see an increase in the option
    price. The price versus volatility chart also shows an increase in the price with
    the volatility. However, option price seems to exhibit a nonlinear relationship
    with most of the variables. This means that we expect our nonlinear models to
    do a better job than our linear models.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 散点图揭示了变量之间非常有趣的依赖关系。让我们看看图表的第一行，以查看价格与不同变量之间的关系。我们观察到随着货币性的减少（即与股票价格相比，行权价格的减少），价格增加，这与前一节描述的理由一致。观察价格与到期时间的关系，我们看到期权价格增加。价格与波动率图表也显示出价格随波动率增加而增加。然而，期权价格似乎与大多数变量呈非线性关系。这意味着我们预计我们的非线性模型将比线性模型做得更好。
- en: Another interesting relationship is between volatility and strike. The more
    we deviate from the moneyness of one, the higher the volatility we observe. This
    behavior is shown due to the volatility function we defined before and illustrates
    the volatility smile/skew.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有趣的关系是波动率和行权价格之间的关系。当我们远离一个货币性时，我们观察到更高的波动率。这种行为是由我们之前定义的波动率函数所显示的，并说明了波动率笑曲线/偏斜。
- en: 4\. Data preparation and analysis
  id: totrans-348
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4\. 数据准备和分析
- en: We performed most of the data preparation steps (i.e., getting the dependent
    and independent variables) in the preceding sections. In this step we look at
    the feature importance.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在前面的步骤中执行了大部分数据准备工作（即获取依赖变量和独立变量）。在这一步中，我们查看特征重要性。
- en: 4.1\. Univariate feature selection
  id: totrans-350
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 4.1\. 单变量特征选择
- en: 'We start by looking at each feature individually and, using the single variable
    regression fit as the criteria, look at the most important variables:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先单独查看每个特征，并使用单变量回归拟合作为标准，查看最重要的变量：
- en: '[PRE44]'
  id: totrans-352
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '`Output`'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '[PRE45]'
  id: totrans-354
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: We observe that the moneyness is the most important variable for the option
    price, followed by volatility and time to maturity. Given there are only three
    predictor variables, we retain all the variables for modeling.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 我们观察到货币性是期权价格最重要的变量，其次是波动率和到期时间。鉴于只有三个预测变量，我们保留所有变量进行建模。
- en: 5\. Evaluate models
  id: totrans-356
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5\. 评估模型
- en: 5.1\. Train-test split and evaluation metrics
  id: totrans-357
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.1\. 训练集-测试集分离和评估指标
- en: 'First, we separate the training set and test set:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们分离训练集和测试集：
- en: '[PRE46]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'We use the prebuilt sklearn models to run a *k*-fold analysis on our training
    data. We then train the model on the full training data and use it for prediction
    of the test data. We will evaluate algorithms using the mean squared error metric.
    The parameters for the *k*-fold analysis and evaluation metrics are defined as
    follows:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用预构建的sklearn模型对我们的训练数据进行*k*-fold分析。然后，我们在完整的训练数据上训练模型，并将其用于测试数据的预测。我们将使用均方误差指标评估算法。*k*-fold分析和评估指标的参数定义如下：
- en: '[PRE47]'
  id: totrans-361
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 5.2\. Compare models and algorithms
  id: totrans-362
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.2\. 比较模型和算法
- en: Now that we have completed the data loading and have designed the test harness,
    we need to choose a model out of the suite of the supervised regression models.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了数据加载并设计了测试工具，我们需要从一系列监督回归模型中选择一个模型。
- en: '`Linear models and regression trees`'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '`Linear models and regression trees`'
- en: '[PRE48]'
  id: totrans-365
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '`Artificial neural network`'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: '`Artificial neural network`'
- en: '[PRE49]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: '`Boosting and bagging methods`'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '`Boosting and bagging methods`'
- en: '[PRE50]'
  id: totrans-369
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Once we have selected all the models, we loop over each of them. First, we run
    the *k*-fold analysis. Next, we run the model on the entire training and testing
    dataset.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们选择了所有的模型，我们对每个模型进行循环。首先，我们进行*k*-fold分析。接下来，我们在整个训练和测试数据集上运行模型。
- en: The algorithms use default tuning parameters. We will calculate the mean and
    standard deviation of error metric and save the results for use later.
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 算法使用默认调整参数。我们将计算错误度量的平均值和标准差，并保存结果供以后使用。
- en: '`Output`'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in11](Images/mlbf_05in11.png)'
  id: totrans-373
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in11](Images/mlbf_05in11.png)'
- en: The Python code for the *k*-fold analysis step is similar to that used in case
    study 1\. Readers can also refer to the Jupyter notebook of this case study in
    the code repository for more details. Let us look at the performance of the models
    in the training set.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: '*k* 折分析步骤的Python代码类似于案例研究1中使用的代码。读者也可以参考代码库中此案例研究的Jupyter笔记本以获取更多详细信息。让我们看看训练集中模型的性能。'
- en: We see clearly that the nonlinear models, including classification and regression
    tree (CART), ensemble models, and artificial neural network (represented by MLP
    in the chart above), perform a lot better that the linear algorithms. This is
    intuitive given the nonlinear relationships we observed in the scatterplot.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 我们清楚地看到，非线性模型（包括分类和回归树（CART）、集成模型以及在上图中由MLP表示的人工神经网络）比线性算法表现得更好。这是合理的，考虑到我们在散点图中观察到的非线性关系。
- en: Artificial neural networks (ANN) have the natural ability to model any function
    with fast experimentation and deployment times (definition, training, testing,
    inference). ANN can effectively be used in complex derivative pricing situations.
    Hence, out of all the models with good performance, we choose ANN for further
    analysis.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 人工神经网络（ANN）具有通过快速实验和部署时间（定义、训练、测试、推断）来建模任何函数的自然能力。在复杂的衍生品定价情况下，ANN可以有效地使用。因此，在所有表现良好的模型中，我们选择ANN进行进一步分析。
- en: 6\. Model tuning and finalizing the model
  id: totrans-377
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6\. 模型调优和最终模型的确定
- en: Determining the proper number of nodes for the middle layer of an ANN is more
    of an art than a science, as discussed in [Chapter 3](ch03.xhtml#Chapter3). Too
    many nodes in the middle layer, and thus too many connections, produce a neural
    network that memorizes the input data and lacks the ability to generalize. Therefore,
    increasing the number of nodes in the middle layer will improve performance on
    the training set, while decreasing the number of nodes in the middle layer will
    improve performance on a new dataset.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 确定ANN中间层节点的适当数量更像是一门艺术而不是科学，正如在[第三章](ch03.xhtml#Chapter3)中讨论的那样。中间层中过多的节点，以及因此而产生的过多连接，会导致神经网络仅仅记忆输入数据而失去泛化能力。因此，增加中间层节点的数量将提高训练集上的性能，而减少中间层节点的数量将改善对新数据集的性能。
- en: 'As discussed in [Chapter 3](ch03.xhtml#Chapter3), the ANN model has several
    other hyperparameters such as learning rate, momentum, activation function, number
    of epochs, and batch size. All these hyperparameters can be tuned during the grid
    search process. However, in this step, we stick to performing grid search on the
    number of hidden layers for the purpose of simplicity. The approach to perform
    grid search on other hyperparameters is the same as described in the following
    code snippet:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 正如在[第三章](ch03.xhtml#Chapter3)中讨论的那样，ANN模型还有几个超参数，如学习率、动量、激活函数、迭代次数和批次大小。在网格搜索过程中，可以调整所有这些超参数。然而，在这一步骤中，我们简化地只对隐藏层的数量进行网格搜索。对其他超参数进行网格搜索的方法与下面代码片段中描述的相同：
- en: '[PRE51]'
  id: totrans-380
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: '`Output`'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE52]'
  id: totrans-382
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The best model has three layers, with 20, 30, and 20 nodes in each hidden layer,
    respectively. Hence, we prepare a model with this configuration and check its
    performance on the test set. This is a crucial step, because a greater number
    of layers may lead to overfitting and have poor performance in the test set.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳模型有三层，分别为20、30和20个节点。因此，我们按照这个配置准备一个模型，并检查其在测试集上的表现。这是一个关键步骤，因为更多的层可能导致过拟合，并在测试集上表现不佳。
- en: '[PRE53]'
  id: totrans-384
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '[PRE54]'
  id: totrans-385
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '`Output`'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE55]'
  id: totrans-387
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: We see that the root mean squared error (RMSE) is 3.08e–5, which is less than
    one cent. Hence, the ANN model does an excellent job of fitting the Black-Scholes
    option pricing model. A greater number of layers and tuning of other hyperparameters
    may enable the ANN model to capture the complex relationship and nonlinearity
    in the data even better. Overall, the results suggest that ANN may be used to
    train an option pricing model that matches market prices.
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到均方根误差（RMSE）为3.08e-5，小于一分钱。因此，ANN模型非常适合拟合Black-Scholes期权定价模型。增加更多层和调整其他超参数可能会使ANN模型更好地捕捉数据中的复杂关系和非线性。总体而言，结果表明，ANN可以用于训练与市场价格匹配的期权定价模型。
- en: '7\. Additional analysis: removing the volatility data'
  id: totrans-389
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7\. 额外分析：移除波动率数据
- en: 'As an additional analysis, we make the process harder by trying to predict
    the price without the volatility data. If the model performance is good, we will
    eliminate the need to have a volatility function as described before. In this
    step, we further compare the performance of the linear and nonlinear models. In
    the following code snippet, we remove the volatility variable from the dataset
    of the predictor variable and define the training set and test set again:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 作为额外分析，我们试图在没有波动率数据的情况下预测价格，这使得过程更加复杂。如果模型表现良好，我们将取消之前描述的波动率函数的需求。在这一步骤中，我们进一步比较线性模型和非线性模型的表现。在下面的代码片段中，我们从预测变量的数据集中移除波动率变量，并重新定义训练集和测试集：
- en: '[PRE56]'
  id: totrans-391
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'Next, we run the suite of the models (except the regularized regression model)
    with the new dataset, with the same parameters and similar Python code as before.
    The performance of all the models after removing the volatility data is as follows:'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们使用新数据集（除了正则化回归模型），使用与之前相同的参数和类似的Python代码来运行一系列模型。移除波动率数据后所有模型的表现如下：
- en: '![mlbf 05in12](Images/mlbf_05in12.png)'
  id: totrans-393
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in12](Images/mlbf_05in12.png)'
- en: Looking at the result, we have a similar conclusion as before and see a poor
    performance of the linear regression and good performance of the ensemble and
    ANN models. The linear regression now does even a worse job than before. However,
    the performance of ANN and other ensemble models does not deviate much from their
    previous performance. This implies the information of the volatility is likely
    captured in other variables, such as moneyness and time to maturity. Overall,
    it is good news as it means that fewer variables might be needed to achieve the
    same performance.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 从结果来看，我们得出与之前类似的结论，看到线性回归的表现不佳，而集成模型和ANN模型表现良好。现在线性回归的表现甚至比以前更差。然而，ANN和其他集成模型的表现与之前的表现差异不大。这表明，波动率的信息很可能被其他变量捕捉到，例如货币性和到期时间。总体而言，这是个好消息，因为这意味着可能只需要更少的变量就能达到相同的性能。
- en: Conclusion
  id: totrans-395
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 结论
- en: We know that derivative pricing is a nonlinear problem. As expected, our linear
    regression model did not do as well as our nonlinear models, and the non-linear
    models have a very good overall performance. We also observed that removing the
    volatility increases the difficulty of the prediction problem for the linear regression.
    However, the nonlinear models such as ensemble models and ANN are still able to
    do well at the prediction process. This does indicate that one might be able to
    sidestep the development of an option volatility surface and achieve a good prediction
    with a smaller number of variables.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道，衍生品定价是一个非线性问题。如预期的那样，我们的线性回归模型表现不如非线性模型好，而非线性模型的整体表现非常出色。我们还观察到，移除波动率会增加线性回归预测问题的难度。然而，诸如集成模型和人工神经网络（ANN）等非线性模型仍能在预测过程中表现良好。这表明，可能可以避开期权波动率曲面的开发，并且用更少的变量达到良好的预测。
- en: We saw that an artificial neural network (ANN) can reproduce the Black-Scholes
    option pricing formula for a call option to a high degree of accuracy, meaning
    we can leverage efficient numerical calculation of machine learning in derivative
    pricing without relying on the impractical assumptions made in the traditional
    derivative pricing models. The ANN and the related machine learning architecture
    can easily be extended to pricing derivatives in the real world, with no knowledge
    of the theory of derivative pricing. The use of machine learning techniques can
    lead to much faster derivative pricing compared to traditional derivative pricing
    models. The price we might have to pay for this extra speed is some loss of accuracy.
    However, this reduced accuracy is often well within reasonable limits and acceptable
    from a practical point of view. New technology has commoditized the use of ANN,
    so it might be worthwhile for banks, hedge funds, and financial institutions to
    explore these models for derivative pricing.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 我们发现，人工神经网络（ANN）可以高度准确地复制Black-Scholes期权定价公式，这意味着我们可以利用机器学习在衍生品定价中进行高效的数值计算，而无需依赖传统衍生品定价模型中不切实际的假设。ANN及其相关的机器学习架构可以轻松扩展到实际世界中的衍生品定价，而无需了解衍生品定价理论。与传统衍生品定价模型相比，机器学习技术的使用可以大大加快衍生品定价的速度。我们可能需要为这种额外速度付出的代价是一些精度损失。然而，从实际角度来看，这种降低的准确性通常仍然在合理的限度内，并且可以被接受。新技术已经使ANN的使用变得普遍化，因此银行、对冲基金和金融机构探索这些模型用于衍生品定价可能是值得的。
- en: '![](Images/bracket_bottom.png)'
  id: totrans-398
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_bottom.png)'
- en: 'Case Study 3: Investor Risk Tolerance and Robo-Advisors'
  id: totrans-399
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 案例研究3：投资者风险容忍度与智能投顾
- en: The risk tolerance of an investor is one of the most important inputs to the
    portfolio allocation and rebalancing steps of the portfolio management process.
    There is a wide variety of risk profiling tools that take varied approaches to
    understanding the risk tolerance of an investor. Most of these approaches include
    qualitative judgment and involve significant manual effort. In most of the cases,
    the risk tolerance of an investor is decided based on a risk tolerance questionnaire.
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 投资者的风险容忍度是投资组合管理过程中资产配置和再平衡步骤中最重要的输入之一。有多种风险评估工具采用不同的方法来理解投资者的风险容忍度。大多数这些方法包括定性判断，并涉及大量的手动工作。在大多数情况下，投资者的风险容忍度是基于风险容忍度问卷来决定的。
- en: Several studies have shown that these risk tolerance questionnaires are prone
    to error, as investors suffer from behavioral biases and are poor judges of their
    own risk perception, especially during stressed markets. Also, given that these
    questionnaires must be manually completed by investors, they eliminate the possibility
    of automating the entire investment management process.
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 几项研究表明，这些风险容忍度问卷易于出错，因为投资者受到行为偏见的影响，在压力下市场时尤其如此。此外，考虑到这些问卷必须由投资者手动完成，它们排除了全自动化投资管理过程的可能性。
- en: So can machine learning provide a better understanding of an investor’s risk
    profile than a risk tolerance questionnaire can? Can machine learning contribute
    to automating the entire portfolio management process by cutting the client out
    of the loop? Could an algorithm be written to develop a personality profile for
    the client that would be a better representation of how they would deal with different
    market scenarios?
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习能否比风险容忍问卷更好地理解投资者的风险偏好？机器学习是否可以通过剔除客户而自动化整个投资组合管理过程？是否可以编写算法为客户开发一个人格概要，以更好地反映他们在不同市场情景下的处理方式？
- en: The goal of this case study is to answer these questions. We first build a supervised
    regression–based model to predict the risk tolerance of an investor. We then build
    a robo-advisor dashboard in Python and implement the risk tolerance prediction
    model in the dashboard. The overall purpose is to demonstrate the automation of
    the manual steps in the portfolio management process with the help of machine
    learning. This can prove to be immensely useful, specifically for robo-advisors.
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 本案例研究的目标是回答这些问题。我们首先构建了一个基于监督回归的模型来预测投资者的风险容忍度。然后我们在Python中构建了一个智能投顾仪表板，并在仪表板中实现了风险容忍度预测模型。总体目的是展示如何通过机器学习自动化投资组合管理过程中的手动步骤。这对智能投顾来说可能是非常有用的。
- en: A *dashboard* is one of the key features of a robo-advisor as it provides access
    to important information and allows users to interact with their accounts free
    of any human dependency, making the portfolio management process highly efficient.
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 仪表板是 Robo-Advisor 的关键功能之一，因为它提供对重要信息的访问，并允许用户在没有任何人的依赖的情况下与他们的帐户交互，使投资组合管理过程高效。
- en: '[Figure 5-6](#ROBO1) provides a quick glance at the robo-advisor dashboard
    built for this case study. The dashboard performs end-to-end asset allocation
    for an investor, embedding the machine learning–based risk tolerance model constructed
    in this case study.'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-6](#ROBO1) 提供了为这个案例研究构建的 Robo-Advisor 仪表板的快速概览。该仪表板为投资者执行端到端资产配置，嵌入了本案例研究中构建的基于机器学习的风险容忍模型。'
- en: '![mlbf 0506](Images/mlbf_0506.png)'
  id: totrans-406
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0506](Images/mlbf_0506.png)'
- en: Figure 5-6\. Robo-advisor dashboard
  id: totrans-407
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-6\. Robo-Advisor 仪表板
- en: This dashboard has been built in Python and is described in detail in an additional
    step in this case study. Although it has been built in the context of robo-advisors,
    it can be extended to other areas in finance and can embed the machine learning
    models discussed in other case studies, providing finance decision makers with
    a graphical interface for analyzing and interpreting model results.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 这个仪表板是用 Python 构建的，并在本案例研究的附加步骤中详细描述。虽然它是在 Robo-Advisor 的背景下构建的，但它可以扩展到金融领域的其他领域，并嵌入其他案例研究中讨论的机器学习模型，为金融决策者提供一个用于分析和解释模型结果的图形界面。
- en: '![](Images/bracket_top.png)'
  id: totrans-409
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_top.png)'
- en: Blueprint for Modeling Investor Risk Tolerance and Enabling a Machine Learning–Based
    Robo-Advisor
  id: totrans-410
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 建模投资者风险容忍度并启用基于机器学习的 Robo-Advisor 的蓝图
- en: 1\. Problem definition
  id: totrans-411
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1\. 问题定义
- en: In the supervised regression framework used for this case study, the predicted
    variable is the “true” risk tolerance of an individual,^([15](ch05.xhtml#idm45174926472776))
    and the predictor variables are demographic, financial, and behavioral attributes
    of an individual.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 在本案例研究中使用的监督回归框架中，预测变量是个体的“真实”风险容忍度，^([15](ch05.xhtml#idm45174926472776)) 而预测变量是个体的人口统计、财务和行为属性。
- en: The data used for this case study is from the [Survey of Consumer Finances (SCF)](https://oreil.ly/2vxJ6),
    which is conducted by the Federal Reserve Board. The survey includes responses
    about household demographics, net worth, financial, and nonfinancial assets for
    the same set of individuals in 2007 (precrisis) and 2009 (postcrisis). This enables
    us to see how each household’s allocation changed after the 2008 global financial
    crisis. Refer to the [data dictionary](https://oreil.ly/_L8vS) for more information
    on this survey.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 本案例研究使用的数据来自[消费者金融调查（SCF）](https://oreil.ly/2vxJ6)，由美联储委员会进行。 调查包括关于2007年（危机前）和2009年（危机后）相同个体的家庭人口统计、净值、金融和非金融资产的响应。
    这使我们能够看到每个家庭在2008年全球金融危机后的配置如何改变。 有关此调查的更多信息，请参阅[数据字典](https://oreil.ly/_L8vS)。
- en: 2\. Getting started—loading the data and Python packages
  id: totrans-414
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2\. 入门—加载数据和 Python 软件包
- en: 2.1\. Loading the Python packages
  id: totrans-415
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.1\. 载入 Python 软件包
- en: The details on loading the standard Python packages were presented in the previous
    case studies. Refer to the Jupyter notebook for this case study for more details.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 关于加载标准 Python 软件包的详细信息已在先前的案例研究中提供。 有关更多详细信息，请参阅本案例研究的 Jupyter 笔记本。
- en: 2.2\. Loading the data
  id: totrans-417
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.2\. 载入数据
- en: 'In this step we load the data from the Survey of Consumer Finances and look
    at the data shape:'
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，我们从消费者金融调查中加载数据并查看数据形状：
- en: '[PRE57]'
  id: totrans-419
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Let us look at the size of the data:'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一下数据的规模：
- en: '[PRE58]'
  id: totrans-421
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '`Output`'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE59]'
  id: totrans-423
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: As we can see, the dataset has a total of 19,285 observations with 515 columns.
    The number of columns represents the number of features.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，数据集共有 19,285 条观察值，其中包含 515 列。 列的数量表示特征的数量。
- en: 3\. Data preparation and feature selection
  id: totrans-425
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 3\. 数据准备与特征选择
- en: In this step we prepare the predicted and predictor variables to be used for
    modeling.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，我们准备用于建模的预测变量和预测器变量。
- en: 3.1\. Preparing the predicted variable
  id: totrans-427
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.1\. 准备预测变量
- en: In the first step, we prepare the predicted variable, which is the true risk
    tolerance.
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一步中，我们准备了预测变量，即真实风险容忍度。
- en: 'The steps to compute the true risk tolerance are as follows:'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 计算真实风险容忍的步骤如下：
- en: 'Compute the risky assets and the risk-free assets for all the individuals in
    the survey data. Risky and risk-free assets are defined as follows:'
  id: totrans-430
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算调查数据中所有个人的风险资产和无风险资产。 风险资产和无风险资产的定义如下：
- en: Risky assets
  id: totrans-431
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 风险资产
- en: Investments in mutual funds, stocks, and bonds.
  id: totrans-432
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 投资于共同基金、股票和债券。
- en: Risk-free assets
  id: totrans-433
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 无风险资产
- en: Checking and savings balances, certificates of deposit, and other cash balances
    and equivalents.
  id: totrans-434
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查和储蓄余额、存款证书和其他现金余额及等价物。
- en: Take the ratio of risky assets to total assets (where total assets is the sum
    of risky and risk-free assets) of an individual and consider that as a measure
    of the individual’s risk tolerance.^([16](ch05.xhtml#idm45174926394984)) From
    the SCF, we have the data of risky and risk-free assets for the individuals in
    2007 and 2009\. We use this data and normalize the risky assets with the price
    of a stock index (S&P500) in 2007 versus 2009 to get risk tolerance.
  id: totrans-435
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将一个人的风险资产与总资产的比率（其中总资产是风险资产和无风险资产的总和）作为个人风险容忍度的衡量标准。^([16](ch05.xhtml#idm45174926394984))
    从SCF中，我们获取了2007年和2009年个人的风险和无风险资产数据。我们使用这些数据，并将2007年与2009年的股票指数（S&P500）的价格标准化风险资产，以获取风险容忍度。
- en: Identify the “intelligent” investors. Some literature describes an intelligent
    investor as one who does not change their risk tolerance during changes in the
    market. So we consider the investors who changed their risk tolerance by less
    than 10% between 2007 and 2009 as the intelligent investors. Of course, this is
    a qualitative judgment, and there can be several other ways of defining an intelligent
    investor. However, as mentioned before, beyond coming up with a precise definition
    of true risk tolerance, the purpose of this case study is to demonstrate the usage
    of machine learning and provide a machine learning–based framework in portfolio
    management that can be further leveraged for more detailed analysis.
  id: totrans-436
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别“聪明”的投资者。有些文献将聪明的投资者描述为在市场变动期间不改变其风险容忍度的投资者。因此，我们认为在2007年和2009年之间其风险容忍度变化不超过10%的投资者为聪明的投资者。当然，这是一个定性判断，还可以有几种其他定义聪明投资者的方法。然而，正如前面提到的，除了得出真正风险容忍度的精确定义之外，本案例研究的目的是展示机器学习的使用，并提供一个基于机器学习的投资组合管理框架，可以进一步用于更详细的分析。
- en: 'Let us compute the predicted variable. First, we get the risky and risk-free
    assets and compute the risk tolerance for 2007 and 2009 in the following code
    snippet:'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们计算预测变量。首先，我们获取风险资产和无风险资产，并计算以下代码片段中的2007年和2009年的风险容忍度：
- en: '[PRE60]'
  id: totrans-438
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Let us look at the details of the data:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们查看数据的详细信息：
- en: '[PRE61]'
  id: totrans-440
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: '`Output`'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in13](Images/mlbf_05in13.png)'
  id: totrans-442
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in13](Images/mlbf_05in13.png)'
- en: The data above displays some of the columns out of the 521 columns of the dataset.
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 上述数据显示了数据集中的521列中的一些列。
- en: 'Let us compute the percentage change in risk tolerance between 2007 and 2009:'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们计算2007年和2009年之间风险容忍度的百分比变化：
- en: '[PRE62]'
  id: totrans-445
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Next, we drop the rows containing “NA” or “NaN”:'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们删除包含“NA”或“NaN”的行：
- en: '[PRE63]'
  id: totrans-447
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Let us investigate the risk tolerance behavior of individuals in 2007 versus
    2009\. First we look at the risk tolerance in 2007:'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们调查个人在2007年和2009年的风险容忍度行为。首先我们看看2007年的风险容忍度：
- en: '[PRE64]'
  id: totrans-449
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '`Output`'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in14](Images/mlbf_05in14.png)'
  id: totrans-451
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in14](Images/mlbf_05in14.png)'
- en: 'Looking at the risk tolerance in 2007, we see that a significant number of
    individuals had a risk tolerance close to one, meaning investments were skewed
    more toward the risky assets. Now let us look at the risk tolerance in 2009:'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 查看2007年的风险容忍度，我们发现许多个人的风险容忍度接近1，这意味着投资更偏向于风险资产。现在让我们看看2009年的风险容忍度：
- en: '[PRE65]'
  id: totrans-453
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: '`Output`'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in15](Images/mlbf_05in15.png)'
  id: totrans-455
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in15](Images/mlbf_05in15.png)'
- en: Clearly, the behavior of the individuals reversed after the crisis. Overall
    risk tolerance decreased, which is shown by the outsized proportion of households
    having risk tolerance close to zero in 2009\. Most of the investments of these
    individuals were in risk-free assets.
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，个人在危机后的行为发生了逆转。总体风险容忍度减少，这表现在2009年风险容忍度接近零的家庭比例过大。这些个人的大多数投资都是在无风险资产上。
- en: 'In the next step, we pick the intelligent investors whose change in risk tolerance
    between 2007 and 2009 was less than 10%, as described in [“3.1\. Preparing the
    predicted variable”](#prep_pred_var):'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们挑选了在2007年和2009年之间风险容忍度变化少于10%的聪明投资者，如[“3.1\. 准备预测变量”](#prep_pred_var)中所述：
- en: '[PRE66]'
  id: totrans-458
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'We assign the true risk tolerance as the average risk tolerance of these intelligent
    investors between 2007 and 2009:'
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将这些聪明投资者在2007年和2009年之间的平均风险容忍度作为真正的风险容忍度：
- en: '[PRE67]'
  id: totrans-460
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: This is the predicted variable for this case study.
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 这是本案例研究的预测变量。
- en: 'Let us drop other labels that might not be needed for the prediction:'
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们舍弃其他可能不需要的标签：
- en: '[PRE68]'
  id: totrans-463
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 3.2\. Feature selection—limit the feature space
  id: totrans-464
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.2\. 特征选择—限制特征空间
- en: In this section, we will explore ways to condense the feature space.
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨压缩特征空间的方法。
- en: 3.2.1\. Feature elimination
  id: totrans-466
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.2.1\. 特征消除
- en: To filter the features further, we check the description in the [data dictionary](https://oreil.ly/_L8vS)
    and keep only the features that are relevant.
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步筛选特征，我们查看[数据字典](https://oreil.ly/_L8vS)中的描述，仅保留相关特征。
- en: Looking at the entire data, we have more than *500* features in the dataset.
    However, academic literature and industry practice indicate risk tolerance is
    heavily influenced by investor demographic, financial, and behavioral attributes,
    such as age, current income, net worth, and willingness to take risk. All these
    attributes were available in the dataset and are summarized in the following section.
    These attributes are used as features to predict investors’ risk tolerance.
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: 看整个数据，我们在数据集中有超过*500*个特征。然而，学术文献和行业实践表明，风险容忍度受投资者的人口统计、财务和行为属性的影响很大，如年龄、当前收入、净资产和愿意承担的风险。所有这些属性都包含在数据集中，并在以下部分进行了总结。这些属性被用作预测投资者风险容忍度的特征。
- en: '![mlbf 05in16](Images/mlbf_05in16.png)'
  id: totrans-469
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in16](Images/mlbf_05in16.png)'
- en: 'In the dataset, each of the columns contains a numeric value corresponding
    to the value of the attribute. The details are as follows:'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据集中，每列包含与属性值对应的数值。详情如下：
- en: AGE
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: AGE
- en: There are six age categories, where 1 represents age less than 35 and 6 represents
    age more than 75.
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: 有六个年龄类别，其中1代表35岁以下，6代表75岁以上。
- en: EDUC
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: EDUC
- en: There are four education categories, where 1 represents no high school and 4
    represents college degree.
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 有四个教育类别，其中1代表没有高中，4代表大学学位。
- en: MARRIED
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: MARRIED
- en: There are two categories to represent marital status, where 1 represents married
    and 2 represents unmarried.
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 有两个类别来表示婚姻状况，其中1代表已婚，2代表未婚。
- en: OCCU
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: OCCU
- en: This represents occupation category. A value of 1 represents managerial status
    and 4 represents unemployed.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: 这代表职业类别。值为1代表管理地位，4代表失业状态。
- en: KIDS
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: KIDS
- en: Number of children.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 孩子的数量。
- en: WSAVED
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: WSAVED
- en: This represents the individual’s spending versus income, split into three categories.
    For example, 1 represents spending exceeded income.
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 这代表个人的支出与收入比，分为三个类别。例如，1代表支出超过收入。
- en: NWCAT
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: NWCAT
- en: This represents net worth category. There are five categories, where 1 represents
    net worth less than the 25th percentile and 5 represents net worth more than the
    90th percentile.
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 这代表净资产类别。有五个类别，其中1代表净资产低于第25百分位数，5代表净资产高于第90百分位数。
- en: INCCL
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: INCCL
- en: This represents income category. There are five categories, where 1 represents
    income less than $10,000 and 5 represents income more than $100,000.
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 这代表收入类别。有五个类别，其中1代表收入低于$10,000，5代表收入超过$100,000。
- en: RISK
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: RISK
- en: This represents the willingness to take risk on a scale of 1 to 4, where 1 represents
    the highest level of willingness to take risk.
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 这代表愿意承担的风险程度，范围从1到4，其中1代表最高水平的愿意承担风险。
- en: 'We keep only the intuitive features as of 2007 and remove all the intermediate
    features and features related to 2009, as the variables of 2007 are the only ones
    required for predicting the risk tolerance:'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仅保留2007年的直观特征，并删除所有中间特征和2009年相关特征，因为2007年的变量是预测风险容忍度所需的唯一变量：
- en: '[PRE69]'
  id: totrans-490
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Now let us look at the correlation among the features:'
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看一下特征之间的相关性：
- en: '[PRE70]'
  id: totrans-492
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: '`Output`'
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in17](Images/mlbf_05in17.png)'
  id: totrans-494
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in17](Images/mlbf_05in17.png)'
- en: Looking at the correlation chart (full-size version available on [GitHub](https://oreil.ly/iQpk4)),
    net worth and income are positively correlated with risk tolerance. With a greater
    number of kids and marriage, risk tolerance decreases. As the willingness to take
    risks decreases, the risk tolerance decreases. With age there is a positive relationship
    of the risk tolerance. As per Hui Wang and Sherman Hanna’s paper “Does Risk Tolerance
    Decrease with Age?,” risk tolerance increases as people age (i.e., the proportion
    of net wealth invested in risky assets increases as people age) when other variables
    are held constant.
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
  zh: 查看相关图表（GitHub上有完整版：[GitHub](https://oreil.ly/iQpk4)），净资产和收入与风险容忍度呈正相关。随着子女数量和婚姻状况的增加，风险容忍度降低。随着愿意承担的风险减少，风险容忍度也减少。随着年龄增长，风险容忍度呈正相关。根据Hui
    Wang和Sherman Hanna的论文“随年龄增长风险容忍度减少吗？”，在其他变量保持不变的情况下，随着人们年龄增长，风险容忍度增加（即随着人们年龄增长，投资于风险资产的净财富比例增加）。
- en: So in summary, the relationship of these variables with risk tolerance seems
    intuitive.
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，总结来说，这些变量与风险承受能力的关系似乎是直观的。
- en: 4\. Evaluate models
  id: totrans-497
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4\. 评估模型
- en: 4.1\. Train-test split
  id: totrans-498
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 4.1\. 训练集-测试集分割
- en: 'Let us split the data into training and test set:'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将数据分割成训练集和测试集：
- en: '[PRE71]'
  id: totrans-500
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: 4.2\. Test options and evaluation metrics
  id: totrans-501
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 4.2\. 测试选项和评估指标
- en: We use R² as the evaluation metric and select 10 as the number of folds for
    cross validation.^([17](ch05.xhtml#idm45174925517336))
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用R²作为评估指标，并选择10作为交叉验证的折数。^([17](ch05.xhtml#idm45174925517336))
- en: '[PRE72]'
  id: totrans-503
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: 4.3\. Compare models and algorithms
  id: totrans-504
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 4.3\. 比较模型和算法
- en: Next, we select the suite of the regression model and perform the *k*-folds
    cross validation.
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们选择回归模型套件并进行*k*-折交叉验证。
- en: '`Regression Models`'
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: '`回归模型`'
- en: '[PRE73]'
  id: totrans-507
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: The Python code for the *k*-fold analysis step is similar to that of previous
    case studies. Readers can also refer to the Jupyter notebook of this case study
    in the code repository for more details. Let us look at the performance of the
    models in the training set.
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: '*k*-折分析步骤的Python代码与之前案例研究类似。读者还可以参考代码库中本案例研究的Jupyter笔记本获取更多细节。让我们来看看训练集中模型的表现。'
- en: '![mlbf 05in18](Images/mlbf_05in18.png)'
  id: totrans-509
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in18](Images/mlbf_05in18.png)'
- en: The nonlinear models perform better than the linear models, which means that
    there is a nonlinear relationship between the risk tolerance and the variables
    used to predict it. Given random forest regression is one of the best methods,
    we use it for further grid search.
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 非线性模型的表现优于线性模型，这意味着风险承受能力与用于预测它的变量之间存在非线性关系。鉴于随机森林回归是最佳方法之一，我们将其用于进一步的网格搜索。
- en: 5\. Model tuning and grid search
  id: totrans-511
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5\. 模型调优和网格搜索
- en: 'As discussed in [Chapter 4](ch04.xhtml#Chapter4), random forest has many hyperparameters
    that can be tweaked while performing the grid search. However, we will confine
    our grid search to number of estimators (`n_estimators`) as it is one of the most
    important hyperparameters. It represents the number of trees in the random forest
    model. Ideally, this should be increased until no further improvement is seen
    in the model:'
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: 如在[第四章](ch04.xhtml#Chapter4)中讨论的，随机森林有许多可以在网格搜索中调整的超参数。然而，在进行网格搜索时，我们将限制在评估器数量（`n_estimators`），因为它是最重要的超参数之一。它表示随机森林模型中树的数量。理想情况下，应增加到模型不再显示进展为止：
- en: '[PRE74]'
  id: totrans-513
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: '`Output`'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '[PRE75]'
  id: totrans-515
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: Random forest with number of estimators as 250 is the best model after grid
    search.
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 经过网格搜索后，以250为评估器数量的随机森林是最佳模型。
- en: 6\. Finalize the model
  id: totrans-517
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6\. 完成模型
- en: Let us look at the results on the test dataset and check the feature importance.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看在测试数据集上的结果，并检查特征的重要性。
- en: 6.1\. Results on the test dataset
  id: totrans-519
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.1\. 测试数据集的结果
- en: 'We prepare the random forest model with the number of estimators as 250:'
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: 我们准备以250为评估器数量的随机森林模型：
- en: '[PRE76]'
  id: totrans-521
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'Let us look at the performance in the training set:'
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看训练集的表现：
- en: '[PRE77]'
  id: totrans-523
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '`Output`'
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '[PRE78]'
  id: totrans-525
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'The R² of the training set is 96%, which is a good result. Now let us look
    at the performance in the test set:'
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: 训练集的R²为96%，这是一个很好的结果。现在让我们来看看测试集的表现：
- en: '[PRE79]'
  id: totrans-527
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: '`Output`'
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '[PRE80]'
  id: totrans-529
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: From the mean squared error and R² of 76% shown above for the test set, the
    random forest model does an excellent job of fitting the risk tolerance.
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: 根据上述测试集的均方误差和R²为76%，随机森林模型在拟合风险承受能力方面表现出色。
- en: 6.2\. Feature importance and features intuition
  id: totrans-531
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.2\. 特征重要性和特征直觉
- en: 'Let us look into the feature importance of the variables within the random
    forest model:'
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看随机森林模型内变量的特征重要性：
- en: '[PRE81]'
  id: totrans-533
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: '`Output`'
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '![mlbf 05in19](Images/mlbf_05in19.png)'
  id: totrans-535
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in19](Images/mlbf_05in19.png)'
- en: In the chart, the x-axis represents the magnitude of the importance of a feature.
    Hence, income and net worth, followed by age and willingness to take risk, are
    the key variables in determining risk tolerance.
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 在图表中，x轴表示特征重要性的大小。因此，收入和净值，其次是年龄和愿意承担的风险，是决定风险承受能力的关键变量。
- en: 6.3\. Save model for later use
  id: totrans-537
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 6.3\. 保存模型以备后用
- en: In this step we save the model for later use. The saved model can be used directly
    for prediction given the set of input variables. The model is saved as *finalized_model.sav*
    using the `dump` module of the pickle package. This saved model can be loaded
    using the `load` module.
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，我们将模型保存以备后用。保存的模型可以直接用于根据输入变量集进行预测。使用pickle包的`dump`模块将模型保存为*finalized_model.sav*。可以使用`load`模块加载此保存的模型。
- en: 'Let’s save the model as the first step:'
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将模型保存为第一步：
- en: '[PRE82]'
  id: totrans-540
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: 'Now let’s load the saved model and use it for prediction:'
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们加载已保存的模型，并用于预测：
- en: '[PRE83]'
  id: totrans-542
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: '`Output`'
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '[PRE84]'
  id: totrans-544
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: '7\. Additional step: robo-advisor dashboard'
  id: totrans-545
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7\. 附加步骤：机器人顾问仪表板
- en: We mentioned the robo-advisor dashboard in the beginning of this case study.
    The robo-advisor dashboard performs an automation of the portfolio management
    process and aims to overcome the problem of traditional risk tolerance profiling.
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本案例研究的开头提到了机器人顾问仪表板。机器人顾问仪表板自动化了投资组合管理流程，并旨在解决传统风险容忍度分析的问题。
- en: Python Code for Robo-Advisor Dashboard
  id: totrans-547
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Python代码用于机器人顾问仪表板
- en: This robo-advisor dashboard is built in Python using the plotly dash package.
    [Dash](https://dash.plot.ly) is a productive Python framework for building web
    applications with good user interfaces. The code for the robo-advisor dashboard
    is added to the [code repository for this book](https://oreil.ly/8fTDy). The code
    is in a Jupyter notebook called “Sample Robo-advisor”. A detailed description
    of the code is outside the scope of this case study. However, the codebase can
    be leveraged for creation of any new machine learning–enabled dashboard.
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: 该机器人顾问仪表板是使用Python中的plotly dash包构建的。[Dash](https://dash.plot.ly)是一个用于构建具有良好用户界面的Web应用程序的高效Python框架。机器人顾问仪表板的代码已添加到[本书的代码库](https://oreil.ly/8fTDy)中。代码位于名为“Sample
    Robo-advisor”的Jupyter笔记本中。本案例研究不涉及代码的详细描述。但是，该代码库可用于创建任何新的机器学习增强仪表板。
- en: 'The dashboard has two panels:'
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 仪表板有两个面板：
- en: Inputs for investor characteristics
  id: totrans-550
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 投资者特征的输入
- en: Asset allocation and portfolio performance
  id: totrans-551
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资产配置和投资组合表现
- en: Input for investor characteristics
  id: totrans-552
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 投资者特征的输入
- en: '[Figure 5-7](#Robo2) shows the input panel for the investor characteristics.
    This panel takes all the input regarding the investor’s demographic, financial,
    and behavioral attributes. These inputs are for the predicted variables we used
    in the risk tolerance model created in the preceding steps. The interface is designed
    to input the categorical and continuous variables in the correct format.'
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-7](#Robo2)显示了投资者特征的输入面板。该面板收集关于投资者人口统计学、财务和行为属性的所有输入。这些输入用于我们在前面步骤中创建的风险容忍度模型中的预测变量。界面设计为以正确格式输入分类和连续变量。'
- en: Once the inputs are submitted, we leverage the model saved in [“6.3\. Save model
    for later use”](#save_model). This model takes all the inputs and produces the
    risk tolerance of an investor (refer to the `predict_riskTolerance` function of
    the “Sample Robo-advisor” Jupyter notebook in the code repository for this book
    for more details). The risk tolerance prediction model is embedded in this dashboard
    and is triggered once the “Calculate Risk Tolerance” button is pressed after submitting
    the inputs.
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦提交了输入，我们利用保存在[“6.3\. 保存模型以备后用”](#save_model)中的模型。此模型接受所有输入并生成投资者的风险容忍度（有关更多详细信息，请参阅本书代码库中名为“Sample
    Robo-advisor”的Jupyter笔记本中的“predict_riskTolerance”函数）。风险容忍度预测模型嵌入在此仪表板中，并在提交输入后按下“计算风险容忍度”按钮时触发。
- en: '![mlbf 0507](Images/mlbf_0507.png)'
  id: totrans-555
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0507](Images/mlbf_0507.png)'
- en: Figure 5-7\. Robo-advisor input panel
  id: totrans-556
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-7\. 机器人顾问输入面板
- en: 7.2 Asset allocation and portfolio performance
  id: totrans-557
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 7.2 资产配置和投资组合表现
- en: '[Figure 5-8](#Robo3) shows the “Asset Allocation and Portfolio Performance”
    panel, which performs the following functionalities:'
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-8](#Robo3)显示了“资产配置和投资组合表现”面板，该面板执行以下功能：'
- en: Once the risk tolerance is computed using the model, it is displayed on the
    top of this panel.
  id: totrans-559
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一旦使用模型计算了风险容忍度，它将显示在此面板的顶部。
- en: In the next step, we pick the assets for our portfolio from the dropdown.
  id: totrans-560
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在下一步中，我们从下拉菜单中选择我们的投资组合资产。
- en: Once the list of assets are submitted, the traditional mean-variance portfolio
    allocation model is used to allocate the portfolio among the assets selected.
    Risk tolerance is one of the key inputs for this process. (Refer to the `get_asset_allocation`
    function of the “Sample Robo-advisor” Jupyter notebook in the code repository
    for this book for more details.)
  id: totrans-561
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提交资产列表后，使用传统的均值-方差投资组合分配模型来分配所选资产的投资组合。风险容忍度是此过程的关键输入之一。（有关更多详细信息，请参阅本书代码库中名为“Sample
    Robo-advisor”的Jupyter笔记本中的“get_asset_allocation”函数。）
- en: The dashboard also shows the historical performance of the allocated portfolio
    for an initial investment of *$100*.
  id: totrans-562
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仪表板还显示了以*100美元*初始投资的分配投资组合的历史表现。
- en: '![mlbf 0508](Images/mlbf_0508.png)'
  id: totrans-563
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 0508](Images/mlbf_0508.png)'
- en: Figure 5-8\. Robo-advisor asset allocation and portfolio performance panel
  id: totrans-564
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 5-8\. 机器人顾问资产配置和投资组合表现面板
- en: Although the dashboard is a basic version of the robo-advisor dashboard, it
    performs end-to-end asset allocation for an investor and provides the portfolio
    view and historical performance of the portfolio over a selected period. There
    are several potential enhancements to this prototype in terms of the interface
    and underlying models used. The dashboard can be enhanced to include additional
    instruments and incorporate additional features such as real-time portfolio monitoring,
    portfolio rebalancing, and investment advisory. In terms of the underlying models
    used for asset allocation, we have used the traditional mean-variance optimization
    method, but it can be further enhanced to use the allocation algorithms based
    on machine learning techniques such as eigen-portfolio, hierarchical risk parity,
    or reinforcement learning–based models, described in Chapters [7](ch07.xhtml#Chapter7),
    [8](ch08.xhtml#Chapter8) and [9](ch09.xhtml#Chapter9), respectively. The risk
    tolerance model can be further enhanced by using additional features or using
    the actual data of the investors rather than using data from the Survey of Consumer
    Finances.
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然仪表板是机器人顾问仪表板的基本版本，但它可以为投资者进行端到端资产配置，并提供选定期间的投资组合视图和历史绩效。在界面和底层模型使用方面，这个原型可以进行多个潜在的增强。仪表板可以增加额外的工具，并加入实时投资组合监控、投资组合再平衡和投资咨询等附加功能。在用于资产配置的底层模型方面，我们使用了传统的均值-方差优化方法，但可以进一步改进为使用基于机器学习技术的分配算法，如特征组合投资组合、层次风险平价或基于强化学习的模型，分别在第[7](ch07.xhtml#Chapter7)、[8](ch08.xhtml#Chapter8)和[9](ch09.xhtml#Chapter9)章节中描述。风险承受能力模型可以通过使用额外的特征或使用投资者的实际数据而非使用消费者金融调查数据进一步改进。
- en: Conclusion
  id: totrans-566
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 结论
- en: In this case study, we introduced the regression-based algorithm applied to
    compute an investor’s risk tolerance, followed by a demonstration of the model
    in a robo-advisor setup. We showed that machine learning models might be able
    to objectively analyze the behavior of different investors in a changing market
    and attribute these changes to variables involved in determining risk appetite.
    With an increase in the volume of investors’ data and the availability of rich
    machine learning infrastructure, such models might prove to be more useful than
    existing manual processes.
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个案例研究中，我们介绍了基于回归的算法，用于计算投资者的风险承受能力，随后演示了该模型在机器人顾问设置中的应用。我们展示了机器学习模型可以在不断变化的市场中客观分析不同投资者的行为，并将这些变化归因于决定风险偏好的相关变量。随着投资者数据量的增加和丰富的机器学习基础设施的可用性，这些模型可能比现有的手动流程更加实用。
- en: We saw that there is a nonlinear relationship between the variables and the
    risk tolerance. We analyzed the feature importance and found that results of the
    case study are quite intuitive. Income and net worth, followed by age and willingness
    to take risk, are the key variables to deciding risk tolerance. These variables
    have been considered key variables to model risk tolerance across academic and
    industry literature.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 我们发现变量与风险承受能力之间存在非线性关系。我们分析了特征的重要性，并发现案例研究的结果非常直观。收入和净值，其次是年龄和愿意承担风险，是决定风险承受能力的关键变量。这些变量被认为是跨学术和行业文献中模拟风险承受能力的关键变量。
- en: Through the robo-advisor dashboard powered by machine learning, we demonstrated
    an effective combination of data science and machine learning implementation in
    wealth management. Robo-advisors and investment managers could leverage such models
    and platforms to enhance the portfolio management process with the help of machine
    learning.
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: 通过由机器学习驱动的机器人顾问仪表板，我们展示了数据科学和机器学习在财富管理中的有效结合。机器人顾问和投资经理可以利用这些模型和平台增强投资组合管理流程，借助机器学习的帮助。
- en: '![](Images/bracket_bottom.png)'
  id: totrans-570
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_bottom.png)'
- en: 'Case Study 4: Yield Curve Prediction'
  id: totrans-571
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 案例研究 4：收益率曲线预测
- en: A *yield curve* is a line that plots yields (interest rates) of bonds having
    equal credit quality but differing maturity dates. This yield curve is used as
    a benchmark for other debt in the market, such as mortgage rates or bank lending
    rates. The most frequently reported yield curve compares the 3-months, 2-years,
    5-years, 10-years, and 30-years U.S. Treasury debt.
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
  zh: '*收益率曲线*是一条绘制具有相同信用质量但到期日期不同的债券收益率（利率）的线。这条收益率曲线被用作市场上其他债务（如抵押利率或银行贷款利率）的基准。最常报告的收益率曲线比较了3个月、2年、5年、10年和30年的美国国债。'
- en: The yield curve is the centerpiece in a fixed income market. Fixed income markets
    are important sources of finance for governments, national and supranational institutions,
    banks, and private and public corporations. In addition, yield curves are very
    important to investors in pension funds and insurance companies.
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: 收益率曲线是固定收益市场的核心。固定收益市场是政府、国家和超国家机构、银行以及私人和公共公司的重要融资来源。此外，收益率曲线对养老基金和保险公司的投资者非常重要。
- en: The yield curve is a key representation of the state of the bond market. Investors
    watch the bond market closely as it is a strong predictor of future economic activity
    and levels of inflation, which affect prices of goods, financial assets, and real
    estate. The slope of the yield curve is an important indicator of short-term interest
    rates and is followed closely by investors.
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
  zh: 收益率曲线是债券市场状况的关键表征。投资者密切关注债券市场，因为它是未来经济活动和通货膨胀水平的强有力预测者，这些因素会影响商品、金融资产和房地产的价格。收益率曲线的斜率是短期利率的重要指标，并受到投资者的密切关注。
- en: Hence, an accurate yield curve forecasting is of critical importance in financial
    applications. Several statistical techniques and tools commonly used in econometrics
    and finance have been applied to model the yield curve.
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，准确的收益率曲线预测在金融应用中至关重要。已经应用了几种通常用于建模收益率曲线的计量经济学和金融学中常用的统计技术和工具。
- en: In this case study we will use supervised learning–based models to predict the
    yield curve. This case study is inspired by the paper *Artificial Neural Networks
    in Fixed Income Markets for Yield Curve Forecasting* by Manuel Nunes et al. (2018).
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: 在本案例研究中，我们将使用基于监督学习的模型来预测收益率曲线。本案例研究受到曼努埃尔·努内斯等人（2018年）的论文*《固定收益市场中的人工神经网络用于收益率曲线预测》*的启发。
- en: 'Overall, the case study is similar to the stock price prediction case study
    presented earlier in this chapter, with the following differences:'
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，本案例研究与本章前面介绍的股价预测案例研究相似，但存在以下区别：
- en: We predict multiple outputs simultaneously, rather than a single output.
  id: totrans-578
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们同时预测多个输出，而不是单个输出。
- en: The predicted variable in this case study is not the return variable.
  id: totrans-579
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本案例研究中的预测变量不是回报变量。
- en: Given that we already covered time series models in case study 1, we focus on
    artificial neural networks for prediction in this case study.
  id: totrans-580
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 鉴于我们已经在案例研究1中涵盖了时间序列模型，我们将在本案例研究中专注于人工神经网络进行预测。
- en: '![](Images/bracket_top.png)'
  id: totrans-581
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_top.png)'
- en: Blueprint for Using Supervised Learning Models to Predict the Yield Curve
  id: totrans-582
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用监督学习模型预测收益率曲线的蓝图
- en: 1\. Problem definition
  id: totrans-583
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1\. 问题定义
- en: In the supervised regression framework used for this case study, three tenors
    (1M, 5Y, and 30Y) of the yield curve are the predicted variables. These tenors
    represent short-term, medium-term, and long-term tenors of the yield curve.
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
  zh: 在本案例研究中使用的监督回归框架中，收益率曲线的三个期限（1M、5Y和30Y）是预测变量。这些期限代表了收益率曲线的短期、中期和长期期限。
- en: 'We need to understand what affects the movement of the yield curve and hence
    incorporate as much information into our model as we can. As a high-level overview,
    other than the historical price of the yield curve itself, we look at other correlated
    variables that can influence the yield curve. The independent or predictor variables
    we consider are:'
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要了解什么影响了收益率曲线的变动，因此尽可能将更多信息纳入我们的模型中。作为高层次的概述，除了收益率曲线的历史价格外，我们还考虑了其他可能影响收益率曲线的相关变量。我们考虑的独立或预测变量是：
- en: '*Previous value of the treasury curve for different tenors*. The tenors used
    are 1-month, 3-month, 1-year, 2-year, 5-year, 7-year, 10-year, and 30-year yields.'
  id: totrans-586
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*不同期限的国债收益率的前值*。使用的期限为1个月、3个月、1年、2年、5年、7年、10年和30年。'
- en: '*Percentage of the federal debt* held by the public, foreign governments, and
    the federal reserve.'
  id: totrans-587
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*联邦债务*由公众、外国政府和联邦储备所持有的百分比。'
- en: '*Corporate spread* on Baa-rated debt relative to the 10-year treasury rate.'
  id: totrans-588
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Baa评级债务的公司利差相对于10年期国债利率。'
- en: The federal debt and corporate spread are correlated variables and can be potentially
    useful in modeling the yield curve. The dataset used for this case study is extracted
    from Yahoo Finance and [FRED](https://fred.stlouisfed.org). We will use the daily
    data of the last 10 years, from 2010 onward.
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: 联邦债务和公司利差是相关变量，可能对收益率曲线的建模有用。本案例研究使用的数据集从Yahoo Finance和[FRED](https://fred.stlouisfed.org)中提取。我们将使用自2010年以来过去10年的每日数据。
- en: By the end of this case study, readers will be familiar with a general machine
    learning approach to yield curve modeling, from gathering and cleaning data to
    building and tuning different models.
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: 在本案例研究结束时，读者将熟悉一个通用的机器学习方法来进行收益率曲线建模，从数据收集和清理到构建和调整不同的模型。
- en: 2\. Getting started—loading the data and Python packages
  id: totrans-591
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2\. 入门—加载数据和Python包
- en: 2.1\. Loading the Python packages
  id: totrans-592
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.1\. 加载Python包
- en: The loading of Python packages is similar to other case studies in this chapter.
    Refer to the Jupyter notebook of this case study for more details.
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
  zh: Python包的加载与本章其他案例研究类似。更多细节请参考本案例研究的Jupyter笔记本。
- en: 2.2\. Loading the data
  id: totrans-594
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 2.2\. 加载数据
- en: 'The following steps demonstrate the loading of data using Pandas’s `DataReader`
    function:'
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的步骤演示了使用Pandas的`DataReader`函数加载数据：
- en: '[PRE85]'
  id: totrans-596
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: Next, we define our dependent (*Y*) and independent (*X*) variables. The predicted
    variables are the rate for three tenors of the yield curve (i.e., 1M, 5Y, and
    30Y) as mentioned before. The number of trading days in a week is assumed to be
    five, and we compute the lagged version of the variables mentioned in the problem
    definition section as independent variables using five trading day lag.
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们定义我们的依赖变量（*Y*）和独立变量（*X*）。如前所述，预测变量是三个期限的收益率（即1个月、5年和30年）。一周的交易日数假设为五天，并且我们使用五个交易日的滞后版本作为独立变量来计算问题定义部分提到的变量。
- en: The lagged five-day variables embed the time series component by using a *time-delay
    approach*, where the lagged variable is included as one of the independent variables.
    This step reframes the time series data into a supervised regression–based model
    framework.
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: 使用滞后五天的变量通过*时间延迟方法*嵌入了时间序列组件，其中滞后变量被包含为一个独立变量。这一步将时间序列数据重新构建为基于监督回归的模型框架。
- en: 3\. Exploratory data analysis
  id: totrans-599
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3\. 探索性数据分析
- en: We will look at descriptive statistics and data visualization in this section.
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将查看描述性统计和数据可视化。
- en: 3.1\. Descriptive statistics
  id: totrans-601
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.1\. 描述性统计
- en: 'Let us look at the shape and the columns in the dataset:'
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看一下数据集的形状和列：
- en: '[PRE86]'
  id: totrans-603
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: '`Output`'
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '[PRE87]'
  id: totrans-605
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: The data contains around 500 observations with 15 columns.
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包含大约500个观测值和15列。
- en: 3.2\. Data visualization
  id: totrans-607
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 3.2\. 数据可视化
- en: 'Let us first plot the predicted variables and see their behavior:'
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先绘制预测变量并观察它们的行为：
- en: '[PRE88]'
  id: totrans-609
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: '`Output`'
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in20](Images/mlbf_05in20.png)'
  id: totrans-611
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in20](Images/mlbf_05in20.png)'
- en: In the plot, we see that the deviation among the short-term, medium-term, and
    long-term rates was higher in 2010 and has been decreasing since then. There was
    a drop in the long-term and medium-term rates during 2011, and they also have
    been declining since then. The order of the rates has been in line with the tenors.
    However, for a few months in recent years, the *5Y* rate has been lower than the
    *1M* rate. In the time series of all the tenors, we can see that the mean varies
    with time, resulting in an upward trend. Thus these series are nonstationary time
    series.
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
  zh: 在图中，我们看到短期、中期和长期利率之间的偏差在2010年较大，此后有所减少。2011年长期和中期利率下降，此后也一直在下降。利率的顺序符合期限的顺序。然而，近年来有几个月，*5Y*利率低于*1M*利率。在所有期限的时间序列中，我们可以看到均值随时间变化，呈上升趋势。因此，这些系列是非平稳时间序列。
- en: In some cases, the linear regression for such nonstationary dependent variables
    might not be valid. However, we are using the lagged variables, which are also
    nonstationary as independent variables. So we are effectively modeling a nonstationary
    time series against another nonstationary time series, which might still be valid.
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，对于这样的非平稳依赖变量，线性回归可能不适用。然而，我们使用的滞后变量作为独立变量同样是非平稳的。因此，我们实际上是在对非平稳时间序列进行建模，这可能仍然有效。
- en: 'Next, we look at the scatterplots (a correlation plot is skipped for this case
    study as it has a similar interpretation to that of a scatterplot). We can visualize
    the relationship between all the variables in the regression using the scatter
    matrix shown below:'
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们看一下散点图（本案例研究跳过了相关性图，因为它与散点图有类似的解释）。我们可以通过下面显示的散点矩阵可视化回归中所有变量之间的关系：
- en: '[PRE89]'
  id: totrans-615
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: '`Output`'
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in21](Images/mlbf_05in21.png)'
  id: totrans-617
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in21](Images/mlbf_05in21.png)'
- en: Looking at the scatterplot (full-size version available on [GitHub](https://oreil.ly/XIsvu)),
    we see a significant linear relationship of the predicted variables with their
    lags and other tenors of the yield curve. There is also a linear relationship,
    with negative slope between 1M, 5Y rates versus corporate spread and changes in
    foreign government purchases. The 30Y rate shows a linear relationship with these
    variables, although the slope is negative. Overall, we see a lot of linear relationships,
    and we expect the linear models to perform well.
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
  zh: 查看散点图（完整版本可在[GitHub](https://oreil.ly/XIsvu)上找到），我们看到了预测变量与它们的滞后值和收益率曲线的其他期限之间的显著线性关系。
    还存在线性关系，1M、5Y利率与企业利差和外国政府购买变化之间的斜率为负。 30Y利率与这些变量之间存在线性关系，尽管斜率为负。 总体而言，我们看到许多线性关系，并且我们期望线性模型表现良好。
- en: 4\. Data preparation and analysis
  id: totrans-619
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 4\. 数据准备和分析
- en: We performed most of the data preparation steps (i.e., getting the dependent
    and independent variables) in the preceding steps, and so we’ll skip this step.
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在前面的步骤中执行了大部分数据准备步骤（即获取因变量和自变量），因此我们将跳过此步骤。
- en: 5\. Evaluate models
  id: totrans-621
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 5\. 评估模型
- en: In this step we evaluate the models. The Python code for this step is similar
    to dthat in case study 1, and some of the repetitive code is skipped. Readers
    can also refer to the Jupyter notebook of this case study in the code repository
    for this book for more details.
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一步中，我们评估模型。 这一步的Python代码与案例研究1中的代码类似，并且跳过了一些重复的代码。 读者还可以参考本书代码存储库中此案例研究的Jupyter笔记本以获取更多详细信息。
- en: 5.1\. Train-test split and evaluation metrics
  id: totrans-623
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.1\. 训练-测试分割和评估指标
- en: We will use 80% of the dataset for modeling and use 20% for testing. We will
    evaluate algorithms using the mean squared error metric. All the algorithms use
    default tuning parameters.
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用数据集的80%进行建模，并使用20%进行测试。 我们将使用均方误差度量评估算法。 所有算法使用默认调整参数。
- en: 5.2\. Compare models and algorithms
  id: totrans-625
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 5.2\. 比较模型和算法
- en: In this case study, the primary purpose is to compare the linear models with
    the artificial neural network in yield curve modeling. So we stick to the linear
    regression (LR), regularized regression (LASSO and EN), and artificial neural
    network (shown as MLP). We also include a few other models such as KNN and CART,
    as these models are simpler with good interpretation, and if there is a nonlinear
    relationship between the variables, the CART and KNN models will be able to capture
    it and provide a good comparison benchmark for ANN.
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
  zh: 在本案例研究中，主要目的是将线性模型与人工神经网络在收益率曲线建模中进行比较。 因此，我们坚持使用线性回归（LR）、正则化回归（LASSO 和 EN）和人工神经网络（表示为MLP）。
    我们还包括一些其他模型，如KNN和CART，因为这些模型更简单，具有良好的解释性，如果变量之间存在非线性关系，CART和KNN模型将能够捕捉到并提供ANN的良好比较基准。
- en: Looking at the training and test error, we see a good performance of the linear
    regression model. We see that lasso and elastic net perform poorly. These are
    regularized regression models, and they reduce the number of variables in case
    they are not important. A decrease in the number of variables might have caused
    a loss of information leading to poor model performance. KNN and CART are good,
    but looking closely, we see that the test errors are higher than the training
    error. We also see that the performance of the artificial neural network (MLP)
    algorithm is comparable to the linear regression model. Despite its simplicity,
    the linear regression is a tough benchmark to beat for one-step-ahead forecasting
    when there is a significant linear relationship between the variables.
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: 查看训练和测试误差，我们看到线性回归模型的性能良好。 我们看到套索和弹性网表现不佳。 这些都是正则化回归模型，如果不重要，它们会减少变量的数量。 变量数量的减少可能导致信息丢失，从而导致模型性能不佳。
    KNN和CART都不错，但仔细观察，我们会发现测试错误高于训练错误。 我们还看到人工神经网络（MLP）算法的性能与线性回归模型相当。 尽管简单，但在变量之间存在显著线性关系时，线性回归是难以超越的一步预测的坚实基准。
- en: '`Output`'
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
  zh: '`输出`'
- en: '![mlbf 05in22](Images/mlbf_05in22.png)'
  id: totrans-629
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in22](Images/mlbf_05in22.png)'
- en: 6\. Model tuning and grid search.
  id: totrans-630
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6\. 模型调整和网格搜索。
- en: Similar to case study 2 of this chapter, we perform a grid search of the ANN
    model with different combinations of hidden layers. Several other hyperparameters
    such as learning rate, momentum, activation function, number of epochs, and batch
    size can be tuned during the grid search process, similar to the steps mentioned
    below.
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: 与本章案例研究2类似，我们对ANN模型进行了网格搜索，尝试不同的隐藏层组合。在网格搜索过程中还可以调整几个其他超参数，如学习率、动量、激活函数、迭代次数和批量大小，这与下面提到的步骤类似。
- en: '[PRE90]'
  id: totrans-632
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: '`Output`'
  id: totrans-633
  prefs: []
  type: TYPE_NORMAL
  zh: '`Output`'
- en: '[PRE91]'
  id: totrans-634
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: The best model is the model with three layers, with 20, 30, and 20 nodes in
    each hidden layer, respectively. Hence, we prepare a model with this configuration
    and check its performance on the test set. This is a crucial step, as a greater
    number of layers may lead to overfitting and have poor performance in the test
    set.
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳模型是具有三层的模型，每个隐藏层分别具有20、30和20个节点。因此，我们准备了一个具有这种配置的模型，并在测试集上检验其性能。这是一个关键步骤，因为更多的层可能导致过度拟合，并在测试集上表现不佳。
- en: Prediction comparison
  id: totrans-636
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 预测比较
- en: In the last step we look at the prediction plot of actual data versus the prediction
    from both linear regression and ANN models. Refer to the Jupyter notebook of this
    case study for the Python code of this section.
  id: totrans-637
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，我们查看了实际数据与线性回归和ANN模型预测之间的预测图。有关本节Python代码，请参阅本案例研究的Jupyter笔记本。
- en: '![mlbf 05in23](Images/mlbf_05in23.png)![mlbf 05in24](Images/mlbf_05in24.png)![mlbf
    05in25](Images/mlbf_05in25.png)'
  id: totrans-638
  prefs: []
  type: TYPE_IMG
  zh: '![mlbf 05in23](Images/mlbf_05in23.png)![mlbf 05in24](Images/mlbf_05in24.png)![mlbf
    05in25](Images/mlbf_05in25.png)'
- en: Looking at the charts above, we see that the predictions of the linear regression
    and ANN are comparable. For 1M tenor, the fitting with ANN is slightly poor compared
    to the regression. However, for 5Y and 30Y tenors the ANN performs as well as
    the regression model.
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: 从上面的图表中可以看出，线性回归和ANN的预测是可比较的。对于1M期限，ANN的拟合稍逊于回归模型。然而，对于5Y和30Y期限，ANN的表现与回归模型一样好。
- en: Conclusion
  id: totrans-640
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 结论
- en: In this case study, we applied supervised regression to the prediction of several
    tenors of yield curve. The linear regression model, despite its simplicity, is
    a tough benchmark to beat for such one-step-ahead forecasting, given the dominant
    characteristic of the last available value of the variable to predict. The ANN
    results in this case study are comparable to the linear regression models. An
    additional benefit of ANN is that it is more flexible to changing market conditions.
    Also, ANN models can be enhanced by performing grid search on several other hyperparameters
    and the option of incorporating recurrent neural networks, such as LSTM.
  id: totrans-641
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个案例研究中，我们应用监督回归来预测多种期限的收益率曲线。尽管线性回归模型简单，但在预测单步前景时是一个难以超越的严格基准，因为其主要特征是要预测的变量的最后一个可用值。在这个案例研究中，ANN的结果与线性回归模型相当。ANN的另一个优点是，它对市场条件的变化更加灵活。此外，通过对几个其他超参数进行网格搜索和包括递归神经网络（如LSTM）的选项，可以增强ANN模型。
- en: Overall, we built a machine learning–based model using ANN with an encouraging
    outcome, in the context of fixed income instruments. This allows us to perform
    predictions using historical data to generate results and analyze risk and profitability
    before risking any actual capital in the fixed income market.
  id: totrans-642
  prefs: []
  type: TYPE_NORMAL
  zh: 总体而言，我们使用了ANN构建了一个基于机器学习的模型，在固定收益工具的背景下取得了令人鼓舞的结果。这使我们能够使用历史数据进行预测并分析风险和盈利能力，而不必在固定收益市场中冒任何实际资本的风险。
- en: '![](Images/bracket_bottom.png)'
  id: totrans-643
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/bracket_bottom.png)'
- en: Chapter Summary
  id: totrans-644
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 章节总结
- en: 'In [“Case Study 1: Stock Price Prediction”](#CaseStudy1SR), we covered a machine
    learning and time series–based framework for stock price prediction. We demonstrated
    the significance of visualization and compared time series against the machine
    learning models. In [“Case Study 2: Derivative Pricing”](#CaseStudy2SR), we explored
    the use of machine learning for a traditional derivative pricing problem and demonstrated
    a high model performance. In [“Case Study 3: Investor Risk Tolerance and Robo-Advisors”](#CaseStudy3SR),
    we demonstrated how supervised learning models can be used to model the risk tolerance
    of investors, which can lead to automation of the portfolio management process.
    [“Case Study 4: Yield Curve Prediction”](#CaseStudy4SR) was similar to the stock
    price prediction case study, providing another example of comparison of linear
    and nonlinear models in the context of fixed income markets.'
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [“股票价格预测案例研究1”](#CaseStudy1SR) 中，我们涵盖了基于机器学习和时间序列的股票价格预测框架。我们展示了可视化的重要性，并比较了时间序列与机器学习模型。在
    [“衍生品定价案例研究2”](#CaseStudy2SR) 中，我们探讨了用于传统衍生品定价问题的机器学习应用，并展示了高模型性能。在 [“投资者风险容忍度和智能顾问案例研究3”](#CaseStudy3SR)
    中，我们展示了如何使用监督学习模型来模拟投资者的风险容忍度，这可以导致投资组合管理过程的自动化。[“收益率曲线预测案例研究4”](#CaseStudy4SR)
    与股票价格预测案例研究类似，在固定收益市场的背景下比较了线性和非线性模型的另一个例子。
- en: We saw that time series and linear supervised learning models worked well for
    asset price prediction problems (i.e., case studies 1 and 4), where the predicted
    variable had a significant linear relationship with its lagged component. However,
    in derivative pricing and risk tolerance prediction, where there are nonlinear
    relationships, ensemble and ANN models performed better. Readers who are interested
    in implementing a case study using supervised regression or time series models
    are encouraged to understand the nuances in the variable relationships and model
    intuition before proceeding to model selection.
  id: totrans-646
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到时间序列和线性监督学习模型在资产价格预测问题（即案例研究1和4）中表现良好，其中预测变量与其滞后组件有显著的线性关系。然而，在衍生品定价和风险容忍度预测中，存在非线性关系，集成和ANN模型表现更好。鼓励有兴趣使用监督回归或时间序列模型进行案例研究实施的读者，在进行模型选择之前理解变量关系和模型直觉的细微差别。
- en: Overall, the concepts in Python, machine learning, time series, and finance
    presented in this chapter through the case studies can used as a blueprint for
    any other supervised regression–based problem in finance.
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，本章通过案例研究展示的Python、机器学习、时间序列和金融概念可以作为金融中任何其他基于监督回归的问题的蓝图。
- en: Exercises
  id: totrans-648
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 练习
- en: Using the concepts and framework of machine learning and time series models
    specified in case study 1, develop a predictive model for another asset class—currency
    pair (EUR/USD, for example) or bitcoin.
  id: totrans-649
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用案例研究1中指定的机器学习和时间序列模型的概念和框架，为另一个资产类别（如货币对EUR/USD或比特币）开发预测模型。
- en: 'In case study 1, add some technical indicators, such as trend or momentum,
    and check the enhancement in the model performance. Some of the ideas of the technical
    indicators can be borrowed from [“Case Study 3: Bitcoin Trading Strategy”](ch06.xhtml#CaseStudy3SC)
    in [Chapter 6](ch06.xhtml#Chapter6).'
  id: totrans-650
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在案例研究1中，添加一些技术指标，如趋势或动量，并检查模型性能的提升。某些技术指标的想法可以从 [“比特币交易策略案例研究3”](ch06.xhtml#CaseStudy3SC)
    中借鉴，在[第6章](ch06.xhtml#Chapter6)。
- en: 'Using the concepts in [“Case Study 2: Derivative Pricing”](#CaseStudy2SR),
    develop a machine learning–based model to price [American options](https://oreil.ly/EMUXv).'
  id: totrans-651
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 [“衍生品定价案例研究2”](#CaseStudy2SR) 中的概念，开发一个基于机器学习的模型来定价[美式期权](https://oreil.ly/EMUXv)。
- en: Incorporate multivariate time series modeling using a variant of the ARIMA model,
    such as [VARMAX](https://oreil.ly/t7s8q), for rates prediction in the yield curve
    prediction case study and compare the performance against the machine learning–based
    models.
  id: totrans-652
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在收益率曲线预测案例研究中，利用多变量时间序列建模，例如[VARMAX](https://oreil.ly/t7s8q)，并与基于机器学习的模型进行性能比较。
- en: 'Enhance the robo-advisor dashboard presented in [“Case Study 3: Investor Risk
    Tolerance and Robo-Advisors”](#CaseStudy3SR) to incorporate instruments other
    than equities.'
  id: totrans-653
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加强 [“投资者风险容忍度和智能顾问案例研究3”](#CaseStudy3SR) 中呈现的智能顾问仪表板，以纳入除股票以外的工具。
- en: ^([1](ch05.xhtml#idm45174931460040-marker)) There may be reordering or renaming
    of the steps or substeps based on the appropriateness and intuitiveness of the
    steps/substeps.
  id: totrans-654
  prefs: []
  type: TYPE_NORMAL
  zh: ^([1](ch05.xhtml#idm45174931460040-marker)) 根据步骤和子步骤的适当性和直觉性可能会重新排序或重命名步骤或子步骤。
- en: ^([2](ch05.xhtml#idm45174931449640-marker)) An exogenous variable is one whose
    value is determined outside the model and imposed on the model.
  id: totrans-655
  prefs: []
  type: TYPE_NORMAL
  zh: ^([2](ch05.xhtml#idm45174931449640-marker)) 外生变量是指其值由模型外部决定并强加于模型的变量。
- en: ^([3](ch05.xhtml#idm45174931422552-marker)) These models are discussed later
    in this chapter.
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: ^([3](ch05.xhtml#idm45174931422552-marker)) 这些模型将在本章后面讨论。
- en: ^([4](ch05.xhtml#idm45174931421656-marker)) There may be reordering or renaming
    of the steps or substeps based on the appropriateness and intuitiveness of the
    steps/substeps.
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
  zh: ^([4](ch05.xhtml#idm45174931421656-marker)) 根据步骤或子步骤的适当性和直觉性可能会重新排序或重命名步骤或子步骤。
- en: ^([5](ch05.xhtml#idm45174931308056-marker)) A white noise process is a random
    process of random variables that are uncorrelated and have a mean of zero and
    a finite variance.
  id: totrans-658
  prefs: []
  type: TYPE_NORMAL
  zh: ^([5](ch05.xhtml#idm45174931308056-marker)) 白噪声过程是一种随机过程，其随机变量是不相关的，均值为零，有有限方差。
- en: ^([6](ch05.xhtml#idm45174931138088-marker)) A detailed explanation of LSTM models
    can be found in this [blog post by Christopher Olah](https://oreil.ly/4PDhr) .
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: ^([6](ch05.xhtml#idm45174931138088-marker)) LSTM模型的详细解释可以在Christopher Olah的[博客文章](https://oreil.ly/4PDhr)中找到。
- en: ^([7](ch05.xhtml#idm45174931122968-marker)) An ARIMA model and a Keras-based
    LSTM model will be demonstrated in one of the case studies.
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: ^([7](ch05.xhtml#idm45174931122968-marker)) 将在其中一个案例研究中展示ARIMA模型和基于Keras的LSTM模型。
- en: '^([8](ch05.xhtml#idm45174930951640-marker)) Refer to [“Case Study 3: Bitcoin
    Trading Strategy”](ch06.xhtml#CaseStudy3SC) presented in [Chapter 6](ch06.xhtml#Chapter6)
    and [“Case Study 1: NLP and Sentiment Analysis–Based Trading Strategies”](ch10.xhtml#CaseStudy1NLP)
    presented in [Chapter 10](ch10.xhtml#Chapter10) to understand the usage of technical
    indicators and news-based fundamental analysis as features in the price prediction.'
  id: totrans-661
  prefs: []
  type: TYPE_NORMAL
  zh: ^([8](ch05.xhtml#idm45174930951640-marker)) 参考[“第三案例研究：比特币交易策略”](ch06.xhtml#CaseStudy3SC)（见[第6章](ch06.xhtml#Chapter6)）和[“第一案例研究：基于NLP和情感分析的交易策略”](ch10.xhtml#CaseStudy1NLP)（见[第10章](ch10.xhtml#Chapter10)）了解技术指标和基于新闻的基本分析作为价格预测中的特征的使用。
- en: ^([9](ch05.xhtml#idm45174930944792-marker)) Equity markets have trading holidays,
    while currency markets do not. However, the alignment of the dates across all
    the time series is ensured before any modeling or analysis.
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
  zh: ^([9](ch05.xhtml#idm45174930944792-marker)) 股票市场有交易假期，而货币市场没有。然而，在进行任何建模或分析之前，确保所有时间序列的日期对齐。
- en: ^([10](ch05.xhtml#idm45174930595336-marker)) In different case studies across
    the book we will demonstrate loading the data through different sources (e.g.,
    CSV, and external websites like quandl).
  id: totrans-663
  prefs: []
  type: TYPE_NORMAL
  zh: ^([10](ch05.xhtml#idm45174930595336-marker)) 在本书的不同案例研究中，我们将展示通过不同来源（例如CSV和像quandl这样的外部网站）加载数据的方法。
- en: ^([11](ch05.xhtml#idm45174929976312-marker)) The time series is not the stock
    price but stock return, so the trend is mild compared to the stock price series.
  id: totrans-664
  prefs: []
  type: TYPE_NORMAL
  zh: ^([11](ch05.xhtml#idm45174929976312-marker)) 时间序列不是股票价格而是股票回报率，因此与股票价格序列相比，趋势较为温和。
- en: ^([12](ch05.xhtml#idm45174927997912-marker)) The predicted variable, which is
    the option price, should ideally be directly obtained for the market. Given this
    case study is more for demonstration purposes, we use model-generated option price
    for the sake of convenience.
  id: totrans-665
  prefs: []
  type: TYPE_NORMAL
  zh: ^([12](ch05.xhtml#idm45174927997912-marker)) 预测变量即期权价格，理想情况下应直接从市场获取。鉴于此案例研究更多用于演示目的，我们为了方便起见使用模型生成的期权价格。
- en: ^([13](ch05.xhtml#idm45174927663880-marker)) When the spot price is equal to
    the strike price, at-the-money option.
  id: totrans-666
  prefs: []
  type: TYPE_NORMAL
  zh: ^([13](ch05.xhtml#idm45174927663880-marker)) 当现货价格等于行权价格时，称为平值期权。
- en: ^([14](ch05.xhtml#idm45174927344984-marker)) Refer to the Jupyter notebook of
    this case study to go through other charts such as histogram plot and correlation
    plot.
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: ^([14](ch05.xhtml#idm45174927344984-marker)) 参考本案例研究的Jupyter笔记本，浏览其他图表如直方图和相关图。
- en: ^([15](ch05.xhtml#idm45174926472776-marker)) Given that the primary purpose
    of the model is to be used in the portfolio management context, the individual
    is also referred to as investor in the case study.
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: ^([15](ch05.xhtml#idm45174926472776-marker)) 鉴于模型的主要目的是在投资组合管理背景下使用，本案例研究中个人也被称为投资者。
- en: ^([16](ch05.xhtml#idm45174926394984-marker)) There potentially can be several
    ways of computing the risk tolerance. In this case study, we use the intuitive
    ways to measure the risk tolerance of an individual.
  id: totrans-669
  prefs: []
  type: TYPE_NORMAL
  zh: ^([16](ch05.xhtml#idm45174926394984-marker)) 计算风险容忍度可能有多种方法。在这个案例研究中，我们使用直观的方法来衡量个人的风险容忍度。
- en: ^([17](ch05.xhtml#idm45174925517336-marker)) We could have chosen RMSE as the
    evaluation metric; however, R² was chosen as the evaluation metric given that
    we already used RMSE as the evaluation metric in the previous case studies.
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
  zh: ^([17](ch05.xhtml#idm45174925517336-marker)) 我们本可以选择 RMSE 作为评估指标；然而，鉴于我们在之前的案例研究中已经使用了
    RMSE 作为评估指标，因此选择了 R² 作为评估指标。
