<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. AI-First Finance"><div class="chapter" id="ai_first_finance">
<h1><span class="label">Chapter 6. </span>AI-First Finance</h1>

<blockquote>
<p class="align_me_right">A computation takes information and transforms it, implementing what mathematicians call a <em>function</em>….If you’re in possession of a function that inputs all the world’s financial data and outputs the best stocks to buy, you’ll soon be extremely rich.</p>
<p data-type="attribution">Max Tegmark (2017)</p>
</blockquote>

<p><a data-type="indexterm" data-primary="AI-first finance" id="ix_AI-firstfin_ch6"/>This chapter sets out to combine data-driven finance with the machine learning approach from the previous chapter. It only represents the beginning of this endeavor in that, for the first time, neural networks are used to discover statistical inefficiencies. <a data-type="xref" href="#aiff_efficiency">“Efficient Markets”</a> discusses the efficient market hypothesis and uses OLS regression to illustrate it based on financial time series data. <a data-type="xref" href="#aiff_returns">“Market Prediction Based on Returns Data”</a> for the first time applies neural networks, alongside OLS regression, to predict the future direction of a financial instrument’s price (“market direction”). The analysis relies on returns data only. <a data-type="xref" href="#aiff_features">“Market Prediction with More Features”</a> adds more features to the mix, such as typical financial indicators. In this context, first results indicate that statistical inefficiencies might indeed be present. This is confirmed in <a data-type="xref" href="#aiff_intraday">“Market Prediction Intraday”</a>, which works with intraday data as compared to end-of-day data. Finally, <a data-type="xref" href="#aiff_effectiveness">“Conclusions”</a> discusses the effectiveness of big data in combination with AI in certain domains and argues that AI-first, theory-free finance might represent a way out of the theory fallacies in traditional finance.</p>






<section data-type="sect1" data-pdf-bookmark="Efficient Markets"><div class="sect1" id="aiff_efficiency">
<h1>Efficient Markets</h1>

<p><a data-type="indexterm" data-primary="EMH (efficient market hypothesis)" id="ix_emh_ai-first_ch6"/><a data-type="indexterm" data-primary="AI-first finance" data-secondary="efficient markets hypothesis" id="ix_ai-first_emh_ch6"/>One of the hypotheses with the strongest empirical support is the <em>efficient market hypothesis</em> (EMH). It is also called the <em>random walk hypothesis</em> (RWH).<sup><a data-type="noteref" id="idm45625304814120-marker" href="ch06.xhtml#idm45625304814120">1</a></sup> Simply speaking, the hypothesis says that the prices of financial instruments at a certain point in time reflect all available information at this point in time. If the EMH holds true, a discussion about whether the price of a stock is too high or too low would be pointless. The price of a stock, given the EMH, is at all times exactly on its appropriate level given the available information.</p>

<p>Lots of effort has been put into refining and formalizing the idea of efficient markets since the formulation and first discussions of the EMH in the 1960s. The definitions as presented in Jensen (1978) are still used today. Jensen defines an efficient market as follows:</p>
<blockquote>
<p>A market is efficient with respect to an information set <math alttext="theta Subscript t">
  <msub><mi>θ</mi> <mi>t</mi> </msub>
</math> if it is impossible to make economic profits by trading on the basis of information set <math alttext="theta Subscript t">
  <msub><mi>θ</mi> <mi>t</mi> </msub>
</math>. By economic profits, we mean the risk adjusted returns net of all costs.</p></blockquote>

<p>In this context, Jensen distinguishes three forms of market efficiency:</p>
<dl>
<dt>Weak form of EMH</dt>
<dd>
<p><a data-type="indexterm" data-primary="weak form market efficiency" id="idm45625303868184"/>In this case, the information set <math alttext="theta Subscript t">
  <msub><mi>θ</mi> <mi>t</mi> </msub>
</math> only encompasses the past price and return history of the market.</p>
</dd>
<dt>Semi-strong form of EMH</dt>
<dd>
<p><a data-type="indexterm" data-primary="semi-strong form of EMH" id="idm45625304455848"/>In this case, the information set <math alttext="theta Subscript t">
  <msub><mi>θ</mi> <mi>t</mi> </msub>
</math> is taken to be all publicly available information, including not only the past price and return history but also financial reports, news articles, weather data, and so on.</p>
</dd>
<dt>Strong form of EMH</dt>
<dd>
<p><a data-type="indexterm" data-primary="strong form of EMH" id="idm45625304451912"/>This case is given when the information set <math alttext="theta Subscript t">
  <msub><mi>θ</mi> <mi>t</mi> </msub>
</math> includes all information available to anyone (that is, even private information).</p>
</dd>
</dl>

<p>No matter which form is assumed, the implications of the EMH are far reaching. <a data-type="indexterm" data-primary="Fama, Eugene" id="idm45625304448696"/>In his pioneering article on the EMH, Fama (1965) concludes the following:</p>
<blockquote>
<p>For many years, economists, statisticians, and teachers of finance have been interested in developing and testing models of stock price behavior. One important model that has evolved from this research is the theory of random walks. This theory casts serious doubt on many other methods for describing and predicting stock price behavior—methods that have considerable popularity outside the academic world. For example, we shall see later that, if the random-walk theory is an accurate description of reality, then the various “technical” or “chartist” procedures for predicting stock prices are completely without value.</p></blockquote>

<p>In other words, if the EMH holds true, then any kind of research or data analysis for the purposes of achieving above-market returns should be useless in practice. On the other hand, a multitrillion-dollar asset management industry has evolved that promises such above-market returns due to rigorous research and the active management of capital. In particular, the hedge fund industry is based on promises to deliver <em>alpha</em>—that is, returns that are above-market and even independent, at least to a large extent, of the market returns. How hard it is to live up to such a promise is shown by the data from a recent study by <a href="https://oreil.ly/C38Tl">Preqin</a>. The study reports a drop in the Preqin All-Strategies Hedge Fund index of –3.42% for the year 2018. Close to 40% of all hedge funds covered by the study experienced losses of 5% or greater for that year.</p>

<p><a data-type="indexterm" data-primary="normally distributed returns" id="idm45625303740744"/><a data-type="indexterm" data-primary="returns" data-secondary="normally distributed" id="idm45625303740072"/>If a stock price (or the price of any other financial instrument) follows a standard random walk, then the returns are normally distributed with zero mean. The stock price goes up with 50% probability and down with 50% probability. In such a context, the best predictor of tomorrow’s stock price, in a least-squares sense, is today’s stock price. <a data-type="indexterm" data-primary="Markov property of random walks" id="idm45625303738632"/>This is due to the Markov property of random walks, namely that the distribution of the future stock prices is independent of the history of the price process; it only depends on the current price level. Therefore, in the context of a random walk, the analysis of the historical prices (or returns) is useless for predicting future prices.</p>

<p><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="efficient markets test" id="ix_OLS_effic_market_test"/>Against this background, a semiformal test for efficient markets can be implemented as follows.<sup><a data-type="noteref" id="idm45625303735832-marker" href="ch06.xhtml#idm45625303735832">2</a></sup> Take a financial time series, lag the price data multiple times, and use the lagged price data as features data for an OLS regression that uses the current price level as the labels data. This is similar in spirit to charting techniques that rely on historical price formations to predict future prices.</p>

<p>The following Python code implements such an analysis based on lagged price data for a number of financial instruments—both tradable ones and nontradable ones. First, import the data and its visualization (see <a data-type="xref" href="#figure_aiff_01">Figure 6-1</a>):</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">pylab</code><code> </code><code class="kn">import</code><code> </code><code class="n">plt</code><code class="p">,</code><code> </code><code class="n">mpl</code><code>
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>        </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">savefig.dpi</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">300</code><code>
</code><code>        </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">font.family</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">serif</code><code class="s1">'</code><code>
</code><code>        </code><code class="n">pd</code><code class="o">.</code><code class="n">set_option</code><code class="p">(</code><code class="s1">'</code><code class="s1">precision</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>
</code><code>        </code><code class="n">np</code><code class="o">.</code><code class="n">set_printoptions</code><code class="p">(</code><code class="n">suppress</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code> </code><code class="n">precision</code><code class="o">=</code><code class="mi">4</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">url</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">http://hilpisch.com/aiif_eikon_eod_data.csv</code><code class="s1">'</code><code>  </code><a class="co" id="co_ai_first_finance_CO1-1" href="#callout_ai_first_finance_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">,</code><code> </code><code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO1-2" href="#callout_ai_first_finance_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="n">data</code><code> </code><code class="o">/</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="s1">'</code><code class="s1">coolwarm</code><code class="s1">'</code><code class="p">)</code><code class="p">;</code><code>  </code><a class="co" id="co_ai_first_finance_CO1-3" href="#callout_ai_first_finance_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO1-1" href="#co_ai_first_finance_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Reads the data into a <code>DataFrame</code> object</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO1-2" href="#co_ai_first_finance_CO1-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Plots the normalized time series data</p></dd>
</dl>

<figure class="thumb"><div id="figure_aiff_01" class="figure">
<img src="Images/aiif_0601.png" alt="aiif 0601" width="2402" height="1394"/>
<h6><span class="label">Figure 6-1. </span>Normalized time series data (end-of-day)</h6>
</div></figure>

<p>Second, the price data for all financial time series is lagged and stored in <code>DataFrame</code> objects:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">lags</code><code> </code><code class="o">=</code><code> </code><code class="mi">7</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-1" href="#callout_ai_first_finance_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">add_lags</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">ric</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="p">)</code><code class="p">:</code><code>
</code><code>            </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>
</code><code>            </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code class="p">)</code><code>
</code><code>            </code><code class="k">for</code><code> </code><code class="n">lag</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">lags</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code>
</code><code>                </code><code class="n">col</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">lag_{}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">lag</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-2" href="#callout_ai_first_finance_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>                </code><code class="n">df</code><code class="p">[</code><code class="n">col</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="n">lag</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-3" href="#callout_ai_first_finance_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>                </code><code class="n">cols</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">col</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-4" href="#callout_ai_first_finance_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>            </code><code class="n">df</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-5" href="#callout_ai_first_finance_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>            </code><code class="k">return</code><code> </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>        </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code><code>
</code><code>            </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="n">add_lags</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">sym</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-6" href="#callout_ai_first_finance_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>            </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-7" href="#callout_ai_first_finance_CO2-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="mi">7</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO2-8" href="#callout_ai_first_finance_CO2-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code>                </code><code class="n">GLD</code><code>   </code><code class="n">lag_1</code><code>   </code><code class="n">lag_2</code><code>   </code><code class="n">lag_3</code><code>   </code><code class="n">lag_4</code><code>   </code><code class="n">lag_5</code><code>   </code><code class="n">lag_6</code><code>   </code><code class="n">lag_7</code><code>
</code><code>        </code><code class="n">Date</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">13</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code><code>  </code><code class="mf">112.85</code><code>  </code><code class="mf">111.37</code><code>  </code><code class="mf">110.82</code><code>  </code><code class="mf">111.51</code><code>  </code><code class="mf">109.70</code><code>  </code><code class="mf">109.80</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">14</code><code>  </code><code class="mf">112.03</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code><code>  </code><code class="mf">112.85</code><code>  </code><code class="mf">111.37</code><code>  </code><code class="mf">110.82</code><code>  </code><code class="mf">111.51</code><code>  </code><code class="mf">109.70</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">15</code><code>  </code><code class="mf">110.86</code><code>  </code><code class="mf">112.03</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code><code>  </code><code class="mf">112.85</code><code>  </code><code class="mf">111.37</code><code>  </code><code class="mf">110.82</code><code>  </code><code class="mf">111.51</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">19</code><code>  </code><code class="mf">111.52</code><code>  </code><code class="mf">110.86</code><code>  </code><code class="mf">112.03</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code><code>  </code><code class="mf">112.85</code><code>  </code><code class="mf">111.37</code><code>  </code><code class="mf">110.82</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">20</code><code>  </code><code class="mf">108.94</code><code>  </code><code class="mf">111.52</code><code>  </code><code class="mf">110.86</code><code>  </code><code class="mf">112.03</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code><code>  </code><code class="mf">112.85</code><code>  </code><code class="mf">111.37</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">21</code><code>  </code><code class="mf">107.37</code><code>  </code><code class="mf">108.94</code><code>  </code><code class="mf">111.52</code><code>  </code><code class="mf">110.86</code><code>  </code><code class="mf">112.03</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code><code>  </code><code class="mf">112.85</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">22</code><code>  </code><code class="mf">107.17</code><code>  </code><code class="mf">107.37</code><code>  </code><code class="mf">108.94</code><code>  </code><code class="mf">111.52</code><code>  </code><code class="mf">110.86</code><code>  </code><code class="mf">112.03</code><code>  </code><code class="mf">111.54</code><code>  </code><code class="mf">110.49</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO2-1" href="#co_ai_first_finance_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The number of lags (in trading days)</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-2" href="#co_ai_first_finance_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Creates a column name</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-3" href="#co_ai_first_finance_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Lags the price data</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-4" href="#co_ai_first_finance_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Adds the column name to a <code>list</code> object</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-5" href="#co_ai_first_finance_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Deletes all incomplete data rows</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-6" href="#co_ai_first_finance_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Creates the lagged data for every financial time series</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-7" href="#co_ai_first_finance_CO2-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Stores the results in a <code>dict</code> object</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO2-8" href="#co_ai_first_finance_CO2-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>Shows a sample of the lagged price data</p></dd>
</dl>

<p>Third, with the data prepared, the OLS regression analysis is straightforward to conduct. <a data-type="xref" href="#figure_aiff_02">Figure 6-2</a> shows the average optimal regression results. Without a doubt, the price data that is lagged by only one day has the highest explanatory power. Its weight is close to 1, supporting the idea that the best predictor for tomorrow’s price of a financial instrument is its price today. This also holds true for the single regression results obtained per financial time series:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">regs</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>        </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code><code>
</code><code>            </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-1" href="#callout_ai_first_finance_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>            </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linalg</code><code class="o">.</code><code class="n">lstsq</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">rcond</code><code class="o">=</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-2" href="#callout_ai_first_finance_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>            </code><code class="n">regs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">reg</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-3" href="#callout_ai_first_finance_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rega</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">stack</code><code class="p">(</code><code class="nb">tuple</code><code class="p">(</code><code class="n">regs</code><code class="o">.</code><code class="n">values</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-4" href="#callout_ai_first_finance_CO3-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">regd</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">rega</code><code class="p">,</code><code> </code><code class="n">columns</code><code class="o">=</code><code class="n">cols</code><code class="p">,</code><code> </code><code class="n">index</code><code class="o">=</code><code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-5" href="#callout_ai_first_finance_CO3-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">regd</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-6" href="#callout_ai_first_finance_CO3-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code>          </code><code class="n">lag_1</code><code>   </code><code class="n">lag_2</code><code>   </code><code class="n">lag_3</code><code>   </code><code class="n">lag_4</code><code>   </code><code class="n">lag_5</code><code>   </code><code class="n">lag_6</code><code>   </code><code class="n">lag_7</code><code>
</code><code>         </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mf">1.0106</code><code> </code><code class="o">-</code><code class="mf">0.0592</code><code>  </code><code class="mf">0.0258</code><code>  </code><code class="mf">0.0535</code><code> </code><code class="o">-</code><code class="mf">0.0172</code><code>  </code><code class="mf">0.0060</code><code> </code><code class="o">-</code><code class="mf">0.0184</code><code>
</code><code>         </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mf">0.8928</code><code>  </code><code class="mf">0.0112</code><code>  </code><code class="mf">0.1175</code><code> </code><code class="o">-</code><code class="mf">0.0832</code><code> </code><code class="o">-</code><code class="mf">0.0258</code><code>  </code><code class="mf">0.0567</code><code>  </code><code class="mf">0.0323</code><code>
</code><code>         </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mf">0.9519</code><code>  </code><code class="mf">0.0579</code><code>  </code><code class="mf">0.0490</code><code> </code><code class="o">-</code><code class="mf">0.0772</code><code> </code><code class="o">-</code><code class="mf">0.0373</code><code>  </code><code class="mf">0.0449</code><code>  </code><code class="mf">0.0112</code><code>
</code><code>         </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mf">0.9799</code><code> </code><code class="o">-</code><code class="mf">0.0134</code><code>  </code><code class="mf">0.0206</code><code>  </code><code class="mf">0.0007</code><code>  </code><code class="mf">0.0525</code><code> </code><code class="o">-</code><code class="mf">0.0452</code><code>  </code><code class="mf">0.0056</code><code>
</code><code>         </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>    </code><code class="mf">0.9806</code><code>  </code><code class="mf">0.0342</code><code> </code><code class="o">-</code><code class="mf">0.0172</code><code>  </code><code class="mf">0.0042</code><code> </code><code class="o">-</code><code class="mf">0.0387</code><code>  </code><code class="mf">0.0585</code><code> </code><code class="o">-</code><code class="mf">0.0215</code><code>
</code><code>         </code><code class="n">SPY</code><code>     </code><code class="mf">0.9692</code><code>  </code><code class="mf">0.0067</code><code>  </code><code class="mf">0.0228</code><code> </code><code class="o">-</code><code class="mf">0.0244</code><code> </code><code class="o">-</code><code class="mf">0.0237</code><code>  </code><code class="mf">0.0379</code><code>  </code><code class="mf">0.0121</code><code>
</code><code>         </code><code class="o">.</code><code class="n">SPX</code><code>    </code><code class="mf">0.9672</code><code>  </code><code class="mf">0.0106</code><code>  </code><code class="mf">0.0219</code><code> </code><code class="o">-</code><code class="mf">0.0252</code><code> </code><code class="o">-</code><code class="mf">0.0318</code><code>  </code><code class="mf">0.0515</code><code>  </code><code class="mf">0.0063</code><code>
</code><code>         </code><code class="o">.</code><code class="n">VIX</code><code>    </code><code class="mf">0.8823</code><code>  </code><code class="mf">0.0591</code><code> </code><code class="o">-</code><code class="mf">0.0289</code><code>  </code><code class="mf">0.0284</code><code> </code><code class="o">-</code><code class="mf">0.0256</code><code>  </code><code class="mf">0.0511</code><code>  </code><code class="mf">0.0306</code><code>
</code><code>         </code><code class="n">EUR</code><code class="o">=</code><code>    </code><code class="mf">0.9859</code><code>  </code><code class="mf">0.0239</code><code> </code><code class="o">-</code><code class="mf">0.0484</code><code>  </code><code class="mf">0.0508</code><code> </code><code class="o">-</code><code class="mf">0.0217</code><code>  </code><code class="mf">0.0149</code><code> </code><code class="o">-</code><code class="mf">0.0055</code><code>
</code><code>         </code><code class="n">XAU</code><code class="o">=</code><code>    </code><code class="mf">0.9864</code><code>  </code><code class="mf">0.0069</code><code>  </code><code class="mf">0.0166</code><code> </code><code class="o">-</code><code class="mf">0.0215</code><code>  </code><code class="mf">0.0044</code><code>  </code><code class="mf">0.0198</code><code> </code><code class="o">-</code><code class="mf">0.0125</code><code>
</code><code>         </code><code class="n">GDX</code><code>     </code><code class="mf">0.9765</code><code>  </code><code class="mf">0.0096</code><code> </code><code class="o">-</code><code class="mf">0.0039</code><code>  </code><code class="mf">0.0223</code><code> </code><code class="o">-</code><code class="mf">0.0364</code><code>  </code><code class="mf">0.0379</code><code> </code><code class="o">-</code><code class="mf">0.0065</code><code>
</code><code>         </code><code class="n">GLD</code><code>     </code><code class="mf">0.9766</code><code>  </code><code class="mf">0.0246</code><code>  </code><code class="mf">0.0060</code><code> </code><code class="o">-</code><code class="mf">0.0142</code><code> </code><code class="o">-</code><code class="mf">0.0047</code><code>  </code><code class="mf">0.0223</code><code> </code><code class="o">-</code><code class="mf">0.0106</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">regd</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'</code><code class="s1">bar</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>  </code><a class="co" id="co_ai_first_finance_CO3-7" href="#callout_ai_first_finance_CO3-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO3-1" href="#co_ai_first_finance_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Gets the data for the current time series</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO3-2" href="#co_ai_first_finance_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Implements the regression analysis</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO3-3" href="#co_ai_first_finance_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Stores the optimal regression parameters in a <code>dict</code> object</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO3-4" href="#co_ai_first_finance_CO3-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Combines the optimal results into a single <code>ndarray</code> object</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO3-5" href="#co_ai_first_finance_CO3-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Puts the results into a <code>DataFrame</code> object and shows them</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO3-6" href="#co_ai_first_finance_CO3-7"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Visualizes the average optimal regression parameters (weights) for every lag</p></dd>
</dl>

<figure class="thumb"><div id="figure_aiff_02" class="figure">
<img src="Images/aiif_0602.png" alt="aiif 0602" width="2418" height="1502"/>
<h6><span class="label">Figure 6-2. </span>Average optimal regression parameters for the lagged prices</h6>
</div></figure>

<p>Given this semiformal analysis, there seems to be strong supporting evidence for the EMH in its weak form, at least. It is noteworthy that the OLS regression analysis as implemented here violates several assumptions. Among those is that the features are assumed to be noncorrelated among each other, whereas they should ideally be highly correlated with the labels data. However, the lagged price data leads to highly correlated features. The following Python code presents the correlation data, which shows a close-to-perfect correlation between all features. This explains why only one feature (“lag 1”) is enough to accomplish the approximation and prediction based on the OLS regression approach. Adding more, highly correlated features does not yield any improvements. <a data-type="indexterm" data-primary="stationarity of time series data, assumption of" id="idm45625303251704"/>Another fundamental assumption violated is the <em>stationarity</em> of the time series data, which the following code also tests for:<sup><a data-type="noteref" id="idm45625303250520-marker" href="ch06.xhtml#idm45625303250520">3</a></sup></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">corr</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO4-1" href="#callout_ai_first_finance_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code>           </code><code class="n">GLD</code><code>   </code><code class="n">lag_1</code><code>   </code><code class="n">lag_2</code><code>   </code><code class="n">lag_3</code><code>   </code><code class="n">lag_4</code><code>   </code><code class="n">lag_5</code><code>   </code><code class="n">lag_6</code><code>   </code><code class="n">lag_7</code><code>
</code><code>         </code><code class="n">GLD</code><code>    </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9867</code><code>  </code><code class="mf">0.9841</code><code>  </code><code class="mf">0.9815</code><code>
</code><code>         </code><code class="n">lag_1</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9867</code><code>  </code><code class="mf">0.9842</code><code>
</code><code>         </code><code class="n">lag_2</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9867</code><code>
</code><code>         </code><code class="n">lag_3</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9893</code><code>
</code><code>         </code><code class="n">lag_4</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9920</code><code>
</code><code>         </code><code class="n">lag_5</code><code>  </code><code class="mf">0.9867</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">0.9946</code><code>
</code><code>         </code><code class="n">lag_6</code><code>  </code><code class="mf">0.9841</code><code>  </code><code class="mf">0.9867</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>  </code><code class="mf">0.9972</code><code>
</code><code>         </code><code class="n">lag_7</code><code>  </code><code class="mf">0.9815</code><code>  </code><code class="mf">0.9842</code><code>  </code><code class="mf">0.9867</code><code>  </code><code class="mf">0.9893</code><code>  </code><code class="mf">0.9920</code><code>  </code><code class="mf">0.9946</code><code>  </code><code class="mf">0.9972</code><code>  </code><code class="mf">1.0000</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">statsmodels.tsa.stattools</code><code> </code><code class="kn">import</code><code> </code><code class="n">adfuller</code><code>  </code><a class="co" id="co_ai_first_finance_CO4-2" href="#callout_ai_first_finance_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">adfuller</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO4-3" href="#callout_ai_first_finance_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="o">-</code><code class="mf">1.9488969577009954</code><code class="p">,</code><code>
</code><code>          </code><code class="mf">0.3094193074034718</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">0</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2515</code><code class="p">,</code><code>
</code><code>          </code><code class="p">{</code><code class="s1">'</code><code class="s1">1</code><code class="s1">%</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">3.4329527780962255</code><code class="p">,</code><code>
</code><code>           </code><code class="s1">'</code><code class="s1">5</code><code class="s1">%</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">2.8626898965523724</code><code class="p">,</code><code>
</code><code>           </code><code class="s1">'</code><code class="s1">10</code><code class="s1">%</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">2.567382133955709</code><code class="p">}</code><code class="p">,</code><code>
</code><code>          </code><code class="mf">8446.683102944744</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO4-1" href="#co_ai_first_finance_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Shows the correlations between the lagged time series</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO4-2" href="#co_ai_first_finance_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="Augmented Dickey-Fuller test" id="idm45625302964712"/>Tests for stationarity using the <a href="https://oreil.ly/rfdaC">Augmented Dickey-Fuller</a> test</p></dd>
</dl>

<p>In summary, if the EMH holds true, active or algorithmic portfolio management or trading would not make economic sense. <a data-type="indexterm" data-primary="CAPM (capital asset pricing model)" data-secondary="EMH and" id="idm45625302962568"/>Simply investing in a stock or an efficient portfolio in the MVP sense, say, and passively holding the investment over a long period would yield without any effort at least the same, if not superior, returns. According to the CAPM and the MVP, the higher the risk the investor is willing to bear, the higher the expected return should be. In fact, as Copeland et al. (2005, ch. 10) point out, the CAPM and the EMH form a joint hypothesis about financial 
<span class="keep-together">markets:</span> if the EMH is rejected, then the CAPM must be rejected as well, since its derivation assumes the EMH to hold true.<a data-type="indexterm" data-primary="" data-startref="ix_ai-first_emh_ch6" id="idm45625302960248"/><a data-type="indexterm" data-primary="" data-startref="ix_emh_ai-first_ch6" id="idm45625302959272"/><a data-type="indexterm" data-primary="" data-startref="ix_OLS_effic_market_test" id="idm45625302517640"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Market Prediction Based on Returns Data"><div class="sect1" id="aiff_returns">
<h1>Market Prediction Based on Returns Data</h1>

<p><a data-type="indexterm" data-primary="market prediction" data-secondary="returns data as basis for" id="ix_market_predict_returns"/><a data-type="indexterm" data-primary="returns" data-secondary="basing market prediction on" id="ix_returns_predict_market"/><a data-type="indexterm" data-primary="AI-first finance" data-secondary="returns data as basis for market prediction" id="ix_AI-firstfin_predict_returns"/><a data-type="indexterm" data-primary="DL (deep learning)" data-secondary="predictive performance based on returns data" id="idm45625302511384"/>As <a data-type="xref" href="ch02.xhtml#superintelligence">Chapter 2</a> shows, ML and, in particular, DL algorithms have generated breakthroughs in recent years in fields that have proven resistant over pretty long periods of time to standard statistical or mathematical methods. What about the financial markets? Might ML and DL algorithms be capable of discovering inefficiencies where traditional financial econometrics methods, such as OLS regression, fail? Of course, there are no simple and concise answers to these questions yet.</p>

<p>However, some concrete examples might shed light on possible answers. To this end, the same data as in the previous section is used to derive log returns from the price data. The idea is to compare the performance of OLS regression to the performance of neural networks in predicting the next day’s direction of movement for the different time series. <a data-type="indexterm" data-primary="economic inefficiencies" data-seealso="algorithmic trading" id="idm45625302508280"/><a data-type="indexterm" data-primary="statistical inefficiencies" data-secondary="predicting markets with neural networks" id="idm45625302507304"/>The goal at this stage is to discover <em>statistical inefficiencies</em> as compared to <em>economic inefficiencies</em>. Statistical inefficiencies are given when a model is able to predict the direction of the future price movement with a certain edge (say, the prediction is correct in 55% or 60% of the cases). Economic inefficiencies would only be given if the statistical inefficiencies can be exploited profitably through a trading strategy that takes into account, for example, transaction costs.</p>

<p>The first step in the analysis is to create data sets with lagged log returns data. The normalized lagged log returns data is also tested for stationarity (given), and the features are tested for correlation (not correlated). <a data-type="indexterm" data-primary="weak form market efficiency" id="idm45625302504440"/>Since the following analyses rely on time-series-related data only, they are dealing with <em>weak form market efficiency</em>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">data</code><code> </code><code class="o">/</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-1" href="#callout_ai_first_finance_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="p">:</code><code>
</code><code>             </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="n">add_lags</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">sym</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-2" href="#callout_ai_first_finance_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">mu</code><code class="p">,</code><code> </code><code class="n">std</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-3" href="#callout_ai_first_finance_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">mu</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">std</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-4" href="#callout_ai_first_finance_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-5" href="#callout_ai_first_finance_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code>                </code><code class="n">GLD</code><code>   </code><code class="n">lag_1</code><code>   </code><code class="n">lag_2</code><code>   </code><code class="n">lag_3</code><code>   </code><code class="n">lag_4</code><code>   </code><code class="n">lag_5</code><code>   </code><code class="n">lag_6</code><code>   </code><code class="n">lag_7</code><code>
</code><code>         </code><code class="n">Date</code><code>
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">14</code><code>  </code><code class="mf">0.0044</code><code>  </code><code class="mf">0.9570</code><code> </code><code class="o">-</code><code class="mf">2.1692</code><code>  </code><code class="mf">1.3386</code><code>  </code><code class="mf">0.4959</code><code> </code><code class="o">-</code><code class="mf">0.6434</code><code>  </code><code class="mf">1.6613</code><code> </code><code class="o">-</code><code class="mf">0.1028</code><code>
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">15</code><code> </code><code class="o">-</code><code class="mf">0.0105</code><code>  </code><code class="mf">0.4379</code><code>  </code><code class="mf">0.9571</code><code> </code><code class="o">-</code><code class="mf">2.1689</code><code>  </code><code class="mf">1.3388</code><code>  </code><code class="mf">0.4966</code><code> </code><code class="o">-</code><code class="mf">0.6436</code><code>  </code><code class="mf">1.6614</code><code>
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">19</code><code>  </code><code class="mf">0.0059</code><code> </code><code class="o">-</code><code class="mf">1.0842</code><code>  </code><code class="mf">0.4385</code><code>  </code><code class="mf">0.9562</code><code> </code><code class="o">-</code><code class="mf">2.1690</code><code>  </code><code class="mf">1.3395</code><code>  </code><code class="mf">0.4958</code><code> </code><code class="o">-</code><code class="mf">0.6435</code><code>
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">20</code><code> </code><code class="o">-</code><code class="mf">0.0234</code><code>  </code><code class="mf">0.5967</code><code> </code><code class="o">-</code><code class="mf">1.0823</code><code>  </code><code class="mf">0.4378</code><code>  </code><code class="mf">0.9564</code><code> </code><code class="o">-</code><code class="mf">2.1686</code><code>  </code><code class="mf">1.3383</code><code>  </code><code class="mf">0.4958</code><code>
</code><code>         </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mi">21</code><code> </code><code class="o">-</code><code class="mf">0.0145</code><code> </code><code class="o">-</code><code class="mf">2.4045</code><code>  </code><code class="mf">0.5971</code><code> </code><code class="o">-</code><code class="mf">1.0825</code><code>  </code><code class="mf">0.4379</code><code>  </code><code class="mf">0.9571</code><code> </code><code class="o">-</code><code class="mf">2.1680</code><code>  </code><code class="mf">1.3384</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">adfuller</code><code class="p">(</code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">lag_1</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-6" href="#callout_ai_first_finance_CO5-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="o">-</code><code class="mf">51.568251505825536</code><code class="p">,</code><code>
</code><code>          </code><code class="mf">0.0</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">0</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2507</code><code class="p">,</code><code>
</code><code>          </code><code class="p">{</code><code class="s1">'</code><code class="s1">1</code><code class="s1">%</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">3.4329610922579095</code><code class="p">,</code><code>
</code><code>           </code><code class="s1">'</code><code class="s1">5</code><code class="s1">%</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">2.8626935681060375</code><code class="p">,</code><code>
</code><code>           </code><code class="s1">'</code><code class="s1">10</code><code class="s1">%</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">2.567384088736619</code><code class="p">}</code><code class="p">,</code><code>
</code><code>          </code><code class="mf">7017.165474260225</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">corr</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO5-7" href="#callout_ai_first_finance_CO5-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code>           </code><code class="n">GLD</code><code>   </code><code class="n">lag_1</code><code>   </code><code class="n">lag_2</code><code>       </code><code class="n">lag_3</code><code>   </code><code class="n">lag_4</code><code>       </code><code class="n">lag_5</code><code>   </code><code class="n">lag_6</code><code>   </code><code class="n">lag_7</code><code>
</code><code>         </code><code class="n">GLD</code><code>    </code><code class="mf">1.0000</code><code> </code><code class="o">-</code><code class="mf">0.0297</code><code>  </code><code class="mf">0.0003</code><code>  </code><code class="mf">1.2635e-02</code><code> </code><code class="o">-</code><code class="mf">0.0026</code><code> </code><code class="o">-</code><code class="mf">5.9392e-03</code><code>  </code><code class="mf">0.0099</code><code> </code><code class="o">-</code><code class="mf">0.0013</code><code>
</code><code>         </code><code class="n">lag_1</code><code> </code><code class="o">-</code><code class="mf">0.0297</code><code>  </code><code class="mf">1.0000</code><code> </code><code class="o">-</code><code class="mf">0.0305</code><code>  </code><code class="mf">8.1418e-04</code><code>  </code><code class="mf">0.0128</code><code> </code><code class="o">-</code><code class="mf">2.8765e-03</code><code> </code><code class="o">-</code><code class="mf">0.0053</code><code>  </code><code class="mf">0.0098</code><code>
</code><code>         </code><code class="n">lag_2</code><code>  </code><code class="mf">0.0003</code><code> </code><code class="o">-</code><code class="mf">0.0305</code><code>  </code><code class="mf">1.0000</code><code> </code><code class="o">-</code><code class="mf">3.1617e-02</code><code>  </code><code class="mf">0.0003</code><code>  </code><code class="mf">1.3234e-02</code><code> </code><code class="o">-</code><code class="mf">0.0043</code><code> </code><code class="o">-</code><code class="mf">0.0052</code><code>
</code><code>         </code><code class="n">lag_3</code><code>  </code><code class="mf">0.0126</code><code>  </code><code class="mf">0.0008</code><code> </code><code class="o">-</code><code class="mf">0.0316</code><code>  </code><code class="mf">1.0000e+00</code><code> </code><code class="o">-</code><code class="mf">0.0313</code><code> </code><code class="o">-</code><code class="mf">6.8542e-06</code><code>  </code><code class="mf">0.0141</code><code> </code><code class="o">-</code><code class="mf">0.0044</code><code>
</code><code>         </code><code class="n">lag_4</code><code> </code><code class="o">-</code><code class="mf">0.0026</code><code>  </code><code class="mf">0.0128</code><code>  </code><code class="mf">0.0003</code><code> </code><code class="o">-</code><code class="mf">3.1329e-02</code><code>  </code><code class="mf">1.0000</code><code> </code><code class="o">-</code><code class="mf">3.1761e-02</code><code>  </code><code class="mf">0.0002</code><code>  </code><code class="mf">0.0141</code><code>
</code><code>         </code><code class="n">lag_5</code><code> </code><code class="o">-</code><code class="mf">0.0059</code><code> </code><code class="o">-</code><code class="mf">0.0029</code><code>  </code><code class="mf">0.0132</code><code> </code><code class="o">-</code><code class="mf">6.8542e-06</code><code> </code><code class="o">-</code><code class="mf">0.0318</code><code>  </code><code class="mf">1.0000e+00</code><code> </code><code class="o">-</code><code class="mf">0.0323</code><code>  </code><code class="mf">0.0002</code><code>
</code><code>         </code><code class="n">lag_6</code><code>  </code><code class="mf">0.0099</code><code> </code><code class="o">-</code><code class="mf">0.0053</code><code> </code><code class="o">-</code><code class="mf">0.0043</code><code>  </code><code class="mf">1.4115e-02</code><code>  </code><code class="mf">0.0002</code><code> </code><code class="o">-</code><code class="mf">3.2289e-02</code><code>  </code><code class="mf">1.0000</code><code> </code><code class="o">-</code><code class="mf">0.0324</code><code>
</code><code>         </code><code class="n">lag_7</code><code> </code><code class="o">-</code><code class="mf">0.0013</code><code>  </code><code class="mf">0.0098</code><code> </code><code class="o">-</code><code class="mf">0.0052</code><code> </code><code class="o">-</code><code class="mf">4.3869e-03</code><code>  </code><code class="mf">0.0141</code><code>  </code><code class="mf">2.1707e-04</code><code> </code><code class="o">-</code><code class="mf">0.0324</code><code>  </code><code class="mf">1.0000</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO5-1" href="#co_ai_first_finance_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Derives the log returns from the price data</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO5-2" href="#co_ai_first_finance_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Lags the log returns data</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO5-3" href="#co_ai_first_finance_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="DNNs (dense neural networks)" data-secondary="normalization" id="idm45625301967416"/><a data-type="indexterm" data-primary="normalization, DNNs" id="idm45625301966424"/><a data-type="indexterm" data-primary="Gaussian normalization" id="idm45625301965752"/><a data-type="indexterm" data-primary="z-score normalization" id="idm45625301965080"/>Applies <em>Gaussian normalization</em> to the features data<sup><a data-type="noteref" id="idm45625301826344-marker" href="ch06.xhtml#idm45625301826344">4</a></sup></p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO5-4" href="#co_ai_first_finance_CO5-5"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Shows a sample of the lagged returns data</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO5-5" href="#co_ai_first_finance_CO5-6"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Tests for stationarity of the time series data</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO5-6" href="#co_ai_first_finance_CO5-7"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Shows the correlation data for the features</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="market prediction with" id="idm45625302735256"/><a data-type="indexterm" data-primary="market prediction" data-secondary="with OLS regression" data-secondary-sortas="OLS regression" id="idm45625303019320"/>First, the OLS regression is implemented and the predictions resulting from the regression are generated. The analysis is implemented on the complete data set. It shall show how well the algorithms perform in-sample. The accuracy with which OLS regression predicts the next day’s direction of movement is slightly, or even a few percentage points, above 50% with one exception:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.metrics</code><code> </code><code class="kn">import</code><code> </code><code class="n">accuracy_score</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="p">:</code><code>
</code><code>             </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code>
</code><code>             </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linalg</code><code class="o">.</code><code class="n">lstsq</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">rcond</code><code class="o">=</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>  </code><a class="co" id="co_ai_first_finance_CO6-1" href="#callout_ai_first_finance_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">reg</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO6-2" href="#callout_ai_first_finance_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">pred</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO6-3" href="#callout_ai_first_finance_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">OLS | {sym:10s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5056</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5088</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5040</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5048</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5080</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5080</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5167</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5291</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4984</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5207</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5307</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5072</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mi">201</code><code> </code><code class="n">ms</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">65.8</code><code> </code><code class="n">ms</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mi">267</code><code> </code><code class="n">ms</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">60.8</code><code> </code><code class="n">ms</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO6-1" href="#co_ai_first_finance_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The regression step</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO6-2" href="#co_ai_first_finance_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The prediction step</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO6-3" href="#co_ai_first_finance_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The accuracy of the prediction</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="scikit-learn package" data-secondary="market prediction on returns data" id="idm45625301853096"/><a data-type="indexterm" data-primary="neural networks" data-secondary="market prediction with" id="ix_nn_market_predict"/><a data-type="indexterm" data-primary="market prediction" data-secondary="with neural networks" data-secondary-sortas="neural networks" id="ix_market_predict_nn"/>Second, the same analysis is done again but this time with a neural network from <code>scikit-learn</code> as the model for learning and predicting. The prediction accuracy in-sample is significantly above 50% throughout and above 60% in a few cases:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">25</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.neural_network</code><code> </code><code class="kn">import</code><code> </code><code class="n">MLPRegressor</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code><code>
</code><code>             </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">MLPRegressor</code><code class="p">(</code><code class="n">hidden_layer_sizes</code><code class="o">=</code><code class="p">[</code><code class="mi">512</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">random_state</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">max_iter</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">early_stopping</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">validation_fraction</code><code class="o">=</code><code class="mf">0.15</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">shuffle</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO7-1" href="#callout_ai_first_finance_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO7-2" href="#callout_ai_first_finance_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO7-3" href="#callout_ai_first_finance_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">pred</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO7-4" href="#callout_ai_first_finance_CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">MLP | {sym:10s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6005</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5853</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5766</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5510</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6527</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5419</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5399</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6579</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5642</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5522</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6029</code><code>
</code><code>         </code><code class="n">MLP</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5259</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">37</code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">6.74</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">44</code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mi">14</code><code> </code><code class="n">s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO7-1" href="#co_ai_first_finance_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Model instantiation</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO7-2" href="#co_ai_first_finance_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Model fitting</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO7-3" href="#co_ai_first_finance_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Prediction step</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO7-4" href="#co_ai_first_finance_CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Accuracy calculation</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="DNNs (dense neural networks)" data-secondary="market efficiency" id="idm45625301425128"/><a data-type="indexterm" data-primary="Keras deep learning package" data-secondary="market prediction with neural network" id="idm45625301424248"/><a data-type="indexterm" data-primary="MLPRegressor class, scikit-learn" id="idm45625301423272"/><a data-type="indexterm" data-primary="scikit-learn package" data-secondary="MLPRegressor class" id="idm45625301422584"/>Third, the same analysis again but with a neural network from the <code>Keras</code> package. The accuracy results are similar to those from the <code>MLPRegressor</code>, but with a higher average accuracy:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">tensorflow</code><code> </code><code class="kn">as</code><code> </code><code class="nn">tf</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">keras.layers</code><code> </code><code class="kn">import</code><code> </code><code class="n">Dense</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">keras.models</code><code> </code><code class="kn">import</code><code> </code><code class="n">Sequential</code><code>
</code><code>         </code><code class="n">Using</code><code> </code><code class="n">TensorFlow</code><code> </code><code class="n">backend</code><code class="o">.</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>         </code><code class="n">tf</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">set_seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">29</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">create_model</code><code class="p">(</code><code class="n">problem</code><code class="o">=</code><code class="s1">'</code><code class="s1">regression</code><code class="s1">'</code><code class="p">)</code><code class="p">:</code><code>  </code><a class="co" id="co_ai_first_finance_CO8-1" href="#callout_ai_first_finance_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">Sequential</code><code class="p">(</code><code class="p">)</code><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="mi">512</code><code class="p">,</code><code> </code><code class="n">input_dim</code><code class="o">=</code><code class="nb">len</code><code class="p">(</code><code class="n">cols</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                             </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">relu</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>             </code><code class="k">if</code><code> </code><code class="n">problem</code><code> </code><code class="o">==</code><code> </code><code class="s1">'</code><code class="s1">regression</code><code class="s1">'</code><code class="p">:</code><code>
</code><code>                 </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">linear</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">model</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="n">loss</code><code class="o">=</code><code class="s1">'</code><code class="s1">mse</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">optimizer</code><code class="o">=</code><code class="s1">'</code><code class="s1">adam</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="k">else</code><code class="p">:</code><code>
</code><code>                 </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">sigmoid</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">model</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="n">loss</code><code class="o">=</code><code class="s1">'</code><code class="s1">binary_crossentropy</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">optimizer</code><code class="o">=</code><code class="s1">'</code><code class="s1">adam</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">model</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">30</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="p">:</code><code class="p">]</code><code class="p">:</code><code>
</code><code>             </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">create_model</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO8-2" href="#callout_ai_first_finance_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">25</code><code class="p">,</code><code> </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO8-3" href="#callout_ai_first_finance_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO8-4" href="#callout_ai_first_finance_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">pred</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO8-5" href="#callout_ai_first_finance_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">DNN | {sym:10s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6292</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5981</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6073</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5781</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6196</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5829</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6077</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6392</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5845</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5881</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5829</code><code>
</code><code>         </code><code class="n">DNN</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5666</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">34.3</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">5.34</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">39.6</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">23.1</code><code> </code><code class="n">s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO8-1" href="#co_ai_first_finance_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Model creation function</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO8-2" href="#co_ai_first_finance_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Model instantiation</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO8-3" href="#co_ai_first_finance_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Model fitting</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO8-4" href="#co_ai_first_finance_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Prediction step</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO8-5" href="#co_ai_first_finance_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Accuracy calculation</p></dd>
</dl>

<p>This simple example shows that neural networks can outperform OLS regression significantly <em>in-sample</em> in predicting the next day’s direction of price movements. However, how does the picture change when testing for the <em>out-of-sample</em> performance of the two model types?</p>

<p><a data-type="indexterm" data-primary="market prediction" data-secondary="with OLS regression" data-secondary-sortas="OLS regression" id="idm45625300848648"/><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="market prediction with" id="idm45625300424328"/>To this end, the analyses are repeated, but the training (fitting) step is implemented on the first 80% of the data while the performance is tested on the remaining 20%. OLS regression is implemented first. Out-of-sample OLS regression shows similar accuracy levels as in-sample—around 50%:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">31</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">split</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mf">0.8</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">32</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code><code>
</code><code>             </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code>
</code><code>             </code><code class="n">train</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code>  </code><a class="co" id="co_ai_first_finance_CO9-1" href="#callout_ai_first_finance_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linalg</code><code class="o">.</code><code class="n">lstsq</code><code class="p">(</code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">train</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">rcond</code><code class="o">=</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>
</code><code>             </code><code class="n">test</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code>  </code><a class="co" id="co_ai_first_finance_CO9-2" href="#callout_ai_first_finance_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">reg</code><code class="p">)</code><code>
</code><code>             </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">pred</code><code class="p">)</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">OLS | {sym:10s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5219</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4960</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5418</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4841</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4980</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5020</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5120</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5458</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4482</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>       </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5299</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5159</code><code>
</code><code>         </code><code class="n">OLS</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>        </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5100</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mi">200</code><code> </code><code class="n">ms</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">60.6</code><code> </code><code class="n">ms</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mi">261</code><code> </code><code class="n">ms</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">61.7</code><code> </code><code class="n">ms</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO9-1" href="#co_ai_first_finance_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Creates the <em>training</em> data sub-set</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO9-2" href="#co_ai_first_finance_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Creates the <em>test</em> data sub-set</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="DNNs (dense neural networks)" data-secondary="market efficiency" id="idm45625300519864"/><a data-type="indexterm" data-primary="MLPRegressor class, scikit-learn" id="idm45625300518920"/><a data-type="indexterm" data-primary="scikit-learn package" data-secondary="MLPRegressor class" id="idm45625300518280"/>The performance of the <code>MLPRegressor</code> model is out-of-sample much worse when compared to the in-sample numbers and similar to the OLS regression results:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">34</code><code class="p">]:</code> <code class="o">%%</code><code class="n">time</code>
         <code class="k">for</code> <code class="n">sym</code> <code class="ow">in</code> <code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code>
             <code class="n">df</code> <code class="o">=</code> <code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code>
             <code class="n">train</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="n">split</code><code class="p">]</code>
             <code class="n">model</code> <code class="o">=</code> <code class="n">MLPRegressor</code><code class="p">(</code><code class="n">hidden_layer_sizes</code><code class="o">=</code><code class="p">[</code><code class="mi">512</code><code class="p">],</code>
                                  <code class="n">random_state</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code>
                                  <code class="n">max_iter</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code>
                                  <code class="n">early_stopping</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>
                                  <code class="n">validation_fraction</code><code class="o">=</code><code class="mf">0.15</code><code class="p">,</code>
                                  <code class="n">shuffle</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code>
             <code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">],</code> <code class="n">train</code><code class="p">[</code><code class="n">sym</code><code class="p">])</code>
             <code class="n">test</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:]</code>
             <code class="n">pred</code> <code class="o">=</code> <code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">cols</code><code class="p">])</code>
             <code class="n">acc</code> <code class="o">=</code> <code class="n">accuracy_score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">sym</code><code class="p">]),</code> <code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">pred</code><code class="p">))</code>
             <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'MLP | {sym:10s} | acc={acc:.4f}'</code><code class="p">)</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4920</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5279</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5279</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4641</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">GS</code><code class="o">.</code><code class="n">N</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5040</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">SPY</code>        <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5259</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="o">.</code><code class="n">SPX</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5478</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="o">.</code><code class="n">VIX</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5279</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">EUR</code><code class="o">=</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4980</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">XAU</code><code class="o">=</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5239</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">GDX</code>        <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4880</code>
         <code class="n">MLP</code> <code class="o">|</code> <code class="n">GLD</code>        <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5000</code>
         <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mi">1</code><code class="nb">min</code> <code class="mi">39</code><code class="n">s</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mf">4.98</code> <code class="n">s</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mi">1</code><code class="nb">min</code> <code class="mi">44</code><code class="n">s</code>
         <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mf">13.7</code> <code class="n">s</code></pre>

<p><a data-type="indexterm" data-primary="Sequential model, Keras package" id="idm45625300617656"/><a data-type="indexterm" data-primary="Keras deep learning package" data-secondary="Sequential model" id="idm45625300617000"/>The same holds true for the <code>Sequential</code> model from <code>Keras</code> for which the out-of-sample numbers also show accuracy values between a few percentage points above and below the 50% threshold:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">35</code><code class="p">]:</code> <code class="o">%%</code><code class="n">time</code>
         <code class="k">for</code> <code class="n">sym</code> <code class="ow">in</code> <code class="n">data</code><code class="o">.</code><code class="n">columns</code><code class="p">:</code>
             <code class="n">df</code> <code class="o">=</code> <code class="n">dfs</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code>
             <code class="n">train</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="n">split</code><code class="p">]</code>
             <code class="n">model</code> <code class="o">=</code> <code class="n">create_model</code><code class="p">()</code>
             <code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">],</code> <code class="n">train</code><code class="p">[</code><code class="n">sym</code><code class="p">],</code> <code class="n">epochs</code><code class="o">=</code><code class="mi">50</code><code class="p">,</code> <code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code>
             <code class="n">test</code> <code class="o">=</code> <code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:]</code>
             <code class="n">pred</code> <code class="o">=</code> <code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">cols</code><code class="p">])</code>
             <code class="n">acc</code> <code class="o">=</code> <code class="n">accuracy_score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">sym</code><code class="p">]),</code> <code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">pred</code><code class="p">))</code>
             <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'DNN | {sym:10s} | acc={acc:.4f}'</code><code class="p">)</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5179</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5598</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4821</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4920</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">GS</code><code class="o">.</code><code class="n">N</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5179</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">SPY</code>        <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4861</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="o">.</code><code class="n">SPX</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5100</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="o">.</code><code class="n">VIX</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5378</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">EUR</code><code class="o">=</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4661</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">XAU</code><code class="o">=</code>       <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4602</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">GDX</code>        <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4841</code>
         <code class="n">DNN</code> <code class="o">|</code> <code class="n">GLD</code>        <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5378</code>
         <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mf">50.4</code> <code class="n">s</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mf">7.52</code> <code class="n">s</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mf">57.9</code> <code class="n">s</code>
         <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mf">32.9</code> <code class="n">s</code></pre>
<div data-type="note" epub:type="note"><h1>Weak Form Market Efficiency</h1>
<p><a data-type="indexterm" data-primary="weak form market efficiency" id="idm45625299990664"/>Although the labeling as <em>weak form</em> market efficiency might suggest otherwise, it is the hardest form in the sense that only time-series-related data can be used to identify statistical inefficiencies. With the semi-strong form, any other source of publicly available data could be added to improve prediction accuracy.</p>
</div>

<p><a data-type="indexterm" data-primary="market prediction" data-secondary="with OLS regression" data-secondary-sortas="OLS regression" id="idm45625299702888"/><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="market prediction with" id="idm45625299701800"/>Based on the approaches chosen in this section, markets seem to be at least efficient in the weak form. Just analyzing historical return patterns based on OLS regression or neural networks might not be enough to discover statistical inefficiencies.</p>

<p>There are two major elements of the approach chosen in this section that can be adjusted in the hope of improving prediction results:</p>
<dl>
<dt>Features</dt>
<dd>
<p>In addition to vanilla price-and-returns data, other features can be added to the data, such as technical indicators (for example, simple moving averages, or SMAs for short). The hope is, in the technical chartist’s tradition, that such indicators improve the prediction accuracy.</p>
</dd>
<dt>Bar length</dt>
<dd>
<p>Instead of working with end-of-day data, intraday data might allow for higher prediction accuracies. Here, the hope is that one is more likely to discover statistical inefficiencies during the day as compared to at end of day, when all market participants in general pay the highest attention to making their final trades—by taking into account all available information.</p>
</dd>
</dl>

<p>The following two sections address these elements.<a data-type="indexterm" data-primary="" data-startref="ix_AI-firstfin_predict_returns" id="idm45625299696264"/><a data-type="indexterm" data-primary="" data-startref="ix_market_predict_returns" id="idm45625299695416"/><a data-type="indexterm" data-primary="" data-startref="ix_returns_predict_market" id="idm45625299694568"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Market Prediction with More Features"><div class="sect1" id="aiff_features">
<h1>Market Prediction with More Features</h1>

<p><a data-type="indexterm" data-primary="market prediction" data-secondary="with more features" data-secondary-sortas="more features" id="ix_market_predict_more"/><a data-type="indexterm" data-primary="AI-first finance" data-secondary="market prediction with more features" id="ix_AI-firstfin_more_features"/><a data-type="indexterm" data-primary="technical indicators, adding to market prediction" id="ix_tech_indic_feature"/>In trading, there is a long tradition of using technical indicators to generate, based on observed patterns, buy or sell signals. Such technical indicators, basically of any kind, can also be used as features for the training of neural networks.</p>

<p>The following Python code uses an SMA, rolling minimum and maximum values, momentum, and rolling volatility as features:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">36</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">url</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">http://hilpisch.com/aiif_eikon_eod_data.csv</code><code class="s1">'</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">37</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">,</code><code> </code><code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">38</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">add_lags</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">ric</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="p">,</code><code> </code><code class="n">window</code><code class="o">=</code><code class="mi">50</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>
</code><code>             </code><code class="n">df</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">df</code><code> </code><code class="o">/</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">sma</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO10-1" href="#callout_ai_first_finance_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">min</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="p">)</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO10-2" href="#callout_ai_first_finance_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">max</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="p">)</code><code class="o">.</code><code class="n">max</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO10-3" href="#callout_ai_first_finance_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">mom</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO10-4" href="#callout_ai_first_finance_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">vol</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">window</code><code class="p">)</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO10-5" href="#callout_ai_first_finance_CO10-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">df</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">where</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">&gt;</code><code> </code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO10-6" href="#callout_ai_first_finance_CO10-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">features</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">ric</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">r</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">sma</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">min</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">max</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">mom</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">vol</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>             </code><code class="k">for</code><code> </code><code class="n">f</code><code> </code><code class="ow">in</code><code> </code><code class="n">features</code><code class="p">:</code><code>
</code><code>                 </code><code class="k">for</code><code> </code><code class="n">lag</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">lags</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code>
</code><code>                     </code><code class="n">col</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{f}_lag_{lag}</code><code class="s1">'</code><code>
</code><code>                     </code><code class="n">df</code><code class="p">[</code><code class="n">col</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">f</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="n">lag</code><code class="p">)</code><code>
</code><code>                     </code><code class="n">cols</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">col</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">39</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">lags</code><code> </code><code class="o">=</code><code> </code><code class="mi">5</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">40</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">dfs</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">ric</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="p">:</code><code>
</code><code>             </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="n">add_lags</code><code class="p">(</code><code class="n">data</code><code class="p">,</code><code> </code><code class="n">ric</code><code class="p">,</code><code> </code><code class="n">lags</code><code class="p">)</code><code>
</code><code>             </code><code class="n">dfs</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">cols</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO10-1" href="#co_ai_first_finance_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="SMA (simple moving average)" id="idm45625299459704"/>Simple moving average (SMA)</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO10-2" href="#co_ai_first_finance_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="rolling minimum feature" id="idm45625298965336"/>Rolling minimum</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO10-3" href="#co_ai_first_finance_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="rolling maximum feature" id="idm45625298990552"/>Rolling maximum</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO10-4" href="#co_ai_first_finance_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="momentum feature" id="idm45625299431384"/>Momentum as average of log returns</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO10-5" href="#co_ai_first_finance_CO10-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="volatility" data-secondary="rolling volatility feature" id="idm45625299454984"/><a data-type="indexterm" data-primary="rolling volatility feature" id="idm45625299453992"/>Rolling volatility</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO10-6" href="#co_ai_first_finance_CO10-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="direction as binary feature" id="idm45625299489192"/>Direction as binary feature</p></dd>
</dl>
<div data-type="tip"><h1>Technical Indicators as Features</h1>
<p>As the preceding examples show, basically any traditional technical indicator used for investing or intraday trading can be used as a feature to train ML algorithms. In that sense, AI and ML do not necessarily render such indicators obsolete, rather they can indeed enrich the ML-driven derivation of trading strategies.</p>
</div>

<p><a data-type="indexterm" data-primary="DNNs (dense neural networks)" data-secondary="market efficiency" id="ix_dnn_market_effic"/><a data-type="indexterm" data-primary="Sequential model, Keras package" id="idm45625299071560"/><a data-type="indexterm" data-primary="Keras deep learning package" data-secondary="Sequential model" id="idm45625299070872"/><a data-type="indexterm" data-primary="MLPClassifier model, scikit-learn" id="idm45625299069912"/><a data-type="indexterm" data-primary="scikit-learn package" data-secondary="MLPClassifier model" id="idm45625299069224"/>In-sample, the performance of the <code>MLPClassifier</code> model is now much better 
<span class="keep-together">when taking</span> into account the new features and normalizing them for training. The 
<span class="keep-together"><code>Sequential</code></span> model of <code>Keras</code> reaches accuracies of around 70%  for the number of epochs trained. From experience, these can be easily increased by increasing the number of epochs and/or the capacity of the neural network:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">41</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.neural_network</code><code> </code><code class="kn">import</code><code> </code><code class="n">MLPClassifier</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">42</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">ric</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="p">:</code><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">MLPClassifier</code><code class="p">(</code><code class="n">hidden_layer_sizes</code><code class="o">=</code><code class="p">[</code><code class="mi">512</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">random_state</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">max_iter</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">early_stopping</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">validation_fraction</code><code class="o">=</code><code class="mf">0.15</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">shuffle</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO11-1" href="#callout_ai_first_finance_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>             </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">)</code><code>
</code><code>             </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">pred</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">IN-SAMPLE | {ric:7s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5510</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5376</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5607</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5559</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5794</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5729</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5941</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6940</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5766</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5672</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5847</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5567</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">1</code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">4.5</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">6</code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">9.05</code><code> </code><code class="n">s</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">43</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">ric</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="p">:</code><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">create_model</code><code class="p">(</code><code class="s1">'</code><code class="s1">classification</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code>
</code><code>             </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO11-2" href="#callout_ai_first_finance_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">50</code><code class="p">,</code><code> </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>
</code><code>             </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">where</code><code class="p">(</code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="mf">0.5</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code>
</code><code>             </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">df</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">pred</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">IN-SAMPLE | {ric:7s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.7156</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.7156</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.7046</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6640</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6855</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6696</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6579</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.7489</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6737</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.7143</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.6826</code><code>
</code><code>         </code><code class="n">IN</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.7078</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">5</code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">7.06</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">12</code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">44.3</code><code> </code><code class="n">s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO11-1" href="#co_ai_first_finance_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Normalizes the features data</p></dd>
</dl>

<p>Are these improvements to be transferred to the out-of-sample prediction accuracies? The following Python code repeats the analysis, this time with the training and test split as used before. Unfortunately, the picture is mixed at best. The numbers do not represent real improvements when compared to the approach, relying only on lagged returns data as features. For selected instruments, there seems to be an edge of a few percentage points in the prediction accuracy compared to the 50% benchmark. For others, however, the accuracy is still below 50%—as illustrated for the <code>MLPClassifier</code> model:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">44</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">train_test_model</code><code class="p">(</code><code class="n">model</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="k">for</code><code> </code><code class="n">ric</code><code> </code><code class="ow">in</code><code> </code><code class="n">data</code><code class="p">:</code><code>
</code><code>                 </code><code class="n">df</code><code class="p">,</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="n">dfs</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code><code>
</code><code>                 </code><code class="n">split</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">df</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mf">0.85</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">train</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code class="o">.</code><code class="n">copy</code><code class="p">(</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">mu</code><code class="p">,</code><code> </code><code class="n">std</code><code> </code><code class="o">=</code><code> </code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO12-1" href="#callout_ai_first_finance_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">mu</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">std</code><code>
</code><code>                 </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">train</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">train</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">test</code><code> </code><code class="o">=</code><code> </code><code class="n">df</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">copy</code><code class="p">(</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">test</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code> </code><code class="o">-</code><code> </code><code class="n">mu</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">std</code><code>
</code><code>                 </code><code class="n">pred</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="n">cols</code><code class="p">]</code><code class="p">)</code><code>
</code><code>                 </code><code class="n">acc</code><code> </code><code class="o">=</code><code> </code><code class="n">accuracy_score</code><code class="p">(</code><code class="n">test</code><code class="p">[</code><code class="s1">'</code><code class="s1">d</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">pred</code><code class="p">)</code><code>
</code><code>                 </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">OUT-OF-SAMPLE | {ric:7s} | acc={acc:.4f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">45</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model_mlp</code><code> </code><code class="o">=</code><code> </code><code class="n">MLPClassifier</code><code class="p">(</code><code class="n">hidden_layer_sizes</code><code class="o">=</code><code class="p">[</code><code class="mi">512</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">random_state</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">max_iter</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">early_stopping</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">validation_fraction</code><code class="o">=</code><code class="mf">0.15</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">shuffle</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">46</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="n">time</code><code> </code><code class="n">train_test_model</code><code class="p">(</code><code class="n">model_mlp</code><code class="p">)</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4432</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4595</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5000</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5270</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4838</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4811</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5027</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5676</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4649</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5514</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5162</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.4946</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">44.9</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">2.64</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">47.5</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">6.37</code><code> </code><code class="n">s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO12-1" href="#co_ai_first_finance_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Training data set statistics are used for normalization.</p></dd>
</dl>

<p>The good in-sample performance and the not-so-good out-of-sample performance suggest that overfitting of the neural network might play a crucial role. <a data-type="indexterm" data-primary="BaggingClassifier class" id="idm45625296165096"/><a data-type="indexterm" data-primary="bagging method to avoid overfitting" id="idm45625296171048"/><a data-type="indexterm" data-primary="overfitting of data, avoiding" id="idm45625296170408"/>One approach to avoid overfitting is to use ensemble methods that combine multiple trained models of the same type to come up with a more robust meta model and better out-of-sample predictions. <a data-type="indexterm" data-primary="scikit-learn package" data-secondary="BaggingClassifier class" id="idm45625296169432"/>One such method is called <em>bagging</em>. <code>scikit-learn</code> has an implementation of this approach in the form of the <a href="https://oreil.ly/gQLFZ"><code>BaggingClassifier</code> class</a>. Using multiple estimators allows for training every one of them without exposing them to the complete training data set or all features. This should help in avoiding overfitting.</p>

<p>The following Python code implements a bagging approach based on a number of base estimators of the same type (<code>MLPClassifier</code>). The prediction accuracies are now consistently above 50%. Some accuracy values are above 55%, which can be considered pretty high in this context. Overall, bagging seems to avoid, at least to some extent, overfitting and seems to improve the predictions noticeably:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">47</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.ensemble</code><code> </code><code class="kn">import</code><code> </code><code class="n">BaggingClassifier</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">base_estimator</code><code> </code><code class="o">=</code><code> </code><code class="n">MLPClassifier</code><code class="p">(</code><code class="n">hidden_layer_sizes</code><code class="o">=</code><code class="p">[</code><code class="mi">256</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">random_state</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">max_iter</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">early_stopping</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">validation_fraction</code><code class="o">=</code><code class="mf">0.15</code><code class="p">,</code><code>
</code><code>                                   </code><code class="n">shuffle</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-1" href="#callout_ai_first_finance_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model_bag</code><code> </code><code class="o">=</code><code> </code><code class="n">BaggingClassifier</code><code class="p">(</code><code class="n">base_estimator</code><code class="o">=</code><code class="n">base_estimator</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-2" href="#callout_ai_first_finance_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">n_estimators</code><code class="o">=</code><code class="mi">35</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-3" href="#callout_ai_first_finance_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">max_samples</code><code class="o">=</code><code class="mf">0.25</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-4" href="#callout_ai_first_finance_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">max_features</code><code class="o">=</code><code class="mf">0.5</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-5" href="#callout_ai_first_finance_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">bootstrap</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-6" href="#callout_ai_first_finance_CO13-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">bootstrap_features</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-7" href="#callout_ai_first_finance_CO13-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">n_jobs</code><code class="o">=</code><code class="mi">8</code><code class="p">,</code><code>  </code><a class="co" id="co_ai_first_finance_CO13-8" href="#callout_ai_first_finance_CO13-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">random_state</code><code class="o">=</code><code class="mi">100</code><code>
</code><code>                                  </code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">50</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="n">time</code><code> </code><code class="n">train_test_model</code><code class="p">(</code><code class="n">model_bag</code><code class="p">)</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5243</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5703</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5027</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5270</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5243</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">SPY</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5595</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">SPX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5514</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="o">.</code><code class="n">VIX</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5649</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">EUR</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5108</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">XAU</code><code class="o">=</code><code>    </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5378</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GDX</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5162</code><code>
</code><code>         </code><code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code><code> </code><code class="o">|</code><code> </code><code class="n">GLD</code><code>     </code><code class="o">|</code><code> </code><code class="n">acc</code><code class="o">=</code><code class="mf">0.5432</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">2.55</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mi">494</code><code> </code><code class="n">ms</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">3.05</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">11.1</code><code> </code><code class="n">s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_ai_first_finance_CO13-1" href="#co_ai_first_finance_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The base estimator</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO13-2" href="#co_ai_first_finance_CO13-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The number of estimators used</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO13-3" href="#co_ai_first_finance_CO13-4"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Maximum percentage of training data used per estimator</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO13-4" href="#co_ai_first_finance_CO13-5"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Maximum number of features used per estimator</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO13-5" href="#co_ai_first_finance_CO13-6"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Whether to bootstrap (reuse) data</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO13-6" href="#co_ai_first_finance_CO13-7"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Whether to bootstrap (reuse) features</p></dd>
<dt><a class="co" id="callout_ai_first_finance_CO13-7" href="#co_ai_first_finance_CO13-8"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Number of parallel jobs</p></dd>
</dl>
<div data-type="note" epub:type="note"><h1>End-of-Day Market Efficiency</h1>
<p><a data-type="indexterm" data-primary="EOD (end-of-day) versus intraday data" id="idm45625297227096"/>The efficient market hypothesis dates back to the 1960s and 1970s, periods during which end-of-day data was basically the only available time series data. Back in those days (and still today), it could be assumed that market players paid particularly close attention to their positions and trades the closer the end of the trading session came. This might be more true for stocks, say, and a bit less so for currencies, which are traded in principle around the clock.<a data-type="indexterm" data-primary="" data-startref="ix_tech_indic_feature" id="idm45625297225816"/><a data-type="indexterm" data-primary="" data-startref="ix_AI-firstfin_more_features" id="idm45625296246696"/><a data-type="indexterm" data-primary="" data-startref="ix_market_predict_more" id="idm45625296245784"/></p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Market Prediction Intraday"><div class="sect1" id="aiff_intraday">
<h1>Market Prediction Intraday</h1>

<p><a data-type="indexterm" data-primary="intraday trading" id="ix_intraday_trade_2"/><a data-type="indexterm" data-primary="market prediction" data-secondary="intraday market prediction" id="ix_market_predict_intraday_2"/><a data-type="indexterm" data-primary="AI-first finance" data-secondary="intraday market prediction" id="ix_AI-firstfin_intraday"/>This chapter has not produced conclusive evidence, but the analyses implemented so far point more in the direction that markets are weakly efficient on an end-of-day basis. What about intraday markets? Are there more consistent statistical inefficiencies to be spotted? To work toward an answer of this question, another data set is necessary. The following Python code uses a data set that is composed of the same instruments as in the end-of-day data set, but now contains hourly closing prices. Since trading hours might differ from instrument to instrument, the data set is incomplete. This is no problem, though, since the analyses are implemented time 
<span class="keep-together">series</span> by time series.</p>

<p>The technical implementation for the hourly data is essentially the same as before, relying on the same code as the end-of-day analysis:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">51</code><code class="p">]:</code> <code class="n">url</code> <code class="o">=</code> <code class="s1">'http://hilpisch.com/aiif_eikon_id_data.csv'</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">52</code><code class="p">]:</code> <code class="n">data</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">,</code> <code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code> <code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">53</code><code class="p">]:</code> <code class="n">data</code><code class="o">.</code><code class="n">info</code><code class="p">()</code>
         <code class="o">&lt;</code><code class="k">class</code> <code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'&gt;</code>
         <code class="n">DatetimeIndex</code><code class="p">:</code> <code class="mi">5529</code> <code class="n">entries</code><code class="p">,</code> <code class="mi">2019</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mo">01</code> <code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code> <code class="n">to</code> <code class="mi">2020</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">01</code> <code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code>
         <code class="n">Data</code> <code class="n">columns</code> <code class="p">(</code><code class="n">total</code> <code class="mi">12</code> <code class="n">columns</code><code class="p">):</code>
          <code class="c1">#   Column  Non-Null Count  Dtype</code>
         <code class="o">---</code>  <code class="o">------</code>  <code class="o">--------------</code>  <code class="o">-----</code>
          <code class="mi">0</code>   <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>  <code class="mi">3384</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">1</code>   <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>  <code class="mi">3378</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">2</code>   <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>  <code class="mi">3275</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">3</code>   <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>  <code class="mi">3381</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">4</code>   <code class="n">GS</code><code class="o">.</code><code class="n">N</code>    <code class="mi">1686</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">5</code>   <code class="n">SPY</code>     <code class="mi">3388</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">6</code>   <code class="o">.</code><code class="n">SPX</code>    <code class="mi">1802</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">7</code>   <code class="o">.</code><code class="n">VIX</code>    <code class="mi">2959</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">8</code>   <code class="n">EUR</code><code class="o">=</code>    <code class="mi">5429</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">9</code>   <code class="n">XAU</code><code class="o">=</code>    <code class="mi">5149</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">10</code>  <code class="n">GDX</code>     <code class="mi">3173</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
          <code class="mi">11</code>  <code class="n">GLD</code>     <code class="mi">3351</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>   <code class="n">float64</code>
         <code class="n">dtypes</code><code class="p">:</code> <code class="n">float64</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code>
         <code class="n">memory</code> <code class="n">usage</code><code class="p">:</code> <code class="mf">561.5</code> <code class="n">KB</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="n">lags</code> <code class="o">=</code> <code class="mi">5</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">55</code><code class="p">]:</code> <code class="n">dfs</code> <code class="o">=</code> <code class="p">{}</code>
         <code class="k">for</code> <code class="n">ric</code> <code class="ow">in</code> <code class="n">data</code><code class="p">:</code>
             <code class="n">df</code><code class="p">,</code> <code class="n">cols</code> <code class="o">=</code> <code class="n">add_lags</code><code class="p">(</code><code class="n">data</code><code class="p">,</code> <code class="n">ric</code><code class="p">,</code> <code class="n">lags</code><code class="p">)</code>
             <code class="n">dfs</code><code class="p">[</code><code class="n">ric</code><code class="p">]</code> <code class="o">=</code> <code class="n">df</code><code class="p">,</code> <code class="n">cols</code></pre>

<p>The prediction accuracies intraday are again distributed around 50% with a relatively wide spread for the single neural network. On the positive side, some accuracy values are above 55%. <a data-type="indexterm" data-primary="bagging method to avoid overfitting" id="idm45625299285112"/>The bagging meta model shows a more consistent out-of-sample 
<span class="keep-together">performance</span>, though, with many of the observed accuracy values a few percentage points above the 50% benchmark:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">56</code><code class="p">]:</code> <code class="o">%</code><code class="n">time</code> <code class="n">train_test_model</code><code class="p">(</code><code class="n">model_mlp</code><code class="p">)</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5420</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4930</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5549</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4709</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">GS</code><code class="o">.</code><code class="n">N</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5184</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">SPY</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4860</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="o">.</code><code class="n">SPX</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5019</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="o">.</code><code class="n">VIX</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4885</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">EUR</code><code class="o">=</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5130</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">XAU</code><code class="o">=</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4824</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">GDX</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4765</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">GLD</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5455</code>
         <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mi">1</code><code class="nb">min</code> <code class="mi">4</code><code class="n">s</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mf">5.05</code> <code class="n">s</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mi">1</code><code class="nb">min</code> <code class="mi">9</code><code class="n">s</code>
         <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mf">9.56</code> <code class="n">s</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">57</code><code class="p">]:</code> <code class="o">%</code><code class="n">time</code> <code class="n">train_test_model</code><code class="p">(</code><code class="n">model_bag</code><code class="p">)</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5660</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5431</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5072</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>  <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5110</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">GS</code><code class="o">.</code><code class="n">N</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5020</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">SPY</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5120</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="o">.</code><code class="n">SPX</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.4677</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="o">.</code><code class="n">VIX</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5092</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">EUR</code><code class="o">=</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5242</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">XAU</code><code class="o">=</code>    <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5255</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">GDX</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5085</code>
         <code class="n">OUT</code><code class="o">-</code><code class="n">OF</code><code class="o">-</code><code class="n">SAMPLE</code> <code class="o">|</code> <code class="n">GLD</code>     <code class="o">|</code> <code class="n">acc</code><code class="o">=</code><code class="mf">0.5374</code>
         <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mf">2.64</code> <code class="n">s</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mi">439</code> <code class="n">ms</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mf">3.08</code> <code class="n">s</code>
         <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mf">12.4</code> <code class="n">s</code></pre>
<div data-type="note" epub:type="note"><h1>Intraday Market Efficiency</h1>
<p><a data-type="indexterm" data-primary="weak form market efficiency" id="idm45625297341048"/>Even if markets are <em>weakly efficient on an end-of-day basis</em>, they can nevertheless be <em>weakly inefficient intraday</em>. Such statistical inefficiencies might result from temporary imbalances, buy or sell pressures, market overreactions, technically driven buy or sell orders, and so on. The central question is whether such statistical inefficiencies, once discovered, can be exploited profitably via specific trading strategies.<a data-type="indexterm" data-primary="" data-startref="ix_AI-firstfin_ch6" id="idm45625297338936"/><a data-type="indexterm" data-primary="" data-startref="ix_market_predict_nn" id="idm45625297337992"/><a data-type="indexterm" data-primary="" data-startref="ix_nn_market_predict" id="idm45625297337048"/><a data-type="indexterm" data-primary="" data-startref="ix_dnn_market_effic" id="idm45625297668696"/><a data-type="indexterm" data-primary="" data-startref="ix_AI-firstfin_intraday" id="idm45625297667752"/><a data-type="indexterm" data-primary="" data-startref="ix_intraday_trade_2" id="idm45625297666808"/><a data-type="indexterm" data-primary="" data-startref="ix_market_predict_intraday_2" id="idm45625297665864"/></p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusions"><div class="sect1" id="aiff_effectiveness">
<h1>Conclusions</h1>

<p><a data-type="indexterm" data-primary="prediction of economic behavior" data-secondary="physics envy and challenge of" id="ix_predict_physics_envy"/>In their widely cited article “The Unreasonable Effectiveness of Data,” Halevy et al. (2009) point out that economists suffer from what they call <em>physics envy</em>. By that, they mean the inability to explain human behavior in the same mathematically elegant way that physicists are able to describe even complex real-world phenomena. One such example is Albert Einstein’s probably best-known formula <math alttext="upper E equals m c squared">
  <mrow>
    <mi>E</mi>
    <mo>=</mo>
    <mi>m</mi>
    <msup><mi>c</mi> <mn>2</mn> </msup>
  </mrow>
</math>, which equates energy with the mass of an object times the speed of light squared.</p>

<p>In economics and finance, researchers for decades have tried to emulate the physical approach in deriving and proving simple, elegant equations to explain economic and financial phenomena. But as <a data-type="xref" href="ch03.xhtml#normative_finance">Chapter 3</a> and <a data-type="xref" href="ch04.xhtml#data_driven_finance">Chapter 4</a> together show, many of the most elegant financial theories have hardly any supporting evidence in the real financial world in which the simplifying assumptions, such as normal distributions and linear relationships, do not hold.</p>

<p>As Halevy et al. (2009) explain in their article, there might be domains, such as natural languages and the rules they follow, that defy the derivation and formulation of concise, elegant theories. Researchers might simply need to rely on complex theories and models that are driven by data. For language in particular, the World Wide Web represents a treasure trove of <em>big data</em>. And big data seems to be required to train ML and DL algorithms on certain tasks, such as natural language processing or translation on a human level.</p>

<p>After all, finance might be a discipline that has more in common with natural language than with physics. Maybe there are, after all, no simple, elegant formulas that describe important financial phenomena, such as the daily change in a currency rate or the price of a stock.<sup><a data-type="noteref" id="idm45625297652504-marker" href="ch06.xhtml#idm45625297652504">5</a></sup> Maybe the truth might be found only in the big data 
<span class="keep-together">that nowadays</span> is available in programmatic fashion to financial researchers and 
<span class="keep-together">academics</span> alike.</p>

<p>This chapter presents the beginning of the quest to uncover the truth, to discover the holy grail of finance: proving that markets are not that efficient after all. The relatively simple neural network approaches of this chapter only rely on time-series-related features for the training. The labels are simple and straightforward: whether the market (financial instrument’s price) goes up or down. The goal is to discover <em>statistical inefficiencies</em> in predicting the future market direction. This in turn represents the first step in exploiting such inefficiencies economically through an implementable trading strategy.</p>

<p>Agrawal et al. (2018) explain in detail, with many examples, that predictions themselves are only one side of the coin. Decision and implementation rules that specify in detail how a certain prediction is dealt with are equally important. The same holds true in an algorithmic trading context: the signal (prediction) is only the beginning. The hard part is to optimally execute an appropriate trade, to monitor active trades, to implement appropriate risk measures—such as stop loss and take profit orders—and so on.</p>

<p>In its quest for statistical inefficiencies, this chapter relies on data and neural networks only. There is no theory involved, and there are no assumptions about how market participants might behave, or similar reasonings. The major modeling effort is done with regard to preparing the features, which of course represent what the modeler considers important. One implicit assumption in the approach taken is that statistical inefficiencies can be discovered based on time-series-related data only. This is to say that markets are not even weakly efficient—the most difficult form of the three to disprove.</p>

<p>Relying on financial data only and applying general ML and DL algorithms and models to it are what this book considers <em>AI-first finance</em>. No theories needed, no modeling of human behavior, no assumptions about distributions or the nature of relationships—just data and algorithms. In that sense, AI-first finance could also be labeled <em>theory-free</em> or <em>model-free finance</em>.<a data-type="indexterm" data-primary="" data-startref="ix_predict_physics_envy" id="idm45625297626360"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="References"><div class="sect1" id="idm45625297664344">
<h1>References</h1>

<p>Books and papers cited in this chapter:</p>

<ul class="author-date-bib">
<li>
<p>Agrawal, Ajay, Joshua Gans, and Avi Goldfarb. 2018. <em>Prediction Machines: The Simple Economics of Artificial Intelligence.</em> Boston: Harvard Business Review Press.</p>
</li>
<li>
<p>Copeland, Thomas, Fred Weston, and Kuldeep Shastri. 2005. <em>Financial Theory and Corporate Policy</em>. 4th ed. Boston: Pearson.</p>
</li>
<li>
<p>Fama, Eugene. 1965. “Random Walks in Stock Market Prices.” <em>Financial Analysts Journal</em> (September/October): 55-59.</p>
</li>
<li>
<p>Halevy, Alon, Peter Norvig, and Fernando Pereira. 2009. “The Unreasonable Effectiveness of Data.” <em>IEEE Intelligent Systems</em>, Expert Opinion.</p>
</li>
<li>
<p>Hilpisch, Yves. 2018. <em>Python for Finance: Mastering Data-Driven Finance.</em> 2nd ed. Sebastopol: O’Reilly.</p>
</li>
<li>
<p>Jensen, Michael. 1978. “Some Anomalous Evidence Regarding Market Efficiency.” <em>Journal of Financial Economics</em> 6 (2/3): 95-101.</p>
</li>
<li>
<p>Tegmark, Max. 2017. <em>Life 3.0: Being Human in the Age of Artificial Intelligence</em>. United Kingdom: Penguin Random House.</p>
</li>
<li>
<p>Tsay, Ruey S. 2005. <em>Analysis of Financial Time Series.</em> Hoboken: Wiley.</p>
</li>
</ul>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45625304814120"><sup><a href="ch06.xhtml#idm45625304814120-marker">1</a></sup> For the purposes of this chapter and the book, the two hypotheses are treated as equal, although the RWH is somewhat stronger than the EMH. See, for instance, Copeland et al. (2005, ch. 10).</p><p data-type="footnote" id="idm45625303735832"><sup><a href="ch06.xhtml#idm45625303735832-marker">2</a></sup> See also Hilpisch (2018, ch. 15).</p><p data-type="footnote" id="idm45625303250520"><sup><a href="ch06.xhtml#idm45625303250520-marker">3</a></sup> For details on <em>stationarity</em> in financial time series, see Tsay (2005, sec. 2.1). Tsay points out: “The foundation of time series analysis is stationarity.”</p><p data-type="footnote" id="idm45625301826344"><sup><a href="ch06.xhtml#idm45625301826344-marker">4</a></sup> Another term for the approach is <em>z-score normalization</em>.</p><p data-type="footnote" id="idm45625297652504"><sup><a href="ch06.xhtml#idm45625297652504-marker">5</a></sup> There are, of course, more simple financial aspects that allow the modeling by a simple formula. An example might be the derivation of a continuous discount factor <math alttext="upper D">
  <mi>D</mi>
</math> for a period of two years <math alttext="upper T equals 2">
  <mrow>
    <mi>T</mi>
    <mo>=</mo>
    <mn>2</mn>
  </mrow>
</math> if the relevant log return is <math alttext="r equals">
  <mrow>
    <mi>r</mi>
    <mo>=</mo>
  </mrow>
</math> 0.01. It is given by <math alttext="upper D left-parenthesis r comma upper T right-parenthesis equals exp left-parenthesis minus r upper T right-parenthesis equals exp left-parenthesis">
  <mrow>
    <mi>D</mi>
    <mo>(</mo>
    <mi>r</mi>
    <mo>,</mo>
    <mi>T</mi>
    <mo>)</mo>
    <mo>=</mo>
    <mo form="prefix">exp</mo>
    <mo>(</mo>
    <mo>-</mo>
    <mi>r</mi>
    <mi>T</mi>
    <mo>)</mo>
    <mo>=</mo>
    <mo form="prefix">exp</mo>
    <mo>(</mo>
  </mrow>
</math>-0.01 <math alttext="dot 2 right-parenthesis equals">
  <mrow>
    <mo>·</mo>
    <mn>2</mn>
    <mo>)</mo>
    <mo>=</mo>
  </mrow>
</math> 0.9802. AI or ML cannot offer any benefits here.</p></div></div></section></div>



  </body></html>