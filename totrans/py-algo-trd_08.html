<html><head></head><body><section data-pdf-bookmark="Chapter 8. CFD Trading with Oanda" data-type="chapter" epub:type="chapter"><div class="chapter" id="trading_oanda">&#13;
<h1><span class="label">Chapter 8. </span>CFD Trading with Oanda</h1>&#13;
&#13;
<blockquote>&#13;
<p class="align_me_right"><a data-primary="CFD (contracts for difference)" data-secondary="trading with Oanda" data-seealso="Oanda" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc0"/><a data-primary="Oanda" data-secondary="CFD trading" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc1"/>Today, <a data-primary="Singer, Paul" data-type="indexterm" id="idm45785354107400"/>even small entities that trade complex instruments or are granted sufficient leverage can threaten the global financial system.</p>&#13;
<p data-type="attribution">Paul Singer</p>&#13;
</blockquote>&#13;
&#13;
<p>Today, it is easier than ever to get started with trading in the financial markets. There is a large number of online trading platforms (brokers) available from which an algorithmic trader can choose. <a data-primary="trading platforms, factors influencing choice of" data-type="indexterm" id="idm45785354104968"/>The choice of a platform might be influenced by multiple factors:</p>&#13;
<dl>&#13;
<dt>Instruments</dt>&#13;
<dd>&#13;
<p>The first criterion that comes to mind is the type of instrument one is interested in to trade. For example, one might be interested in trading stocks, exchange &#13;
<span class="keep-together">traded</span> funds (ETFs), bonds, currencies, commodities, options, or futures.</p>&#13;
</dd>&#13;
<dt>Strategies</dt>&#13;
<dd>&#13;
<p>Some traders are interested in long-only strategies, while others require short selling as well. Some focus on single-instrument strategies, while others focus on those involving multiple instruments at the same time.</p>&#13;
</dd>&#13;
<dt>Costs</dt>&#13;
<dd>&#13;
<p>Fixed and variable transaction costs are an important factor for many traders. They might even decide whether a certain strategy is profitable or not (see, for instance, Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch04.html#vectorized_backtesting">4</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch06.html#event_based_backtesting">6</a>).</p>&#13;
</dd>&#13;
</dl>&#13;
<dl class="pagebreak-before">&#13;
<dt>Technology</dt>&#13;
<dd>&#13;
<p>Technology has become an important factor in the selection of trading platforms. First, there are the tools that the platforms offer to traders. Trading tools are available, in general, for desktop/notebook computers, tablets, and smart phones. Second, there are the application programming interfaces (APIs) that can be accessed programmatically by traders.</p>&#13;
</dd>&#13;
<dt>Jurisdiction</dt>&#13;
<dd>&#13;
<p>Financial trading is a heavily regulated field with different legal frameworks in place for different countries or regions. This might prohibit certain traders from using certain platforms and/or financial instruments depending on their residence.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>This chapter focuses on <a href="http://oanda.com">Oanda</a>, an online trading platform that is well suited to deploy automated, algorithmic trading strategies, even for retail traders. The following is a brief description of Oanda along the criteria as outlined previously:</p>&#13;
<dl>&#13;
<dt>Instruments</dt>&#13;
<dd>&#13;
<p>Oanda offers a wide range of so-called <em>contracts for difference</em> (CFD) products (see also <a data-type="xref" href="#cfds">“Contracts for Difference (CFDs)”</a> and <a data-type="xref" href="ch09.html#disclaimer">“Disclaimer”</a>). Main characteristics of CFDs are that they are leveraged (for example, 10:1 or 50:1) and traded on margin such that losses might exceed the initial &#13;
<span class="keep-together">capital.</span></p>&#13;
</dd>&#13;
<dt>Strategies</dt>&#13;
<dd>&#13;
<p>Oanda allows both to go long (buy) and to go short (sell) CFDs. Different order types are available, such as market or limit orders, with or without profit targets and/or (trailing) stop losses.</p>&#13;
</dd>&#13;
<dt>Costs</dt>&#13;
<dd>&#13;
<p>There are no fixed transaction costs associated with the trading of CFDs at Oanda. However, there is a bid-ask spread that leads to variable transaction costs when trading CFDs.</p>&#13;
</dd>&#13;
<dt>Technology</dt>&#13;
<dd>&#13;
<p><a data-primary="fxTrade" data-type="indexterm" id="idm45785354081656"/>Oanda provides the trading application fxTrade (Practice), which retrieves data in real time and allows the (manual, discretionary) trading of all instruments (see <a data-type="xref" href="#oanda_01_a">Figure 8-1</a>). There is also a browser-based trading application available (see <a data-type="xref" href="#oanda_01_b">Figure 8-2</a>). A major strength of the platform are the RESTful and streaming APIs (see <a href="https://oreil.ly/_AHHI">Oanda v20 API</a>) via which traders can programmatically access historical and streaming data, place buy and sell orders, or retrieve account information. A Python wrapper package is available (see <a href="https://oreil.ly/iZuuV">v20 on PyPi</a>). Oanda offers free paper trading accounts that provide full access to all technological capabilities, which is really helpful in getting started on the platform. This also simplifies the transitioning from paper to live trading.</p>&#13;
</dd>&#13;
<dt>Jurisdiction</dt>&#13;
<dd>&#13;
<p>Depending on the residence of the account holder, the selection of CFDs that can be traded changes. FX-related CFDs are available basically everywhere  Oanda is active. CFDs on stock indices, for instance, might not be available in certain jurisdictions.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="oanda_01_a">&#13;
<img alt="pfat 0801" src="assets/pfat_0801.png"/>&#13;
<h6><span class="label">Figure 8-1. </span>Oanda trading application fxTrade Practice</h6>&#13;
</div></figure>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="cfds">&#13;
<h5>Contracts for Difference (CFDs)</h5>&#13;
<p><a data-primary="CFD (contracts for difference)" data-secondary="defined" data-type="indexterm" id="idm45785354072184"/>For more details on CFDs, see the <a href="https://oreil.ly/wsoAz">Investopedia CFD page</a> or the more detailed <a href="https://oreil.ly/2PnEQ">Wikipedia CFD page</a>. There are CFDs available on currency pairs (for example, EUR/USD), commodities (for example, gold), stock indices (for example, S&amp;P 500 stock index), bonds (for example, German 10 Year Bund), and more. One can think of a product range that basically allows one to implement global macro strategies. Financially speaking, CFDs are derivative products that derive their payoff based on the development of prices for other instruments. In addition, trading activity (liquidity) influences the price of CFDs. Although a CFD might be based on the S&amp;P 500 index, it is a completely different product issued, quoted, and supported by Oanda (or a similar provider).</p>&#13;
&#13;
<p class="pagebreak-before">This brings along certain risks that traders should be aware of. <a data-primary="Swiss Franc event" data-type="indexterm" id="idm45785354068280"/>A recent event that illustrates this issue is the <em>Swiss Franc event</em> that led to a number of insolvencies in the online broker space. See, for instance, the article <a href="https://oreil.ly/dx7ps">Currency Brokers Fall Over Like Dominoes After SNB Decison on Swiss Franc</a>.</p>&#13;
</div></aside>&#13;
&#13;
<figure><div class="figure" id="oanda_01_b">&#13;
<img alt="pfat 0802" src="assets/pfat_0802.png"/>&#13;
<h6><span class="label">Figure 8-2. </span>Oanda browser-based trading application</h6>&#13;
</div></figure>&#13;
&#13;
<p>The chapter is organized as follows. <a data-type="xref" href="#oanda_setup">“Setting Up an Account”</a> briefly discusses how to set up an account. <a data-type="xref" href="#oanda_api">“The Oanda API”</a> illustrates the necessary steps to access the API. Based on the API access, <a data-type="xref" href="#oanda_historical">“Retrieving Historical Data”</a> retrieves and works with historical data for a certain CFD. <a data-type="xref" href="#oanda_streaming">“Working with Streaming Data”</a> introduces the streaming API of Oanda for data retrieval and visualization. <a data-type="xref" href="#oanda_trading">“Implementing Trading Strategies in Real Time”</a> implements an automated, algorithmic trading strategy in real time. Finally, <a data-type="xref" href="#oanda_account">“Retrieving Account Information”</a> deals with retrieving data about the account itself, such as the current balance or recent trades. Throughout, the code makes use of a Python wrapper class called <code>tpqoa</code> (see <a href="https://oreil.ly/E95UV">GitHub repository</a>).</p>&#13;
&#13;
<p>The goal of this chapter is to make use of the approaches and technologies as introduced in previous chapters to automatically trade on the Oanda platform.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before" data-pdf-bookmark="Setting Up an Account" data-type="sect1"><div class="sect1" id="oanda_setup">&#13;
<h1>Setting Up an Account</h1>&#13;
&#13;
<p><a data-primary="Oanda" data-secondary="account setup" data-type="indexterm" id="idm45785354054632"/>The process for setting up an account with Oanda is simple and efficient. You can choose between a real account and a free demo (“practice”) account, which absolutely suffices to implement what follows (see Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#oanda_02">8-3</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#oanda_03">8-4</a>).</p>&#13;
&#13;
<figure><div class="figure" id="oanda_02">&#13;
<img alt="pfat 0803" src="assets/pfat_0803.png"/>&#13;
<h6><span class="label">Figure 8-3. </span>Oanda account registration (account types)</h6>&#13;
</div></figure>&#13;
&#13;
<p>If the registration is successful and you are logged in to the account on the platform, you should see a starting page, as shown in <a data-type="xref" href="#oanda_04">Figure 8-5</a>. In the middle, you will find a download link for the <code>fxTrade Practice for Desktop</code> application, which you should install. Once it is running, it looks similar to the screenshot shown in <a data-type="xref" href="#oanda_01_a">Figure 8-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="oanda_03">&#13;
<img alt="pfat 0804" src="assets/pfat_0804.png"/>&#13;
<h6><span class="label">Figure 8-4. </span>Oanda account registration (registration form)</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="oanda_04">&#13;
<img alt="pfat 0805" src="assets/pfat_0805.png"/>&#13;
<h6><span class="label">Figure 8-5. </span>Oanda account starting page</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Oanda API" data-type="sect1"><div class="sect1" id="oanda_api">&#13;
<h1>The Oanda API</h1>&#13;
&#13;
<p><a data-primary="Oanda" data-secondary="API access" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc3"/>After registration, getting access to the APIs of Oanda is an easy affair. The major ingredients needed are the account number and the access token (API key). You will find the account number, for instance, in the area <code>Manage Funds</code>. The access token can be generated in the area <code>Manage API Access</code> (see <a data-type="xref" href="#oanda_05">Figure 8-6</a>).<sup><a data-type="noteref" href="ch08.html#idm45785354036712" id="idm45785354036712-marker">1</a></sup></p>&#13;
&#13;
<p><a data-primary="configparser module" data-type="indexterm" id="idm45785354033992"/>From now on, the <a href="https://oreil.ly/UaQyo"><code>configparser</code></a> module is used to manage account credentials. The module expects a text file—with a filename, say, of <em>pyalgo.cfg</em>—in the following format for use with an Oanda practice account:</p>&#13;
&#13;
<pre data-type="programlisting">[oanda]&#13;
account_id = YOUR_ACCOUNT_ID&#13;
access_token = YOUR_ACCESS_TOKEN&#13;
account_type = practice</pre>&#13;
&#13;
<figure><div class="figure" id="oanda_05">&#13;
<img alt="pfat 0806" src="assets/pfat_0806.png"/>&#13;
<h6><span class="label">Figure 8-6. </span>Oanda API access managing page</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="tpqoa wrapper package" data-type="indexterm" id="idm45785353987112"/>To access the API via Python, it is recommended to use the Python wrapper package <code>tpqoa</code> (see <a href="http://github.com/yhilpisch/tpqoa">GitHub repository</a>) that in turn relies on the <a data-primary="Oanda v20 RESTful API" data-type="indexterm" id="idm45785353985144"/><a data-primary="v20 wrapper package" data-type="indexterm" id="idm45785353984536"/><code>v20</code> package from Oanda (see <a href="https://oreil.ly/F_cB2">GitHub repository</a>).</p>&#13;
&#13;
<p class="pagebreak-before">It is installed with the following command:</p>&#13;
&#13;
<pre data-type="programlisting">pip install git+https://github.com/yhilpisch/tpqoa.git</pre>&#13;
&#13;
<p>With these prerequisites, you can connect to the API with a single line of code:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">tpqoa</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">api</code><code> </code><code class="o">=</code><code> </code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="p">(</code><code class="s1">'</code><code class="s1">../pyalgo.cfg</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO1-1" id="co_cfd_trading_with_oanda_CO1-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO1-1" id="callout_cfd_trading_with_oanda_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Adjust the path and filename if required.</p></dd>&#13;
</dl>&#13;
&#13;
<p>This is a major milestone: being connected to the Oanda API allows for the retrieval of historical data, the programmatic placement of orders, and more.</p>&#13;
<div data-type="caution">&#13;
<p>The upside of using the <code>configparser</code> module is that it simplifies the storage and management of account credentials. In algorithmic trading, the number of accounts needed can quickly grow. Examples are a cloud instance or server, data service provider, online trading platform, and so on.</p>&#13;
&#13;
<p>The downside is that the account information is stored in the form of plain text, which represents a considerable security risk, particularly since the information about multiple accounts is stored in a single file. When moving to production, you should therefore apply, for example, file encryption methods to keep the credentials safe.<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc3" data-type="indexterm" id="idm45785353941224"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Retrieving Historical Data" data-type="sect1"><div class="sect1" id="oanda_historical">&#13;
<h1>Retrieving Historical Data</h1>&#13;
&#13;
<p><a data-primary="Oanda" data-secondary="retrieving historical data" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc4"/>A major benefit of working with the Oanda platform is that the complete price history of all Oanda instruments is accessible via the RESTful API. In this context, <em>complete history</em> refers to the different CFDs themselves, not the underlying instruments they are defined on.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Looking Up Instruments Available for Trading" data-type="sect2"><div class="sect2" id="idm45785353921736">&#13;
<h2>Looking Up Instruments Available for Trading</h2>&#13;
&#13;
<p><a data-primary="Oanda" data-secondary="looking up instruments available for trading" data-type="indexterm" id="idm45785353920728"/>For an overview of what instruments can be traded for a given account, use the <a data-primary=".get_instruments() method" data-primary-sortas="get_instruments" data-type="indexterm" id="idm45785353919752"/><code>.get_instruments()</code> method. It only retrieves the display names and technical instruments, names from the API. More details are available via the API, such as minimum position size:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">api</code><code class="o">.</code><code class="n">get_instruments</code><code class="p">()[:</code><code class="mi">15</code><code class="p">]</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="p">[(</code><code class="s1">'AUD/CAD'</code><code class="p">,</code> <code class="s1">'AUD_CAD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'AUD/CHF'</code><code class="p">,</code> <code class="s1">'AUD_CHF'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'AUD/HKD'</code><code class="p">,</code> <code class="s1">'AUD_HKD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'AUD/JPY'</code><code class="p">,</code> <code class="s1">'AUD_JPY'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'AUD/NZD'</code><code class="p">,</code> <code class="s1">'AUD_NZD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'AUD/SGD'</code><code class="p">,</code> <code class="s1">'AUD_SGD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'AUD/USD'</code><code class="p">,</code> <code class="s1">'AUD_USD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'Australia 200'</code><code class="p">,</code> <code class="s1">'AU200_AUD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'Brent Crude Oil'</code><code class="p">,</code> <code class="s1">'BCO_USD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'Bund'</code><code class="p">,</code> <code class="s1">'DE10YB_EUR'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'CAD/CHF'</code><code class="p">,</code> <code class="s1">'CAD_CHF'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'CAD/HKD'</code><code class="p">,</code> <code class="s1">'CAD_HKD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'CAD/JPY'</code><code class="p">,</code> <code class="s1">'CAD_JPY'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'CAD/SGD'</code><code class="p">,</code> <code class="s1">'CAD_SGD'</code><code class="p">),</code>&#13;
         <code class="p">(</code><code class="s1">'CHF/HKD'</code><code class="p">,</code> <code class="s1">'CHF_HKD'</code><code class="p">)]</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Backtesting a Momentum Strategy on Minute Bars" data-type="sect2"><div class="sect2" id="idm45785353915192">&#13;
<h2>Backtesting a Momentum Strategy on Minute Bars</h2>&#13;
&#13;
<p><a data-primary="EUR/USD exchange rate" data-secondary="backtesting momentum strategy on minute bars" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc5"/><a data-primary="momentum strategies" data-secondary="backtesting on minute bars" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc6"/><a data-primary="Oanda" data-secondary="backtesting momentum strategy on minute bars" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc7"/>The example that follows uses the instrument <code>EUR_USD</code> based on the EUR/USD currency pair. The goal is to backtest <em>momentum-based strategies on one-minute bars</em>. The data used is for two days in May 2020. The first step is to <em>retrieve the raw data</em> from Oanda:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">help</code><code class="p">(</code><code class="n">api</code><code class="o">.</code><code class="n">get_history</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-1" id="co_cfd_trading_with_oanda_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">Help</code><code> </code><code class="n">on</code><code> </code><code class="n">method</code><code> </code><code class="n">get_history</code><code> </code><code class="ow">in</code><code> </code><code class="n">module</code><code> </code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">get_history</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code class="p">,</code><code> </code><code class="n">granularity</code><code class="p">,</code><code> </code><code class="n">price</code><code class="p">,</code><code> </code><code class="n">localize</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">method</code><code> </code><code class="n">of</code><code> </code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code> </code><code class="n">instance</code><code>&#13;
</code><code>            </code><code class="n">Retrieves</code><code> </code><code class="n">historical</code><code> </code><code class="n">data</code><code> </code><code class="k">for</code><code> </code><code class="n">instrument</code><code class="o">.</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="n">Parameters</code><code>&#13;
</code><code>            </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>            </code><code class="n">instrument</code><code class="p">:</code><code> </code><code class="n">string</code><code>&#13;
</code><code>                </code><code class="n">valid</code><code> </code><code class="n">instrument</code><code> </code><code class="n">name</code><code>&#13;
</code><code>            </code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code class="p">:</code><code> </code><code class="n">datetime</code><code class="p">,</code><code> </code><code class="nb">str</code><code>&#13;
</code><code>                </code><code class="n">Python</code><code> </code><code class="n">datetime</code><code> </code><code class="ow">or</code><code> </code><code class="n">string</code><code> </code><code class="n">objects</code><code> </code><code class="k">for</code><code> </code><code class="n">start</code><code> </code><code class="ow">and</code><code> </code><code class="n">end</code><code>&#13;
</code><code>            </code><code class="n">granularity</code><code class="p">:</code><code> </code><code class="n">string</code><code>&#13;
</code><code>                </code><code class="n">a</code><code> </code><code class="n">string</code><code> </code><code class="n">like</code><code> </code><code class="s1">'</code><code class="s1">S5</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">M1</code><code class="s1">'</code><code> </code><code class="ow">or</code><code> </code><code class="s1">'</code><code class="s1">D</code><code class="s1">'</code><code>&#13;
</code><code>            </code><code class="n">price</code><code class="p">:</code><code> </code><code class="n">string</code><code>&#13;
</code><code>                </code><code class="n">one</code><code> </code><code class="n">of</code><code> </code><code class="s1">'</code><code class="s1">A</code><code class="s1">'</code><code> </code><code class="p">(</code><code class="n">ask</code><code class="p">)</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">B</code><code class="s1">'</code><code> </code><code class="p">(</code><code class="n">bid</code><code class="p">)</code><code> </code><code class="ow">or</code><code> </code><code class="s1">'</code><code class="s1">M</code><code class="s1">'</code><code> </code><code class="p">(</code><code class="n">middle</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code>            </code><code class="n">Returns</code><code>&#13;
</code><code>            </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>&#13;
</code><code>            </code><code class="n">data</code><code class="p">:</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code>&#13;
</code><code>                </code><code class="n">pandas</code><code> </code><code class="n">DataFrame</code><code> </code><code class="nb">object</code><code> </code><code class="k">with</code><code> </code><code class="n">data</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">instrument</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">EUR_USD</code><code class="s1">'</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-2" id="co_cfd_trading_with_oanda_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">start</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">2020-08-10</code><code class="s1">'</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-2" id="co_cfd_trading_with_oanda_CO2-3"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">2020-08-12</code><code class="s1">'</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-2" id="co_cfd_trading_with_oanda_CO2-4"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">granularity</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">M1</code><code class="s1">'</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-2" id="co_cfd_trading_with_oanda_CO2-5"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">price</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">M</code><code class="s1">'</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-2" id="co_cfd_trading_with_oanda_CO2-6"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">api</code><code class="o">.</code><code class="n">get_history</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code class="p">,</code><code>&#13;
</code><code>                              </code><code class="n">granularity</code><code class="p">,</code><code> </code><code class="n">price</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-3" id="co_cfd_trading_with_oanda_CO2-7"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-4" id="co_cfd_trading_with_oanda_CO2-8"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="o">&lt;</code><code class="k">class</code><code> </code><code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'</code><code class="s1">&gt;</code><code>&#13;
</code><code>        </code><code class="n">DatetimeIndex</code><code class="p">:</code><code> </code><code class="mi">2814</code><code> </code><code class="n">entries</code><code class="p">,</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">10</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code> </code><code class="n">to</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">11</code><code>&#13;
</code><code>         </code><code class="mi">23</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mo">00</code><code>&#13;
</code><code>        </code><code class="n">Data</code><code> </code><code class="n">columns</code><code> </code><code class="p">(</code><code class="n">total</code><code> </code><code class="mi">6</code><code> </code><code class="n">columns</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>         </code><code class="c1">#   Column    Non-Null Count  Dtype</code><code>&#13;
</code><code>        </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>    </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>&#13;
</code><code>         </code><code class="mi">0</code><code>   </code><code class="n">o</code><code>         </code><code class="mi">2814</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>&#13;
</code><code>         </code><code class="mi">1</code><code>   </code><code class="n">h</code><code>         </code><code class="mi">2814</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>&#13;
</code><code>         </code><code class="mi">2</code><code>   </code><code class="n">l</code><code>         </code><code class="mi">2814</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>&#13;
</code><code>         </code><code class="mi">3</code><code>   </code><code class="n">c</code><code>         </code><code class="mi">2814</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>&#13;
</code><code>         </code><code class="mi">4</code><code>   </code><code class="n">volume</code><code>    </code><code class="mi">2814</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">int64</code><code>&#13;
</code><code>         </code><code class="mi">5</code><code>   </code><code class="n">complete</code><code>  </code><code class="mi">2814</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="nb">bool</code><code>&#13;
</code><code>        </code><code class="n">dtypes</code><code class="p">:</code><code> </code><code class="nb">bool</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">float64</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">int64</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">memory</code><code> </code><code class="n">usage</code><code class="p">:</code><code> </code><code class="mf">134.7</code><code> </code><code class="n">KB</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="p">[</code><code class="p">[</code><code class="s1">'</code><code class="s1">c</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">volume</code><code class="s1">'</code><code class="p">]</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO2-5" id="co_cfd_trading_with_oanda_CO2-9"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code>                            </code><code class="n">c</code><code>  </code><code class="n">volume</code><code>&#13;
</code><code>        </code><code class="n">time</code><code>&#13;
</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">10</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">1.17822</code><code>      </code><code class="mi">18</code><code>&#13;
</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">10</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">01</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">1.17836</code><code>      </code><code class="mi">32</code><code>&#13;
</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">10</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">1.17828</code><code>      </code><code class="mi">25</code><code>&#13;
</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">10</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">03</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">1.17834</code><code>      </code><code class="mi">13</code><code>&#13;
</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">10</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">04</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">1.17847</code><code>      </code><code class="mi">43</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO2-1" id="callout_cfd_trading_with_oanda_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Shows the docstring (help text) for the <code>.get_history()</code> method.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO2-2" id="callout_cfd_trading_with_oanda_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Defines the parameter values.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO2-7" id="callout_cfd_trading_with_oanda_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Retrieves the raw data from the API.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO2-8" id="callout_cfd_trading_with_oanda_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Shows the meta information for the retrieved data set.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO2-9" id="callout_cfd_trading_with_oanda_CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Shows the first five data rows for two columns.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The second step is to <em>implement the vectorized backtesting</em>. The idea is to simultaneously backtest a couple of momentum strategies. The code is straightforward and concise (see also <a data-type="xref" href="ch04.html#vectorized_backtesting">Chapter 4</a>).</p>&#13;
&#13;
<p>For simplicity, the  following code uses close (<code>c</code>) values of mid &#13;
<span class="keep-together">prices</span> only:<sup><a data-type="noteref" href="ch08.html#idm45785352515432" id="idm45785352515432-marker">2</a></sup></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">returns</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">c</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">c</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO3-1" id="co_cfd_trading_with_oanda_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">cols</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO3-2" id="co_cfd_trading_with_oanda_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">momentum</code><code> </code><code class="ow">in</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">,</code><code> </code><code class="mi">30</code><code class="p">,</code><code> </code><code class="mi">60</code><code class="p">,</code><code> </code><code class="mi">120</code><code class="p">]</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO3-3" id="co_cfd_trading_with_oanda_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>             </code><code class="n">col</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">position_{}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">momentum</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO3-4" id="co_cfd_trading_with_oanda_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>             </code><code class="n">data</code><code class="p">[</code><code class="n">col</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">returns</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="n">momentum</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO3-5" id="co_cfd_trading_with_oanda_CO3-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>             </code><code class="n">cols</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">col</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO3-6" id="co_cfd_trading_with_oanda_CO3-6"><img alt="6" src="assets/6.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO3-1" id="callout_cfd_trading_with_oanda_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Calculates the log returns based on the <code>close</code> values of the mid prices.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO3-2" id="callout_cfd_trading_with_oanda_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Instantiates an empty <code>list</code> object to collect column names.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO3-3" id="callout_cfd_trading_with_oanda_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Defines the time interval in minute bars for the momentum strategy.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO3-4" id="callout_cfd_trading_with_oanda_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Defines the name of the column to be used for storage in the <code>DataFrame</code> object.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO3-5" id="callout_cfd_trading_with_oanda_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Adds the strategy positionings as a new column.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO3-6" id="callout_cfd_trading_with_oanda_CO3-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Appends the name of the column to the <code>list</code> object.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The final step is the <em>derivation and plotting of the absolute performance</em> of the different momentum strategies. The plot <a data-type="xref" href="#oanda_plot_1">Figure 8-7</a> shows the performances of the momentum-based strategies graphically and compares them to the performance of the base instrument itself:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">pylab</code><code> </code><code class="kn">import</code><code> </code><code class="n">plt</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="kn">import</code><code> </code><code class="nn">matplotlib</code><code> </code><code class="kn">as</code><code> </code><code class="nn">mpl</code><code>&#13;
</code><code>         </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">savefig.dpi</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">300</code><code>&#13;
</code><code>         </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">font.family</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">serif</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">strats</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">returns</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO4-1" id="co_cfd_trading_with_oanda_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">col</code><code> </code><code class="ow">in</code><code> </code><code class="n">cols</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO4-2" id="co_cfd_trading_with_oanda_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>             </code><code class="n">strat</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">strategy_{}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">col</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s1">'</code><code class="s1">_</code><code class="s1">'</code><code class="p">)</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO4-3" id="co_cfd_trading_with_oanda_CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>             </code><code class="n">data</code><code class="p">[</code><code class="n">strat</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">col</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">returns</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO4-4" id="co_cfd_trading_with_oanda_CO4-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>             </code><code class="n">strats</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">strat</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO4-5" id="co_cfd_trading_with_oanda_CO4-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">strats</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code>&#13;
</code><code>             </code><code class="p">)</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO4-6" id="co_cfd_trading_with_oanda_CO4-6"><img alt="6" src="assets/6.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO4-1" id="callout_cfd_trading_with_oanda_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Defines another <code>list</code> object to store the column names to be plotted later on.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO4-2" id="callout_cfd_trading_with_oanda_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Iterates over columns with the positionings for the different strategies.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO4-3" id="callout_cfd_trading_with_oanda_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Derives the name for the new column in which the strategy performance is stored.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO4-4" id="callout_cfd_trading_with_oanda_CO4-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Calculates the log returns for the different strategies and stores them as new &#13;
<span class="keep-together">columns.</span></p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO4-5" id="callout_cfd_trading_with_oanda_CO4-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Appends the column names to the <code>list</code> object for later plotting.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO4-6" id="callout_cfd_trading_with_oanda_CO4-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Plots the cumulative performances for the instrument and the strategies.<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc7" data-type="indexterm" id="idm45785353221608"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc6" data-type="indexterm" id="idm45785353220936"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc5" data-type="indexterm" id="idm45785353220296"/></p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="oanda_plot_1">&#13;
<img alt="pfat 0807" src="assets/pfat_0807.png"/>&#13;
<h6><span class="label">Figure 8-7. </span>Gross performance of different momentum strategies for <code>EUR_USD</code> instrument (minute bars)</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Factoring In Leverage and Margin" data-type="sect2"><div class="sect2" id="idm45785353914696">&#13;
<h2>Factoring In Leverage and Margin</h2>&#13;
&#13;
<p><a data-primary="EUR/USD exchange rate" data-secondary="factoring in leverage/margin" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc8"/><a data-primary="Oanda" data-secondary="factoring in leverage/margin with historical data" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc9"/>In general, when you buy a share of a stock for, say, 100 USD, the profit and loss (P&amp;L) calculations are straightforward: if the stock price rises by 1 USD, you earn 1 USD (unrealized profit); if the stock price falls by 1 USD, you lose 1 USD (unrealized loss). If you buy 10 shares, just multiply the results by 10.</p>&#13;
&#13;
<p>Trading CFDs on the Oanda platform involves leverage and margin. This significantly influences the P&amp;L calculation. For an introduction to and overview of this topic refer to <a href="https://oreil.ly/8I5Eg">Oanda fxTrade Margin Rules</a>. A simple example can illustrate the major aspects in this context.</p>&#13;
&#13;
<p>Consider that a EUR-based algorithmic trader wants to trade the <code>EUR_USD</code> instrument on the Oanda platform and wants to get a long exposure of 10,000 EUR at an ask price of 1.1. Without leverage and margin, the trader (or Python program) would buy 10,000 units of the CFD.<sup><a data-type="noteref" href="ch08.html#idm45785353211096" id="idm45785353211096-marker">3</a></sup> If the price of the instrument (exchange rate) rises to 1.105 (as the midpoint rate between bid and ask prices), the absolute profit is 10,000 x 0.005 = 50 or 0.5%.</p>&#13;
&#13;
<p>What impact do leverage and margining have? Suppose the algorithmic trader chooses a leverage ratio of 20:1, which translates into a 5% margin (= 100% / 20). This in turn implies that the trader only needs to put up a margin upfront of 10,000 EUR x 5% = 500 EUR to get the same exposure. If the price of the instrument then rises to 1.105, the absolute profit stays the same at 50 EUR, but the relative profit rises to 50 EUR / 500 EUR = 10%. The return is considerably amplified by a factor of 20; this is the benefit of leverage when things go as desired.</p>&#13;
&#13;
<p>What happens if things go south? Assume the instrument price drops to 1.08 (as the midpoint rate between bid and ask prices), leading to a loss of 10,000 x (1.08 - 1.1) = -200 EUR. The relative loss now is -200 EUR / 500 EUR = -40%. If the account the algorithmic trader is trading with has less than 200 EUR left in equity/cash, the position needs to be closed out since the (regulatory) margin requirements cannot be met anymore. If losses eat up the margin completely, additional funds need to be allocated as margin to keep the trade alive.<sup><a data-type="noteref" href="ch08.html#idm45785353206904" id="idm45785353206904-marker">4</a></sup></p>&#13;
&#13;
<p><a data-type="xref" href="#oanda_plot_2">Figure 8-8</a> shows the amplifying effect on the performance of the momentum strategies for a leverage ratio of 20:1. The initial margin of 5% suffices to cover potential losses since it is not eaten up even in the worst case depicted:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="p">[</code><code class="n">strats</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code>&#13;
</code><code>                     </code><code class="k">lambda</code><code> </code><code class="n">x</code><code class="p">:</code><code> </code><code class="n">x</code><code> </code><code class="o">*</code><code> </code><code class="mi">20</code><code class="p">)</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO5-1" id="co_cfd_trading_with_oanda_CO5-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO5-1" id="callout_cfd_trading_with_oanda_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Multiplies the log returns by a factor of 20 according to the leverage ratio assumed.</p></dd>&#13;
</dl>&#13;
<div data-type="caution">&#13;
<p><a data-primary="leveraged trading, risks of" data-type="indexterm" id="idm45785353115960"/>Leveraged trading does not only amplify potentials profits, but it also amplifies potential losses. With leveraged trading based on a 10:1 factor (10% margin), a 10% adverse move in the base instrument already wipes out the complete margin. In other words, a 10% move leads to a 100% loss. Therefore, you should make sure to fully understand all risks involved in leveraged trading. You should also make sure to apply appropriate risk measures, such as stop loss orders, that are in line with your risk profile and appetite<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc9" data-type="indexterm" id="idm45785353114616"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc8" data-type="indexterm" id="idm45785353113976"/>.<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc4" data-type="indexterm" id="idm45785353113208"/></p>&#13;
</div>&#13;
&#13;
<figure><div class="figure" id="oanda_plot_2">&#13;
<img alt="pfat 0808" src="assets/pfat_0808.png"/>&#13;
<h6><span class="label">Figure 8-8. </span>Gross performance of momentum strategies for <code>EUR_USD</code> instrument with 20:1 leverage (minute bars)</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Working with Streaming Data" data-type="sect1"><div class="sect1" id="oanda_streaming">&#13;
<h1>Working with Streaming Data</h1>&#13;
&#13;
<p><a data-primary="Oanda" data-secondary="working with streaming data" data-type="indexterm" id="idm45785353128632"/><a data-primary="streaming data" data-secondary="Oanda and" data-type="indexterm" id="idm45785353127688"/><a data-primary="tpqoa wrapper package" data-type="indexterm" id="idm45785353126744"/>Working with streaming data is again made simple and straightforward by the Python wrapper package <code>tpqoa</code>. The package, in combination with the <code>v20</code> package, takes care of the socket communication such that the algorithmic trader only needs to decide what to do with the streaming data:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">instrument</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">EUR_USD</code><code class="s1">'</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">api</code><code class="o">.</code><code class="n">stream_data</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">stop</code><code class="o">=</code><code class="mi">10</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO6-1" id="co_cfd_trading_with_oanda_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">13.560138152</code><code class="n">Z</code><code> </code><code class="mf">1.19131</code><code> </code><code class="mf">1.1915</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">14.088511060</code><code class="n">Z</code><code> </code><code class="mf">1.19134</code><code> </code><code class="mf">1.19152</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">14.390081879</code><code class="n">Z</code><code> </code><code class="mf">1.19124</code><code> </code><code class="mf">1.19145</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">15.105974700</code><code class="n">Z</code><code> </code><code class="mf">1.19129</code><code> </code><code class="mf">1.19144</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">15.375370451</code><code class="n">Z</code><code> </code><code class="mf">1.19128</code><code> </code><code class="mf">1.19144</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">15.501380756</code><code class="n">Z</code><code> </code><code class="mf">1.1912</code><code> </code><code class="mf">1.19141</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">15.951793928</code><code class="n">Z</code><code> </code><code class="mf">1.1912</code><code> </code><code class="mf">1.19138</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">16.354844135</code><code class="n">Z</code><code> </code><code class="mf">1.19123</code><code> </code><code class="mf">1.19138</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">16.661440356</code><code class="n">Z</code><code> </code><code class="mf">1.19118</code><code> </code><code class="mf">1.19133</code><code>&#13;
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">16.912150908</code><code class="n">Z</code><code> </code><code class="mf">1.19112</code><code> </code><code class="mf">1.19132</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO6-1" id="callout_cfd_trading_with_oanda_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <code>stop</code> parameter stops the streaming after a certain number of ticks retrieved.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Placing Market Orders" data-type="sect1"><div class="sect1" id="idm45785352189432">&#13;
<h1>Placing Market Orders</h1>&#13;
&#13;
<p><a data-primary=".create_order() method" data-primary-sortas="create_order" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc10"/><a data-primary="market orders, placing" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc11"/><a data-primary="Oanda" data-secondary="placing market orders" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc12"/>Similarly, it is straightforward to place market buy or sell orders with the <code>create_order()</code> method:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">help</code><code class="p">(</code><code class="n">api</code><code class="o">.</code><code class="n">create_order</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO7-1" id="co_cfd_trading_with_oanda_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">Help</code><code> </code><code class="n">on</code><code> </code><code class="n">method</code><code> </code><code class="n">create_order</code><code> </code><code class="ow">in</code><code> </code><code class="n">module</code><code> </code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="p">:</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">create_order</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">units</code><code class="p">,</code><code> </code><code class="n">price</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="n">sl_distance</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="n">tsl_distance</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="n">tp_price</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="n">comment</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="n">touch</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="n">suppress</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code><code> </code><code class="n">ret</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code> </code><code class="n">method</code><code> </code><code class="n">of</code><code> </code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code> </code><code class="n">instance</code><code>&#13;
</code><code>             </code><code class="n">Places</code><code> </code><code class="n">order</code><code> </code><code class="k">with</code><code> </code><code class="n">Oanda</code><code class="o">.</code><code>&#13;
</code><code>&#13;
</code><code>             </code><code class="n">Parameters</code><code>&#13;
</code><code>             </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>&#13;
</code><code>             </code><code class="n">instrument</code><code class="p">:</code><code> </code><code class="n">string</code><code>&#13;
</code><code>                 </code><code class="n">valid</code><code> </code><code class="n">instrument</code><code> </code><code class="n">name</code><code>&#13;
</code><code>             </code><code class="n">units</code><code class="p">:</code><code> </code><code class="nb">int</code><code>&#13;
</code><code>                 </code><code class="n">number</code><code> </code><code class="n">of</code><code> </code><code class="n">units</code><code> </code><code class="n">of</code><code> </code><code class="n">instrument</code><code> </code><code class="n">to</code><code> </code><code class="n">be</code><code> </code><code class="n">bought</code><code>&#13;
</code><code>                 </code><code class="p">(</code><code class="n">positive</code><code> </code><code class="nb">int</code><code class="p">,</code><code> </code><code class="n">e</code><code class="o">.</code><code class="n">g</code><code class="o">.</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">units=50</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>                 </code><code class="ow">or</code><code> </code><code class="n">to</code><code> </code><code class="n">be</code><code> </code><code class="n">sold</code><code> </code><code class="p">(</code><code class="n">negative</code><code> </code><code class="nb">int</code><code class="p">,</code><code> </code><code class="n">e</code><code class="o">.</code><code class="n">g</code><code class="o">.</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">units=-100</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">price</code><code class="p">:</code><code> </code><code class="nb">float</code><code>&#13;
</code><code>                 </code><code class="n">limit</code><code> </code><code class="n">order</code><code> </code><code class="n">price</code><code class="p">,</code><code> </code><code class="n">touch</code><code> </code><code class="n">order</code><code> </code><code class="n">price</code><code>&#13;
</code><code>             </code><code class="n">sl_distance</code><code class="p">:</code><code> </code><code class="nb">float</code><code>&#13;
</code><code>                 </code><code class="n">stop</code><code> </code><code class="n">loss</code><code> </code><code class="n">distance</code><code> </code><code class="n">price</code><code class="p">,</code><code> </code><code class="n">mandatory</code><code> </code><code class="n">e</code><code class="o">.</code><code class="n">g</code><code class="o">.</code><code class="p">,</code><code> </code><code class="ow">in</code><code> </code><code class="n">Germany</code><code>&#13;
</code><code>             </code><code class="n">tsl_distance</code><code class="p">:</code><code> </code><code class="nb">float</code><code>&#13;
</code><code>                 </code><code class="n">trailing</code><code> </code><code class="n">stop</code><code> </code><code class="n">loss</code><code> </code><code class="n">distance</code><code>&#13;
</code><code>             </code><code class="n">tp_price</code><code class="p">:</code><code> </code><code class="nb">float</code><code>&#13;
</code><code>                 </code><code class="n">take</code><code> </code><code class="n">profit</code><code> </code><code class="n">price</code><code> </code><code class="n">to</code><code> </code><code class="n">be</code><code> </code><code class="n">used</code><code> </code><code class="k">for</code><code> </code><code class="n">the</code><code> </code><code class="n">trade</code><code>&#13;
</code><code>             </code><code class="n">comment</code><code class="p">:</code><code> </code><code class="nb">str</code><code>&#13;
</code><code>                 </code><code class="n">string</code><code>&#13;
</code><code>             </code><code class="n">touch</code><code class="p">:</code><code> </code><code class="n">boolean</code><code>&#13;
</code><code>                 </code><code class="n">market_if_touched</code><code> </code><code class="n">order</code><code> </code><code class="p">(</code><code class="n">requires</code><code> </code><code class="n">price</code><code> </code><code class="n">to</code><code> </code><code class="n">be</code><code> </code><code class="nb">set</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">suppress</code><code class="p">:</code><code> </code><code class="n">boolean</code><code>&#13;
</code><code>                 </code><code class="n">whether</code><code> </code><code class="n">to</code><code> </code><code class="n">suppress</code><code> </code><code class="k">print</code><code> </code><code class="n">out</code><code>&#13;
</code><code>             </code><code class="n">ret</code><code class="p">:</code><code> </code><code class="n">boolean</code><code>&#13;
</code><code>                 </code><code class="n">whether</code><code> </code><code class="n">to</code><code> </code><code class="k">return</code><code> </code><code class="n">the</code><code> </code><code class="n">order</code><code> </code><code class="nb">object</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">api</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="mi">1000</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO7-2" id="co_cfd_trading_with_oanda_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="p">{</code><code class="s1">'</code><code class="s1">id</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1721</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">2020-08-19T14:39:17.062399275Z</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">userID</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mi">13834683</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">accountID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">101-004-13834683-001</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">batchID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1720</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">requestID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">24716258589170956</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">ORDER_FILL</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">orderID</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">1720</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">instrument</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">EUR_USD</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1000.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">gainQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.835288642787</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">lossQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.843683503518</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19131</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">fullVWAP</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19131</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">fullPrice</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">PRICE</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bids</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">10000000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">asks</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19131</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">10000000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">closeoutBid</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">closeoutAsk</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.19131</code><code class="p">}</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">reason</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">MARKET_ORDER</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">pl</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">commission</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">accountBalance</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">98510.7986</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">tradeOpened</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">tradeID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1721</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1000.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19131</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0881</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">initialMarginRequired</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">33.3</code><code class="s1">'</code><code class="p">}</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0881</code><code class="s1">'</code><code class="p">}</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">api</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">1500</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO7-3" id="co_cfd_trading_with_oanda_CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="p">{</code><code class="s1">'</code><code class="s1">id</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1723</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">2020-08-19T14:39:17.200434462Z</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">userID</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mi">13834683</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">accountID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">101-004-13834683-001</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">batchID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1722</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">requestID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">24716258589171315</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">ORDER_FILL</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">orderID</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">1722</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">instrument</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">EUR_USD</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-1500.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">gainQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.835288642787</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">lossQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.843683503518</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1911</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">fullVWAP</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">fullPrice</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">PRICE</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bids</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">10000000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">asks</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19131</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">9999000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">closeoutBid</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">closeoutAsk</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.19131</code><code class="p">}</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">reason</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">MARKET_ORDER</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">pl</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-0.1772</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">commission</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">accountBalance</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">98510.6214</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">tradeOpened</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">tradeID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1723</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-500.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0441</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">initialMarginRequired</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">16.65</code><code class="s1">'</code><code class="p">}</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">tradesClosed</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">tradeID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1721</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-1000.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.1911</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">realizedPL</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-0.1772</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0881</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.1322</code><code class="s1">'</code><code class="p">}</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">api</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="mi">500</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO7-4" id="co_cfd_trading_with_oanda_CO7-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="p">{</code><code class="s1">'</code><code class="s1">id</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1725</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">2020-08-19T14:39:17.348231507Z</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">userID</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mi">13834683</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">accountID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">101-004-13834683-001</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">batchID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1724</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">requestID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">24716258589171775</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">ORDER_FILL</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">orderID</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">1724</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">instrument</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">EUR_USD</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">500.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">gainQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.835313189428</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">lossQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.84370829686</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1913</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">fullVWAP</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1913</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">fullPrice</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">PRICE</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">bids</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.19104</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">9998500</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">asks</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1913</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">9999000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">closeoutBid</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19104</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">closeoutAsk</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="mf">1.1913</code><code class="p">}</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">reason</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">MARKET_ORDER</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">pl</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-0.0844</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">commission</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">accountBalance</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">98510.537</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">tradesClosed</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">tradeID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1723</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">500.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.1913</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">realizedPL</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-0.0844</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">0.0546</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0546</code><code class="s1">'</code><code class="p">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO7-1" id="callout_cfd_trading_with_oanda_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Shows all options for placing market, limit, and market-if-touched orders.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO7-2" id="callout_cfd_trading_with_oanda_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Opens a long position via market order.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO7-3" id="callout_cfd_trading_with_oanda_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Goes short after closing the long position via market order.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO7-4" id="callout_cfd_trading_with_oanda_CO7-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Closes the short position via market order.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Although the Oanda API allows the placement of different order types, this chapter and the following chapter mainly focus on <em>market orders</em> to instantly go long or short whenever a new signal appears.<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc12" data-type="indexterm" id="idm45785347119272"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc11" data-type="indexterm" id="idm45785347118712"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc10" data-type="indexterm" id="idm45785347118072"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Implementing Trading Strategies in Real Time" data-type="sect1"><div class="sect1" id="oanda_trading">&#13;
<h1>Implementing Trading Strategies in Real Time</h1>&#13;
&#13;
<p><a data-primary="EUR/USD exchange rate" data-secondary="implementing trading strategies in real time" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc13"/><a data-primary="MomentumTrader class" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc14"/><a data-primary="Oanda" data-secondary="implementing trading strategies in real time" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc15"/><a data-primary="trading strategies" data-secondary="implementing in real time with Oanda" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc16"/>This section presents a custom class that automatically trades the <code>EUR_USD</code> instrument on the Oanda platform based on a momentum strategy. It is called <code>MomentumTrader</code> and is presented in <a data-type="xref" href="#oanda_momentum_trader">“Python Script”</a>. The following walks through the class line by line, beginning with the <code>0</code> method. The class itself inherits from the <code>tpqoa</code> class:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="kn">import</code><code> </code><code class="nn">tpqoa</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="k">class</code><code> </code><code class="nc">MomentumTrader</code><code class="p">(</code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>    </code><code class="k">def</code><code> </code><code class="nf-Magic">__init__</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code><code> </code><code class="n">conf_file</code><code class="p">,</code><code> </code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">bar_length</code><code class="p">,</code><code> </code><code class="n">momentum</code><code class="p">,</code><code> </code><code class="n">units</code><code class="p">,</code><code>&#13;
</code><code>                 </code><code class="o">*</code><code class="n">args</code><code class="p">,</code><code> </code><code class="o">*</code><code class="o">*</code><code class="n">kwargs</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>        </code><code class="nb">super</code><code class="p">(</code><code class="n">MomentumTrader</code><code class="p">,</code><code> </code><code class="bp">self</code><code class="p">)</code><code class="o">.</code><code class="nf-Magic">__init__</code><code class="p">(</code><code class="n">conf_file</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-1" id="co_cfd_trading_with_oanda_CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code> </code><code class="o">=</code><code> </code><code class="n">instrument</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-2" id="co_cfd_trading_with_oanda_CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">momentum</code><code> </code><code class="o">=</code><code> </code><code class="n">momentum</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-3" id="co_cfd_trading_with_oanda_CO8-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">bar_length</code><code> </code><code class="o">=</code><code> </code><code class="n">bar_length</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-4" id="co_cfd_trading_with_oanda_CO8-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">units</code><code> </code><code class="o">=</code><code> </code><code class="n">units</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-5" id="co_cfd_trading_with_oanda_CO8-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-6" id="co_cfd_trading_with_oanda_CO8-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">min_length</code><code> </code><code class="o">=</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">momentum</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO8-7" id="co_cfd_trading_with_oanda_CO8-7"><img alt="7" src="assets/7.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-1" id="callout_cfd_trading_with_oanda_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Initial position value (market neutral).</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-2" id="callout_cfd_trading_with_oanda_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Instrument to be traded.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-3" id="callout_cfd_trading_with_oanda_CO8-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Length of the bar for the resampling of the tick data.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-4" id="callout_cfd_trading_with_oanda_CO8-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Number of intervals for momentum calculation.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-5" id="callout_cfd_trading_with_oanda_CO8-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Number of units to be traded.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-6" id="callout_cfd_trading_with_oanda_CO8-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>An empty <code>DataFrame</code> object to be filled with tick data.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO8-7" id="callout_cfd_trading_with_oanda_CO8-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>The initial minimum bar length for the start of the trading itself.</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary=".on_success() method" data-primary-sortas="on_success" data-type="indexterm" id="idm45785350546024"/>The major method is the <code>.on_success()</code> method, which implements the trading logic for the momentum strategy:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code>    </code><code class="k">def</code><code> </code><code class="nf">on_success</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code><code> </code><code class="n">time</code><code class="p">,</code><code> </code><code class="n">bid</code><code class="p">,</code><code> </code><code class="n">ask</code><code class="p">)</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-1" id="co_cfd_trading_with_oanda_CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="sd">''' Takes actions when new tick data arrives. '''</code><code>&#13;
</code><code>        </code><code class="k">print</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">ticks</code><code class="p">,</code><code> </code><code class="n">end</code><code class="o">=</code><code class="s1">'</code><code class="s1"> </code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-2" id="co_cfd_trading_with_oanda_CO9-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code><code> </code><code class="o">=</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code>&#13;
</code><code>            </code><code class="p">{</code><code class="s1">'</code><code class="s1">bid</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">bid</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ask</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">ask</code><code class="p">}</code><code class="p">,</code><code> </code><code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">pd</code><code class="o">.</code><code class="n">Timestamp</code><code class="p">(</code><code class="n">time</code><code class="p">)</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-3" id="co_cfd_trading_with_oanda_CO9-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code>&#13;
</code><code>            </code><code class="bp">self</code><code class="o">.</code><code class="n">bar_length</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">right</code><code class="s1">'</code><code class="p">)</code><code class="o">.</code><code class="n">last</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">ffill</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-4" id="co_cfd_trading_with_oanda_CO9-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">mid</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-5" id="co_cfd_trading_with_oanda_CO9-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">returns</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">mid</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">/</code><code>&#13;
</code><code>                                      </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">mid</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-6" id="co_cfd_trading_with_oanda_CO9-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">position</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code>&#13;
</code><code>            </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">returns</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">momentum</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-7" id="co_cfd_trading_with_oanda_CO9-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">)</code><code> </code><code class="o">&gt;</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">min_length</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-8" id="co_cfd_trading_with_oanda_CO9-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>            </code><code class="bp">self</code><code class="o">.</code><code class="n">min_length</code><code> </code><code class="o">+</code><code class="o">=</code><code> </code><code class="mi">1</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-8" id="co_cfd_trading_with_oanda_CO9-9"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>            </code><code class="k">if</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">position</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">==</code><code> </code><code class="mi">1</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-9" id="co_cfd_trading_with_oanda_CO9-10"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>                </code><code class="k">if</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">==</code><code> </code><code class="mi">0</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-10" id="co_cfd_trading_with_oanda_CO9-11"><img alt="10" src="assets/10.png"/></a><code>&#13;
</code><code>                    </code><code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">units</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-11" id="co_cfd_trading_with_oanda_CO9-12"><img alt="11" src="assets/11.png"/></a><code>&#13;
</code><code>                </code><code class="k">elif</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">==</code><code> </code><code class="o">-</code><code class="mi">1</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-12" id="co_cfd_trading_with_oanda_CO9-13"><img alt="12" src="assets/12.png"/></a><code>&#13;
</code><code>                    </code><code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">units</code><code> </code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-13" id="co_cfd_trading_with_oanda_CO9-14"><img alt="13" src="assets/13.png"/></a><code>&#13;
</code><code>                </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-14" id="co_cfd_trading_with_oanda_CO9-15"><img alt="14" src="assets/14.png"/></a><code>&#13;
</code><code>            </code><code class="k">elif</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'</code><code class="s1">position</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">==</code><code> </code><code class="o">-</code><code class="mi">1</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-15" id="co_cfd_trading_with_oanda_CO9-16"><img alt="15" src="assets/15.png"/></a><code>&#13;
</code><code>                </code><code class="k">if</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">==</code><code> </code><code class="mi">0</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-16" id="co_cfd_trading_with_oanda_CO9-17"><img alt="16" src="assets/16.png"/></a><code>&#13;
</code><code>                    </code><code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="o">-</code><code class="bp">self</code><code class="o">.</code><code class="n">units</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-17" id="co_cfd_trading_with_oanda_CO9-18"><img alt="17" src="assets/17.png"/></a><code>&#13;
</code><code>                </code><code class="k">elif</code><code> </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">==</code><code> </code><code class="mi">1</code><code class="p">:</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-18" id="co_cfd_trading_with_oanda_CO9-19"><img alt="18" src="assets/18.png"/></a><code>&#13;
</code><code>                    </code><code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="o">-</code><code class="bp">self</code><code class="o">.</code><code class="n">units</code><code> </code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-19" id="co_cfd_trading_with_oanda_CO9-20"><img alt="19" src="assets/19.png"/></a><code>&#13;
</code><code>                </code><code class="bp">self</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO9-20" id="co_cfd_trading_with_oanda_CO9-21"><img alt="20" src="assets/20.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-1" id="callout_cfd_trading_with_oanda_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>This method is called whenever new tick data arrives.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-2" id="callout_cfd_trading_with_oanda_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The number of ticks retrieved is printed.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-3" id="callout_cfd_trading_with_oanda_CO9-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The tick data is collected and stored.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-4" id="callout_cfd_trading_with_oanda_CO9-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The tick data is then resampled to the appropriate bar length.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-5" id="callout_cfd_trading_with_oanda_CO9-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>The mid prices are calculated…</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-6" id="callout_cfd_trading_with_oanda_CO9-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>…based on which the log returns are derived.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-7" id="callout_cfd_trading_with_oanda_CO9-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>The signal (positioning) is derived based on the <code>momentum</code> parameter/attribute (via an online algorithm).</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-8" id="callout_cfd_trading_with_oanda_CO9-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>When there is enough or new data, the trading logic is applied and the minimum length is increased by one every time.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-10" id="callout_cfd_trading_with_oanda_CO9-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Checks whether the latest positioning (“signal”) is <code>1</code> (long).</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-11" id="callout_cfd_trading_with_oanda_CO9-10"><img alt="10" src="assets/10.png"/></a></dt>&#13;
<dd><p>If the current market position is <code>0</code> (neutral)…</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-12" id="callout_cfd_trading_with_oanda_CO9-11"><img alt="11" src="assets/11.png"/></a></dt>&#13;
<dd><p>…a buy order for <code>self.units</code> is initiated.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-13" id="callout_cfd_trading_with_oanda_CO9-12"><img alt="12" src="assets/12.png"/></a></dt>&#13;
<dd><p>If it is <code>-1</code> (short)…</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-14" id="callout_cfd_trading_with_oanda_CO9-13"><img alt="13" src="assets/13.png"/></a></dt>&#13;
<dd><p>…a buy order for <code>0</code> is initiated.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-15" id="callout_cfd_trading_with_oanda_CO9-14"><img alt="14" src="assets/14.png"/></a></dt>&#13;
<dd><p>The market position <code>self.position</code> is set to <code>+1</code> (long).</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-16" id="callout_cfd_trading_with_oanda_CO9-15"><img alt="15" src="assets/15.png"/></a></dt>&#13;
<dd><p>Checks whether the latest positioning (“signal”) is <code>-1</code> (short).</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-17" id="callout_cfd_trading_with_oanda_CO9-16"><img alt="16" src="assets/16.png"/></a></dt>&#13;
<dd><p>If the current market position is <code>0</code> (neutral)…</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-18" id="callout_cfd_trading_with_oanda_CO9-17"><img alt="17" src="assets/17.png"/></a></dt>&#13;
<dd><p>…a sell order for <code>-self.units</code> is initiated.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-19" id="callout_cfd_trading_with_oanda_CO9-18"><img alt="18" src="assets/18.png"/></a></dt>&#13;
<dd><p>If it is <code>+1</code> (long)…</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-20" id="callout_cfd_trading_with_oanda_CO9-19"><img alt="19" src="assets/19.png"/></a></dt>&#13;
<dd><p>…a sell order for <code>0</code> is initiated.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO9-21" id="callout_cfd_trading_with_oanda_CO9-20"><img alt="20" src="assets/20.png"/></a></dt>&#13;
<dd><p>The market position <code>self.position</code> is set to -1 (short).</p></dd>&#13;
</dl>&#13;
&#13;
<p>Based on this class, getting started with automated, algorithmic trading is just four lines of code. The Python code that follows initiates an automated trading session:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">MomentumTrader</code><code> </code><code class="kn">as</code><code> </code><code class="nn">MT</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">25</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">mt</code><code> </code><code class="o">=</code><code> </code><code class="n">MT</code><code class="o">.</code><code class="n">MomentumTrader</code><code class="p">(</code><code class="s1">'</code><code class="s1">../pyalgo.cfg</code><code class="s1">'</code><code class="p">,</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO10-1" id="co_cfd_trading_with_oanda_CO10-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>                                </code><code class="n">instrument</code><code class="o">=</code><code class="n">instrument</code><code class="p">,</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO10-2" id="co_cfd_trading_with_oanda_CO10-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                                </code><code class="n">bar_length</code><code class="o">=</code><code class="s1">'</code><code class="s1">10s</code><code class="s1">'</code><code class="p">,</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO10-3" id="co_cfd_trading_with_oanda_CO10-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>                                </code><code class="n">momentum</code><code class="o">=</code><code class="mi">6</code><code class="p">,</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO10-4" id="co_cfd_trading_with_oanda_CO10-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>                                </code><code class="n">units</code><code class="o">=</code><code class="mi">10000</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO10-5" id="co_cfd_trading_with_oanda_CO10-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">mt</code><code class="o">.</code><code class="n">stream_data</code><code class="p">(</code><code class="n">mt</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">stop</code><code class="o">=</code><code class="mi">500</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO10-6" id="co_cfd_trading_with_oanda_CO10-6"><img alt="6" src="assets/6.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO10-1" id="callout_cfd_trading_with_oanda_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The configuration file with the credentials.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO10-2" id="callout_cfd_trading_with_oanda_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The <code>instrument</code> parameter is specified.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO10-3" id="callout_cfd_trading_with_oanda_CO10-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The <code>bar_length</code> parameter for the resampling is provided.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO10-4" id="callout_cfd_trading_with_oanda_CO10-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The <code>momentum</code> parameter is defined, which is applied to the resampled data intervals.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO10-5" id="callout_cfd_trading_with_oanda_CO10-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>The <code>units</code> parameter is set, which specifies the position size for long and short positions.</p></dd>&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO10-6" id="callout_cfd_trading_with_oanda_CO10-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>This starts the streaming and therewith the trading; it stops after 100 ticks.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The preceding code provides the following output:</p>&#13;
&#13;
<pre data-type="programlisting">1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27&#13;
 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50&#13;
 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73&#13;
 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96&#13;
 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114&#13;
 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131&#13;
 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148&#13;
 149 150 151 152 153&#13;
&#13;
{'id': '1727', 'time': '2020-08-19T14:40:30.443867492Z', 'userID':&#13;
 13834683, 'accountID': '101-004-13834683-001', 'batchID': '1726',&#13;
 'requestID': '42730657405829101', 'type': 'ORDER_FILL', 'orderID':&#13;
 '1726', 'instrument': 'EUR_USD', 'units': '10000.0',&#13;
 'gainQuoteHomeConversionFactor': '0.8350012403',&#13;
 'lossQuoteHomeConversionFactor': '0.843393212565', 'price': 1.19168,&#13;
 'fullVWAP': 1.19168, 'fullPrice': {'type': 'PRICE', 'bids': [{'price':&#13;
 1.19155, 'liquidity': '10000000'}], 'asks': [{'price': 1.19168,&#13;
 'liquidity': '10000000'}], 'closeoutBid': 1.19155, 'closeoutAsk':&#13;
 1.19168}, 'reason': 'MARKET_ORDER', 'pl': '0.0', 'financing': '0.0',&#13;
 'commission': '0.0', 'guaranteedExecutionFee': '0.0',&#13;
 'accountBalance': '98510.537', 'tradeOpened': {'tradeID': '1727',&#13;
 'units': '10000.0', 'price': 1.19168, 'guaranteedExecutionFee': '0.0',&#13;
 'halfSpreadCost': '0.5455', 'initialMarginRequired': '333.0'},&#13;
 'halfSpreadCost': '0.5455'}&#13;
&#13;
154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171&#13;
 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188&#13;
 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205&#13;
 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222&#13;
 223&#13;
&#13;
{'id': '1729', 'time': '2020-08-19T14:41:11.436438078Z', 'userID':&#13;
 13834683, 'accountID': '101-004-13834683-001', 'batchID': '1728',&#13;
 'requestID': '42730657577912600', 'type': 'ORDER_FILL', 'orderID':&#13;
 '1728', 'instrument': 'EUR_USD', 'units': '-20000.0',&#13;
 'gainQuoteHomeConversionFactor': '0.83519398913',&#13;
 'lossQuoteHomeConversionFactor': '0.843587898569', 'price': 1.19124,&#13;
 'fullVWAP': 1.19124, 'fullPrice': {'type': 'PRICE', 'bids': [{'price':&#13;
 1.19124, 'liquidity': '10000000'}], 'asks': [{'price': 1.19144,&#13;
 'liquidity': '10000000'}], 'closeoutBid': 1.19124, 'closeoutAsk':&#13;
 1.19144}, 'reason': 'MARKET_ORDER', 'pl': '-3.7118', 'financing':&#13;
 '0.0', 'commission': '0.0', 'guaranteedExecutionFee': '0.0',&#13;
 'accountBalance': '98506.8252', 'tradeOpened': {'tradeID': '1729',&#13;
 'units': '-10000.0', 'price': 1.19124, 'guaranteedExecutionFee':&#13;
 '0.0', 'halfSpreadCost': '0.8394', 'initialMarginRequired': '333.0'},&#13;
 'tradesClosed': [{'tradeID': '1727', 'units': '-10000.0', 'price':&#13;
 1.19124, 'realizedPL': '-3.7118', 'financing': '0.0',&#13;
 'guaranteedExecutionFee': '0.0', 'halfSpreadCost': '0.8394'}],&#13;
 'halfSpreadCost': '1.6788'}&#13;
&#13;
224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241&#13;
 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258&#13;
 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275&#13;
 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292&#13;
 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309&#13;
 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326&#13;
 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343&#13;
 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360&#13;
 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377&#13;
 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394&#13;
&#13;
{'id': '1731', 'time': '2020-08-19T14:42:20.525804142Z', 'userID':&#13;
 13834683, 'accountID': '101-004-13834683-001', 'batchID': '1730',&#13;
 'requestID': '42730657867512554', 'type': 'ORDER_FILL', 'orderID':&#13;
 '1730', 'instrument': 'EUR_USD', 'units': '20000.0',&#13;
 'gainQuoteHomeConversionFactor': '0.835400847964',&#13;
 'lossQuoteHomeConversionFactor': '0.843796836386', 'price': 1.19111,&#13;
 'fullVWAP': 1.19111, 'fullPrice': {'type': 'PRICE', 'bids': [{'price':&#13;
 1.19098, 'liquidity': '10000000'}], 'asks': [{'price': 1.19111,&#13;
 'liquidity': '10000000'}], 'closeoutBid': 1.19098, 'closeoutAsk':&#13;
 1.19111}, 'reason': 'MARKET_ORDER', 'pl': '1.086', 'financing': '0.0',&#13;
 'commission': '0.0', 'guaranteedExecutionFee': '0.0',&#13;
 'accountBalance': '98507.9112', 'tradeOpened': {'tradeID': '1731',&#13;
 'units': '10000.0', 'price': 1.19111, 'guaranteedExecutionFee': '0.0',&#13;
 'halfSpreadCost': '0.5457', 'initialMarginRequired': '333.0'},&#13;
 'tradesClosed': [{'tradeID': '1729', 'units': '10000.0', 'price':&#13;
 1.19111, 'realizedPL': '1.086', 'financing': '0.0',&#13;
 'guaranteedExecutionFee': '0.0', 'halfSpreadCost': '0.5457'}],&#13;
 'halfSpreadCost': '1.0914'}&#13;
&#13;
395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412&#13;
 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429&#13;
 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446&#13;
 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463&#13;
 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480&#13;
 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497&#13;
 498 499 500</pre>&#13;
&#13;
<p>Finally, close out the final position:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">oo</code><code> </code><code class="o">=</code><code> </code><code class="n">mt</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="n">instrument</code><code class="p">,</code><code> </code><code class="n">units</code><code class="o">=</code><code class="o">-</code><code class="n">mt</code><code class="o">.</code><code class="n">position</code><code> </code><code class="o">*</code><code> </code><code class="n">mt</code><code class="o">.</code><code class="n">units</code><code class="p">,</code><code>&#13;
</code><code>                              </code><code class="n">ret</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code> </code><code class="n">suppress</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>  </code><a class="co" href="#callout_cfd_trading_with_oanda_CO11-1" id="co_cfd_trading_with_oanda_CO11-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">oo</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">id</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1733</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">time</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">2020-08-19T14:43:17.107985242Z</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">userID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mi">13834683</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">accountID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">101-004-13834683-001</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">batchID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1732</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">requestID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">42730658106750652</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">ORDER_FILL</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">orderID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1732</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">instrument</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">EUR_USD</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-10000.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">gainQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.835327206922</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">lossQuoteHomeConversionFactor</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.843722455232</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19109</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">fullVWAP</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19109</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">fullPrice</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">PRICE</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>           </code><code class="s1">'</code><code class="s1">bids</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19109</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">10000000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>           </code><code class="s1">'</code><code class="s1">asks</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19121</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">liquidity</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">10000000</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>           </code><code class="s1">'</code><code class="s1">closeoutBid</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19109</code><code class="p">,</code><code>&#13;
</code><code>           </code><code class="s1">'</code><code class="s1">closeoutAsk</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19121</code><code class="p">}</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">reason</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">MARKET_ORDER</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">pl</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-0.1687</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">commission</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">accountBalance</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">98507.7425</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">tradesClosed</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">{</code><code class="s1">'</code><code class="s1">tradeID</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">1731</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>            </code><code class="s1">'</code><code class="s1">units</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-10000.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>            </code><code class="s1">'</code><code class="s1">price</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="mf">1.19109</code><code class="p">,</code><code>&#13;
</code><code>            </code><code class="s1">'</code><code class="s1">realizedPL</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">-0.1687</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>            </code><code class="s1">'</code><code class="s1">financing</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>            </code><code class="s1">'</code><code class="s1">guaranteedExecutionFee</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.0</code><code class="s1">'</code><code class="p">,</code><code>&#13;
</code><code>            </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.5037</code><code class="s1">'</code><code class="p">}</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>          </code><code class="s1">'</code><code class="s1">halfSpreadCost</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">0.5037</code><code class="s1">'</code><code class="p">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_cfd_trading_with_oanda_CO11-1" id="callout_cfd_trading_with_oanda_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Closes out the final position.<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc16" data-type="indexterm" id="idm45785353631976"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc15" data-type="indexterm" id="idm45785353631304"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc14" data-type="indexterm" id="idm45785353630008"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc13" data-type="indexterm" id="idm45785353629368"/></p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Retrieving Account Information" data-type="sect1"><div class="sect1" id="oanda_account">&#13;
<h1>Retrieving Account Information</h1>&#13;
&#13;
<p><a data-primary="EUR/USD exchange rate" data-secondary="retrieving trading account information" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc17"/><a data-primary="Oanda" data-secondary="retrieving account information" data-type="indexterm" id="ix_08_cfd_trading_with_oanda_-asciidoc18"/>With regard to account information, transaction history, and the like, the Oanda RESTful API is also convenient to work with. <a data-primary=".get_account_summary() method" data-primary-sortas="get_account_summary" data-type="indexterm" id="idm45785346894808"/>For example, after the execution of the momentum strategy in the previous section, the algorithmic trader might want &#13;
<span class="keep-together">to inspect</span> the current balance of the trading account. This is possible via the <code>.get_account_summary()</code> method:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="n">api</code><code class="o">.</code><code class="n">get_account_summary</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="p">{</code><code class="s1">'id'</code><code class="p">:</code> <code class="s1">'101-004-13834683-001'</code><code class="p">,</code>&#13;
          <code class="s1">'alias'</code><code class="p">:</code> <code class="s1">'Primary'</code><code class="p">,</code>&#13;
          <code class="s1">'currency'</code><code class="p">:</code> <code class="s1">'EUR'</code><code class="p">,</code>&#13;
          <code class="s1">'balance'</code><code class="p">:</code> <code class="s1">'98507.7425'</code><code class="p">,</code>&#13;
          <code class="s1">'createdByUserID'</code><code class="p">:</code> <code class="mi">13834683</code><code class="p">,</code>&#13;
          <code class="s1">'createdTime'</code><code class="p">:</code> <code class="s1">'2020-03-19T06:08:14.363139403Z'</code><code class="p">,</code>&#13;
          <code class="s1">'guaranteedStopLossOrderMode'</code><code class="p">:</code> <code class="s1">'DISABLED'</code><code class="p">,</code>&#13;
          <code class="s1">'pl'</code><code class="p">:</code> <code class="s1">'-1273.126'</code><code class="p">,</code>&#13;
          <code class="s1">'resettablePL'</code><code class="p">:</code> <code class="s1">'-1273.126'</code><code class="p">,</code>&#13;
          <code class="s1">'resettablePLTime'</code><code class="p">:</code> <code class="s1">'0'</code><code class="p">,</code>&#13;
          <code class="s1">'financing'</code><code class="p">:</code> <code class="s1">'-219.1315'</code><code class="p">,</code>&#13;
          <code class="s1">'commission'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
          <code class="s1">'guaranteedExecutionFees'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
          <code class="s1">'marginRate'</code><code class="p">:</code> <code class="s1">'0.0333'</code><code class="p">,</code>&#13;
          <code class="s1">'openTradeCount'</code><code class="p">:</code> <code class="mi">1</code><code class="p">,</code>&#13;
          <code class="s1">'openPositionCount'</code><code class="p">:</code> <code class="mi">1</code><code class="p">,</code>&#13;
          <code class="s1">'pendingOrderCount'</code><code class="p">:</code> <code class="mi">0</code><code class="p">,</code>&#13;
          <code class="s1">'hedgingEnabled'</code><code class="p">:</code> <code class="bp">False</code><code class="p">,</code>&#13;
          <code class="s1">'unrealizedPL'</code><code class="p">:</code> <code class="s1">'929.8862'</code><code class="p">,</code>&#13;
          <code class="s1">'NAV'</code><code class="p">:</code> <code class="s1">'99437.6287'</code><code class="p">,</code>&#13;
          <code class="s1">'marginUsed'</code><code class="p">:</code> <code class="s1">'377.76'</code><code class="p">,</code>&#13;
          <code class="s1">'marginAvailable'</code><code class="p">:</code> <code class="s1">'99064.4945'</code><code class="p">,</code>&#13;
          <code class="s1">'positionValue'</code><code class="p">:</code> <code class="s1">'3777.6'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCloseoutUnrealizedPL'</code><code class="p">:</code> <code class="s1">'935.8183'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCloseoutNAV'</code><code class="p">:</code> <code class="s1">'99443.5608'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCloseoutMarginUsed'</code><code class="p">:</code> <code class="s1">'377.76'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCloseoutPercent'</code><code class="p">:</code> <code class="s1">'0.0019'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCloseoutPositionValue'</code><code class="p">:</code> <code class="s1">'3777.6'</code><code class="p">,</code>&#13;
          <code class="s1">'withdrawalLimit'</code><code class="p">:</code> <code class="s1">'98507.7425'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCallMarginUsed'</code><code class="p">:</code> <code class="s1">'377.76'</code><code class="p">,</code>&#13;
          <code class="s1">'marginCallPercent'</code><code class="p">:</code> <code class="s1">'0.0038'</code><code class="p">,</code>&#13;
          <code class="s1">'lastTransactionID'</code><code class="p">:</code> <code class="s1">'1733'</code><code class="p">}</code></pre>&#13;
&#13;
<p><a data-primary=".get_transactions() method" data-primary-sortas="get_transactions" data-type="indexterm" id="idm45785347851208"/>Information about the last few trades is received with the <code>.get_transactions()</code> method:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="n">api</code><code class="o">.</code><code class="n">get_transactions</code><code class="p">(</code><code class="n">tid</code><code class="o">=</code><code class="nb">int</code><code class="p">(</code><code class="n">oo</code><code class="p">[</code><code class="s1">'id'</code><code class="p">])</code> <code class="o">-</code> <code class="mi">2</code><code class="p">)</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="p">[{</code><code class="s1">'id'</code><code class="p">:</code> <code class="s1">'1732'</code><code class="p">,</code>&#13;
           <code class="s1">'time'</code><code class="p">:</code> <code class="s1">'2020-08-19T14:43:17.107985242Z'</code><code class="p">,</code>&#13;
           <code class="s1">'userID'</code><code class="p">:</code> <code class="mi">13834683</code><code class="p">,</code>&#13;
           <code class="s1">'accountID'</code><code class="p">:</code> <code class="s1">'101-004-13834683-001'</code><code class="p">,</code>&#13;
           <code class="s1">'batchID'</code><code class="p">:</code> <code class="s1">'1732'</code><code class="p">,</code>&#13;
           <code class="s1">'requestID'</code><code class="p">:</code> <code class="s1">'42730658106750652'</code><code class="p">,</code>&#13;
           <code class="s1">'type'</code><code class="p">:</code> <code class="s1">'MARKET_ORDER'</code><code class="p">,</code>&#13;
           <code class="s1">'instrument'</code><code class="p">:</code> <code class="s1">'EUR_USD'</code><code class="p">,</code>&#13;
           <code class="s1">'units'</code><code class="p">:</code> <code class="s1">'-10000.0'</code><code class="p">,</code>&#13;
           <code class="s1">'timeInForce'</code><code class="p">:</code> <code class="s1">'FOK'</code><code class="p">,</code>&#13;
           <code class="s1">'positionFill'</code><code class="p">:</code> <code class="s1">'DEFAULT'</code><code class="p">,</code>&#13;
           <code class="s1">'reason'</code><code class="p">:</code> <code class="s1">'CLIENT_ORDER'</code><code class="p">},</code>&#13;
          <code class="p">{</code><code class="s1">'id'</code><code class="p">:</code> <code class="s1">'1733'</code><code class="p">,</code>&#13;
           <code class="s1">'time'</code><code class="p">:</code> <code class="s1">'2020-08-19T14:43:17.107985242Z'</code><code class="p">,</code>&#13;
           <code class="s1">'userID'</code><code class="p">:</code> <code class="mi">13834683</code><code class="p">,</code>&#13;
           <code class="s1">'accountID'</code><code class="p">:</code> <code class="s1">'101-004-13834683-001'</code><code class="p">,</code>&#13;
           <code class="s1">'batchID'</code><code class="p">:</code> <code class="s1">'1732'</code><code class="p">,</code>&#13;
           <code class="s1">'requestID'</code><code class="p">:</code> <code class="s1">'42730658106750652'</code><code class="p">,</code>&#13;
           <code class="s1">'type'</code><code class="p">:</code> <code class="s1">'ORDER_FILL'</code><code class="p">,</code>&#13;
           <code class="s1">'orderID'</code><code class="p">:</code> <code class="s1">'1732'</code><code class="p">,</code>&#13;
           <code class="s1">'instrument'</code><code class="p">:</code> <code class="s1">'EUR_USD'</code><code class="p">,</code>&#13;
           <code class="s1">'units'</code><code class="p">:</code> <code class="s1">'-10000.0'</code><code class="p">,</code>&#13;
           <code class="s1">'gainQuoteHomeConversionFactor'</code><code class="p">:</code> <code class="s1">'0.835327206922'</code><code class="p">,</code>&#13;
           <code class="s1">'lossQuoteHomeConversionFactor'</code><code class="p">:</code> <code class="s1">'0.843722455232'</code><code class="p">,</code>&#13;
           <code class="s1">'price'</code><code class="p">:</code> <code class="mf">1.19109</code><code class="p">,</code>&#13;
           <code class="s1">'fullVWAP'</code><code class="p">:</code> <code class="mf">1.19109</code><code class="p">,</code>&#13;
           <code class="s1">'fullPrice'</code><code class="p">:</code> <code class="p">{</code><code class="s1">'type'</code><code class="p">:</code> <code class="s1">'PRICE'</code><code class="p">,</code>&#13;
            <code class="s1">'bids'</code><code class="p">:</code> <code class="p">[{</code><code class="s1">'price'</code><code class="p">:</code> <code class="mf">1.19109</code><code class="p">,</code> <code class="s1">'liquidity'</code><code class="p">:</code> <code class="s1">'10000000'</code><code class="p">}],</code>&#13;
            <code class="s1">'asks'</code><code class="p">:</code> <code class="p">[{</code><code class="s1">'price'</code><code class="p">:</code> <code class="mf">1.19121</code><code class="p">,</code> <code class="s1">'liquidity'</code><code class="p">:</code> <code class="s1">'10000000'</code><code class="p">}],</code>&#13;
            <code class="s1">'closeoutBid'</code><code class="p">:</code> <code class="mf">1.19109</code><code class="p">,</code>&#13;
            <code class="s1">'closeoutAsk'</code><code class="p">:</code> <code class="mf">1.19121</code><code class="p">},</code>&#13;
           <code class="s1">'reason'</code><code class="p">:</code> <code class="s1">'MARKET_ORDER'</code><code class="p">,</code>&#13;
           <code class="s1">'pl'</code><code class="p">:</code> <code class="s1">'-0.1687'</code><code class="p">,</code>&#13;
           <code class="s1">'financing'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
           <code class="s1">'commission'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
           <code class="s1">'guaranteedExecutionFee'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
           <code class="s1">'accountBalance'</code><code class="p">:</code> <code class="s1">'98507.7425'</code><code class="p">,</code>&#13;
           <code class="s1">'tradesClosed'</code><code class="p">:</code> <code class="p">[{</code><code class="s1">'tradeID'</code><code class="p">:</code> <code class="s1">'1731'</code><code class="p">,</code>&#13;
             <code class="s1">'units'</code><code class="p">:</code> <code class="s1">'-10000.0'</code><code class="p">,</code>&#13;
             <code class="s1">'price'</code><code class="p">:</code> <code class="mf">1.19109</code><code class="p">,</code>&#13;
             <code class="s1">'realizedPL'</code><code class="p">:</code> <code class="s1">'-0.1687'</code><code class="p">,</code>&#13;
             <code class="s1">'financing'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
             <code class="s1">'guaranteedExecutionFee'</code><code class="p">:</code> <code class="s1">'0.0'</code><code class="p">,</code>&#13;
             <code class="s1">'halfSpreadCost'</code><code class="p">:</code> <code class="s1">'0.5037'</code><code class="p">}],</code>&#13;
           <code class="s1">'halfSpreadCost'</code><code class="p">:</code> <code class="s1">'0.5037'</code><code class="p">}]</code></pre>&#13;
&#13;
<p><a data-primary=".print_transactions() method" data-primary-sortas="print_transactions" data-type="indexterm" id="idm45785350556344"/>For a concise overview, there is also the <code>.print_transactions()</code> method available:<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc18" data-type="indexterm" id="idm45785350554824"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc17" data-type="indexterm" id="idm45785350554056"/></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">30</code><code class="p">]:</code> <code class="n">api</code><code class="o">.</code><code class="n">print_transactions</code><code class="p">(</code><code class="n">tid</code><code class="o">=</code><code class="nb">int</code><code class="p">(</code><code class="n">oo</code><code class="p">[</code><code class="s1">'id'</code><code class="p">])</code> <code class="o">-</code> <code class="mi">18</code><code class="p">)</code>&#13;
         <code class="mi">1717</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">37</code><code class="p">:</code><code class="mf">00.803426931</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>   <code class="o">-</code><code class="mf">10000.0</code> <code class="o">|</code> <code class="mf">0.0</code>&#13;
         <code class="mi">1719</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">38</code><code class="p">:</code><code class="mf">21.953399006</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>    <code class="mf">10000.0</code> <code class="o">|</code> <code class="mf">6.8444</code>&#13;
         <code class="mi">1721</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">17.062399275</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>     <code class="mf">1000.0</code> <code class="o">|</code> <code class="mf">0.0</code>&#13;
         <code class="mi">1723</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">17.200434462</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>    <code class="o">-</code><code class="mf">1500.0</code> <code class="o">|</code> <code class="o">-</code><code class="mf">0.1772</code>&#13;
         <code class="mi">1725</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">39</code><code class="p">:</code><code class="mf">17.348231507</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>      <code class="mf">500.0</code> <code class="o">|</code> <code class="o">-</code><code class="mf">0.0844</code>&#13;
         <code class="mi">1727</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">40</code><code class="p">:</code><code class="mf">30.443867492</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>    <code class="mf">10000.0</code> <code class="o">|</code> <code class="mf">0.0</code>&#13;
         <code class="mi">1729</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">41</code><code class="p">:</code><code class="mf">11.436438078</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>   <code class="o">-</code><code class="mf">20000.0</code> <code class="o">|</code> <code class="o">-</code><code class="mf">3.7118</code>&#13;
         <code class="mi">1731</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">42</code><code class="p">:</code><code class="mf">20.525804142</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>    <code class="mf">20000.0</code> <code class="o">|</code> <code class="mf">1.086</code>&#13;
         <code class="mi">1733</code> <code class="o">|</code> <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mi">19</code><code class="n">T14</code><code class="p">:</code><code class="mi">43</code><code class="p">:</code><code class="mf">17.107985242</code><code class="n">Z</code> <code class="o">|</code> <code class="n">EUR_USD</code> <code class="o">|</code>   <code class="o">-</code><code class="mf">10000.0</code> <code class="o">|</code> <code class="o">-</code><code class="mf">0.1687</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space" data-pdf-bookmark="Conclusions" data-type="sect1"><div class="sect1" id="idm45785348704568">&#13;
<h1>Conclusions</h1>&#13;
&#13;
<p>The Oanda platform allows for an easy and straightforward entry into the world of automated, algorithmic trading. Oanda specializes in so-called contracts for difference (CFDs). Depending on the country of residence of the trader, there is a great variety of instruments that can be traded.</p>&#13;
&#13;
<p>A major advantage of Oanda from a technological point of view is the modern, powerful APIs that can be easily accessed via a dedicated Python wrapper package (<code>v20</code>). This chapter shows how to set up an account, how to connect to the APIs with Python, how to retrieve historical data (one minute bars) for backtesting purposes, how to retrieve streaming data in real time, how to automatically trade a CFD based on a momentum strategy, and how to retrieve account information and the detailed transaction history.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="References and Further Resources" data-type="sect1"><div class="sect1" id="idm45785349155240">&#13;
<h1>References and Further Resources</h1>&#13;
&#13;
<p>Visit the help and support pages of Oanda under <a href="https://oreil.ly/-CMwk">Help and Support</a> to learn more about the Oanda platform and important aspects of CFD &#13;
<span class="keep-together">trading</span>.</p>&#13;
&#13;
<p>The developer portal of Oanda <a href="https://oreil.ly/oO_eV">Getting Started</a> provides a detailed description of the APIs.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Python Script" data-type="sect1"><div class="sect1" id="oanda_momentum_trader">&#13;
<h1>Python Script</h1>&#13;
&#13;
<p><a data-primary="momentum strategies" data-secondary="Python script for custom streaming class" data-type="indexterm" id="idm45785348576664"/><a data-primary="Oanda" data-secondary="Python script for custom streaming class" data-type="indexterm" id="idm45785348575592"/><a data-primary="Python scripts" data-secondary="custom streaming class that trades a momentum strategy" data-type="indexterm" id="idm45785348574616"/>The following Python script contains an Oanda custom streaming class that automatically trades a momentum strategy:<a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc1" data-type="indexterm" id="idm45785348573384"/><a data-startref="ix_08_cfd_trading_with_oanda_-asciidoc0" data-type="indexterm" id="idm45785348572648"/></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1">#</code>&#13;
<code class="c1"># Python Script</code>&#13;
<code class="c1"># with Momentum Trading Class</code>&#13;
<code class="c1"># for Oanda v20</code>&#13;
<code class="c1">#</code>&#13;
<code class="c1"># Python for Algorithmic Trading</code>&#13;
<code class="c1"># (c) Dr. Yves J. Hilpisch</code>&#13;
<code class="c1"># The Python Quants GmbH</code>&#13;
<code class="c1">#</code>&#13;
<code class="kn">import</code> <code class="nn">tpqoa</code>&#13;
<code class="kn">import</code> <code class="nn">numpy</code> <code class="kn">as</code> <code class="nn">np</code>&#13;
<code class="kn">import</code> <code class="nn">pandas</code> <code class="kn">as</code> <code class="nn">pd</code>&#13;
&#13;
&#13;
<code class="k">class</code> <code class="nc">MomentumTrader</code><code class="p">(</code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="p">):</code>&#13;
    <code class="k">def</code> <code class="nf-Magic">__init__</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code> <code class="n">conf_file</code><code class="p">,</code> <code class="n">instrument</code><code class="p">,</code> <code class="n">bar_length</code><code class="p">,</code> <code class="n">momentum</code><code class="p">,</code> <code class="n">units</code><code class="p">,</code>&#13;
                 <code class="o">*</code><code class="n">args</code><code class="p">,</code> <code class="o">**</code><code class="n">kwargs</code><code class="p">):</code>&#13;
        <code class="nb">super</code><code class="p">(</code><code class="n">MomentumTrader</code><code class="p">,</code> <code class="bp">self</code><code class="p">)</code><code class="o">.</code><code class="nf-Magic">__init__</code><code class="p">(</code><code class="n">conf_file</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">=</code> <code class="mi">0</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">instrument</code> <code class="o">=</code> <code class="n">instrument</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">momentum</code> <code class="o">=</code> <code class="n">momentum</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">bar_length</code> <code class="o">=</code> <code class="n">bar_length</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">units</code> <code class="o">=</code> <code class="n">units</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">()</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">min_length</code> <code class="o">=</code> <code class="bp">self</code><code class="o">.</code><code class="n">momentum</code> <code class="o">+</code> <code class="mi">1</code>&#13;
&#13;
    <code class="k">def</code> <code class="nf">on_success</code><code class="p">(</code><code class="bp">self</code><code class="p">,</code> <code class="n">time</code><code class="p">,</code> <code class="n">bid</code><code class="p">,</code> <code class="n">ask</code><code class="p">):</code>&#13;
        <code class="sd">''' Takes actions when new tick data arrives. '''</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">ticks</code><code class="p">,</code> <code class="n">end</code><code class="o">=</code><code class="s1">' '</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code> <code class="o">=</code> <code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code>&#13;
            <code class="p">{</code><code class="s1">'bid'</code><code class="p">:</code> <code class="n">bid</code><code class="p">,</code> <code class="s1">'ask'</code><code class="p">:</code> <code class="n">ask</code><code class="p">},</code> <code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">pd</code><code class="o">.</code><code class="n">Timestamp</code><code class="p">(</code><code class="n">time</code><code class="p">)]))</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">data</code> <code class="o">=</code> <code class="bp">self</code><code class="o">.</code><code class="n">raw_data</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code>&#13;
            <code class="bp">self</code><code class="o">.</code><code class="n">bar_length</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'right'</code><code class="p">)</code><code class="o">.</code><code class="n">last</code><code class="p">()</code><code class="o">.</code><code class="n">ffill</code><code class="p">()</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'mid'</code><code class="p">]</code> <code class="o">=</code> <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'returns'</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'mid'</code><code class="p">]</code> <code class="o">/</code>&#13;
                                      <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'mid'</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">))</code>&#13;
        <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'position'</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code>&#13;
            <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'returns'</code><code class="p">]</code><code class="o">.</code><code class="n">rolling</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">momentum</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">())</code>&#13;
&#13;
        <code class="k">if</code> <code class="nb">len</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">)</code> <code class="o">&gt;</code> <code class="bp">self</code><code class="o">.</code><code class="n">min_length</code><code class="p">:</code>&#13;
            <code class="bp">self</code><code class="o">.</code><code class="n">min_length</code> <code class="o">+=</code> <code class="mi">1</code>&#13;
            <code class="k">if</code> <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'position'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code> <code class="o">==</code> <code class="mi">1</code><code class="p">:</code>&#13;
                <code class="k">if</code> <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">==</code> <code class="mi">0</code><code class="p">:</code>&#13;
                    <code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="bp">self</code><code class="o">.</code><code class="n">units</code><code class="p">)</code>&#13;
                <code class="k">elif</code> <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">==</code> <code class="o">-</code><code class="mi">1</code><code class="p">:</code>&#13;
                    <code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="bp">self</code><code class="o">.</code><code class="n">units</code> <code class="o">*</code> <code class="mi">2</code><code class="p">)</code>&#13;
                <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">=</code> <code class="mi">1</code>&#13;
            <code class="k">elif</code> <code class="bp">self</code><code class="o">.</code><code class="n">data</code><code class="p">[</code><code class="s1">'position'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code> <code class="o">==</code> <code class="o">-</code><code class="mi">1</code><code class="p">:</code>&#13;
                <code class="k">if</code> <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">==</code> <code class="mi">0</code><code class="p">:</code>&#13;
                    <code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="o">-</code><code class="bp">self</code><code class="o">.</code><code class="n">units</code><code class="p">)</code>&#13;
                <code class="k">elif</code> <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">==</code> <code class="mi">1</code><code class="p">:</code>&#13;
                    <code class="bp">self</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="bp">self</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="o">-</code><code class="bp">self</code><code class="o">.</code><code class="n">units</code> <code class="o">*</code> <code class="mi">2</code><code class="p">)</code>&#13;
                <code class="bp">self</code><code class="o">.</code><code class="n">position</code> <code class="o">=</code> <code class="o">-</code><code class="mi">1</code>&#13;
&#13;
&#13;
<code class="k">if</code> <code class="nv-Magic">__name__</code> <code class="o">==</code> <code class="s1">'__main__'</code><code class="p">:</code>&#13;
    <code class="n">strat</code> <code class="o">=</code> <code class="mi">2</code>&#13;
    <code class="k">if</code> <code class="n">strat</code> <code class="o">==</code> <code class="mi">1</code><code class="p">:</code>&#13;
        <code class="n">mom</code> <code class="o">=</code> <code class="n">MomentumTrader</code><code class="p">(</code><code class="s1">'../pyalgo.cfg'</code><code class="p">,</code> <code class="s1">'DE30_EUR'</code><code class="p">,</code> <code class="s1">'5s'</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>&#13;
        <code class="n">mom</code><code class="o">.</code><code class="n">stream_data</code><code class="p">(</code><code class="n">mom</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="n">stop</code><code class="o">=</code><code class="mi">100</code><code class="p">)</code>&#13;
        <code class="n">mom</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="n">mom</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="n">units</code><code class="o">=-</code><code class="n">mom</code><code class="o">.</code><code class="n">position</code> <code class="o">*</code> <code class="n">mom</code><code class="o">.</code><code class="n">units</code><code class="p">)</code>&#13;
    <code class="k">elif</code> <code class="n">strat</code> <code class="o">==</code> <code class="mi">2</code><code class="p">:</code>&#13;
        <code class="n">mom</code> <code class="o">=</code> <code class="n">MomentumTrader</code><code class="p">(</code><code class="s1">'../pyalgo.cfg'</code><code class="p">,</code> <code class="n">instrument</code><code class="o">=</code><code class="s1">'EUR_USD'</code><code class="p">,</code>&#13;
                             <code class="n">bar_length</code><code class="o">=</code><code class="s1">'5s'</code><code class="p">,</code> <code class="n">momentum</code><code class="o">=</code><code class="mi">6</code><code class="p">,</code> <code class="n">units</code><code class="o">=</code><code class="mi">100000</code><code class="p">)</code>&#13;
        <code class="n">mom</code><code class="o">.</code><code class="n">stream_data</code><code class="p">(</code><code class="n">mom</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="n">stop</code><code class="o">=</code><code class="mi">100</code><code class="p">)</code>&#13;
        <code class="n">mom</code><code class="o">.</code><code class="n">create_order</code><code class="p">(</code><code class="n">mom</code><code class="o">.</code><code class="n">instrument</code><code class="p">,</code> <code class="n">units</code><code class="o">=-</code><code class="n">mom</code><code class="o">.</code><code class="n">position</code> <code class="o">*</code> <code class="n">mom</code><code class="o">.</code><code class="n">units</code><code class="p">)</code>&#13;
    <code class="k">else</code><code class="p">:</code>&#13;
        <code class="k">print</code><code class="p">(</code><code class="s1">'Strategy not known.'</code><code class="p">)</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45785354036712"><sup><a href="ch08.html#idm45785354036712-marker">1</a></sup> The naming of certain objects is not completely consistent in the context of the Oanda APIs. For example, <em>API key</em> and <em>access token</em> are used interchangeably. Also, <em>account ID</em> and <em>account number</em> refer to the same number.</p><p data-type="footnote" id="idm45785352515432"><sup><a href="ch08.html#idm45785352515432-marker">2</a></sup> This implicitely neglects transaction costs in the form of bid-ask spreads when selling and buying units of the instrument, respectively.</p><p data-type="footnote" id="idm45785353211096"><sup><a href="ch08.html#idm45785353211096-marker">3</a></sup> Note that for some instruments, <em>one unit</em> means 1 USD, like for currency-related CFDs. For others, like for index-related CFDs (for example, <code>DE30_EUR</code>), <em>one unit</em> means a currency exposure at the (bid/ask) price of the CFD (for example, 11,750 EUR).</p><p data-type="footnote" id="idm45785353206904"><sup><a href="ch08.html#idm45785353206904-marker">4</a></sup> The simplified calculations neglect, for example, <em>financing costs</em> that might become due for leveraged trading.</p></div></div></section></body></html>