<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Machine Learning"><div class="chapter" id="machine_learning">
<h1><span class="label">Chapter 5. </span>Machine Learning</h1>

<blockquote>
<p class="align_me_right">Dataism says that the universe consists of data flows, and the value of any phenomenon or entity is determined by its contribution to data processing….Dataism thereby collapses the barrier between animals [humans] and machines, and expects electronic algorithms to eventually decipher and outperform biochemical algorithms.</p>
<p data-type="attribution">Yuval Noah Harari (2015)</p>
</blockquote>
<blockquote>
<p class="align_me_right">Machine learning is the scientific method on steroids. It follows the same process of generating, testing, and discarding or refining hypotheses. But while a scientist may spend his or her whole life coming up with and testing a few hundred hypotheses, a machine learning system can do the same in a second. Machine learning automates discovery. It’s no surprise, then, that it’s revolutionizing science as much as it’s revolutionizing business.</p>
<p data-type="attribution">Pedro Domingos (2015)</p>
</blockquote>

<p><a data-type="indexterm" data-primary="ML (machine learning)" id="ix_ML_gen_ch5"/>This chapter is about <em>machine learning as a process</em>. Although it uses specific algorithms and specific data for illustration, the notions and approaches discussed in this chapter are general in nature. The goal is to present the most important elements of machine learning in a single place and in an easy-to-understand and easy-to-visualize manner. The approach of this chapter is practical and illustrative in nature, omitting most technical details throughout. In that sense, the chapter provides a kind of blueprint for later, more realistic machine learning applications.</p>

<p><a data-type="xref" href="#ml_learning">“Learning”</a> briefly discusses the very notion of a machine that <em>learns</em>. <a data-type="xref" href="#ml_data">“Data”</a> imports and preprocesses the sample data used in later sections. The sample data is based on a time series for the EUR/USD exchange rate. <a data-type="xref" href="#ml_success">“Success”</a> implements OLS regression and neural network estimation 
<span class="keep-together">given the sample</span> data and uses the mean-squared error as the measure of success. <a data-type="xref" href="#ml_capacity">“Capacity”</a> discusses the role of the model capacity in making 
<span class="keep-together">models more</span> successful in the context of estimation problems. <a data-type="xref" href="#ml_evaluation">“Evaluation”</a> explains the role that model evaluation, typically based on a validation data sub-set, plays in the machine-learning process. <a data-type="xref" href="#ml_bias_var">“Bias and Variance”</a> discusses the notions of <em>high bias</em> and <em>high variance</em> models and their typical characteristics in the context of estimation problems. <a data-type="xref" href="#ml_cross_val">“Cross-Validation”</a> illustrates the concept of cross-validation to avoid, among other things, overfitting due to a too-large model capacity.</p>

<p>VanderPlas (2017, ch. 5) discusses topics similar to the ones covered in this chapter, making use primarily of the <code>scikit-learn</code> Python package. Chollet (2017, ch. 4) also provides an overview similar to the one provided here, but primarily makes use of the <code>Keras</code> deep learning package. Goodfellow et al. (2016, ch. 5) give a more technical and mathematical overview of machine learning and related important concepts.</p>






<section data-type="sect1" data-pdf-bookmark="Learning"><div class="sect1" id="ml_learning">
<h1>Learning</h1>

<p><a data-type="indexterm" data-primary="learning" data-seealso="ML" id="idm45625309678984"/>On a formal, more abstract level, <em>learning</em> by an algorithm or computer program can be defined as in Mitchell (1997):</p>
<blockquote>
<p>A computer program is said to learn from experience <math alttext="upper E">
  <mi>E</mi>
</math> with respect to some class of tasks <math alttext="upper T">
  <mi>T</mi>
</math> and performance measure <math alttext="upper P">
  <mi>P</mi>
</math>, if its performance at tasks in <math alttext="upper T">
  <mi>T</mi>
</math>, as measured by <math alttext="upper P">
  <mi>P</mi>
</math>, improves with experience <math alttext="upper E">
  <mi>E</mi>
</math>.</p></blockquote>

<p>There is a class of tasks that are to be performed (for example, <em>estimation</em> or <em>classification</em>). <a data-type="indexterm" data-primary="MSE (mean squared error)" id="idm45625309667448"/><a data-type="indexterm" data-primary="accuracy ratio" id="idm45625309666744"/>Then there is a performance measure, such as the <em>mean-squared error</em> (MSE) or the <em>accuracy ratio</em>. Then there is <em>learning</em> as measured by the improvement in performance given the experience of the algorithm with the task. <a data-type="indexterm" data-primary="UL (unsupervised learning)" id="idm45625309664488"/><a data-type="indexterm" data-primary="SL (supervised learning)" id="idm45625309663768"/>The class of tasks at hand is described in general based on the given data set, which includes the features data and the labels data in the case of supervised learning, or only the features data in the case of unsupervised learning.</p>
<div data-type="note" epub:type="note"><h1>Learning Task Versus Task to Learn</h1>
<p>In the definition of learning through an algorithm or computer program, it is important to note the difference between the task of learning and the tasks to be learned. <em>Learning</em> means to learn how to (best) execute a certain task, such as estimation or classification.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Data"><div class="sect1" id="ml_data">
<h1>Data</h1>

<p><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="sample data set" id="ix_ML_sample_data"/>This section introduces the sample data set to be used in the sections to follow. The sample data is created based on a real financial time series for the EUR/USD exchange rate. First, the data is imported from a CSV file, and then the data is resampled to monthly data and stored in a <code>Series</code> object:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">pylab</code><code> </code><code class="kn">import</code><code> </code><code class="n">plt</code><code class="p">,</code><code> </code><code class="n">mpl</code><code>
</code><code>        </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>        </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">savefig.dpi</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">300</code><code>
</code><code>        </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">font.family</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">serif</code><code class="s1">'</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">url</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">http://hilpisch.com/aiif_eikon_eod_data.csv</code><code class="s1">'</code><code>  </code><a class="co" id="co_machine_learning_CO1-1" href="#callout_machine_learning_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">raw</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">,</code><code> </code><code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="p">[</code><code class="s1">'</code><code class="s1">EUR=</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO1-2" href="#callout_machine_learning_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">raw</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">Date</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">1.4323</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">04</code><code>    </code><code class="mf">1.4411</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">05</code><code>    </code><code class="mf">1.4368</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">06</code><code>    </code><code class="mf">1.4412</code><code>
</code><code>        </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">07</code><code>    </code><code class="mf">1.4318</code><code>
</code><code>        </code><code class="n">Name</code><code class="p">:</code><code> </code><code class="n">EUR</code><code class="o">=</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">raw</code><code class="o">.</code><code class="n">tail</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">Date</code><code>
</code><code>        </code><code class="mi">2019</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">26</code><code>    </code><code class="mf">1.1096</code><code>
</code><code>        </code><code class="mi">2019</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">27</code><code>    </code><code class="mf">1.1175</code><code>
</code><code>        </code><code class="mi">2019</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">30</code><code>    </code><code class="mf">1.1197</code><code>
</code><code>        </code><code class="mi">2019</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">31</code><code>    </code><code class="mf">1.1210</code><code>
</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">01</code><code>    </code><code class="mf">1.1210</code><code>
</code><code>        </code><code class="n">Name</code><code class="p">:</code><code> </code><code class="n">EUR</code><code class="o">=</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l</code><code> </code><code class="o">=</code><code> </code><code class="n">raw</code><code class="o">.</code><code class="n">resample</code><code class="p">(</code><code class="s1">'</code><code class="s1">1M</code><code class="s1">'</code><code class="p">)</code><code class="o">.</code><code class="n">last</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO1-3" href="#callout_machine_learning_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">title</code><code class="o">=</code><code class="s1">'</code><code class="s1">EUR/USD monthly</code><code class="s1">'</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO1-1" href="#co_machine_learning_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Imports the financial time series data</p></dd>
<dt><a class="co" id="callout_machine_learning_CO1-2" href="#co_machine_learning_CO1-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Resamples the data to monthly time intervals</p></dd>
</dl>

<p><a data-type="xref" href="#figure_ml_01">Figure 5-1</a> shows the financial time series.</p>

<figure class="thumb"><div id="figure_ml_01" class="figure">
<img src="Images/aiif_0501.png" alt="aiif 0501" width="2466" height="1546"/>
<h6><span class="label">Figure 5-1. </span>EUR/USD exchange rate as time series (monthly)</h6>
</div></figure>

<p>To have a single feature only, the following Python code creates a synthetic feature vector. This allows for simple visualizations in two dimensions. The synthetic feature (independent variable), of course, does not have any explanatory power for the EUR/USD exchange rate (labels data, dependent variable). In what follows, it is also abstracted from the fact that the labels data is sequential and temporal in nature. The sample data set is treated in this chapter as a general data set composed of a one-dimensional features vector and a one-dimensional labels vector. <a data-type="xref" href="#figure_ml_01_">Figure 5-2</a> visualizes the sample data set that implies an <em>estimation problem</em> is the task at hand:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l</code><code> </code><code class="o">=</code><code> </code><code class="n">l</code><code class="o">.</code><code class="n">values</code><code>  </code><a class="co" id="co_machine_learning_CO2-1" href="#callout_machine_learning_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">l</code><code> </code><code class="o">-</code><code class="o">=</code><code> </code><code class="n">l</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO2-2" href="#callout_machine_learning_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">f</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="o">-</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">l</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO2-3" href="#callout_machine_learning_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Sample Data Set</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">features</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">labels</code><code class="s1">'</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO2-1" href="#co_machine_learning_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Transforms the labels data to an <code>ndarray</code> object</p></dd>
<dt><a class="co" id="callout_machine_learning_CO2-2" href="#co_machine_learning_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Subtracts the mean value from the data element-wise</p></dd>
<dt><a class="co" id="callout_machine_learning_CO2-3" href="#co_machine_learning_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Creates a synthetic feature as an <code>ndarray</code> object<a data-type="indexterm" data-primary="" data-startref="ix_ML_sample_data" id="idm45625309580168"/></p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_01_" class="figure">
<img src="Images/aiif_0502.png" alt="aiif 0502" width="2517" height="1546"/>
<h6><span class="label">Figure 5-2. </span>Sample data set</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Success"><div class="sect1" id="ml_success">
<h1>Success</h1>

<p><a data-type="indexterm" data-primary="MSE (mean squared error)" id="ix_MSE_inML"/><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="MSE of model or algorithm" id="ix_ML_MSE_model"/><a data-type="indexterm" data-primary="estimation task" data-secondary="machine learning example" id="ix_estim_task_ML_ex"/>The measure of success for estimation problems in general is the MSE, as used in <a data-type="xref" href="ch01.xhtml#artificial_intelligence">Chapter 1</a>. Based on the MSE, success is judged given the labels data as the relevant benchmark and the predicted values of an algorithm after having been exposed to the data set or parts of it. As in <a data-type="xref" href="ch01.xhtml#artificial_intelligence">Chapter 1</a>, two algorithms are considered in this and the following sections: OLS regression and neural networks.</p>

<p><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="estimation task learning" id="ix_OLS_estim_task"/><a data-type="indexterm" data-primary="estimation task" data-secondary="OLS regression" id="ix_estim_task_OLS"/>First is OLS regression. The application is straightforward, as the following Python code illustrates. The regression result is shown in <a data-type="xref" href="#figure_ml_02">Figure 5-3</a> for a regression including monomials up to the fifth order. The resulting MSE is also calculated:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">MSE</code><code class="p">(</code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">(</code><code class="n">l</code><code> </code><code class="o">-</code><code> </code><code class="n">p</code><code class="p">)</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO3-1" href="#callout_machine_learning_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">deg</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO3-2" href="#callout_machine_learning_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">reg</code><code>  </code><a class="co" id="co_machine_learning_CO3-3" href="#callout_machine_learning_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="o">-</code><code class="mf">0.01910626</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mf">0.0147182</code><code> </code><code class="p">,</code><code>  </code><code class="mf">0.10990388</code><code class="p">,</code><code>  </code><code class="mf">0.06007211</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mf">0.20833598</code><code class="p">,</code><code>
</code><code>                </code><code class="o">-</code><code class="mf">0.03275423</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO3-4" href="#callout_machine_learning_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO3-5" href="#callout_machine_learning_CO3-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.0034166422957371025</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">sample data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">regression</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO3-1" href="#co_machine_learning_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The function <code>MSE</code> calculates the mean-squared error.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO3-2" href="#co_machine_learning_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The fitting of the OLS regression model up to and including fifth-order monomials.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO3-3" href="#co_machine_learning_CO3-4"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The prediction by the OLS regression model given the optimal parameters.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO3-4" href="#co_machine_learning_CO3-5"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The MSE value given the prediction values.</p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_02" class="figure">
<img src="Images/aiif_0503.png" alt="aiif 0503" width="2451" height="1421"/>
<h6><span class="label">Figure 5-3. </span>Sample data and cubic regression line</h6>
</div></figure>

<p>OLS regression is generally solved analytically. Therefore, no iterated learning takes place. However, one can simulate a learning procedure by gradually exposing the algorithm to more data. The following Python code implements OLS regression and prediction, starting with a few samples only and gradually increasing the number to finally reach the complete length of the data set. The regression step is implemented based on the smaller sub-sets, whereas the prediction steps are implemented based on the whole features data in each case. In general, the MSE drops significantly when increasing the training data set:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">20</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">f</code><code class="p">[</code><code class="p">:</code><code class="n">i</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">[</code><code class="p">:</code><code class="n">i</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">deg</code><code class="o">=</code><code class="mi">3</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO4-1" href="#callout_machine_learning_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO4-2" href="#callout_machine_learning_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">mse</code><code> </code><code class="o">=</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO4-3" href="#callout_machine_learning_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">{i:3d} | MSE={mse}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>          </code><code class="mi">10</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">248628.10681642237</code><code>
</code><code>          </code><code class="mi">30</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">731.9382249304651</code><code>
</code><code>          </code><code class="mi">50</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">12.236088505004465</code><code>
</code><code>          </code><code class="mi">70</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.7410590619743301</code><code>
</code><code>          </code><code class="mi">90</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0057430617304093275</code><code>
</code><code>         </code><code class="mi">110</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.006492800939555582</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO4-1" href="#co_machine_learning_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Regression step based on data sub-set</p></dd>
<dt><a class="co" id="callout_machine_learning_CO4-2" href="#co_machine_learning_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Prediction step based on the complete data set</p></dd>
<dt><a class="co" id="callout_machine_learning_CO4-3" href="#co_machine_learning_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Resulting MSE value<a data-type="indexterm" data-primary="" data-startref="ix_estim_task_OLS" id="idm45625308749880"/><a data-type="indexterm" data-primary="" data-startref="ix_OLS_estim_task" id="idm45625308604376"/></p></dd>
</dl>

<p><a data-type="indexterm" data-primary="neural networks" data-secondary="in estimation task" data-secondary-sortas="estimation task" id="ix_neuralnet_estim_task_ch5"/><a data-type="indexterm" data-primary="estimation task" data-secondary="neural networks applied to" id="ix_estim_task_neuralnet_app_ch5"/>Second is the neural network. The application to the sample data is again straightforward and similar to the case in <a data-type="xref" href="ch01.xhtml#artificial_intelligence">Chapter 1</a>. <a data-type="xref" href="#figure_ml_03">Figure 5-4</a> shows how the neural network approximates the sample data:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">tensorflow</code><code> </code><code class="kn">as</code><code> </code><code class="nn">tf</code><code>
</code><code>         </code><code class="n">tf</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">set_seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">keras.layers</code><code> </code><code class="kn">import</code><code> </code><code class="n">Dense</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">keras.models</code><code> </code><code class="kn">import</code><code> </code><code class="n">Sequential</code><code>
</code><code>         </code><code class="n">Using</code><code> </code><code class="n">TensorFlow</code><code> </code><code class="n">backend</code><code class="o">.</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">Sequential</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="mi">256</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">relu</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">input_dim</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO5-1" href="#callout_machine_learning_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">linear</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" id="co_machine_learning_CO5-2" href="#callout_machine_learning_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="n">loss</code><code class="o">=</code><code class="s1">'</code><code class="s1">mse</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">optimizer</code><code class="o">=</code><code class="s1">'</code><code class="s1">rmsprop</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">summary</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="n">Model</code><code class="p">:</code><code> </code><code class="s2">"</code><code class="s2">sequential_1</code><code class="s2">"</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>         </code><code class="n">Layer</code><code> </code><code class="p">(</code><code class="nb">type</code><code class="p">)</code><code>                 </code><code class="n">Output</code><code> </code><code class="n">Shape</code><code>              </code><code class="n">Param</code><code> </code><code class="c1">#</code><code>
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>
</code><code>         </code><code class="n">dense_1</code><code> </code><code class="p">(</code><code class="n">Dense</code><code class="p">)</code><code>              </code><code class="p">(</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="mi">256</code><code class="p">)</code><code>               </code><code class="mi">512</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>         </code><code class="n">dense_2</code><code> </code><code class="p">(</code><code class="n">Dense</code><code class="p">)</code><code>              </code><code class="p">(</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>                 </code><code class="mi">257</code><code>
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>
</code><code>         </code><code class="n">Total</code><code> </code><code class="n">params</code><code class="p">:</code><code> </code><code class="mi">769</code><code>
</code><code>         </code><code class="n">Trainable</code><code> </code><code class="n">params</code><code class="p">:</code><code> </code><code class="mi">769</code><code>
</code><code>         </code><code class="n">Non</code><code class="o">-</code><code class="n">trainable</code><code> </code><code class="n">params</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="n">time</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">1500</code><code class="p">,</code><code> </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO5-3" href="#callout_machine_learning_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">5.89</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mi">761</code><code> </code><code class="n">ms</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">6.66</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">4.43</code><code> </code><code class="n">s</code><code>
</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">&lt;</code><code class="n">keras</code><code class="o">.</code><code class="n">callbacks</code><code class="o">.</code><code class="n">callbacks</code><code class="o">.</code><code class="n">History</code><code> </code><code class="n">at</code><code> </code><code class="mh">0x7fc05d599d90</code><code class="o">&gt;</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code class="o">.</code><code class="n">flatten</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO5-4" href="#callout_machine_learning_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO5-5" href="#callout_machine_learning_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.0020217512014360102</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">sample data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">DNN approximation</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO5-1" href="#co_machine_learning_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The neural network is a shallow network with a single hidden layer.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO5-2" href="#co_machine_learning_CO5-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The fitting step with a relatively high number of epochs.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO5-3" href="#co_machine_learning_CO5-4"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The prediction step that also flattens the <code>ndarray</code> object.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO5-4" href="#co_machine_learning_CO5-5"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The resulting MSE value for the DNN prediction.</p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_03" class="figure">
<img src="Images/aiif_0504.png" alt="aiif 0504" width="2451" height="1421"/>
<h6><span class="label">Figure 5-4. </span>Sample data and neural network approximation</h6>
</div></figure>

<p>With the <code>Keras</code> package, the MSE values are stored after every learning step. <a data-type="xref" href="#figure_ml_04">Figure 5-5</a> shows how the MSE value (“loss”) decreases on average (as far as one can tell from the plot) with the increasing number of epochs over which the neural network is trained:<a data-type="indexterm" data-primary="" data-startref="ix_ML_MSE_model" id="idm45625308238312"/><a data-type="indexterm" data-primary="" data-startref="ix_MSE_inML" id="idm45625308237368"/></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">25</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">pandas</code> <code class="kn">as</code> <code class="nn">pd</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">26</code><code class="p">]:</code> <code class="n">res</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">model</code><code class="o">.</code><code class="n">history</code><code class="o">.</code><code class="n">history</code><code class="p">)</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">27</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">tail</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">27</code><code class="p">]:</code>           <code class="n">loss</code>
         <code class="mi">1495</code>  <code class="mf">0.001547</code>
         <code class="mi">1496</code>  <code class="mf">0.001520</code>
         <code class="mi">1497</code>  <code class="mf">0.001456</code>
         <code class="mi">1498</code>  <code class="mf">0.001356</code>
         <code class="mi">1499</code>  <code class="mf">0.001325</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">100</code><code class="p">:]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'MSE'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'epochs'</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ml_04" class="figure">
<img src="Images/aiif_0505.png" alt="aiif 0505" width="2561" height="1490"/>
<h6><span class="label">Figure 5-5. </span>MSE values against number of training epochs</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Capacity"><div class="sect1" id="ml_capacity">
<h1>Capacity</h1>

<p><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="capacity of model or algorithm" id="ix_ML_capacity"/><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="capacity in ML" id="idm45625308090328"/><a data-type="indexterm" data-primary="capacity of model or algorithm, in ML" id="ix_capacity_ML"/>The <em>capacity</em> of a model or algorithm defines what types of functions or relationships the model or algorithm can basically learn. In the case of OLS regression based on monomials only, there is only one parameter that defines the capacity of the model: the degree of the highest monomial to be used. If this degree parameter is set to <code>deg=3</code>, the OLS regression model can learn functional relationships of constant, linear, quadratic, or cubic type. The higher the parameter <code>deg</code> is, the higher the capacity of the OLS regression model will be.</p>

<p>The following Python code starts at <code>deg=1</code> and increases the degree in increments of two. The MSE values monotonically decrease with the increasing degree parameter. <a data-type="xref" href="#figure_ml_05">Figure 5-6</a> shows the regression lines for all degrees considered:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">29</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">d</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">12</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">deg</code><code class="o">=</code><code class="n">d</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO6-1" href="#callout_machine_learning_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">)</code><code>
</code><code>             </code><code class="n">mse</code><code> </code><code class="o">=</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">{d:2d} | MSE={mse}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>          </code><code class="mi">1</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.005322474034260403</code><code>
</code><code>          </code><code class="mi">3</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.004353110724143185</code><code>
</code><code>          </code><code class="mi">5</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0034166422957371025</code><code>
</code><code>          </code><code class="mi">7</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0027389501772354025</code><code>
</code><code>          </code><code class="mi">9</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.001411961626330845</code><code>
</code><code>         </code><code class="mi">11</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0012651237868752322</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">30</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">sample data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">d</code><code> </code><code class="ow">in</code><code> </code><code class="n">reg</code><code class="p">:</code><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">)</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="n">f</code><code class="s1">'</code><code class="s1">deg={d}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO6-1" href="#co_machine_learning_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Regression step for different values for <code>deg</code></p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_05" class="figure">
<img src="Images/aiif_0506.png" alt="aiif 0506" width="2451" height="1421"/>
<h6><span class="label">Figure 5-6. </span>Regression lines for different highest degrees</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="hyperparameters for neural network capacity" id="ix_hyperparam_nn"/>The capacity of a neural network depends on a number of <em>hyperparameters</em>. Among them are, in general, the following:</p>

<ul>
<li>
<p>Number of hidden layers</p>
</li>
<li>
<p>Number of hidden units for each hidden layer</p>
</li>
</ul>

<p>Together, these two hyperparameters define the number of trainable parameters (weights) in the neural network. The neural network model in the previous section has a relatively low number of trainable parameters. Adding, for example, just one more layer of the same size increases the number of trainable parameters significantly. Although the number of training epochs may need to be increased, the MSE value decreases significantly for the neural network with the higher capacity, and the fit also seems much better visually, as <a data-type="xref" href="#figure_ml_06">Figure 5-7</a> shows:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">31</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">create_dnn_model</code><code class="p">(</code><code class="n">hl</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">hu</code><code class="o">=</code><code class="mi">256</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="sd">''' Function to create Keras DNN model.

             Parameters
             ==========
             hl: int
                 number of hidden layers
             hu: int
                 number of hidden units (per layer)
             '''</code><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">Sequential</code><code class="p">(</code><code class="p">)</code><code>
</code><code>             </code><code class="k">for</code><code> </code><code class="n">_</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="n">hl</code><code class="p">)</code><code class="p">:</code><code>
</code><code>                 </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="n">hu</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">relu</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">input_dim</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO7-1" href="#callout_machine_learning_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">add</code><code class="p">(</code><code class="n">Dense</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">activation</code><code class="o">=</code><code class="s1">'</code><code class="s1">linear</code><code class="s1">'</code><code class="p">)</code><code class="p">)</code><code>
</code><code>             </code><code class="n">model</code><code class="o">.</code><code class="n">compile</code><code class="p">(</code><code class="n">loss</code><code class="o">=</code><code class="s1">'</code><code class="s1">mse</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">optimizer</code><code class="o">=</code><code class="s1">'</code><code class="s1">rmsprop</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">model</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">32</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">create_dnn_model</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO7-2" href="#callout_machine_learning_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">summary</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO7-3" href="#callout_machine_learning_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">Model</code><code class="p">:</code><code> </code><code class="s2">"</code><code class="s2">sequential_2</code><code class="s2">"</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>         </code><code class="n">Layer</code><code> </code><code class="p">(</code><code class="nb">type</code><code class="p">)</code><code>                 </code><code class="n">Output</code><code> </code><code class="n">Shape</code><code>              </code><code class="n">Param</code><code> </code><code class="c1">#</code><code>
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>
</code><code>         </code><code class="n">dense_3</code><code> </code><code class="p">(</code><code class="n">Dense</code><code class="p">)</code><code>              </code><code class="p">(</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="mi">256</code><code class="p">)</code><code>               </code><code class="mi">512</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>         </code><code class="n">dense_4</code><code> </code><code class="p">(</code><code class="n">Dense</code><code class="p">)</code><code>              </code><code class="p">(</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="mi">256</code><code class="p">)</code><code>               </code><code class="mi">65792</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>         </code><code class="n">dense_5</code><code> </code><code class="p">(</code><code class="n">Dense</code><code class="p">)</code><code>              </code><code class="p">(</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="mi">256</code><code class="p">)</code><code>               </code><code class="mi">65792</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>         </code><code class="n">dense_6</code><code> </code><code class="p">(</code><code class="n">Dense</code><code class="p">)</code><code>              </code><code class="p">(</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code>                 </code><code class="mi">257</code><code>
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">=</code><code>
</code><code>         </code><code class="n">Total</code><code> </code><code class="n">params</code><code class="p">:</code><code> </code><code class="mi">132</code><code class="p">,</code><code class="mi">353</code><code>
</code><code>         </code><code class="n">Trainable</code><code> </code><code class="n">params</code><code class="p">:</code><code> </code><code class="mi">132</code><code class="p">,</code><code class="mi">353</code><code>
</code><code>         </code><code class="n">Non</code><code class="o">-</code><code class="n">trainable</code><code> </code><code class="n">params</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
</code><code>         </code><code class="n">_________________________________________________________________</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">34</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="n">time</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">2500</code><code class="p">,</code><code> </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">34.9</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">5.91</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">40.8</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">15.5</code><code> </code><code class="n">s</code><code>
</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">34</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">&lt;</code><code class="n">keras</code><code class="o">.</code><code class="n">callbacks</code><code class="o">.</code><code class="n">callbacks</code><code class="o">.</code><code class="n">History</code><code> </code><code class="n">at</code><code> </code><code class="mh">0x7fc03fc18890</code><code class="o">&gt;</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">35</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code class="o">.</code><code class="n">flatten</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">36</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">36</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.00046612284916401614</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">37</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">sample data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">DNN approximation</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO7-1" href="#co_machine_learning_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Adds potentially many layers to the neural network</p></dd>
<dt><a class="co" id="callout_machine_learning_CO7-2" href="#co_machine_learning_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>A deep neural network with three hidden layers</p></dd>
<dt><a class="co" id="callout_machine_learning_CO7-3" href="#co_machine_learning_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The summary shows the increased number of trainable parameters (increased capacity)<a data-type="indexterm" data-primary="" data-startref="ix_estim_task_ML_ex" id="idm45625305849224"/><a data-type="indexterm" data-primary="" data-startref="ix_estim_task_neuralnet_app_ch5" id="idm45625305848248"/><a data-type="indexterm" data-primary="" data-startref="ix_neuralnet_estim_task_ch5" id="idm45625305918280"/><a data-type="indexterm" data-primary="" data-startref="ix_capacity_ML" id="idm45625305917400"/><a data-type="indexterm" data-primary="" data-startref="ix_ML_capacity" id="idm45625305916456"/><a data-type="indexterm" data-primary="" data-startref="ix_hyperparam_nn" id="idm45625305915512"/></p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_06" class="figure">
<img src="Images/aiif_0507.png" alt="aiif 0507" width="2451" height="1421"/>
<h6><span class="label">Figure 5-7. </span>Sample data and DNN approximation (higher capacity)</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Evaluation"><div class="sect1" id="ml_evaluation">
<h1>Evaluation</h1>

<p><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="evaluation of estimation algorithm" id="ix_ML_estim_task_eval"/><a data-type="indexterm" data-primary="estimation task" data-secondary="evaluation of algorithm" id="ix_estim_task_ML_eval"/>In the previous sections, the analysis focuses on the performance of estimation algorithms on the sample data set as a whole. As a general rule, the capacity of the model or algorithm directly influences its performance when training and evaluating it on the same data set. However, this is the “simple and easy case” in ML. <a data-type="indexterm" data-primary="data" data-secondary="training algorithms" id="idm45625305925592"/>The more complex and interesting case is when a trained model or algorithm shall be used for a generalization on data that the model or algorithm has not seen before. Such a generalization can, for example, be the prediction (estimation) of a future stock price, given the history of stock prices, or the classification of potential debtors as “creditworthy” or “not creditworthy,” given the data from existing debtors.</p>

<p><a data-type="indexterm" data-primary="prediction, ML and" data-seealso="market prediction" id="idm45625305923816"/>Although the term <em>prediction</em> is often used freely in the context of estimations, given the features data set used for training, a real prediction probably entails predicting something not known up front and never seen before. Again, the prediction of a future stock price is a good example for a real prediction in a temporal sense.</p>

<p>In general, a given data set is divided into sub-sets that each have different purposes:</p>
<dl>
<dt>Training data set</dt>
<dd>
<p><a data-type="indexterm" data-primary="training data set, training algorithm" id="idm45625305939048"/>This is the sub-set used for the training of the algorithm.</p>
</dd>
<dt>Validation data set</dt>
<dd>
<p><a data-type="indexterm" data-primary="validation data set, training algorithm" id="idm45625305937096"/>This is the sub-set used for validating the performance
of the algorithm during training—and this data set is different from the training data set.</p>
</dd>
<dt>Test data set</dt>
<dd>
<p><a data-type="indexterm" data-primary="test data set, training algorithm" id="idm45625305869304"/>This is the sub-set on which the trained algorithm is only tested after the training is finished.</p>
</dd>
</dl>

<p>Insights that are gained by applying a (currently) trained algorithm on the validation data set might reflect on the training itself (for example, by adjusting the hyperparameters of a model). On the other hand, the idea is that insights from testing the trained algorithm on the test data set shall not be reflected in the training itself or the hyperparameters.</p>

<p>The following Python code chooses, somewhat arbitrarily, 25% of the sample data for testing; the model or algorithm will not see this data before the training (learning) is finished. Similarly, 25% of the sample data is reserved for validation; this data is used to monitor performance during the training step and possibly during many learning iterations. The remaining 50% is used for the training (learning) itself.<sup><a data-type="noteref" id="idm45625305881528-marker" href="ch05.xhtml#idm45625305881528">1</a></sup>  Given the sample data set, it makes sense to apply shuffling techniques to populate all sample data sub-sets randomly:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">38</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">te</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="mf">0.25</code><code> </code><code class="o">*</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-1" href="#callout_machine_learning_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">va</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="mf">0.25</code><code> </code><code class="o">*</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-2" href="#callout_machine_learning_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">39</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ind</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">f</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-3" href="#callout_machine_learning_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">shuffle</code><code class="p">(</code><code class="n">ind</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-4" href="#callout_machine_learning_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">40</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ind_te</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="n">ind</code><code class="p">[</code><code class="p">:</code><code class="n">te</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-5" href="#callout_machine_learning_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">ind_va</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="n">ind</code><code class="p">[</code><code class="n">te</code><code class="p">:</code><code class="n">te</code><code> </code><code class="o">+</code><code> </code><code class="n">va</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-6" href="#callout_machine_learning_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">ind_tr</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="n">ind</code><code class="p">[</code><code class="n">te</code><code> </code><code class="o">+</code><code> </code><code class="n">va</code><code class="p">:</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO8-7" href="#callout_machine_learning_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">41</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">f_te</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="p">[</code><code class="n">ind_te</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO8-8" href="#callout_machine_learning_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">f_va</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="p">[</code><code class="n">ind_va</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO8-9" href="#callout_machine_learning_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">f_tr</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="p">[</code><code class="n">ind_tr</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO8-10" href="#callout_machine_learning_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">42</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l_te</code><code> </code><code class="o">=</code><code> </code><code class="n">l</code><code class="p">[</code><code class="n">ind_te</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO8-11" href="#callout_machine_learning_CO8-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">l_va</code><code> </code><code class="o">=</code><code> </code><code class="n">l</code><code class="p">[</code><code class="n">ind_va</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO8-12" href="#callout_machine_learning_CO8-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">l_tr</code><code> </code><code class="o">=</code><code> </code><code class="n">l</code><code class="p">[</code><code class="n">ind_tr</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO8-13" href="#callout_machine_learning_CO8-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO8-1" href="#co_machine_learning_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Number of test data set samples</p></dd>
<dt><a class="co" id="callout_machine_learning_CO8-2" href="#co_machine_learning_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Number of validation data set samples</p></dd>
<dt><a class="co" id="callout_machine_learning_CO8-3" href="#co_machine_learning_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Randomized index for complete data set</p></dd>
<dt><a class="co" id="callout_machine_learning_CO8-4" href="#co_machine_learning_CO8-5"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Resulting sorted indexes for the data sub-sets</p></dd>
<dt><a class="co" id="callout_machine_learning_CO8-5" href="#co_machine_learning_CO8-8"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Resulting features data sub-sets</p></dd>
<dt><a class="co" id="callout_machine_learning_CO8-6" href="#co_machine_learning_CO8-11"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Resulting labels data sub-sets</p></dd>
</dl>
<div data-type="caution"><h1>Randomized Sampling</h1>
<p><a data-type="indexterm" data-primary="randomized sampling, in ML" id="idm45625307907912"/>The randomized population of training, validation, and test data sets is a common and useful technique for data sets that are neither sequence-like nor temporal in nature. However, when one is dealing, say, with a financial time series, shuffling the data is generally to be avoided because it breaks up temporal structures and sneaks foresight bias into the process by using, for example, later samples for training and implementing the testing on earlier samples.</p>
</div>

<p><a data-type="indexterm" data-primary="MSE (mean squared error)" id="ix_MSE_ch5"/><a data-type="indexterm" data-primary="training data set, training algorithm" id="ix_training_dataset"/><a data-type="indexterm" data-primary="validation data set, training algorithm" id="ix_valid_dataset"/><a data-type="indexterm" data-primary="data" data-secondary="training algorithms" id="ix_data_training_alg"/>Based on the training and validation data sub-sets, the following Python code implements a regression for different <code>deg</code> parameter values and calculates the MSE values for the predictions on both data sub-sets. Although the MSE values on the training data set decrease monotonically, the MSE values on the validation data set often reach a minimum for a certain parameter value and then increase again. <a data-type="indexterm" data-primary="overfitting of data, avoiding" id="idm45625307882424"/>This phenomenon indicates what is called <em>overfitting</em>. <a data-type="xref" href="#figure_ml_07">Figure 5-8</a> shows the regression fits for the different values of <code>deg</code> and compares the fits for both the training data and validation data sets:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">43</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>         </code><code class="n">mse</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">d</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">22</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="n">deg</code><code class="o">=</code><code class="n">d</code><code class="p">)</code><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">f_tr</code><code class="p">)</code><code>
</code><code>             </code><code class="n">mse_tr</code><code> </code><code class="o">=</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO9-1" href="#callout_machine_learning_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">f_va</code><code class="p">)</code><code>
</code><code>             </code><code class="n">mse_va</code><code> </code><code class="o">=</code><code> </code><code class="n">MSE</code><code class="p">(</code><code class="n">l_va</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO9-2" href="#callout_machine_learning_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">mse</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">mse_tr</code><code class="p">,</code><code> </code><code class="n">mse_va</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">{d:2d} | MSE_tr={mse_tr:7.5f} | MSE_va={mse_va:7.5f}</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>          </code><code class="mi">1</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_tr</code><code class="o">=</code><code class="mf">0.00574</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_va</code><code class="o">=</code><code class="mf">0.00492</code><code>
</code><code>          </code><code class="mi">5</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_tr</code><code class="o">=</code><code class="mf">0.00375</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_va</code><code class="o">=</code><code class="mf">0.00273</code><code>
</code><code>          </code><code class="mi">9</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_tr</code><code class="o">=</code><code class="mf">0.00132</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_va</code><code class="o">=</code><code class="mf">0.00243</code><code>
</code><code>         </code><code class="mi">13</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_tr</code><code class="o">=</code><code class="mf">0.00094</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_va</code><code class="o">=</code><code class="mf">0.00183</code><code>
</code><code>         </code><code class="mi">17</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_tr</code><code class="o">=</code><code class="mf">0.00060</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_va</code><code class="o">=</code><code class="mf">0.00153</code><code>
</code><code>         </code><code class="mi">21</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_tr</code><code class="o">=</code><code class="mf">0.00046</code><code> </code><code class="o">|</code><code> </code><code class="n">MSE_va</code><code class="o">=</code><code class="mf">0.00837</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">44</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">8</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">sharex</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">training data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">l_va</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">go</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">validation data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">d</code><code> </code><code class="ow">in</code><code> </code><code class="n">reg</code><code class="p">:</code><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">f_tr</code><code class="p">)</code><code>
</code><code>             </code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="n">f</code><code class="s1">'</code><code class="s1">deg={d} (tr)</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="n">d</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">f_va</code><code class="p">)</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="n">f</code><code class="s1">'</code><code class="s1">deg={d} (va)</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO9-1" href="#co_machine_learning_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>MSE value for the training data set</p></dd>
<dt><a class="co" id="callout_machine_learning_CO9-2" href="#co_machine_learning_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>MSE value for the validation data set</p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_07" class="figure">
<img src="Images/aiif_0508.png" alt="aiif 0508" width="2451" height="1794"/>
<h6><span class="label">Figure 5-8. </span>Training and validation data including regression fits</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="market prediction" data-secondary="with neural networks" data-secondary-sortas="neural networks" id="ix_predict_neuralnet_ch5"/><a data-type="indexterm" data-primary="neural networks" data-secondary="market prediction with" id="ix_neuralnet_predict_ch5"/>With <code>Keras</code> and the neural network model, the validation data set performance can be monitored for every single learning step. One can also use callback functions to stop the model training early when no further improvements, say, in the performance on the training data set, are observed. The following Python code makes use of such a callback function. <a data-type="xref" href="#figure_ml_08">Figure 5-9</a> shows the predictions of the neural network for the training and validation data sets:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">45</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">keras.callbacks</code><code> </code><code class="kn">import</code><code> </code><code class="n">EarlyStopping</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">46</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">create_dnn_model</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">256</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">47</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">callbacks</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">EarlyStopping</code><code class="p">(</code><code class="n">monitor</code><code class="o">=</code><code class="s1">'</code><code class="s1">loss</code><code class="s1">'</code><code class="p">,</code><code>  </code><a class="co" id="co_machine_learning_CO10-1" href="#callout_machine_learning_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>                                    </code><code class="n">patience</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code>  </code><a class="co" id="co_machine_learning_CO10-2" href="#callout_machine_learning_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>                                   </code><code class="n">restore_best_weights</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO10-3" href="#callout_machine_learning_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="o">%</code><code class="n">time</code><code>
</code><code>         </code><code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">3000</code><code class="p">,</code><code> </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code><code>
</code><code>                   </code><code class="n">validation_data</code><code class="o">=</code><code class="p">(</code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">l_va</code><code class="p">)</code><code class="p">,</code><code>  </code><a class="co" id="co_machine_learning_CO10-4" href="#callout_machine_learning_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>                   </code><code class="n">callbacks</code><code class="o">=</code><code class="n">callbacks</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO10-5" href="#callout_machine_learning_CO10-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">8.07</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">1.33</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">9.4</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">4.81</code><code> </code><code class="n">s</code><code>
</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">&lt;</code><code class="n">keras</code><code class="o">.</code><code class="n">callbacks</code><code class="o">.</code><code class="n">callbacks</code><code class="o">.</code><code class="n">History</code><code> </code><code class="n">at</code><code> </code><code class="mh">0x7fc0438b47d0</code><code class="o">&gt;</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">fig</code><code class="p">,</code><code> </code><code class="n">ax</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">sharex</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code> </code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">8</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">training data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">f_tr</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="n">f</code><code class="s1">'</code><code class="s1">DNN (tr)</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">l_va</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">go</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">validation data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">f_va</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">p</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="n">f</code><code class="s1">'</code><code class="s1">DNN (va)</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">ax</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO10-1" href="#co_machine_learning_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Learning is stopped based on training data MSE value.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO10-2" href="#co_machine_learning_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>It is only stopped after a certain number of epochs that do not show an 
<span class="keep-together">improvement.</span></p></dd>
<dt><a class="co" id="callout_machine_learning_CO10-3" href="#co_machine_learning_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The best weights are restored when the learning is stopped.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO10-4" href="#co_machine_learning_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The validation data sub-sets are specified.</p></dd>
<dt><a class="co" id="callout_machine_learning_CO10-5" href="#co_machine_learning_CO10-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The callback function is passed to the <code>fit()</code> method.<a data-type="indexterm" data-primary="" data-startref="ix_data_training_alg" id="idm45625307032504"/><a data-type="indexterm" data-primary="" data-startref="ix_training_dataset" id="idm45625307031496"/><a data-type="indexterm" data-primary="" data-startref="ix_valid_dataset" id="idm45625307030552"/></p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_08" class="figure">
<img src="Images/aiif_0509.png" alt="aiif 0509" width="2477" height="1795"/>
<h6><span class="label">Figure 5-9. </span>Training and validation data including DNN predictions</h6>
</div></figure>

<p><code>Keras</code> allows analysis of the change in the MSE values on both data sets for every single epoch the model has been trained in. <a data-type="xref" href="#figure_ml_09">Figure 5-10</a> shows that the MSE values decrease with the increasing number of training epochs, although only on average and not monotonically:<a data-type="indexterm" data-primary="" data-startref="ix_MSE_ch5" id="idm45625307074232"/><a data-type="indexterm" data-primary="" data-startref="ix_predict_neuralnet_ch5" id="idm45625307073288"/><a data-type="indexterm" data-primary="" data-startref="ix_neuralnet_predict_ch5" id="idm45625307072376"/></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">50</code><code class="p">]:</code> <code class="n">res</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">model</code><code class="o">.</code><code class="n">history</code><code class="o">.</code><code class="n">history</code><code class="p">)</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">51</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">tail</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">51</code><code class="p">]:</code>       <code class="n">val_loss</code>      <code class="n">loss</code>
         <code class="mi">1375</code>  <code class="mf">0.000854</code>  <code class="mf">0.000544</code>
         <code class="mi">1376</code>  <code class="mf">0.000685</code>  <code class="mf">0.000473</code>
         <code class="mi">1377</code>  <code class="mf">0.001326</code>  <code class="mf">0.000942</code>
         <code class="mi">1378</code>  <code class="mf">0.001026</code>  <code class="mf">0.000867</code>
         <code class="mi">1379</code>  <code class="mf">0.000710</code>  <code class="mf">0.000500</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">52</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">35</code><code class="p">::</code><code class="mi">25</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'MSE'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'epochs'</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ml_09" class="figure">
<img src="Images/aiif_0510.png" alt="aiif 0510" width="2542" height="1491"/>
<h6><span class="label">Figure 5-10. </span>MSE values for DNN model on the training and validation data sets</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="market prediction" data-secondary="with OLS regression" data-secondary-sortas="OLS regression" id="idm45625306482584"/><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="market prediction with" id="idm45625306481112"/>In the case of OLS regression, one would probably choose a high—but not too high—value for the degree parameter, such as <code>deg=9</code>. The parameterization of the neural network model automatically gives the best model configuration at the end of the training. <a data-type="xref" href="#figure_ml_09">Figure 5-10</a> compares the predictions of both models to each other and to the test data set. <a data-type="indexterm" data-primary="test data set, training algorithm" id="idm45625306478568"/>Given the nature of the sample data, the somewhat better test data set performance of the neural network should not come as a surprise:<a data-type="indexterm" data-primary="" data-startref="ix_estim_task_ML_eval" id="idm45625306477656"/><a data-type="indexterm" data-primary="" data-startref="ix_ML_estim_task_eval" id="idm45625306476712"/></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">53</code><code class="p">]:</code> <code class="n">p_ols</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">[</code><code class="mi">5</code><code class="p">],</code> <code class="n">f_te</code><code class="p">)</code>
         <code class="n">p_dnn</code> <code class="o">=</code> <code class="n">model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">f_te</code><code class="p">)</code><code class="o">.</code><code class="n">flatten</code><code class="p">()</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="n">MSE</code><code class="p">(</code><code class="n">l_te</code><code class="p">,</code> <code class="n">p_ols</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="mf">0.0038960346771028356</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">55</code><code class="p">]:</code> <code class="n">MSE</code><code class="p">(</code><code class="n">l_te</code><code class="p">,</code> <code class="n">p_dnn</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">55</code><code class="p">]:</code> <code class="mf">0.000705705678438721</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">56</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_te</code><code class="p">,</code> <code class="n">l_te</code><code class="p">,</code> <code class="s1">'ro'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'test data'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_te</code><code class="p">,</code> <code class="n">p_ols</code><code class="p">,</code> <code class="s1">'--'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'OLS prediction'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_te</code><code class="p">,</code> <code class="n">p_dnn</code><code class="p">,</code> <code class="s1">'-.'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'DNN prediction'</code><code class="p">);</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">();</code></pre>

<figure class="thumb"><div id="figure_ml_10" class="figure">
<img src="Images/aiif_0511.png" alt="aiif 0511" width="2504" height="1421"/>
<h6><span class="label">Figure 5-11. </span>Test data and predictions from OLS regression and the DNN model</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Bias and Variance"><div class="sect1" id="ml_bias_var">
<h1>Bias and Variance</h1>

<p><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="bias and variance" id="ix_ML_bias_var"/><a data-type="indexterm" data-primary="overfitting of data, avoiding" id="ix_overfit_avoid"/><a data-type="indexterm" data-primary="bias and variance, in ML" id="ix_bias_var_ML"/>A major problem in ML in general and when applying ML algorithms to financial data in particular is the problem of <em>overfitting</em>. A model is overfitting its training data when the performance is worse on the validation and test data than on the training data. An example using OLS regression can illustrate the problem both visually and numerically.</p>

<p><a data-type="indexterm" data-primary="training data set, training algorithm" id="ix_training_dataset_2"/><a data-type="indexterm" data-primary="validation data set, training algorithm" id="ix_valid_dataset_2"/><a data-type="indexterm" data-primary="data" data-secondary="training algorithms" id="ix_data_training_alg_2"/>The following Python code uses smaller sub-sets for both training and validation and implements a linear regression, as well as one of higher order. The linear regression fit, as shown in <a data-type="xref" href="#figure_ml_11">Figure 5-12</a>, has a <em>high bias</em> on the training data set; absolute differences between predictions and labels data are relatively high. The higher-order fit shows a <em>high variance</em>. It hits all training data points exactly, but the fit itself varies significantly to achieve the perfect fit:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">57</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">f_tr</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="p">[</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO11-1" href="#callout_machine_learning_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">l_tr</code><code> </code><code class="o">=</code><code> </code><code class="n">l</code><code class="p">[</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO11-2" href="#callout_machine_learning_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">58</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">f_va</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO11-3" href="#callout_machine_learning_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">l_va</code><code> </code><code class="o">=</code><code> </code><code class="n">l</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mi">2</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO11-4" href="#callout_machine_learning_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">59</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">reg_b</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="n">deg</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO11-5" href="#callout_machine_learning_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">60</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">reg_v</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="n">deg</code><code class="o">=</code><code class="mi">9</code><code class="p">,</code><code> </code><code class="n">full</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>  </code><a class="co" id="co_machine_learning_CO11-6" href="#callout_machine_learning_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">61</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">f_</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="n">f_tr</code><code class="o">.</code><code class="n">min</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">f_va</code><code class="o">.</code><code class="n">max</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">75</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO11-7" href="#callout_machine_learning_CO11-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">62</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">ro</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">training data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">l_va</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">go</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">validation data</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg_b</code><code class="p">,</code><code> </code><code class="n">f_</code><code class="p">)</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">high bias</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">f_</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg_v</code><code class="p">,</code><code> </code><code class="n">f_</code><code class="p">)</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">--</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">high variance</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">ylim</code><code class="p">(</code><code class="o">-</code><code class="mf">0.2</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="mi">2</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO11-1" href="#co_machine_learning_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Smaller features data sub-set</p></dd>
<dt><a class="co" id="callout_machine_learning_CO11-2" href="#co_machine_learning_CO11-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Smaller labels data sub-set</p></dd>
<dt><a class="co" id="callout_machine_learning_CO11-3" href="#co_machine_learning_CO11-5"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>High bias OLS regression (linear)</p></dd>
<dt><a class="co" id="callout_machine_learning_CO11-4" href="#co_machine_learning_CO11-6"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>High variance OLS regression (higher order)</p></dd>
<dt><a class="co" id="callout_machine_learning_CO11-5" href="#co_machine_learning_CO11-7"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Enlarged features data set for plotting</p></dd>
</dl>

<figure class="thumb"><div id="figure_ml_11" class="figure">
<img src="Images/aiif_0512.png" alt="aiif 0512" width="2451" height="1428"/>
<h6><span class="label">Figure 5-12. </span>High bias and high variance OLS regression fits</h6>
</div></figure>

<p><a data-type="xref" href="#figure_ml_11">Figure 5-12</a> shows that a high bias fit performs worse in the example than a high variance fit on the training data. <a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="bias and variance in regression fit" id="idm45625305307704"/>But the high variance fit, which is overfitting here to a large extent, performs much worse on the validation data. This can be illustrated by comparing performance measures for all cases. The following Python code calculates not only the MSE values, but also the <math alttext="upper R squared">
  <msup><mi>R</mi> <mn>2</mn> </msup>
</math> values:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">63</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.metrics</code><code> </code><code class="kn">import</code><code> </code><code class="n">r2_score</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">64</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">evaluate</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">)</code><code>
</code><code>             </code><code class="n">bias</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">abs</code><code class="p">(</code><code class="n">l</code><code> </code><code class="o">-</code><code> </code><code class="n">p</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO12-1" href="#callout_machine_learning_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">var</code><code> </code><code class="o">=</code><code> </code><code class="n">p</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO12-2" href="#callout_machine_learning_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">msg</code><code> </code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">MSE={MSE(l, p):.4f} | R2={r2_score(l, p):9.4f} | </code><code class="s1">'</code><code>
</code><code>             </code><code class="n">msg</code><code> </code><code class="o">+</code><code class="o">=</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">bias={bias:.4f} | var={var:.4f}</code><code class="s1">'</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">msg</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">65</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">evaluate</code><code class="p">(</code><code class="n">reg_b</code><code class="p">,</code><code> </code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO12-3" href="#callout_machine_learning_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0026</code><code> </code><code class="o">|</code><code> </code><code class="n">R2</code><code class="o">=</code><code>   </code><code class="mf">0.3484</code><code> </code><code class="o">|</code><code> </code><code class="n">bias</code><code class="o">=</code><code class="mf">0.0423</code><code> </code><code class="o">|</code><code> </code><code class="n">var</code><code class="o">=</code><code class="mf">0.0014</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">66</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">evaluate</code><code class="p">(</code><code class="n">reg_b</code><code class="p">,</code><code> </code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">l_va</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO12-4" href="#callout_machine_learning_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0032</code><code> </code><code class="o">|</code><code> </code><code class="n">R2</code><code class="o">=</code><code>   </code><code class="mf">0.4498</code><code> </code><code class="o">|</code><code> </code><code class="n">bias</code><code class="o">=</code><code class="mf">0.0460</code><code> </code><code class="o">|</code><code> </code><code class="n">var</code><code class="o">=</code><code class="mf">0.0014</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">67</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">evaluate</code><code class="p">(</code><code class="n">reg_v</code><code class="p">,</code><code> </code><code class="n">f_tr</code><code class="p">,</code><code> </code><code class="n">l_tr</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO12-5" href="#callout_machine_learning_CO12-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.0000</code><code> </code><code class="o">|</code><code> </code><code class="n">R2</code><code class="o">=</code><code>   </code><code class="mf">1.0000</code><code> </code><code class="o">|</code><code> </code><code class="n">bias</code><code class="o">=</code><code class="mf">0.0000</code><code> </code><code class="o">|</code><code> </code><code class="n">var</code><code class="o">=</code><code class="mf">0.0040</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">68</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">evaluate</code><code class="p">(</code><code class="n">reg_v</code><code class="p">,</code><code> </code><code class="n">f_va</code><code class="p">,</code><code> </code><code class="n">l_va</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO12-6" href="#callout_machine_learning_CO12-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">MSE</code><code class="o">=</code><code class="mf">0.8752</code><code> </code><code class="o">|</code><code> </code><code class="n">R2</code><code class="o">=</code><code class="o">-</code><code class="mf">149.2658</code><code> </code><code class="o">|</code><code> </code><code class="n">bias</code><code class="o">=</code><code class="mf">0.3565</code><code> </code><code class="o">|</code><code> </code><code class="n">var</code><code class="o">=</code><code class="mf">0.7539</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO12-1" href="#co_machine_learning_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Model bias as mean absolute differences</p></dd>
<dt><a class="co" id="callout_machine_learning_CO12-2" href="#co_machine_learning_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Model variance as variance of model predictions</p></dd>
<dt><a class="co" id="callout_machine_learning_CO12-3" href="#co_machine_learning_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Performance of <em>high bias</em> model on <em>training data</em></p></dd>
<dt><a class="co" id="callout_machine_learning_CO12-4" href="#co_machine_learning_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Performance of <em>high bias</em> model on <em>validation data</em></p></dd>
<dt><a class="co" id="callout_machine_learning_CO12-5" href="#co_machine_learning_CO12-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Performance of <em>high variance</em> model on <em>training data</em></p></dd>
<dt><a class="co" id="callout_machine_learning_CO12-6" href="#co_machine_learning_CO12-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Performance of <em>high variance</em> model on <em>validation data</em></p></dd>
</dl>

<p>The results show that performance of the high bias model is roughly comparable on both the training and validation data sets. By contrast, the performance of the high variance model is perfect on the training data and pretty bad on the validation data.<a data-type="indexterm" data-primary="" data-startref="ix_bias_var_ML" id="idm45625304930936"/><a data-type="indexterm" data-primary="" data-startref="ix_ML_bias_var" id="idm45625304930088"/><a data-type="indexterm" data-primary="" data-startref="ix_overfit_avoid" id="idm45625304929240"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Cross-Validation"><div class="sect1" id="ml_cross_val">
<h1>Cross-Validation</h1>

<p><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="cross-validation" id="ix_ML_cross-val"/><a data-type="indexterm" data-primary="cross-validation to avoid overfitting, in ML" id="ix_cross-val_ML"/>A standard approach to avoid overfitting is <em>cross-validation</em>, during which multiple training and validation data populations are tested. The <code>scikit-learn</code> package provides functionality to implement cross-validation in a standardized way. The function <code>cross_val_score</code> can be applied to any <code>scikit-learn</code> model object.</p>

<p><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="cross-validation" id="idm45625304922680"/>The following code implements the OLS regression approach on the complete sample data set, using a polynomial OLS regression model from <code>scikit-learn</code>. The five-fold cross-validation is implemented for different degrees for the highest polynomial. The cross-validation scores become, on average, worse the higher the highest degree is in the regression. Particularly bad results are observed when the first 20% of the data is used for validation (data on the left-hand side in <a data-type="xref" href="#figure_ml_02">Figure 5-3</a>) or the final 20% of the data is used (data on the right-hand side in <a data-type="xref" href="#figure_ml_02">Figure 5-3</a>). Similarly, the best validation scores are observed for the middle 20% of the sample data set:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">69</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.model_selection</code><code> </code><code class="kn">import</code><code> </code><code class="n">cross_val_score</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">sklearn.preprocessing</code><code> </code><code class="kn">import</code><code> </code><code class="n">PolynomialFeatures</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">sklearn.linear_model</code><code> </code><code class="kn">import</code><code> </code><code class="n">LinearRegression</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">sklearn.pipeline</code><code> </code><code class="kn">import</code><code> </code><code class="n">make_pipeline</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">70</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">PolynomialRegression</code><code class="p">(</code><code class="n">degree</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code><code> </code><code class="o">*</code><code class="o">*</code><code class="n">kwargs</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">make_pipeline</code><code class="p">(</code><code class="n">PolynomialFeatures</code><code class="p">(</code><code class="n">degree</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                                 </code><code class="n">LinearRegression</code><code class="p">(</code><code class="o">*</code><code class="o">*</code><code class="n">kwargs</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO13-1" href="#callout_machine_learning_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">71</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">set_printoptions</code><code class="p">(</code><code class="n">suppress</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>
</code><code>                 </code><code class="n">formatter</code><code class="o">=</code><code class="p">{</code><code class="s1">'</code><code class="s1">float</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="k">lambda</code><code> </code><code class="n">x</code><code class="p">:</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{x:12.2f}</code><code class="s1">'</code><code class="p">}</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO13-2" href="#callout_machine_learning_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">72</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">Cross-validation scores</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="mi">74</code><code> </code><code class="o">*</code><code> </code><code class="s1">'</code><code class="s1">=</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">deg</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">PolynomialRegression</code><code class="p">(</code><code class="n">deg</code><code class="p">)</code><code>
</code><code>             </code><code class="n">cvs</code><code> </code><code class="o">=</code><code> </code><code class="n">cross_val_score</code><code class="p">(</code><code class="n">model</code><code class="p">,</code><code> </code><code class="n">f</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">cv</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO13-3" href="#callout_machine_learning_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'</code><code class="s1">deg={deg} | </code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code class="nb">str</code><code class="p">(</code><code class="n">cvs</code><code class="o">.</code><code class="n">round</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code>         </code><code class="n">Cross</code><code class="o">-</code><code class="n">validation</code><code> </code><code class="n">scores</code><code>
</code><code>         </code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code class="o">==</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">0</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>       </code><code class="o">-</code><code class="mf">6.07</code><code>        </code><code class="o">-</code><code class="mf">7.34</code><code>        </code><code class="o">-</code><code class="mf">0.09</code><code>        </code><code class="o">-</code><code class="mf">6.32</code><code>        </code><code class="o">-</code><code class="mf">8.69</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">1</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>       </code><code class="o">-</code><code class="mf">0.28</code><code>        </code><code class="o">-</code><code class="mf">1.40</code><code>         </code><code class="mf">0.16</code><code>        </code><code class="o">-</code><code class="mf">1.66</code><code>        </code><code class="o">-</code><code class="mf">4.62</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">2</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>       </code><code class="o">-</code><code class="mf">3.48</code><code>        </code><code class="o">-</code><code class="mf">2.45</code><code>         </code><code class="mf">0.19</code><code>        </code><code class="o">-</code><code class="mf">1.57</code><code>       </code><code class="o">-</code><code class="mf">12.94</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">3</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>       </code><code class="o">-</code><code class="mf">0.00</code><code>        </code><code class="o">-</code><code class="mf">1.24</code><code>         </code><code class="mf">0.32</code><code>        </code><code class="o">-</code><code class="mf">0.48</code><code>       </code><code class="o">-</code><code class="mf">43.62</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">4</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>     </code><code class="o">-</code><code class="mf">222.81</code><code>        </code><code class="o">-</code><code class="mf">2.88</code><code>         </code><code class="mf">0.37</code><code>        </code><code class="o">-</code><code class="mf">0.32</code><code>      </code><code class="o">-</code><code class="mf">496.61</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">5</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>     </code><code class="o">-</code><code class="mf">143.67</code><code>        </code><code class="o">-</code><code class="mf">5.85</code><code>         </code><code class="mf">0.49</code><code>         </code><code class="mf">0.12</code><code>     </code><code class="o">-</code><code class="mf">1241.04</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">6</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>    </code><code class="o">-</code><code class="mf">4038.96</code><code>       </code><code class="o">-</code><code class="mf">14.71</code><code>         </code><code class="mf">0.49</code><code>        </code><code class="o">-</code><code class="mf">0.33</code><code>      </code><code class="o">-</code><code class="mf">317.32</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">7</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>    </code><code class="o">-</code><code class="mf">9937.83</code><code>       </code><code class="o">-</code><code class="mf">13.98</code><code>         </code><code class="mf">0.64</code><code>         </code><code class="mf">0.22</code><code>    </code><code class="o">-</code><code class="mf">18725.61</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">8</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>    </code><code class="o">-</code><code class="mf">3514.36</code><code>       </code><code class="o">-</code><code class="mf">11.22</code><code>        </code><code class="o">-</code><code class="mf">0.15</code><code>        </code><code class="o">-</code><code class="mf">6.29</code><code>   </code><code class="o">-</code><code class="mf">298744.18</code><code class="p">]</code><code>
</code><code>         </code><code class="n">deg</code><code class="o">=</code><code class="mi">9</code><code> </code><code class="o">|</code><code> </code><code class="p">[</code><code>    </code><code class="o">-</code><code class="mf">7454.15</code><code>        </code><code class="o">-</code><code class="mf">0.91</code><code>         </code><code class="mf">0.15</code><code>        </code><code class="o">-</code><code class="mf">0.41</code><code>    </code><code class="o">-</code><code class="mf">13580.75</code><code class="p">]</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO13-1" href="#co_machine_learning_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Creates a polynomial regression model class</p></dd>
<dt><a class="co" id="callout_machine_learning_CO13-2" href="#co_machine_learning_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Adjusts the default printing settings for <code>numpy</code></p></dd>
<dt><a class="co" id="callout_machine_learning_CO13-3" href="#co_machine_learning_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Implements the five-fold cross-validation</p></dd>
</dl>

<p><code>Keras</code> provides wrapper classes to use <code>Keras</code> model objects with <code>scikit-learn</code> functionality, such as the <code>cross_val_score</code> function. <a data-type="indexterm" data-primary="neural networks" data-secondary="cross-validation" id="idm45625304731416"/>The following example uses the 
<span class="keep-together"><code>KerasRegressor</code></span> class to wrap the neural network models and to apply the cross-validation to them. The cross-validation scores are better throughout for the two networks tested when compared to the OLS regression cross-validation scores. The neural network capacity does not play too large a role in this example:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">73</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>         </code><code class="n">tf</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">set_seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">keras.wrappers.scikit_learn</code><code> </code><code class="kn">import</code><code> </code><code class="n">KerasRegressor</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">74</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">KerasRegressor</code><code class="p">(</code><code class="n">build_fn</code><code class="o">=</code><code class="n">create_dnn_model</code><code class="p">,</code><code>
</code><code>                               </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code>
</code><code>                               </code><code class="n">hl</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">hu</code><code class="o">=</code><code class="mi">36</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO14-1" href="#callout_machine_learning_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">75</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="n">time</code><code> </code><code class="n">cross_val_score</code><code class="p">(</code><code class="n">model</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">cv</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO14-2" href="#callout_machine_learning_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mf">18.6</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">2.17</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mf">20.8</code><code> </code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">14.6</code><code> </code><code class="n">s</code><code>
</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">75</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code>       </code><code class="o">-</code><code class="mf">0.02</code><code class="p">,</code><code>        </code><code class="o">-</code><code class="mf">0.01</code><code class="p">,</code><code>        </code><code class="o">-</code><code class="mf">0.00</code><code class="p">,</code><code>        </code><code class="o">-</code><code class="mf">0.00</code><code class="p">,</code><code>
</code><code>                       </code><code class="o">-</code><code class="mf">0.01</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">76</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">model</code><code> </code><code class="o">=</code><code> </code><code class="n">KerasRegressor</code><code class="p">(</code><code class="n">build_fn</code><code class="o">=</code><code class="n">create_dnn_model</code><code class="p">,</code><code>
</code><code>                               </code><code class="n">verbose</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code><code> </code><code class="n">epochs</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code>
</code><code>                               </code><code class="n">hl</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code><code> </code><code class="n">hu</code><code class="o">=</code><code class="mi">256</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO14-3" href="#callout_machine_learning_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">77</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">%</code><code class="n">time</code><code> </code><code class="n">cross_val_score</code><code class="p">(</code><code class="n">model</code><code class="p">,</code><code> </code><code class="n">f</code><code class="p">,</code><code> </code><code class="n">l</code><code class="p">,</code><code> </code><code class="n">cv</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_machine_learning_CO14-4" href="#callout_machine_learning_CO14-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">CPU</code><code> </code><code class="n">times</code><code class="p">:</code><code> </code><code class="n">user</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">5</code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">sys</code><code class="p">:</code><code> </code><code class="mf">11.6</code><code> </code><code class="n">s</code><code class="p">,</code><code> </code><code class="n">total</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="nb">min</code><code> </code><code class="mi">16</code><code class="n">s</code><code>
</code><code>         </code><code class="n">Wall</code><code> </code><code class="n">time</code><code class="p">:</code><code> </code><code class="mf">30.1</code><code> </code><code class="n">s</code><code>
</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">77</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code>       </code><code class="o">-</code><code class="mf">0.08</code><code class="p">,</code><code>        </code><code class="o">-</code><code class="mf">0.00</code><code class="p">,</code><code>        </code><code class="o">-</code><code class="mf">0.00</code><code class="p">,</code><code>        </code><code class="o">-</code><code class="mf">0.00</code><code class="p">,</code><code>
</code><code>                       </code><code class="o">-</code><code class="mf">0.05</code><code class="p">]</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_machine_learning_CO14-1" href="#co_machine_learning_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Wrapper class for neural network with <em>low</em> capacity</p></dd>
<dt><a class="co" id="callout_machine_learning_CO14-2" href="#co_machine_learning_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Cross-validation for neural network with <em>low</em> capacity</p></dd>
<dt><a class="co" id="callout_machine_learning_CO14-3" href="#co_machine_learning_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Wrapper class for neural network with <em>high</em> capacity</p></dd>
<dt><a class="co" id="callout_machine_learning_CO14-4" href="#co_machine_learning_CO14-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Cross-validation for neural network with <em>high</em> capacity</p></dd>
</dl>
<div data-type="important"><h1>Avoiding Overfitting</h1>
<p>Overfitting—when a model performs much better on a training data set than on the validation and test data sets—is to be avoided in ML in general and in finance in particular. <a data-type="indexterm" data-primary="capacity of model or algorithm, in ML" id="idm45625304658120"/><a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="capacity of model or algorithm" id="idm45625304565912"/>Proper evaluation procedures and analyses, such as cross-validation, help in preventing overfitting and in finding, for example, an adequate model capacity.<a data-type="indexterm" data-primary="" data-startref="ix_ML_gen_ch5" id="idm45625304564696"/><a data-type="indexterm" data-primary="" data-startref="ix_data_training_alg_2" id="idm45625304563752"/><a data-type="indexterm" data-primary="" data-startref="ix_training_dataset_2" id="idm45625304562808"/><a data-type="indexterm" data-primary="" data-startref="ix_valid_dataset_2" id="idm45625304551944"/><a data-type="indexterm" data-primary="" data-startref="ix_cross-val_ML" id="idm45625304551000"/><a data-type="indexterm" data-primary="" data-startref="ix_ML_cross-val" id="idm45625304550056"/></p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusions"><div class="sect1" id="idm45625304928024">
<h1>Conclusions</h1>

<p>This chapter presents a blueprint for a machine learning process. The main elements presented are as follows:</p>
<dl>
<dt>Learning</dt>
<dd>
<p>What exactly is meant by machine <em>learning</em>?</p>
</dd>
<dt>Data</dt>
<dd>
<p>What raw data and what (preprocessed) features and labels data is to be used?</p>
</dd>
<dt>Success</dt>
<dd>
<p>Given the problem as defined indirectly by the data (estimation, classification, etc.), what is the appropriate measure of success?</p>
</dd>
<dt>Capacity</dt>
<dd>
<p>Which role does the model capacity play, and what might be an adequate capacity given the problem at hand?</p>
</dd>
<dt>Evaluation</dt>
<dd>
<p>How shall the model performance be evaluated given the purpose of the trained model?</p>
</dd>
<dt>Bias and variance</dt>
<dd>
<p>Which models are better suited for the problem at hand: those with rather high bias or rather high variance?</p>
</dd>
<dt>Cross-validation</dt>
<dd>
<p>For non-sequence-like data sets, how does the model perform when cross-validated on different configurations for the training and validation data sub-sets used?</p>
</dd>
</dl>

<p>This blueprint is applied loosely in subsequent chapters to a number of real-world financial use cases. For more background information and details about machine learning as a process, refer to the references listed at the end of this chapter.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="References"><div class="sect1" id="ml_further_resources">
<h1>References</h1>

<p>Books and papers cited in this chapter:</p>

<ul class="author-date-bib">
<li>
<p>Chollet, François. 2017. <em>Deep Learning with Python</em>. Shelter Island: Manning.</p>
</li>
<li>
<p>Domingos, Pedro. 2015. <em>The Master Algorithm: How the Quest for the Ultimate Learning Machine Will Remake Our World.</em> New York: Basic Books.</p>
</li>
<li>
<p>Goodfellow, Ian, Yoshua Bengio, and Aaron Courville. 2016. <em>Deep Learning</em>. Cambridge: MIT Press. <a href="http://deeplearningbook.org"><em class="hyperlink">http://deeplearningbook.org</em></a>.</p>
</li>
<li>
<p>Harari, Yuval Noah. 2015. <em>Homo Deus: A Brief History of Tomorrow.</em> London: Harvill Secker.</p>
</li>
<li>
<p>Mitchell, Tom M. 1997. <em>Machine Learning</em>. New York: McGraw-Hill.</p>
</li>
<li>
<p>VanderPlas, Jake. 2017. <em>Python Data Science Handbook</em>. Sebastopol: O’Reilly.</p>
</li>
</ul>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45625305881528"><sup><a href="ch05.xhtml#idm45625305881528-marker">1</a></sup> Often, the rule of thumb mentioned in this context is “60%, 20%, 20%” for the split of a given data set into training, validation, and testing data sub-sets.</p></div></div></section></div>



  </body></html>