<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Data-Driven Finance"><div class="chapter" id="data_driven_finance">
<h1><span class="label">Chapter 4. </span>Data-Driven Finance</h1>

<blockquote>
<p class="align_me_right">If artificial intelligence is the new electricity, big data is the oil that powers the 
<span class="keep-together">generators.</span></p>
<p data-type="attribution">Kai-Fu Lee (2018)</p>
</blockquote>
<blockquote>
<p class="align_me_right">Nowadays, analysts sift through non-traditional information such as satellite imagery and credit card data, or use artificial intelligence techniques such as machine learning and natural language processing to glean fresh insights from traditional sources such as economic data and earnings-call transcripts.</p>
<p data-type="attribution">Robin Wigglesworth (2019)</p>
</blockquote>

<p><a data-type="indexterm" data-primary="data-driven finance" id="ix_data-driven_fin_ch4"/>This chapter discusses central aspects of data-driven finance. For the purposes of this book, <em>data-driven finance</em> is understood to be a financial context (theory, model, application, and so on) that is primarily driven by and based on insights gained from data.</p>

<p><a data-type="xref" href="#scientific_method">“Scientific Method”</a> discusses the scientific method, which is about generally accepted principles that should guide scientific effort. <a data-type="xref" href="#financial_econometrics">“Financial Econometrics and Regression”</a> is about financial econometrics and related topics. 
<span class="keep-together"><a data-type="xref" href="#data_availability">“Data Availability”</a></span> sheds light on which types of (financial) data are available today and in what quality and quantity via programmatic APIs. <a data-type="xref" href="#norm_theories_revisited">“Normative Theories Revisited”</a> revisits the normative theories of <a data-type="xref" href="ch03.xhtml#normative_finance">Chapter 3</a> and analyzes them based on real financial time series data. Also based on real financial data, <a data-type="xref" href="#debunking_assumptions">“Debunking Central Assumptions”</a> debunks two of the most commonly found assumptions in financial models and theories: <em>normality of returns</em> and <em>linear</em> 
<span class="keep-together"><em>relationships</em>.</span></p>






<section data-type="sect1" data-pdf-bookmark="Scientific Method"><div class="sect1" id="scientific_method">
<h1>Scientific Method</h1>

<p><a data-type="indexterm" data-primary="scientific method" id="idm45625325305576"/><a data-type="indexterm" data-primary="data-driven finance" data-secondary="scientific method" id="idm45625325304872"/>The <em>scientific method</em> refers to a set of generally accepted principles that should guide any scientific project. <a href="https://oreil.ly/AX8jv">Wikipedia</a> defines the scientific method as follows:</p>
<blockquote>
<p>The scientific method is an empirical method of acquiring knowledge that has characterized the development of science since at least the 17th century. It involves careful observation, applying rigorous skepticism about what is observed, given that cognitive assumptions can distort how one interprets the observation. It involves formulating hypotheses, via induction, based on such observations; experimental and measurement-based testing of deductions drawn from the hypotheses; and refinement (or elimination) of the hypotheses based on the experimental findings. These are 
<span class="keep-together">principles</span> of the scientific method, as distinguished from a definitive series of steps 
<span class="keep-together">applicable</span> to all scientific enterprises.</p></blockquote>

<p>Given this definition, normative finance, as discussed in <a data-type="xref" href="ch03.xhtml#normative_finance">Chapter 3</a>, is in stark 
<span class="keep-together">contrast</span> to the scientific method. <a data-type="indexterm" data-primary="normative financial theories and models" data-secondary="versus empirical approaches to finance" data-secondary-sortas="empirical approaches to finance" id="idm45625325297976"/>Normative financial theories mostly rely on assumptions and axioms in combination with <em>deduction</em> as the major analytical method to arrive at their central results.</p>

<ul>
<li>
<p><a data-type="indexterm" data-primary="EUT (expected utility theory)" data-secondary="basic assumption of" id="idm45625325295192"/>Expected utility theory (EUT) <em>assumes</em> that agents have the same utility function no matter what state of the world unfolds and that they maximize expected utility under conditions of uncertainty.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="portfolios" data-secondary="MVP theory" id="idm45625325292776"/><a data-type="indexterm" data-primary="normative financial theories and models" data-secondary="mean-variance portfolio theory" id="idm45625325291800"/><a data-type="indexterm" data-primary="MVP (mean-variance portfolio) theory" data-secondary="basic assumption of" id="idm45625325290776"/>Mean-variance portfolio (MVP) theory describes how investors <em>should</em> invest under conditions of uncertainty <em>assuming</em> that only the expected return and the expected volatility of a portfolio over one period count.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="CAPM (capital asset pricing model)" data-secondary="basic assumption of" id="idm45625325288040"/>The capital asset pricing model (CAPM) <em>assumes</em> that only the nondiversifiable market risk <em>explains</em> the expected return and the expected volatility of a stock over one period.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="normative financial theories and models" data-secondary="arbitrage pricing theory" id="idm45625325285384"/><a data-type="indexterm" data-primary="APT (arbitrage pricing theory)" data-secondary="basic assumption of" id="idm45625325284328"/>Arbitrage pricing theory (APT) <em>assumes</em> that a number of identifiable risk factors <em>explains</em> the expected return and the expected volatility of a stock over time; admittedly, compared to the other theories, the formulation of APT is rather broad and allows for wide-ranging interpretations.</p>
</li>
</ul>

<p>What characterizes the aforementioned normative financial theories is that they were originally derived under certain assumptions and axioms using “pen and paper” only, without any recourse to real-world data or observations. From a historical point of view, many of these theories were rigorously tested against real-world data only long after their publication dates. This can be explained primarily with better data availability and increased computational capabilities over time. After all, data and computation are the main ingredients for the application of statistical methods in practice. <a data-type="indexterm" data-primary="data-driven finance" data-secondary="financial econometrics and regression" id="ix_data-driven_fin_econ_ch4"/><a data-type="indexterm" data-primary="financial econometrics and regression" id="ix_fin_econometrics_ch4"/>The discipline at the intersection of mathematics, statistics, and finance that applies such methods to financial market data is typically called <em>financial econometrics</em>, the topic of the next section.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Financial Econometrics and Regression"><div class="sect1" id="financial_econometrics">
<h1>Financial Econometrics and Regression</h1>

<p>Adapting the definition provided by <a href="https://oreil.ly/QErpB">Investopedia</a> for <em>econometrics</em>, one can define <em>financial econometrics</em> as follows:</p>
<blockquote>
<p>[Financial] econometrics is the quantitative application of statistical and mathematical models using [financial] data to develop financial theories or test existing hypotheses in finance and to forecast future trends from historical data. It subjects real-world [financial] data to statistical trials and then compares and contrasts the results against the [financial] theory or theories being tested.</p></blockquote>

<p>Alexander (2008b) provides a thorough and broad introduction to the field of financial econometrics. <a data-type="indexterm" data-primary="econometrics" id="idm45625325272280"/>The second chapter of the book covers single- and multifactor models, such as the CAPM and APT. Alexander (2008b) is part of a series of four books called <em>Market Risk Analysis</em>. The first in the series, Alexander (2008a), covers theoretical background concepts, topics, and methods, such as MVP theory and the CAPM themselves. The book by Campbell (2018) is another comprehensive resource for financial theory and related econometric research.</p>

<p><a data-type="indexterm" data-primary="OLS (ordinary least-squares) regression" data-secondary="as financial econometrics tool" data-secondary-sortas="financial econometrics tool" id="ix_OLS_fin_econ_tool"/>One of the major tools in financial econometrics is <em>regression</em>, in both its univariate and multivariate forms. <a data-type="indexterm" data-primary="statistical learning" id="ix_stat_learn_ch4"/>Regression is also a central tool in <em>statistical learning</em> in general. What is the difference between traditional mathematics and statistical learning? Although there is no general answer to this question (after all, statistics is a sub-field of mathematics), a simple example should emphasize a major difference relevant to the context of this book.</p>

<p>First is the standard mathematical way. Assume a mathematical function is given as follows:</p>
<div data-type="equation">
<math alttext="f colon double-struck upper R right-arrow double-struck upper R Subscript plus Baseline comma x right-arrow from bar 2 plus one-half x" display="block">
  <mrow>
    <mi>f</mi>
    <mo>:</mo>
    <mi>ℝ</mi>
    <mo>→</mo>
    <msub><mi>ℝ</mi> <mo>+</mo> </msub>
    <mo>,</mo>
    <mi>x</mi>
    <mo>↦</mo>
    <mn>2</mn>
    <mo>+</mo>
    <mfrac><mn>1</mn> <mn>2</mn></mfrac>
    <mi>x</mi>
  </mrow>
</math>
</div>

<p>Given multiple values of <math alttext="x Subscript i Baseline comma i equals 1 comma 2 comma ellipsis comma n">
  <mrow>
    <msub><mi>x</mi> <mi>i</mi> </msub>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>, one can derive function values for <math alttext="f">
  <mi>f</mi>
</math> by applying the above definition:</p>
<div data-type="equation">
<math alttext="y Subscript i Baseline equals f left-parenthesis x Subscript i Baseline right-parenthesis comma i equals 1 comma 2 comma ellipsis comma n" display="block">
  <mrow>
    <msub><mi>y</mi> <mi>i</mi> </msub>
    <mo>=</mo>
    <mi>f</mi>
    <mrow>
      <mo>(</mo>
      <msub><mi>x</mi> <mi>i</mi> </msub>
      <mo>)</mo>
    </mrow>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>
</div>

<p>The following Python code illustrates this based on a simple numerical example:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">numpy</code> <code class="kn">as</code> <code class="nn">np</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">f</code><code class="p">(</code><code class="n">x</code><code class="p">):</code>
            <code class="k">return</code> <code class="mi">2</code> <code class="o">+</code> <code class="mi">1</code> <code class="o">/</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">x</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">x</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="o">-</code><code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">)</code>
        <code class="n">x</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">array</code><code class="p">([</code><code class="o">-</code><code class="mi">4</code><code class="p">,</code> <code class="o">-</code><code class="mi">3</code><code class="p">,</code> <code class="o">-</code><code class="mi">2</code><code class="p">,</code> <code class="o">-</code><code class="mi">1</code><code class="p">,</code>  <code class="mi">0</code><code class="p">,</code>  <code class="mi">1</code><code class="p">,</code>  <code class="mi">2</code><code class="p">,</code>  <code class="mi">3</code><code class="p">,</code>  <code class="mi">4</code><code class="p">])</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">y</code> <code class="o">=</code> <code class="n">f</code><code class="p">(</code><code class="n">x</code><code class="p">)</code>
        <code class="n">y</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="n">array</code><code class="p">([</code><code class="mf">0.</code> <code class="p">,</code> <code class="mf">0.5</code><code class="p">,</code> <code class="mf">1.</code> <code class="p">,</code> <code class="mf">1.5</code><code class="p">,</code> <code class="mf">2.</code> <code class="p">,</code> <code class="mf">2.5</code><code class="p">,</code> <code class="mf">3.</code> <code class="p">,</code> <code class="mf">3.5</code><code class="p">,</code> <code class="mf">4.</code> <code class="p">])</code></pre>

<p>Second is the approach taken in statistical learning. Whereas in the preceding example, the function comes first and then the data is derived, this sequence is reversed in statistical learning. Here, the data is generally given and a functional relationship is to be found. In this context, <math alttext="x">
  <mi>x</mi>
</math> is often called the <em>independent</em> variable and <math alttext="y">
  <mi>y</mi>
</math> the <em>dependent</em> variable. Consequently, consider the following data:</p>
<div data-type="equation">
<math alttext="left-parenthesis x Subscript i Baseline comma y Subscript i Baseline right-parenthesis comma i equals 1 comma 2 comma ellipsis comma n" display="block">
  <mrow>
    <mo>(</mo>
    <msub><mi>x</mi> <mi>i</mi> </msub>
    <mo>,</mo>
    <msub><mi>y</mi> <mi>i</mi> </msub>
    <mo>)</mo>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>
</div>

<p>The problem is to find, for example, parameters <math alttext="alpha comma beta">
  <mrow>
    <mi>α</mi>
    <mo>,</mo>
    <mi>β</mi>
  </mrow>
</math> such that:</p>
<div data-type="equation">
<math alttext="ModifyingAbove f With caret left-parenthesis x Subscript i Baseline right-parenthesis identical-to alpha plus beta x Subscript i Baseline equals ModifyingAbove y With caret Subscript i Baseline almost-equals y Subscript i Baseline comma i equals 1 comma 2 comma ellipsis comma n" display="block">
  <mrow>
    <mover accent="true"><mi>f</mi> <mo>^</mo></mover>
    <mrow>
      <mo>(</mo>
      <msub><mi>x</mi> <mi>i</mi> </msub>
      <mo>)</mo>
    </mrow>
    <mo>≡</mo>
    <mi>α</mi>
    <mo>+</mo>
    <mi>β</mi>
    <msub><mi>x</mi> <mi>i</mi> </msub>
    <mo>=</mo>
    <msub><mover accent="true"><mi>y</mi> <mo>^</mo></mover> <mi>i</mi> </msub>
    <mo>≈</mo>
    <msub><mi>y</mi> <mi>i</mi> </msub>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>
</div>

<p>Another way of writing this is by including residual values <math alttext="epsilon Subscript i Baseline comma i equals 1 comma 2 comma ellipsis comma n">
  <mrow>
    <msub><mi>ϵ</mi> <mi>i</mi> </msub>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>:</p>
<div data-type="equation">
<math alttext="alpha plus beta x Subscript i Baseline plus epsilon Subscript i Baseline equals y Subscript i Baseline comma i equals 1 comma 2 comma ellipsis comma n" display="block">
  <mrow>
    <mi>α</mi>
    <mo>+</mo>
    <mi>β</mi>
    <msub><mi>x</mi> <mi>i</mi> </msub>
    <mo>+</mo>
    <msub><mi>ϵ</mi> <mi>i</mi> </msub>
    <mo>=</mo>
    <msub><mi>y</mi> <mi>i</mi> </msub>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>
</div>

<p>In the context of ordinary least-squares (OLS) regression, <math alttext="alpha comma beta">
  <mrow>
    <mi>α</mi>
    <mo>,</mo>
    <mi>β</mi>
  </mrow>
</math> are chosen to minimize the mean-squared error between the approximated values <math alttext="ModifyingAbove y With caret Subscript i">
  <msub><mover accent="true"><mi>y</mi> <mo>^</mo></mover> <mi>i</mi> </msub>
</math> and the real values <math alttext="y Subscript i">
  <msub><mi>y</mi> <mi>i</mi> </msub>
</math>. The minimization problem, then, is as follows:</p>
<div data-type="equation">
<math alttext="min Underscript alpha comma beta Endscripts StartFraction 1 Over n EndFraction sigma-summation Underscript i Overscript n Endscripts left-parenthesis ModifyingAbove y With caret Subscript i Baseline minus y Subscript i Baseline right-parenthesis squared" display="block">
  <mrow>
    <munder><mo movablelimits="true" form="prefix">min</mo> <mrow><mi>α</mi><mo>,</mo><mi>β</mi></mrow> </munder>
    <mfrac><mn>1</mn> <mi>n</mi></mfrac>
    <munderover><mo>∑</mo> <mi>i</mi> <mi>n</mi> </munderover>
    <msup><mrow><mo>(</mo><msub><mover accent="true"><mi>y</mi> <mo>^</mo></mover> <mi>i</mi> </msub><mo>-</mo><msub><mi>y</mi> <mi>i</mi> </msub><mo>)</mo></mrow> <mn>2</mn> </msup>
  </mrow>
</math>
</div>

<p>In the case of <em>simple OLS regression</em>, as described previously, the optimal solutions are known in closed form and are as follows:</p>
<div data-type="equation">
<math alttext="StartLayout Enlarged left-brace 1st Row  beta equals StartFraction Cov left-parenthesis x comma y right-parenthesis Over Var left-parenthesis x right-parenthesis EndFraction 2nd Row  alpha equals y overbar minus beta x overbar EndLayout" display="block">
  <mfenced separators="" open="{" close="">
    <mtable>
      <mtr>
        <mtd columnalign="left">
          <mrow>
            <mi>β</mi>
            <mo>=</mo>
            <mfrac><mrow><mtext>Cov</mtext><mo>(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>)</mo></mrow> <mtext>Var(x)</mtext></mfrac>
          </mrow>
        </mtd>
      </mtr>
      <mtr>
        <mtd columnalign="left">
          <mrow>
            <mi>α</mi>
            <mo>=</mo>
            <mover accent="true"><mi>y</mi> <mo>¯</mo></mover>
            <mo>-</mo>
            <mi>β</mi>
            <mover accent="true"><mi>x</mi> <mo>¯</mo></mover>
          </mrow>
        </mtd>
      </mtr>
    </mtable>
  </mfenced>
</math>
</div>

<p>Here, <math alttext="Cov left-parenthesis right-parenthesis">
  <mrow>
    <mtext>Cov</mtext>
    <mo>(</mo>
    <mo>)</mo>
  </mrow>
</math> stands for the <em>covariance</em>, <math alttext="Var left-parenthesis right-parenthesis">
  <mrow>
    <mtext>Var</mtext>
    <mo>(</mo>
    <mo>)</mo>
  </mrow>
</math> for the <em>variance</em>, and <math alttext="x overbar comma y overbar">
  <mrow>
    <mover accent="true"><mi>x</mi> <mo>¯</mo></mover>
    <mo>,</mo>
    <mover accent="true"><mi>y</mi> <mo>¯</mo></mover>
  </mrow>
</math> for the <em>mean values</em> of <math alttext="x comma y">
  <mrow>
    <mi>x</mi>
    <mo>,</mo>
    <mi>y</mi>
  </mrow>
</math>.</p>

<p>Returning to the preceding numerical example, these insights can be used to derive optimal parameters <math alttext="alpha comma beta">
  <mrow>
    <mi>α</mi>
    <mo>,</mo>
    <mi>β</mi>
  </mrow>
</math> and, in this particular case, to recover the original definition of <math alttext="f left-parenthesis x right-parenthesis">
  <mrow>
    <mi>f</mi>
    <mo>(</mo>
    <mi>x</mi>
    <mo>)</mo>
  </mrow>
</math>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">x</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="o">-</code><code class="mi">4</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">3</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code>  </code><code class="mi">0</code><code class="p">,</code><code>  </code><code class="mi">1</code><code class="p">,</code><code>  </code><code class="mi">2</code><code class="p">,</code><code>  </code><code class="mi">3</code><code class="p">,</code><code>  </code><code class="mi">4</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">y</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="mf">0.</code><code> </code><code class="p">,</code><code> </code><code class="mf">0.5</code><code class="p">,</code><code> </code><code class="mf">1.</code><code> </code><code class="p">,</code><code> </code><code class="mf">1.5</code><code class="p">,</code><code> </code><code class="mf">2.</code><code> </code><code class="p">,</code><code> </code><code class="mf">2.5</code><code class="p">,</code><code> </code><code class="mf">3.</code><code> </code><code class="p">,</code><code> </code><code class="mf">3.5</code><code class="p">,</code><code> </code><code class="mf">4.</code><code> </code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">beta</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">cov</code><code class="p">(</code><code class="n">x</code><code class="p">,</code><code> </code><code class="n">y</code><code class="p">,</code><code> </code><code class="n">ddof</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="n">x</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO1-1" href="#callout_data_driven_finance_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">beta</code><code>  </code><a class="co" id="co_data_driven_finance_CO1-2" href="#callout_data_driven_finance_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.49999999999999994</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">alpha</code><code> </code><code class="o">=</code><code> </code><code class="n">y</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="n">beta</code><code> </code><code class="o">*</code><code> </code><code class="n">x</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO1-3" href="#callout_data_driven_finance_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">alpha</code><code>  </code><a class="co" id="co_data_driven_finance_CO1-4" href="#callout_data_driven_finance_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">2.0</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">y_</code><code> </code><code class="o">=</code><code> </code><code class="n">alpha</code><code> </code><code class="o">+</code><code> </code><code class="n">beta</code><code> </code><code class="o">*</code><code> </code><code class="n">x</code><code>  </code><a class="co" id="co_data_driven_finance_CO1-5" href="#callout_data_driven_finance_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">allclose</code><code class="p">(</code><code class="n">y_</code><code class="p">,</code><code> </code><code class="n">y</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO1-6" href="#callout_data_driven_finance_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="bp">True</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO1-1" href="#co_data_driven_finance_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><math alttext="beta">
  <mi>β</mi>
</math> as derived from the covariance matrix and the variance</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO1-2" href="#co_data_driven_finance_CO1-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><math alttext="alpha">
  <mi>α</mi>
</math> as derived from <math alttext="beta">
  <mi>β</mi>
</math> and the mean values</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO1-3" href="#co_data_driven_finance_CO1-5"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Estimated values <math alttext="ModifyingAbove y With caret Subscript i Baseline comma i equals 1 comma 2 comma ellipsis comma n">
  <mrow>
    <msub><mover accent="true"><mi>y</mi> <mo>^</mo></mover> <mi>i</mi> </msub>
    <mo>,</mo>
    <mi>i</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mn>2</mn>
    <mo>,</mo>
    <mo>...</mo>
    <mo>,</mo>
    <mi>n</mi>
  </mrow>
</math>, given <math alttext="alpha comma beta">
  <mrow>
    <mi>α</mi>
    <mo>,</mo>
    <mi>β</mi>
  </mrow>
</math></p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO1-4" href="#co_data_driven_finance_CO1-6"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Checks whether <math alttext="ModifyingAbove y With caret Subscript i Baseline comma y Subscript i Baseline">
  <mrow>
    <msub><mover accent="true"><mi>y</mi> <mo>^</mo></mover> <mi>i</mi> </msub>
    <mo>,</mo>
    <msub><mi>y</mi> <mi>i</mi> </msub>
  </mrow>
</math> values are numerically equal<a data-type="indexterm" data-primary="" data-startref="ix_stat_learn_ch4" id="idm45625324924616"/></p></dd>
</dl>

<p>The preceding example and those in <a data-type="xref" href="ch01.xhtml#artificial_intelligence">Chapter 1</a> illustrate that the application of OLS regression to a given data set is in general straightforward. There are more reasons why OLS regression has become one of the central tools in econometrics and financial econometrics. Among them are the following:</p>
<dl>
<dt>Centuries old</dt>
<dd>
<p>The least-squares approach, particularly in combination with regression, has been used for more than 200 years.<sup><a data-type="noteref" id="idm45625324920136-marker" href="ch04.xhtml#idm45625324920136">1</a></sup></p>
</dd>
<dt>Simplicity</dt>
<dd>
<p>The mathematics behind OLS regression is easy to understand and easy to implement in programming.</p>
</dd>
<dt>Scalability</dt>
<dd>
<p>There is basically no limit regarding the data size to which OLS regression can be applied.</p>
</dd>
<dt>Flexibility</dt>
<dd>
<p>OLS regression can be applied to a wide range of problems and data sets.</p>
</dd>
<dt>Speed</dt>
<dd>
<p>OLS regression is fast to evaluate, even on larger data sets.</p>
</dd>
<dt>Availability</dt>
<dd>
<p>Efficient implementations in Python and many other programming languages are readily available.</p>
</dd>
</dl>

<p>However, as easy and straightforward as the application of OLS regression might be in general, the method rests on a number of assumptions—most of them related to the residuals—that are not always satisfied in practice.</p>
<dl>
<dt>Linearity</dt>
<dd>
<p>The model is linear in its parameters, with regard to both the coefficients and the residuals.</p>
</dd>
<dt>Independence</dt>
<dd>
<p>Independent variables are not perfectly (to a high degree) correlated with each other (no <em>multicollinearity</em>).</p>
</dd>
<dt>Zero mean</dt>
<dd>
<p>The mean value of the residuals is (close to) zero.</p>
</dd>
<dt>No correlation</dt>
<dd>
<p>Residuals are not (strongly) correlated with the independent variables.</p>
</dd>
<dt>Homoscedasticity</dt>
<dd>
<p>The standard deviation of the residuals is (almost) constant.</p>
</dd>
<dt>No autocorrelation</dt>
<dd>
<p>The residuals are not (strongly) correlated with each other.</p>
</dd>
</dl>

<p>In practice, it is in general quite simple to test for the validity of the assumptions given a specific data set.<a data-type="indexterm" data-primary="" data-startref="ix_fin_econometrics_ch4" id="idm45625324902456"/><a data-type="indexterm" data-primary="" data-startref="ix_data-driven_fin_econ_ch4" id="idm45625324901480"/><a data-type="indexterm" data-primary="" data-startref="ix_OLS_fin_econ_tool" id="idm45625324900568"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Data Availability"><div class="sect1" id="data_availability">
<h1>Data Availability</h1>

<p><a data-type="indexterm" data-primary="data-driven finance" data-secondary="data availability" id="ix_data-driven_fin_data_avail"/>Financial econometrics is driven by statistical methods, such as regression, and the availability of financial data. From the 1950s to the 1990s, and even into the early 2000s, theoretical and empirical financial research was mainly driven by 
<span class="keep-together">relatively</span> small data sets compared to today’s standards, and was mostly comprised of 
<span class="keep-together">end-of-day (EOD)</span> data. Data availability is something that has changed dramatically over the last decade or so, with more and more types of financial and other data available in ever increasing granularity, quantity, and velocity.</p>








<section data-type="sect2" data-pdf-bookmark="Programmatic APIs"><div class="sect2" id="idm45625324895160">
<h2>Programmatic APIs</h2>

<p>With regard to data-driven finance, what is important is not only what data is available but also how it can be accessed and processed. For quite a while now, finance professionals have relied on data terminals from companies such as Refinitiv (see <a href="https://oreil.ly/gcBey">Eikon Terminal</a>) or Bloomberg (see <a href="https://oreil.ly/Y1dEC">Bloomberg Terminal</a>), to mention just two of the leading providers. Newspapers, magazines, financial reports, and the like have long been replaced by such terminals as the primary source for financial information. However, the sheer volume and variety of data provided by such terminals cannot be consumed systematically by a single user or even large groups of finance professionals. Therefore, the major breakthrough in data-driven finance is to be seen in the <em>programmatic availability</em> of data via application programming interfaces (APIs) that allow the usage of computer code to select, retrieve, and process arbitrary data sets.</p>

<p>The remainder of this section is devoted to the illustration of such APIs by which even academics and retail investors can retrieve a wealth of different data sets. Before such examples are provided, <a data-type="xref" href="#ddf_data_types_table">Table 4-1</a> offers an overview of categories of data that are in general relevant in a financial context, as well as typical examples. In the table, <em>structured</em> data refers to numerical data types that often come in tabular structures, while <em>unstructured</em> data refers to data in the form of standard text that often has no structure beyond headers or paragraphs, for example. <em>Alternative</em> data refers to data types that are typically <em>not</em> considered financial data.</p>
<table id="ddf_data_types_table">
<caption><span class="label">Table 4-1. </span>Relevant types of financial data</caption>
<thead>
<tr>
<th>Time</th>
<th>Structured data</th>
<th>Unstructured data</th>
<th>Alternative data</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Historical</p></td>
<td><p>Prices, fundamentals</p></td>
<td><p>News, texts</p></td>
<td><p>Web, social media, satellites</p></td>
</tr>
<tr>
<td><p>Streaming</p></td>
<td><p>Prices, volumes</p></td>
<td><p>News, filings</p></td>
<td><p>Web, social media, satellites, Internet of Things</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Structured Historical Data"><div class="sect2" id="idm45625324877592">
<h2>Structured Historical Data</h2>

<p>First, structured historical data types will be retrieved programmatically. <a data-type="indexterm" data-primary="Eikon Data API" id="ix_eikon_data_api"/>To this end, the following Python code uses the <a href="https://oreil.ly/uDMSk">Eikon Data API</a>.<sup><a data-type="noteref" id="idm45625324874120-marker" href="ch04.xhtml#idm45625324874120">2</a></sup></p>

<p><a data-type="indexterm" data-primary="Refinitiv Workspace" id="idm45625324873272"/>To access data via the Eikon Data API, a local application, such as <a href="https://oreil.ly/NPEav">Refinitiv Workspace</a>, must be running and the API access must be configured on the Python level:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">11</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">eikon</code> <code class="kn">as</code> <code class="nn">ek</code>
         <code class="kn">import</code> <code class="nn">configparser</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">12</code><code class="p">]:</code> <code class="n">c</code> <code class="o">=</code> <code class="n">configparser</code><code class="o">.</code><code class="n">ConfigParser</code><code class="p">()</code>
         <code class="n">c</code><code class="o">.</code><code class="n">read</code><code class="p">(</code><code class="s1">'../aiif.cfg'</code><code class="p">)</code>
         <code class="n">ek</code><code class="o">.</code><code class="n">set_app_key</code><code class="p">(</code><code class="n">c</code><code class="p">[</code><code class="s1">'eikon'</code><code class="p">][</code><code class="s1">'app_id'</code><code class="p">])</code>
         <code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code> <code class="mi">10</code><code class="p">:</code><code class="mi">30</code><code class="p">:</code><code class="mi">18</code><code class="p">,</code><code class="mo">05</code><code class="mi">9</code> <code class="n">P</code><code class="p">[</code><code class="mi">14938</code><code class="p">]</code> <code class="p">[</code><code class="n">MainThread</code> <code class="mi">4521459136</code><code class="p">]</code> <code class="n">Error</code> <code class="n">on</code> <code class="n">handshake</code>
          <code class="n">port</code> <code class="mi">9000</code> <code class="p">:</code> <code class="n">ReadTimeout</code><code class="p">(</code><code class="n">ReadTimeout</code><code class="p">())</code></pre>

<p>If these requirements are met, historical structured data can be retrieved via a single function call. For example, the following Python code retrieves EOD data for a set of symbols and a specified time interval:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">symbols</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">MSFT.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">NFLX.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">AMZN.O</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO2-1" href="#callout_data_driven_finance_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">ek</code><code class="o">.</code><code class="n">get_timeseries</code><code class="p">(</code><code class="n">symbols</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">fields</code><code class="o">=</code><code class="s1">'</code><code class="s1">CLOSE</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">start_date</code><code class="o">=</code><code class="s1">'</code><code class="s1">2019-07-01</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">end_date</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-07-01</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO2-2" href="#callout_data_driven_finance_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO2-3" href="#callout_data_driven_finance_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>         </code><code class="o">&lt;</code><code class="k">class</code><code> </code><code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'</code><code class="s1">&gt;</code><code>
</code><code>         </code><code class="n">DatetimeIndex</code><code class="p">:</code><code> </code><code class="mi">254</code><code> </code><code class="n">entries</code><code class="p">,</code><code> </code><code class="mi">2019</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mo">01</code><code> </code><code class="n">to</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mo">01</code><code>
</code><code>         </code><code class="n">Data</code><code> </code><code class="n">columns</code><code> </code><code class="p">(</code><code class="n">total</code><code> </code><code class="mi">4</code><code> </code><code class="n">columns</code><code class="p">)</code><code class="p">:</code><code>
</code><code>          </code><code class="c1">#   Column  Non-Null Count  Dtype</code><code>
</code><code>         </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>
</code><code>          </code><code class="mi">0</code><code>   </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">254</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">1</code><code>   </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">254</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">2</code><code>   </code><code class="n">NFLX</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">254</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">3</code><code>   </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">254</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>         </code><code class="n">dtypes</code><code class="p">:</code><code> </code><code class="n">float64</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code><code>
</code><code>         </code><code class="n">memory</code><code> </code><code class="n">usage</code><code class="p">:</code><code> </code><code class="mf">9.9</code><code> </code><code class="n">KB</code><code>
</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">tail</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO2-4" href="#callout_data_driven_finance_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">CLOSE</code><code>       </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="n">NFLX</code><code class="o">.</code><code class="n">O</code><code>   </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>
</code><code>         </code><code class="n">Date</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">25</code><code>  </code><code class="mf">364.84</code><code>  </code><code class="mf">200.34</code><code>  </code><code class="mf">465.91</code><code>  </code><code class="mf">2754.58</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">26</code><code>  </code><code class="mf">353.63</code><code>  </code><code class="mf">196.33</code><code>  </code><code class="mf">443.40</code><code>  </code><code class="mf">2692.87</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">29</code><code>  </code><code class="mf">361.78</code><code>  </code><code class="mf">198.44</code><code>  </code><code class="mf">447.24</code><code>  </code><code class="mf">2680.38</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">30</code><code>  </code><code class="mf">364.80</code><code>  </code><code class="mf">203.51</code><code>  </code><code class="mf">455.04</code><code>  </code><code class="mf">2758.82</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mo">01</code><code>  </code><code class="mf">364.11</code><code>  </code><code class="mf">204.70</code><code>  </code><code class="mf">485.64</code><code>  </code><code class="mf">2878.70</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO2-1" href="#co_data_driven_finance_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Defines a list of <code>RICs</code> (symbols) to retrieve data for<sup><a data-type="noteref" id="idm45625324543064-marker" href="ch04.xhtml#idm45625324543064">3</a></sup></p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO2-2" href="#co_data_driven_finance_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Retrieves EOD <code>Close</code> prices for the list of <code>RICs</code></p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO2-3" href="#co_data_driven_finance_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Shows the meta information for the returned <code>DataFrame</code> object</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO2-4" href="#co_data_driven_finance_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Shows the final rows of the <code>DataFrame</code> object</p></dd>
</dl>

<p>Similarly, one-minute bars with <code>OHLC</code> fields can be retrieved with appropriate adjustments of the parameters:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">ek</code><code class="o">.</code><code class="n">get_timeseries</code><code class="p">(</code><code class="s1">'</code><code class="s1">AMZN.O</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">fields</code><code class="o">=</code><code class="s1">'</code><code class="s1">*</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">start_date</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-08-03</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">end_date</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-08-04</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">interval</code><code class="o">=</code><code class="s1">'</code><code class="s1">minute</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO3-1" href="#callout_data_driven_finance_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="o">&lt;</code><code class="k">class</code><code> </code><code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'</code><code class="s1">&gt;</code><code>
</code><code>         </code><code class="n">DatetimeIndex</code><code class="p">:</code><code> </code><code class="mi">911</code><code> </code><code class="n">entries</code><code class="p">,</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mo">01</code><code class="p">:</code><code class="mo">00</code><code> </code><code class="n">to</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="n">Data</code><code> </code><code class="n">columns</code><code> </code><code class="p">(</code><code class="n">total</code><code> </code><code class="mi">6</code><code> </code><code class="n">columns</code><code class="p">)</code><code class="p">:</code><code>
</code><code>          </code><code class="c1">#   Column  Non-Null Count  Dtype</code><code>
</code><code>         </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>
</code><code>          </code><code class="mi">0</code><code>   </code><code class="n">HIGH</code><code>    </code><code class="mi">911</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">1</code><code>   </code><code class="n">LOW</code><code>     </code><code class="mi">911</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">2</code><code>   </code><code class="n">OPEN</code><code>    </code><code class="mi">911</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">3</code><code>   </code><code class="n">CLOSE</code><code>   </code><code class="mi">911</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">4</code><code>   </code><code class="n">COUNT</code><code>   </code><code class="mi">911</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">5</code><code>   </code><code class="n">VOLUME</code><code>  </code><code class="mi">911</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>    </code><code class="n">float64</code><code>
</code><code>         </code><code class="n">dtypes</code><code class="p">:</code><code> </code><code class="n">float64</code><code class="p">(</code><code class="mi">6</code><code class="p">)</code><code>
</code><code>         </code><code class="n">memory</code><code> </code><code class="n">usage</code><code class="p">:</code><code> </code><code class="mf">49.8</code><code> </code><code class="n">KB</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>                  </code><code class="n">HIGH</code><code>      </code><code class="n">LOW</code><code>     </code><code class="n">OPEN</code><code>    </code><code class="n">CLOSE</code><code>  </code><code class="n">COUNT</code><code>  </code><code class="n">VOLUME</code><code>
</code><code>         </code><code class="n">Date</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mo">01</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">3190.00</code><code>  </code><code class="mf">3176.03</code><code>  </code><code class="mf">3176.03</code><code>  </code><code class="mf">3178.17</code><code>   </code><code class="mf">18.0</code><code>   </code><code class="mf">383.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">3183.02</code><code>  </code><code class="mf">3176.03</code><code>  </code><code class="mf">3180.00</code><code>  </code><code class="mf">3177.01</code><code>   </code><code class="mf">15.0</code><code>   </code><code class="mf">513.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mo">03</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">3179.91</code><code>  </code><code class="mf">3177.05</code><code>  </code><code class="mf">3179.91</code><code>  </code><code class="mf">3177.05</code><code>    </code><code class="mf">5.0</code><code>    </code><code class="mf">14.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mo">04</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">3184.00</code><code>  </code><code class="mf">3179.91</code><code>  </code><code class="mf">3179.91</code><code>  </code><code class="mf">3184.00</code><code>    </code><code class="mf">8.0</code><code>   </code><code class="mf">102.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mo">05</code><code class="p">:</code><code class="mo">00</code><code>  </code><code class="mf">3184.91</code><code>  </code><code class="mf">3182.91</code><code>  </code><code class="mf">3183.30</code><code>  </code><code class="mf">3184.00</code><code>   </code><code class="mf">12.0</code><code>   </code><code class="mf">403.0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO3-1" href="#co_data_driven_finance_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves one-minute bars with all available fields for a single <code>RIC</code></p></dd>
</dl>
<div style="page-break-after: always;"/>

<p>One can retrieve more than structured financial time series data from the Eikon Data API. Fundamental data can also be retrieved for a number of <code>RICs</code> and a number of different data fields at the same time, as the following Python code illustrates:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data_grid</code><code class="p">,</code><code> </code><code class="n">err</code><code> </code><code class="o">=</code><code> </code><code class="n">ek</code><code class="o">.</code><code class="n">get_data</code><code class="p">(</code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">IBM</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">GOOG.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">AMZN.O</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                      </code><code class="p">[</code><code class="s1">'</code><code class="s1">TR.TotalReturnYTD</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">TR.WACCBeta</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                       </code><code class="s1">'</code><code class="s1">YRHIGH</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">YRLOW</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                       </code><code class="s1">'</code><code class="s1">TR.Ebitda</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">TR.GrossProfit</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO4-1" href="#callout_data_driven_finance_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data_grid</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code>   </code><code class="n">Instrument</code><code>  </code><code class="n">YTD</code><code> </code><code class="n">Total</code><code> </code><code class="n">Return</code><code>      </code><code class="n">Beta</code><code>   </code><code class="n">YRHIGH</code><code>      </code><code class="n">YRLOW</code><code>        </code><code class="n">EBITDA</code><code>  </code><code>\
</code><code>         </code><code class="mi">0</code><code>     </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>         </code><code class="mf">49.141271</code><code>  </code><code class="mf">1.221249</code><code>   </code><code class="mf">425.66</code><code>   </code><code class="mf">192.5800</code><code>  </code><code class="mf">7.647700e+10</code><code>
</code><code>         </code><code class="mi">1</code><code>        </code><code class="n">IBM</code><code>         </code><code class="o">-</code><code class="mf">5.019570</code><code>  </code><code class="mf">1.208156</code><code>   </code><code class="mf">158.75</code><code>    </code><code class="mf">90.5600</code><code>  </code><code class="mf">1.898600e+10</code><code>
</code><code>         </code><code class="mi">2</code><code>     </code><code class="n">GOOG</code><code class="o">.</code><code class="n">O</code><code>         </code><code class="mf">10.278829</code><code>  </code><code class="mf">1.067084</code><code>  </code><code class="mf">1586.99</code><code>  </code><code class="mf">1013.5361</code><code>  </code><code class="mf">4.757900e+10</code><code>
</code><code>         </code><code class="mi">3</code><code>     </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>         </code><code class="mf">68.406897</code><code>  </code><code class="mf">1.338106</code><code>  </code><code class="mf">3344.29</code><code>  </code><code class="mf">1626.0318</code><code>  </code><code class="mf">3.025600e+10</code><code>
</code><code>
</code><code>            </code><code class="n">Gross</code><code> </code><code class="n">Profit</code><code>
</code><code>         </code><code class="mi">0</code><code>   </code><code class="mi">98392000000</code><code>
</code><code>         </code><code class="mi">1</code><code>   </code><code class="mi">36488000000</code><code>
</code><code>         </code><code class="mi">2</code><code>   </code><code class="mi">89961000000</code><code>
</code><code>         </code><code class="mi">3</code><code>  </code><code class="mi">114986000000</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO4-1" href="#co_data_driven_finance_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves data for multiple <code>RICs</code> and multiple data fields<a data-type="indexterm" data-primary="" data-startref="ix_eikon_data_api" id="idm45625324151864"/><a data-type="indexterm" data-primary="" data-startref="ix_program_apis_data-driven" id="idm45625324150888"/></p></dd>
</dl>
<div data-type="note" epub:type="note"><h1>Programmatic Data Availability</h1>
<p><a data-type="indexterm" data-primary="programmatic APIs, data-driven finance" id="idm45625322757448"/>Basically all structured financial data is available nowadays in programmatic fashion. <a data-type="indexterm" data-primary="financial time series data" data-seealso="market prediction" id="idm45625322756648"/>Financial time series data, in this context, is the paramount example. However, other structured data types such as fundamental data are available in the same way, simplifying the work of quantitative analysts, traders, portfolio managers, and the like significantly.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Structured Streaming Data"><div class="sect2" id="idm45625324877000">
<h2>Structured Streaming Data</h2>

<p><a data-type="indexterm" data-primary="structured streaming data" id="ix_structured_stream_data"/><a data-type="indexterm" data-primary="Oanda trading platform" id="ix_oanda_trade_platform"/>Many applications in finance require real-time structured data, such as in algorithmic trading or market risk management. The following Python code makes use of the API of the <a href="http://oanda.com">Oanda Trading Platform</a> and streams in real time a number of time stamps, bid quotes, and ask quotes for the Bitcoin price in USD:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">tpqoa</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">oa</code><code> </code><code class="o">=</code><code> </code><code class="n">tpqoa</code><code class="o">.</code><code class="n">tpqoa</code><code class="p">(</code><code class="s1">'</code><code class="s1">../aiif.cfg</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO5-1" href="#callout_data_driven_finance_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">25</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">oa</code><code class="o">.</code><code class="n">stream_data</code><code class="p">(</code><code class="s1">'</code><code class="s1">BTC_USD</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">stop</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO5-2" href="#callout_data_driven_finance_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code><code class="n">T08</code><code class="p">:</code><code class="mi">30</code><code class="p">:</code><code class="mf">38.621075583</code><code class="n">Z</code><code> </code><code class="mf">11298.8</code><code> </code><code class="mf">11334.8</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code><code class="n">T08</code><code class="p">:</code><code class="mi">30</code><code class="p">:</code><code class="mf">50.485678488</code><code class="n">Z</code><code> </code><code class="mf">11298.3</code><code> </code><code class="mf">11334.3</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code><code class="n">T08</code><code class="p">:</code><code class="mi">30</code><code class="p">:</code><code class="mf">50.801666847</code><code class="n">Z</code><code> </code><code class="mf">11297.3</code><code> </code><code class="mf">11333.3</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code><code class="n">T08</code><code class="p">:</code><code class="mi">30</code><code class="p">:</code><code class="mf">51.326269990</code><code class="n">Z</code><code> </code><code class="mf">11296.0</code><code> </code><code class="mf">11332.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">04</code><code class="n">T08</code><code class="p">:</code><code class="mi">30</code><code class="p">:</code><code class="mf">54.423973431</code><code class="n">Z</code><code> </code><code class="mf">11296.6</code><code> </code><code class="mf">11332.6</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO5-1" href="#co_data_driven_finance_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Connects to the Oanda API</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO5-2" href="#co_data_driven_finance_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Streams a fixed number of ticks for a given symbol</p></dd>
</dl>

<p>Printing out the streamed data fields is, of course, only for illustration. Certain financial applications might require sophisticated processing of the retrieved data and the generation of signals or statistics, for instance. Particularly during weekdays and trading hours, the number of price ticks streamed for financial instruments increases steadily, demanding powerful data processing capabilities on the end of financial institutions that need to process such data in real time or at least in near-real time (“near time”).</p>

<p>The significance of this observation becomes clear when looking at Apple Inc. stock prices. One can calculate that there are roughly <math alttext="252 dot 40 equals 10 comma 080">
  <mrow>
    <mn>252</mn>
    <mo>·</mo>
    <mn>40</mn>
    <mo>=</mo>
    <mn>10</mn>
    <mo>,</mo>
    <mn>080</mn>
  </mrow>
</math> EOD closing quotes for the Apple stock over a period of 40 years. (Apple Inc. went public on December 12, 1980.) The following code retrieves <em>tick data</em> for the Apple stock price for one hour only. The retrieved data set, which might not even be complete for the given time interval, has 50,000 data rows, or five times as many tick quotes as the EOD quotes accumulated over 40 years of trading:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="n">ek</code><code class="o">.</code><code class="n">get_timeseries</code><code class="p">(</code><code class="s1">'</code><code class="s1">AAPL.O</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">fields</code><code class="o">=</code><code class="s1">'</code><code class="s1">*</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">start_date</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-08-03 15:00:00</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">end_date</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-08-03 16:00:00</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">interval</code><code class="o">=</code><code class="s1">'</code><code class="s1">tick</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO6-1" href="#callout_data_driven_finance_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="o">&lt;</code><code class="k">class</code><code> </code><code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'</code><code class="s1">&gt;</code><code>
</code><code>         </code><code class="n">DatetimeIndex</code><code class="p">:</code><code> </code><code class="mi">50000</code><code> </code><code class="n">entries</code><code class="p">,</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">15</code><code class="p">:</code><code class="mi">26</code><code class="p">:</code><code class="mf">24.889000</code><code> </code><code class="n">to</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code>
</code><code>          </code><code class="mi">15</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mf">59.762000</code><code>
</code><code>         </code><code class="n">Data</code><code> </code><code class="n">columns</code><code> </code><code class="p">(</code><code class="n">total</code><code> </code><code class="mi">2</code><code> </code><code class="n">columns</code><code class="p">)</code><code class="p">:</code><code>
</code><code>          </code><code class="c1">#   Column  Non-Null Count  Dtype</code><code>
</code><code>         </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>
</code><code>          </code><code class="mi">0</code><code>   </code><code class="n">VALUE</code><code>   </code><code class="mi">49953</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>  </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">1</code><code>   </code><code class="n">VOLUME</code><code>  </code><code class="mi">50000</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>  </code><code class="n">float64</code><code>
</code><code>         </code><code class="n">dtypes</code><code class="p">:</code><code> </code><code class="n">float64</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code>
</code><code>         </code><code class="n">memory</code><code> </code><code class="n">usage</code><code class="p">:</code><code> </code><code class="mf">1.1</code><code> </code><code class="n">MB</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>                    </code><code class="n">VALUE</code><code>  </code><code class="n">VOLUME</code><code>
</code><code>         </code><code class="n">Date</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">15</code><code class="p">:</code><code class="mi">26</code><code class="p">:</code><code class="mf">24.889</code><code>  </code><code class="mf">439.06</code><code>   </code><code class="mf">175.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">15</code><code class="p">:</code><code class="mi">26</code><code class="p">:</code><code class="mf">24.889</code><code>  </code><code class="mf">439.08</code><code>     </code><code class="mf">3.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">15</code><code class="p">:</code><code class="mi">26</code><code class="p">:</code><code class="mf">24.890</code><code>  </code><code class="mf">439.08</code><code>   </code><code class="mf">100.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">15</code><code class="p">:</code><code class="mi">26</code><code class="p">:</code><code class="mf">24.890</code><code>  </code><code class="mf">439.08</code><code>     </code><code class="mf">5.0</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mi">08</code><code class="o">-</code><code class="mo">03</code><code> </code><code class="mi">15</code><code class="p">:</code><code class="mi">26</code><code class="p">:</code><code class="mf">24.899</code><code>  </code><code class="mf">439.10</code><code>    </code><code class="mf">35.0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO6-1" href="#co_data_driven_finance_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves tick data for the Apple stock price<a data-type="indexterm" data-primary="" data-startref="ix_oanda_trade_platform" id="idm45625324244008"/><a data-type="indexterm" data-primary="" data-startref="ix_structured_stream_data" id="idm45625323625720"/></p></dd>
</dl>
<div data-type="important"><h1>EOD Versus Tick Data</h1>
<p><a data-type="indexterm" data-primary="EOD (end-of-day) versus intraday data" id="idm45625323623576"/><a data-type="indexterm" data-primary="intraday trading" id="idm45625323622904"/>Most of the financial theories still applied today have their origin in when EOD data was basically the only type of financial data available. Today, financial institutions, and even retail traders and investors, are confronted with never-ending streams of real-time data. The example of Apple stock illustrates that for a single stock during one trading hour, there might be four times as many ticks coming in as the amount of EOD data accumulated over a period of 40 years. This not only challenges actors in financial markets, but also puts into question whether existing financial theories can be applied to such an environment at all.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Unstructured Historical Data"><div class="sect2" id="idm45625323649928">
<h2>Unstructured Historical Data</h2>

<p><a data-type="indexterm" data-primary="unstructured data" data-secondary="historical" id="ix_unstruct_data_hist"/>Many important data sources in finance provide unstructured data only, such as financial news or company filings. Undoubtedly, machines are much better and faster than humans at crunching large amounts of structured, numerical data. <a data-type="indexterm" data-primary="NLP (natural language processing)" id="idm45625323647080"/>However, recent advances in <em>natural language processing</em> (NLP) make machines better and faster at processing financial news too, for example. In 2020, data service providers ingest roughly 1.5 million news articles on a daily basis. It is clear that this vast amount of text-based data cannot be processed properly by human beings.</p>

<p>Fortunately, unstructured data is also to a large extent available these days via programmatic APIs. <a data-type="indexterm" data-primary="Eikon Data API" id="idm45625323645144"/>The following Python code retrieves a number of news articles from the Eikon Data API related to the company Tesla, Inc. and its production. One article is selected and shown in full:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">29</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">news</code><code> </code><code class="o">=</code><code> </code><code class="n">ek</code><code class="o">.</code><code class="n">get_news_headlines</code><code class="p">(</code><code class="s1">'</code><code class="s1">R:TSLA.O PRODUCTION</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">date_from</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-06-01</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">date_to</code><code class="o">=</code><code class="s1">'</code><code class="s1">2020-08-01</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">count</code><code class="o">=</code><code class="mi">7</code><code>
</code><code>                                 </code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO7-1" href="#callout_data_driven_finance_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">30</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">news</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">30</code><code class="p">]</code><code class="p">:</code><code>                                           </code><code class="n">versionCreated</code><code>  </code><code>\
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">29</code><code> </code><code class="mi">11</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mf">31.276</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">29</code><code> </code><code class="mi">11</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mf">31.276000</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">28</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mf">48.000</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">28</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mi">48</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mf">36.090</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mf">36.090000</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mi">22</code><code class="p">:</code><code class="mf">17.000</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mi">22</code><code class="p">:</code><code class="mi">17</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">07</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mf">48.000</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">07</code><code class="p">:</code><code class="mi">46</code><code class="p">:</code><code class="mi">56</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">55</code><code class="p">:</code><code class="mf">54.000</code><code>        </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">55</code><code class="p">:</code><code class="mi">54</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">22</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">35</code><code class="p">:</code><code class="mf">42.640</code><code> </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">22</code><code> </code><code class="mi">22</code><code class="p">:</code><code class="mi">13</code><code class="p">:</code><code class="mf">26.597000</code><code class="o">+</code><code class="mo">00</code><code class="p">:</code><code class="mo">00</code><code>
</code><code>
</code><code>                                                                          </code><code class="n">text</code><code>  </code><code>\
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">29</code><code> </code><code class="mi">11</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mf">31.276</code><code>  </code><code class="n">Tesla</code><code> </code><code class="n">Launches</code><code> </code><code class="n">Hiring</code><code> </code><code class="n">Spree</code><code> </code><code class="ow">in</code><code> </code><code class="n">China</code><code> </code><code class="k">as</code><code> </code><code class="n">It</code><code> </code><code class="n">Pre</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">28</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mf">48.000</code><code>    </code><code class="n">Tesla</code><code> </code><code class="n">hiring</code><code> </code><code class="ow">in</code><code> </code><code class="n">Shanghai</code><code> </code><code class="k">as</code><code> </code><code class="n">production</code><code> </code><code class="n">ramps</code><code> </code><code class="n">up</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mf">36.090</code><code>     </code><code class="n">Tesla</code><code> </code><code class="n">speeds</code><code> </code><code class="n">up</code><code> </code><code class="n">Model</code><code> </code><code class="mi">3</code><code> </code><code class="n">production</code><code> </code><code class="ow">in</code><code> </code><code class="n">Shanghai</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mi">22</code><code class="p">:</code><code class="mf">17.000</code><code>  </code><code class="n">UPDATE</code><code> </code><code class="mi">1</code><code class="o">-</code><code class="s1">'</code><code class="s1">Please mine more nickel,</code><code class="s1">'</code><code> </code><code class="n">Musk</code><code> </code><code class="n">urges</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">07</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mf">48.000</code><code>  </code><code class="s1">'</code><code class="s1">Please mine more nickel,</code><code class="s1">'</code><code> </code><code class="n">Musk</code><code> </code><code class="n">urges</code><code> </code><code class="k">as</code><code> </code><code class="n">Tesla</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">55</code><code class="p">:</code><code class="mf">54.000</code><code>  </code><code class="n">USA</code><code class="o">-</code><code class="n">Tesla</code><code> </code><code class="n">choisit</code><code> </code><code class="n">le</code><code> </code><code class="n">Texas</code><code> </code><code class="n">pour</code><code> </code><code class="n">la</code><code> </code><code class="n">production</code><code> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">22</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">35</code><code class="p">:</code><code class="mf">42.640</code><code>  </code><code class="n">TESLA</code><code> </code><code class="n">INC</code><code> </code><code class="o">-</code><code> </code><code class="n">THE</code><code> </code><code class="n">REAL</code><code> </code><code class="n">LIMITATION</code><code> </code><code class="n">ON</code><code> </code><code class="n">TESLA</code><code> </code><code class="n">GROWT</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>
</code><code>                                                                       </code><code class="n">storyId</code><code>  </code><code>\
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">29</code><code> </code><code class="mi">11</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mf">31.276</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200729</code><code class="p">:</code><code class="n">nCXG3W8s9X</code><code class="p">:</code><code class="mi">1</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">28</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mf">48.000</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200728</code><code class="p">:</code><code class="n">nL3N2EY3PG</code><code class="p">:</code><code class="mi">8</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mf">36.090</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200723</code><code class="p">:</code><code class="n">nNRAcf1v8f</code><code class="p">:</code><code class="mi">1</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mi">22</code><code class="p">:</code><code class="mf">17.000</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200723</code><code class="p">:</code><code class="n">nL3N2EU1P9</code><code class="p">:</code><code class="mi">1</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">07</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mf">48.000</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200723</code><code class="p">:</code><code class="n">nL3N2EU0HH</code><code class="p">:</code><code class="mi">1</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">55</code><code class="p">:</code><code class="mf">54.000</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200723</code><code class="p">:</code><code class="n">nL5N2EU03M</code><code class="p">:</code><code class="mi">1</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">22</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">35</code><code class="p">:</code><code class="mf">42.640</code><code>  </code><code class="n">urn</code><code class="p">:</code><code class="n">newsml</code><code class="p">:</code><code class="n">reuters</code><code class="o">.</code><code class="n">com</code><code class="p">:</code><code class="mi">20200722</code><code class="p">:</code><code class="n">nFWN2ET120</code><code class="p">:</code><code class="mi">2</code><code>
</code><code>
</code><code>                                 </code><code class="n">sourceCode</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">29</code><code> </code><code class="mi">11</code><code class="p">:</code><code class="mo">02</code><code class="p">:</code><code class="mf">31.276</code><code>  </code><code class="n">NS</code><code class="p">:</code><code class="n">CAIXIN</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">28</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">59</code><code class="p">:</code><code class="mf">48.000</code><code>    </code><code class="n">NS</code><code class="p">:</code><code class="n">RTRS</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">20</code><code class="p">:</code><code class="mf">36.090</code><code>  </code><code class="n">NS</code><code class="p">:</code><code class="n">SOUTHC</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mi">08</code><code class="p">:</code><code class="mi">22</code><code class="p">:</code><code class="mf">17.000</code><code>    </code><code class="n">NS</code><code class="p">:</code><code class="n">RTRS</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">07</code><code class="p">:</code><code class="mi">08</code><code class="p">:</code><code class="mf">48.000</code><code>    </code><code class="n">NS</code><code class="p">:</code><code class="n">RTRS</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">23</code><code> </code><code class="mo">00</code><code class="p">:</code><code class="mi">55</code><code class="p">:</code><code class="mf">54.000</code><code>    </code><code class="n">NS</code><code class="p">:</code><code class="n">RTRS</code><code>
</code><code>         </code><code class="mi">2020</code><code class="o">-</code><code class="mo">07</code><code class="o">-</code><code class="mi">22</code><code> </code><code class="mi">21</code><code class="p">:</code><code class="mi">35</code><code class="p">:</code><code class="mf">42.640</code><code>    </code><code class="n">NS</code><code class="p">:</code><code class="n">RTRS</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">31</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">storyId</code><code> </code><code class="o">=</code><code> </code><code class="n">news</code><code class="p">[</code><code class="s1">'</code><code class="s1">storyId</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO7-2" href="#callout_data_driven_finance_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">32</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">IPython.display</code><code> </code><code class="kn">import</code><code> </code><code class="n">HTML</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">HTML</code><code class="p">(</code><code class="n">ek</code><code class="o">.</code><code class="n">get_news_story</code><code class="p">(</code><code class="n">storyId</code><code class="p">)</code><code class="p">[</code><code class="p">:</code><code class="mi">1148</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO7-3" href="#callout_data_driven_finance_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">&lt;</code><code class="n">IPython</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">display</code><code class="o">.</code><code class="n">HTML</code><code> </code><code class="nb">object</code><code class="o">&gt;</code></pre>

<pre data-type="programlisting">Jan 06, 2020

Tesla, Inc.TSLA registered record production and deliveries of 104,891 and
112,000 vehicles, respectively, in the fourth quarter of 2019.

Notably, the company's Model S/X and Model 3 reported record production and
deliveries in the fourth quarter. The Model S/X division recorded production
and delivery volume of 17,933 and 19,450 vehicles, respectively. The Model 3
division registered production of 86,958 vehicles, while 92,550 vehicles were
delivered.

In 2019, Tesla delivered 367,500 vehicles, reflecting an increase of 50%, year
over year, and nearly in line with the company's full-year guidance of 360,000
vehicles.</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO7-1" href="#co_data_driven_finance_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves metadata for a number of news articles that fall in the parameter range</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO7-2" href="#co_data_driven_finance_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Selects one <code>storyId</code> for which to retrieve the full text</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO7-3" href="#co_data_driven_finance_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Retrieves the full text for the selected article and shows it<a data-type="indexterm" data-primary="" data-startref="ix_unstruct_data_hist" id="idm45625319990872"/></p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Unstructured Streaming Data"><div class="sect2" id="idm45625323315896">
<h2>Unstructured Streaming Data</h2>

<p><a data-type="indexterm" data-primary="unstructured data" data-secondary="streaming" id="ix_unstruct_data_stream"/>In the same way that historical unstructured data is retrieved, programmatic APIs can be used to stream unstructured news data, for example, in real time or at least near time. <a data-type="indexterm" data-primary="DNA (Data, News, Analytics) platform" id="ix_dna_platform"/>One such API is available for <a href="https://oreil.ly/kVm18">DNA</a>: the Data, News, Analytics platform from Dow Jones. <a data-type="xref" href="#figure_ddf_dna_01">Figure 4-1</a> shows the screenshot of a web application that streams “Commodity and Financial News” articles and processes these with NLP techniques in real time.</p>

<figure class="thumb"><div id="figure_ddf_dna_01" class="figure">
<img src="Images/aiif_0401.png" alt="aiif 0401" width="1784" height="1616"/>
<h6><span class="label">Figure 4-1. </span>News-streaming application based on DNA (Dow Jones)</h6>
</div></figure>

<p>The news-streaming application has the following main features:</p>
<dl>
<dt>Full text</dt>
<dd>
<p>The full text of each article is available by clicking on the article header.</p>
</dd>
<dt>Keyword summary</dt>
<dd>
<p>A keyword summary is created and printed on the screen.</p>
</dd>
<dt>Sentiment analysis</dt>
<dd>
<p>Sentiment scores are calculated and visualized as colored arrows. Details become visible through a click on the arrows.</p>
</dd>
<dt>Word cloud</dt>
<dd>
<p>A word cloud summary bitmap is created, shown as a thumbnail and visible after a click on the thumbnail (see <a data-type="xref" href="#figure_ddf_dna_02">Figure 4-2</a>).<a data-type="indexterm" data-primary="" data-startref="ix_dna_platform" id="idm45625323540696"/><a data-type="indexterm" data-primary="" data-startref="ix_unstruct_data_stream" id="idm45625323539720"/></p>
</dd>
</dl>

<figure class="thumb"><div id="figure_ddf_dna_02" class="figure">
<img src="Images/aiif_0402.png" alt="aiif 0402" width="1344" height="879"/>
<h6><span class="label">Figure 4-2. </span>Word cloud bitmap shown in news-streaming application</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Alternative Data"><div class="sect2" id="idm45625323536312">
<h2>Alternative Data</h2>

<p><a data-type="indexterm" data-primary="alternative data sources" id="ix_alt_data_sources"/>Nowadays, financial institutions, and in particular hedge funds, systematically mine a number of alternative data sources to gain an edge in trading and investing. A recent article by <a href="http://bit.ly/aiif_alt_data">Bloomberg</a> lists, among others, the following alternative data sources:</p>

<ul>
<li>
<p>Web-scraped data</p>
</li>
<li>
<p>Crowd-sourced data</p>
</li>
<li>
<p>Credit cards and point-of-sales (POS) systems</p>
</li>
<li>
<p>Social media sentiment</p>
</li>
<li>
<p>Search trends</p>
</li>
<li>
<p>Web traffic</p>
</li>
<li>
<p>Supply chain data</p>
</li>
<li>
<p>Energy production data</p>
</li>
<li>
<p>Consumer profiles</p>
</li>
<li>
<p>Satellite imagery/geospacial data</p>
</li>
<li>
<p>App installs</p>
</li>
<li>
<p>Ocean vessel tracking</p>
</li>
<li>
<p>Wearables, drones, Internet of Things (IoT) sensors</p>
</li>
</ul>

<p>In the following, the usage of alternative data is illustrated by two examples. The first retrieves and processes Apple Inc. press releases in the form of HTML pages. The 
<span class="keep-together">following</span> Python code makes use of a set of helper functions as shown in <a data-type="xref" href="#nlp_functions">“Python Code”</a>. In the code, a list of URLs is defined, each representing an HTML page with a press release from Apple Inc. The raw HTML code is then retrieved for each press release. Then the raw code is cleaned up, and an excerpt for one press release is printed:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">34</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">nlp</code><code>  </code><a class="co" id="co_data_driven_finance_CO8-1" href="#callout_data_driven_finance_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="kn">import</code><code> </code><code class="nn">requests</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">35</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sources</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code>
</code><code>             </code><code class="s1">'</code><code class="s1">https://nr.apple.com/dE0b1T5G3u</code><code class="s1">'</code><code class="p">,</code><code>  </code><code class="c1"># iPad Pro</code><code>
</code><code>             </code><code class="s1">'</code><code class="s1">https://nr.apple.com/dE4c7T6g1K</code><code class="s1">'</code><code class="p">,</code><code>  </code><code class="c1"># MacBook Air</code><code>
</code><code>             </code><code class="s1">'</code><code class="s1">https://nr.apple.com/dE4q4r8A2A</code><code class="s1">'</code><code class="p">,</code><code>  </code><code class="c1"># Mac Mini</code><code>
</code><code>         </code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO8-2" href="#callout_data_driven_finance_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">36</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">html</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">requests</code><code class="o">.</code><code class="n">get</code><code class="p">(</code><code class="n">url</code><code class="p">)</code><code class="o">.</code><code class="n">text</code><code> </code><code class="k">for</code><code> </code><code class="n">url</code><code> </code><code class="ow">in</code><code> </code><code class="n">sources</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO8-3" href="#callout_data_driven_finance_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">37</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">nlp</code><code class="o">.</code><code class="n">clean_up_text</code><code class="p">(</code><code class="n">t</code><code class="p">)</code><code> </code><code class="k">for</code><code> </code><code class="n">t</code><code> </code><code class="ow">in</code><code> </code><code class="n">html</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO8-4" href="#callout_data_driven_finance_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">38</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">data</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">[</code><code class="mi">536</code><code class="p">:</code><code class="mi">1001</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO8-5" href="#callout_data_driven_finance_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">38</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1"> display, powerful a12x bionic chip and face id introducing the new ipad pro</code><code>
</code><code>          </code><code class="k">with</code><code> </code><code class="nb">all</code><code class="o">-</code><code class="n">screen</code><code> </code><code class="n">design</code><code> </code><code class="ow">and</code><code> </code><code class="nb">next</code><code class="o">-</code><code class="n">generation</code><code> </code><code class="n">performance</code><code class="o">.</code><code> </code><code class="n">new</code><code> </code><code class="n">york</code><code> </code><code class="n">apple</code><code> </code><code class="n">today</code><code>
</code><code>          </code><code class="n">introduced</code><code> </code><code class="n">the</code><code> </code><code class="n">new</code><code> </code><code class="n">ipad</code><code> </code><code class="n">pro</code><code> </code><code class="k">with</code><code> </code><code class="nb">all</code><code class="o">-</code><code class="n">screen</code><code> </code><code class="n">design</code><code> </code><code class="ow">and</code><code> </code><code class="nb">next</code><code class="o">-</code><code class="n">generation</code><code>
</code><code>          </code><code class="n">performance</code><code class="p">,</code><code> </code><code class="n">marking</code><code> </code><code class="n">the</code><code> </code><code class="n">biggest</code><code> </code><code class="n">change</code><code> </code><code class="n">to</code><code> </code><code class="n">ipad</code><code> </code><code class="n">ever</code><code class="o">.</code><code> </code><code class="n">the</code><code> </code><code class="nb">all</code><code class="o">-</code><code class="n">new</code><code> </code><code class="n">design</code><code>
</code><code>          </code><code class="n">pushes</code><code> </code><code class="mi">11</code><code class="o">-</code><code class="n">inch</code><code> </code><code class="ow">and</code><code> </code><code class="mf">12.9</code><code class="o">-</code><code class="n">inch</code><code> </code><code class="n">liquid</code><code> </code><code class="n">retina</code><code> </code><code class="n">displays</code><code> </code><code class="n">to</code><code> </code><code class="n">the</code><code> </code><code class="n">edges</code><code> </code><code class="n">of</code><code> </code><code class="n">ipad</code><code> </code><code class="n">pro</code><code>
</code><code>          </code><code class="ow">and</code><code> </code><code class="n">integrates</code><code> </code><code class="n">face</code><code> </code><code class="nb">id</code><code> </code><code class="n">to</code><code> </code><code class="n">securely</code><code> </code><code class="n">unlock</code><code> </code><code class="n">ipad</code><code> </code><code class="k">with</code><code> </code><code class="n">just</code><code> </code><code class="n">a</code><code> </code><code class="n">glance</code><code class="o">.</code><code class="mi">1</code><code> </code><code class="n">the</code><code> </code><code class="n">a12x</code><code>
</code><code>          </code><code class="n">bionic</code><code> </code><code class="n">chip</code><code> </code><code class="n">w</code><code class="s1">'</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO8-1" href="#co_data_driven_finance_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Imports the NLP helper functions</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO8-2" href="#co_data_driven_finance_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Defines the URLs for the three press releases</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO8-3" href="#co_data_driven_finance_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Retrieves the raw HTML codes for the three press releases</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO8-4" href="#co_data_driven_finance_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Cleans up the raw HTML codes (for example, HTML tags are removed)</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO8-5" href="#co_data_driven_finance_CO8-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Prints an excerpt from one press release</p></dd>
</dl>

<p>Of course, defining alternative data as broadly as is done in this section implies that there is a limitless amount of data that one can retrieve and process for financial purposes. <a data-type="indexterm" data-primary="Google LLC and data search" id="idm45625323186984"/>At its core, this is the business of search engines such as the one from Google LLC. In a financial context, it would be of paramount importance to specify exactly what unstructured alternative data sources to tap into.</p>

<p><a data-type="indexterm" data-primary="Twitter API" id="ix_twitter_api"/>The second example is about the retrieval of data from the social network Twitter, Inc. To this end, Twitter provides API access to tweets on its platform, provided one has set up a Twitter account appropriately.
The following Python code connects to the Twitter API and retrieves and prints the five most recent tweets from my home timeline and user timeline, respectively:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">39</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">twitter</code><code> </code><code class="kn">import</code><code> </code><code class="n">Twitter</code><code class="p">,</code><code> </code><code class="n">OAuth</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">40</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">t</code><code> </code><code class="o">=</code><code> </code><code class="n">Twitter</code><code class="p">(</code><code class="n">auth</code><code class="o">=</code><code class="n">OAuth</code><code class="p">(</code><code class="n">c</code><code class="p">[</code><code class="s1">'</code><code class="s1">twitter</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">access_token</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                </code><code class="n">c</code><code class="p">[</code><code class="s1">'</code><code class="s1">twitter</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">access_secret_token</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                </code><code class="n">c</code><code class="p">[</code><code class="s1">'</code><code class="s1">twitter</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">api_key</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                </code><code class="n">c</code><code class="p">[</code><code class="s1">'</code><code class="s1">twitter</code><code class="s1">'</code><code class="p">]</code><code class="p">[</code><code class="s1">'</code><code class="s1">api_secret_key</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                     </code><code class="n">retry</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO9-1" href="#callout_data_driven_finance_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">41</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l</code><code> </code><code class="o">=</code><code> </code><code class="n">t</code><code class="o">.</code><code class="n">statuses</code><code class="o">.</code><code class="n">home_timeline</code><code class="p">(</code><code class="n">count</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO9-2" href="#callout_data_driven_finance_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">42</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">e</code><code> </code><code class="ow">in</code><code> </code><code class="n">l</code><code class="p">:</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">e</code><code class="p">[</code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO9-3" href="#callout_data_driven_finance_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">The</code><code> </code><code class="n">Bank</code><code> </code><code class="n">of</code><code> </code><code class="n">England</code><code> </code><code class="ow">is</code><code> </code><code class="n">effectively</code><code> </code><code class="n">subsidizing</code><code> </code><code class="n">polluting</code><code> </code><code class="n">industries</code><code> </code><code class="ow">in</code><code> </code><code class="n">its</code><code>
</code><code>          </code><code class="n">pandemic</code><code> </code><code class="n">rescue</code><code> </code><code class="n">program</code><code class="p">,</code><code> </code><code class="n">a</code><code> </code><code class="n">think</code><code> </code><code class="n">tank</code><code> </code><code class="n">sa</code><code class="err">…</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">Fq5jl2CIcp</code><code>
</code><code>         </code><code class="n">Cool</code><code> </code><code class="n">shared</code><code> </code><code class="n">task</code><code class="p">:</code><code> </code><code class="n">mining</code><code> </code><code class="n">scientific</code><code> </code><code class="n">contributions</code><code> </code><code class="p">(</code><code class="n">by</code><code> </code><code class="nd">@SeeTedTalk</code><code> </code><code class="nd">@SoerenAuer</code><code>
</code><code>          </code><code class="ow">and</code><code> </code><code class="n">Jennifer</code><code> </code><code class="n">D</code><code class="s1">'</code><code class="s1">Souza)</code><code>
</code><code>         </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">dm56DMUrWm</code><code>
</code><code>         </code><code class="n">Twelve</code><code> </code><code class="n">people</code><code> </code><code class="n">were</code><code> </code><code class="n">hospitalized</code><code> </code><code class="ow">in</code><code> </code><code class="n">Wyoming</code><code> </code><code class="n">on</code><code> </code><code class="n">Monday</code><code> </code><code class="n">after</code><code> </code><code class="n">a</code><code> </code><code class="n">hot</code><code> </code><code class="n">air</code><code> </code><code class="n">balloon</code><code>
</code><code>          </code><code class="n">crash</code><code class="p">,</code><code> </code><code class="n">officials</code><code> </code><code class="n">said</code><code class="o">.</code><code>
</code><code>
</code><code>         </code><code class="n">Three</code><code> </code><code class="n">hot</code><code> </code><code class="n">air</code><code class="err">…</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">EaNBBRXVar</code><code>
</code><code>         </code><code class="n">President</code><code> </code><code class="n">Trump</code><code> </code><code class="n">directed</code><code> </code><code class="n">controversial</code><code> </code><code class="n">Pentagon</code><code> </code><code class="n">pick</code><code> </code><code class="n">into</code><code> </code><code class="n">new</code><code> </code><code class="n">role</code><code> </code><code class="k">with</code><code>
</code><code>          </code><code class="n">similar</code><code> </code><code class="n">duties</code><code> </code><code class="n">after</code><code> </code><code class="n">nomination</code><code> </code><code class="n">failed</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">ZyXpPcJkcQ</code><code>
</code><code>         </code><code class="n">Company</code><code> </code><code class="n">announcement</code><code class="p">:</code><code> </code><code class="n">Revolut</code><code> </code><code class="n">launches</code><code> </code><code class="n">Open</code><code> </code><code class="n">Banking</code><code> </code><code class="k">for</code><code> </code><code class="n">its</code><code> </code><code class="mi">400</code><code class="p">,</code><code class="mo">000</code><code> </code><code class="n">Italian</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>          </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">OfvbgwbeJW</code><code> </code><code class="c1">#fintech</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">43</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l</code><code> </code><code class="o">=</code><code> </code><code class="n">t</code><code class="o">.</code><code class="n">statuses</code><code class="o">.</code><code class="n">user_timeline</code><code class="p">(</code><code class="n">screen_name</code><code class="o">=</code><code class="s1">'</code><code class="s1">dyjh</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">count</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO9-4" href="#callout_data_driven_finance_CO9-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">44</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">e</code><code> </code><code class="ow">in</code><code> </code><code class="n">l</code><code class="p">:</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">e</code><code class="p">[</code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO9-5" href="#callout_data_driven_finance_CO9-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>         </code><code class="c1">#Python for #AlgoTrading (focus on the process) &amp;amp; #AI in #Finance (focus</code><code>
</code><code>          </code><code class="n">on</code><code> </code><code class="n">prediction</code><code> </code><code class="n">methods</code><code class="p">)</code><code> </code><code class="n">will</code><code> </code><code class="n">complement</code><code> </code><code class="n">eac</code><code class="err">…</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">P1s8fXCp42</code><code>
</code><code>         </code><code class="n">Currently</code><code> </code><code class="n">putting</code><code> </code><code class="n">finishing</code><code> </code><code class="n">touches</code><code> </code><code class="n">on</code><code> </code><code class="c1">#AI in #Finance (@OReillyMedia). Book</code><code>
</code><code>          </code><code class="n">going</code><code> </code><code class="n">into</code><code> </code><code class="n">production</code><code> </code><code class="n">shortly</code><code class="o">.</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">JsOSA3sfBL</code><code>
</code><code>         </code><code class="n">Chinatown</code><code> </code><code class="n">Is</code><code> </code><code class="n">Coming</code><code> </code><code class="n">Back</code><code class="p">,</code><code> </code><code class="n">One</code><code> </code><code class="n">Noodle</code><code> </code><code class="n">at</code><code> </code><code class="n">a</code><code> </code><code class="n">Time</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">In5kXNeVc5</code><code>
</code><code>         </code><code class="n">Alt</code><code> </code><code class="n">data</code><code> </code><code class="n">industry</code><code> </code><code class="n">balloons</code><code> </code><code class="k">as</code><code> </code><code class="n">hedge</code><code> </code><code class="n">funds</code><code> </code><code class="n">strive</code><code> </code><code class="k">for</code><code> </code><code class="n">Covid</code><code> </code><code class="n">edge</code><code> </code><code class="n">via</code><code> </code><code class="nd">@FT</code><code> </code><code class="o">|</code><code>
</code><code>         </code><code class="s2">"</code><code class="s2">We remain of the view that alternative d… https://t.co/9HtUOjoEdz</code><code>
</code><code>         </code><code class="nd">@Wolf_Of_BTC</code><code> </code><code class="n">Just</code><code> </code><code class="n">follow</code><code> </code><code class="n">me</code><code> </code><code class="n">on</code><code> </code><code class="n">Twitter</code><code> </code><code class="p">(</code><code class="ow">or</code><code> </code><code class="n">LinkedIn</code><code class="p">)</code><code class="o">.</code><code> </code><code class="n">Then</code><code> </code><code class="n">you</code><code> </code><code class="n">will</code><code> </code><code class="n">notice</code><code> </code><code class="k">for</code><code>
</code><code>          </code><code class="n">sure</code><code> </code><code class="n">when</code><code> </code><code class="n">it</code><code> </code><code class="ow">is</code><code> </code><code class="n">out</code><code class="o">.</code></pre>
<div style="page-break-after: always;"/>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO9-1" href="#co_data_driven_finance_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Connects to the Twitter API</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO9-2" href="#co_data_driven_finance_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Retrieves and prints five (most recent) tweets from home timeline</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO9-3" href="#co_data_driven_finance_CO9-4"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Retrieves and prints five (most recent) tweets from user timeline</p></dd>
</dl>

<p>The Twitter API allows also for searches, based on which most recent tweets can be retrieved and processed:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">45</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">d</code><code> </code><code class="o">=</code><code> </code><code class="n">t</code><code class="o">.</code><code class="n">search</code><code class="o">.</code><code class="n">tweets</code><code class="p">(</code><code class="n">q</code><code class="o">=</code><code class="s1">'</code><code class="s1">#Python</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">count</code><code class="o">=</code><code class="mi">7</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO10-1" href="#callout_data_driven_finance_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">46</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">e</code><code> </code><code class="ow">in</code><code> </code><code class="n">d</code><code class="p">[</code><code class="s1">'</code><code class="s1">statuses</code><code class="s1">'</code><code class="p">]</code><code class="p">:</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="n">e</code><code class="p">[</code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO10-2" href="#callout_data_driven_finance_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">RT</code><code> </code><code class="nd">@KirkDBorne</code><code class="p">:</code><code> </code><code class="c1">#AI is Reshaping Programming — Tips on How to Stay on Top:</code><code>
</code><code>          </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">CFNu1i352C</code><code>
</code><code>         </code><code class="err">—</code><code class="err">—</code><code>
</code><code>         </code><code class="n">Courses</code><code class="p">:</code><code>
</code><code>         </code><code class="mi">1</code><code class="p">:</code><code> </code><code class="c1">#MachineLearning — Jupyte…</code><code>
</code><code>         </code><code class="n">RT</code><code> </code><code class="nd">@reuvenmlerner</code><code class="p">:</code><code> </code><code class="n">Today</code><code class="p">,</code><code> </code><code class="n">a</code><code> </code><code class="c1">#Python student's code didn't print:</code><code>
</code><code>
</code><code>         </code><code class="n">x</code><code> </code><code class="o">=</code><code> </code><code class="mi">5</code><code>
</code><code>         </code><code class="k">if</code><code> </code><code class="n">x</code><code> </code><code class="o">==</code><code> </code><code class="mi">5</code><code class="p">:</code><code>
</code><code>             </code><code class="k">print</code><code class="p">:</code><code> </code><code class="p">(</code><code class="s1">'</code><code class="s1">yes!</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>
</code><code>         </code><code class="n">There</code><code> </code><code class="n">was</code><code> </code><code class="n">a</code><code> </code><code class="n">typo</code><code class="p">,</code><code> </code><code class="n">namely</code><code> </code><code class="p">:</code><code> </code><code class="n">after</code><code> </code><code class="n">pr</code><code class="err">…</code><code>
</code><code>         </code><code class="n">RT</code><code> </code><code class="nd">@GavLaaaaaaaa</code><code class="p">:</code><code> </code><code class="n">Javascript</code><code> </code><code class="n">Does</code><code> </code><code class="n">Not</code><code> </code><code class="n">Need</code><code> </code><code class="n">a</code><code> </code><code class="n">StringBuilder</code><code>
</code><code>          </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">aS7NzHLO65</code><code> </code><code class="c1">#programming #softwareengineering #bigdata</code><code>
</code><code>          </code><code class="c1">#datascience…</code><code>
</code><code>         </code><code class="n">RT</code><code> </code><code class="nd">@CodeFlawCo</code><code class="p">:</code><code> </code><code class="n">It</code><code> </code><code class="ow">is</code><code> </code><code class="n">necessary</code><code> </code><code class="n">to</code><code> </code><code class="n">publish</code><code> </code><code class="n">regular</code><code> </code><code class="n">updates</code><code> </code><code class="n">on</code><code> </code><code class="n">Twitter</code><code>
</code><code>          </code><code class="c1">#programmer #coder #developer #technology RT @pak_aims: Learning to C…</code><code>
</code><code>         </code><code class="n">RT</code><code> </code><code class="nd">@GavLaaaaaaaa</code><code class="p">:</code><code> </code><code class="n">Javascript</code><code> </code><code class="n">Does</code><code> </code><code class="n">Not</code><code> </code><code class="n">Need</code><code> </code><code class="n">a</code><code> </code><code class="n">StringBuilder</code><code>
</code><code>          </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">aS7NzHLO65</code><code> </code><code class="c1">#programming #softwareengineering #bigdata</code><code>
</code><code>          </code><code class="c1">#datascience…</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO10-1" href="#co_data_driven_finance_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Searches for tweets with hashtag “Python” and prints the five most recent ones</p></dd>
</dl>

<p>One can also collect a larger number of tweets from a Twitter user and create a summary in the form of a word cloud (see <a data-type="xref" href="#figure_ddf_wc">Figure 4-3</a>). The following Python code again makes use of the NLP helper functions as shown in <a data-type="xref" href="#nlp_functions">“Python Code”</a>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">47</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">l</code><code> </code><code class="o">=</code><code> </code><code class="n">t</code><code class="o">.</code><code class="n">statuses</code><code class="o">.</code><code class="n">user_timeline</code><code class="p">(</code><code class="n">screen_name</code><code class="o">=</code><code class="s1">'</code><code class="s1">elonmusk</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">count</code><code class="o">=</code><code class="mi">50</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO11-1" href="#callout_data_driven_finance_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">tl</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">e</code><code class="p">[</code><code class="s1">'</code><code class="s1">text</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="k">for</code><code> </code><code class="n">e</code><code> </code><code class="ow">in</code><code> </code><code class="n">l</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO11-2" href="#callout_data_driven_finance_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">tl</code><code class="p">[</code><code class="p">:</code><code class="mi">5</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO11-3" href="#callout_data_driven_finance_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">@flcnhvy @Lindw0rm @cleantechnica True</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>          </code><code class="s1">'</code><code class="s1">@Lindw0rm @cleantechnica Highly likely down the road</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>          </code><code class="s1">'</code><code class="s1">@cleantechnica True fact</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>         </code><code class="s1">'</code><code class="s1">@NASASpaceflight Scrubbed for the day. A Raptor turbopump spin start valve</code><code>
</code><code>          </code><code class="n">didn</code><code class="err">’</code><code class="n">t</code><code> </code><code class="nb">open</code><code class="p">,</code><code> </code><code class="n">triggering</code><code> </code><code class="n">an</code><code> </code><code class="n">automatic</code><code> </code><code class="n">abo</code><code class="err">…</code><code> </code><code class="n">https</code><code class="p">:</code><code class="o">/</code><code class="o">/</code><code class="n">t</code><code class="o">.</code><code class="n">co</code><code class="o">/</code><code class="n">QDdlNXFgJg</code><code class="s1">'</code><code class="s1">,</code><code>
</code><code>          </code><code class="s1">'</code><code class="s1">@Erdayastronaut I’m in the Boca control room. Hop attempt in ~33 minutes.</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">50</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">wc</code><code> </code><code class="o">=</code><code> </code><code class="n">nlp</code><code class="o">.</code><code class="n">generate_word_cloud</code><code class="p">(</code><code class="s1">'</code><code class="s1"> </code><code class="s1">'</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">tl</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">35</code><code class="p">,</code><code>
</code><code>                     </code><code class="n">name</code><code class="o">=</code><code class="s1">'</code><code class="s1">../../images/ch04/musk_twitter_wc.png</code><code class="s1">'</code><code>
</code><code>                     </code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO11-4" href="#callout_data_driven_finance_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO11-1" href="#co_data_driven_finance_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves the 50 most recent tweets for the user <code>elonmusk</code></p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO11-2" href="#co_data_driven_finance_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Collects the texts in a <code>list</code> object</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO11-3" href="#co_data_driven_finance_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Shows excerpts for the final five tweets</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO11-4" href="#co_data_driven_finance_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Generates a word cloud summary and shows it</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_wc" class="figure">
<img src="Images/aiif_0403.png" alt="aiif 0403" width="994" height="735"/>
<h6><span class="label">Figure 4-3. </span>Word cloud as summary for larger number of tweets</h6>
</div></figure>

<p>Once a financial practitioner defines the “relevant financial data” to go beyond structured financial time series data, the data sources seem limitless in terms of volume, variety, and velocity. The way the tweets are retrieved from the Twitter API is almost in near time since the most recent tweets are accessed in the examples. These and similar API-based data sources therefore provide a never-ending stream of alternative data for which, as previously pointed out, it is important to specify exactly what one is looking for. Otherwise, any financial data science effort might easily drown in too much data and/or too noisy data.<a data-type="indexterm" data-primary="" data-startref="ix_data-driven_fin_data_avail" id="idm45625323819192"/><a data-type="indexterm" data-primary="" data-startref="ix_alt_data_sources" id="idm45625323818200"/><a data-type="indexterm" data-primary="" data-startref="ix_twitter_api" id="idm45625323817256"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Normative Theories Revisited"><div class="sect1" id="norm_theories_revisited">
<h1>Normative Theories Revisited</h1>

<p><a data-type="xref" href="ch03.xhtml#normative_finance">Chapter 3</a> introduces normative financial theories such as the MVP theory or the CAPM. <a data-type="indexterm" data-primary="data-driven finance" data-secondary="normative theories and" id="ix_data-driven_fin_norm_th"/>For quite a long time, students and academics learning and studying such theories were more or less constrained to the theory itself. With all the available financial data, as discussed and illustrated in the previous section, in combination with powerful open source software for data analysis—such as Python, <code>NumPy</code>, <code>pandas</code>, and so on—it has become pretty easy and straightforward to put financial theories to real-world tests. It does not require small teams and larger studies anymore to do so. A typical notebook, internet access, and a standard Python environment suffice. This is what this section is about. However, before diving into data-driven finance, the following sub-section discusses briefly some famous paradoxes in the context of EUT and how corporations model and predict the behavior of individuals in practice.</p>








<section data-type="sect2" data-pdf-bookmark="Expected Utility and Reality"><div class="sect2" id="idm45625323156040">
<h2>Expected Utility and Reality</h2>

<p><a data-type="indexterm" data-primary="EUT (expected utility theory)" data-secondary="in data-driven finance" data-secondary-sortas="data-driven finance" id="ix_EUT_data-driven_fin"/><a data-type="indexterm" data-primary="EUT (expected utility theory)" data-secondary="risk measures and" id="idm45625323152456"/><a data-type="indexterm" data-primary="uncertainty and risk" data-secondary="expected utility theory" id="idm45625323151496"/>In economics, <em>risk</em> describes a situation in which possible future states and probabilities for those states to unfold are known in advance to the decision maker. This is the standard assumption in finance and the context of EUT. <a data-type="indexterm" data-primary="ambiguity in decision making" id="idm45625323149784"/>On the other hand, <em>ambiguity</em> describes situations in economics in which probabilities, or even possible future states, are not known in advance to a decision maker. <em>Uncertainty</em> subsumes the two different decision-making situations.</p>

<p>There is a long tradition of analyzing the concrete decision-making behavior of individuals (“agents”) under uncertainty. Innumerable studies and experiments have been conducted to observe and analyze how agents behave when faced with uncertainty as compared to what theories such as EUT predict. For centuries, <em>paradoxa</em> have played an important role in decision-making theory and research.</p>

<p><a data-type="indexterm" data-primary="paradoxa, in decision-making theory" id="ix_paradoxa_decision"/><a data-type="indexterm" data-primary="St. Petersburg paradox" id="ix_stpetersburg_paradox"/>One such paradox, the <em>St. Petersburg paradox</em>, gave rise to the invention of utility functions and EUT in the first place. <a data-type="indexterm" data-primary="Bernoulli, Daniel" id="idm45625318608344"/>Daniel Bernoulli presented the paradox—and a solution to it—in 1738. The paradox is based on the following coin tossing game <math alttext="upper G">
  <mi>G</mi>
</math>. An agent is faced with a game during which a (perfect) coin is tossed potentially infinitely many times. If after the first toss heads prevails, the agent receives a payoff of 1 (currency unit). As long as heads is observed, the coin is tossed again. Otherwise the game ends. If heads prevails a second time, the agent receives an additional payoff of 2. If it does a third time, the additional payoff is 4. For the fourth time it is 8, and so on. This is a situation of risk since all possible future states, as well as their associated probabilities, are known in advance.</p>

<p>The expected payoff of this game is <em>infinite</em>. This can be seen from the following infinite sum of which every element is strictly positive:</p>
<div data-type="equation">
<math alttext="bold upper E left-parenthesis upper G right-parenthesis equals one-half dot 1 plus one-fourth dot 2 plus one-eighth dot 4 plus one-sixteenth dot 8 plus ellipsis equals sigma-summation Underscript k equals 1 Overscript normal infinity Endscripts StartFraction 1 Over 2 Superscript k Baseline EndFraction 2 Superscript k minus 1 Baseline equals sigma-summation Underscript k equals 1 Overscript normal infinity Endscripts one-half equals normal infinity" display="block">
  <mrow>
    <mi>𝐄</mi>
    <mrow>
      <mo>(</mo>
      <mi>G</mi>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <mfrac><mn>1</mn> <mn>2</mn></mfrac>
    <mo>·</mo>
    <mn>1</mn>
    <mo>+</mo>
    <mfrac><mn>1</mn> <mn>4</mn></mfrac>
    <mo>·</mo>
    <mn>2</mn>
    <mo>+</mo>
    <mfrac><mn>1</mn> <mn>8</mn></mfrac>
    <mo>·</mo>
    <mn>4</mn>
    <mo>+</mo>
    <mfrac><mn>1</mn> <mn>16</mn></mfrac>
    <mo>·</mo>
    <mn>8</mn>
    <mo>+</mo>
    <mo>...</mo>
    <mo>=</mo>
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>∞</mi> </munderover>
    <mfrac><mn>1</mn> <msup><mn>2</mn> <mi>k</mi> </msup></mfrac>
    <msup><mn>2</mn> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow> </msup>
    <mo>=</mo>
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>∞</mi> </munderover>
    <mfrac><mn>1</mn> <mn>2</mn></mfrac>
    <mo>=</mo>
    <mi>∞</mi>
  </mrow>
</math>
</div>

<p>However, faced with such a game, a decision maker in general would be willing to pay a <em>finite</em> sum only to play the game. A major reason for this is the fact that relatively large payoffs only happen with a relatively small probability. Consider the potential payoff <math alttext="upper W equals 511">
  <mrow>
    <mi>W</mi>
    <mo>=</mo>
    <mn>511</mn>
  </mrow>
</math>:</p>
<div data-type="equation">
<math alttext="upper W equals 1 plus 2 plus 4 plus 8 plus 16 plus 32 plus 64 plus 128 plus 256 equals 511" display="block">
  <mrow>
    <mi>W</mi>
    <mo>=</mo>
    <mn>1</mn>
    <mo>+</mo>
    <mn>2</mn>
    <mo>+</mo>
    <mn>4</mn>
    <mo>+</mo>
    <mn>8</mn>
    <mo>+</mo>
    <mn>16</mn>
    <mo>+</mo>
    <mn>32</mn>
    <mo>+</mo>
    <mn>64</mn>
    <mo>+</mo>
    <mn>128</mn>
    <mo>+</mo>
    <mn>256</mn>
    <mo>=</mo>
    <mn>511</mn>
  </mrow>
</math>
</div>

<p>The probability of winning such a payoff is pretty low. To be exact, it is only <math alttext="upper P left-parenthesis x equals upper W right-parenthesis equals StartFraction 1 Over 512 EndFraction equals">
  <mrow>
    <mi>P</mi>
    <mrow>
      <mo>(</mo>
      <mi>x</mi>
      <mo>=</mo>
      <mi>W</mi>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <mfrac><mn>1</mn> <mn>512</mn></mfrac>
    <mo>=</mo>
  </mrow>
</math> 0.001953125. The probability for such a payoff or a smaller one, on the other hand, is pretty high:</p>
<div data-type="equation">
<math alttext="upper P left-parenthesis x less-than-or-equal-to upper W right-parenthesis equals sigma-summation Underscript k equals 1 Overscript 9 Endscripts StartFraction 1 Over 2 Superscript k Baseline EndFraction equals 0.998046875" display="block">
  <mrow>
    <mi>P</mi>
    <mrow>
      <mo>(</mo>
      <mi>x</mi>
      <mo>≤</mo>
      <mi>W</mi>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mn>9</mn> </munderover>
    <mfrac><mn>1</mn> <msup><mn>2</mn> <mi>k</mi> </msup></mfrac>
    <mo>=</mo>
    <mn>0</mn>
    <mo>.</mo>
    <mn>998046875</mn>
  </mrow>
</math>
</div>

<p><a data-type="indexterm" data-primary="positive but decreasing marginal utility" id="idm45625316222136"/>In other words, in 998 out of 1,000 games the payoff is 511 or smaller. Therefore, an agent would probably not wager much more than 511 to play this game. The way out of this paradox is the introduction of a utility function with <em>positive but decreasing marginal utility</em>. In the context of the St. Petersburg paradox, this means that there is a function <math alttext="u colon double-struck upper R Subscript plus Baseline right-arrow double-struck upper R">
  <mrow>
    <mi>u</mi>
    <mo>:</mo>
    <msub><mi>ℝ</mi> <mo>+</mo> </msub>
    <mo>→</mo>
    <mi>ℝ</mi>
  </mrow>
</math> that assigns to every positive payoff <math alttext="x">
  <mi>x</mi>
</math> a real value <math alttext="u left-parenthesis x right-parenthesis">
  <mrow>
    <mi>u</mi>
    <mo>(</mo>
    <mi>x</mi>
    <mo>)</mo>
  </mrow>
</math>. Positive but decreasing marginal utility then formally translates into the following:</p>
<div data-type="equation">
<math alttext="StartLayout 1st Row 1st Column StartFraction normal partial-differential u Over normal partial-differential x EndFraction 2nd Column greater-than 3rd Column 0 2nd Row 1st Column StartFraction normal partial-differential squared u Over normal partial-differential x squared EndFraction 2nd Column less-than 3rd Column 0 EndLayout" display="block">
  <mtable>
    <mtr>
      <mtd>
        <mfrac><mrow><mi>∂</mi><mi>u</mi></mrow> <mrow><mi>∂</mi><mi>x</mi></mrow></mfrac>
      </mtd>
      <mtd>
        <mo>&gt;</mo>
      </mtd>
      <mtd>
        <mn>0</mn>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mfrac><mrow><msup><mi>∂</mi> <mn>2</mn> </msup><mi>u</mi></mrow> <mrow><mi>∂</mi><msup><mi>x</mi> <mn>2</mn> </msup></mrow></mfrac>
      </mtd>
      <mtd>
        <mo>&lt;</mo>
      </mtd>
      <mtd>
        <mn>0</mn>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<p>As seen in <a data-type="xref" href="ch03.xhtml#normative_finance">Chapter 3</a>, one such candidate function is <math alttext="u left-parenthesis x right-parenthesis equals ln left-parenthesis x right-parenthesis">
  <mrow>
    <mi>u</mi>
    <mo>(</mo>
    <mi>x</mi>
    <mo>)</mo>
    <mo>=</mo>
    <mo form="prefix">ln</mo>
    <mo>(</mo>
    <mi>x</mi>
    <mo>)</mo>
  </mrow>
</math> with:</p>
<div data-type="equation">
<math alttext="StartLayout 1st Row 1st Column StartFraction normal partial-differential u Over normal partial-differential x EndFraction 2nd Column equals 3rd Column StartFraction 1 Over x EndFraction 2nd Row 1st Column StartFraction normal partial-differential squared u Over normal partial-differential x squared EndFraction 2nd Column equals 3rd Column minus StartFraction 1 Over x squared EndFraction EndLayout" display="block">
  <mtable>
    <mtr>
      <mtd>
        <mfrac><mrow><mi>∂</mi><mi>u</mi></mrow> <mrow><mi>∂</mi><mi>x</mi></mrow></mfrac>
      </mtd>
      <mtd>
        <mo>=</mo>
      </mtd>
      <mtd>
        <mfrac><mn>1</mn> <mi>x</mi></mfrac>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mfrac><mrow><msup><mi>∂</mi> <mn>2</mn> </msup><mi>u</mi></mrow> <mrow><mi>∂</mi><msup><mi>x</mi> <mn>2</mn> </msup></mrow></mfrac>
      </mtd>
      <mtd>
        <mo>=</mo>
      </mtd>
      <mtd>
        <mrow>
          <mo>-</mo>
          <mfrac><mn>1</mn> <msup><mi>x</mi> <mn>2</mn> </msup></mfrac>
        </mrow>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<p>The expected utility then is <em>finite</em>, as the calculation of the following infinite sum illustrates:</p>
<div data-type="equation">
<math alttext="bold upper E left-parenthesis u left-parenthesis upper G right-parenthesis right-parenthesis equals sigma-summation Underscript k equals 1 Overscript normal infinity Endscripts StartFraction 1 Over 2 Superscript k Baseline EndFraction u left-parenthesis 2 Superscript k minus 1 Baseline right-parenthesis equals sigma-summation Underscript k equals 1 Overscript normal infinity Endscripts StartFraction ln left-parenthesis 2 Superscript k minus 1 Baseline right-parenthesis Over 2 Superscript k Baseline EndFraction equals left-parenthesis sigma-summation Underscript k equals 1 Overscript normal infinity Endscripts StartFraction left-parenthesis k minus 1 right-parenthesis Over 2 Superscript k Baseline EndFraction right-parenthesis dot ln left-parenthesis 2 right-parenthesis equals ln left-parenthesis 2 right-parenthesis less-than normal infinity" display="block">
  <mrow>
    <mi>𝐄</mi>
    <mfenced separators="" open="(" close=")">
      <mi>u</mi>
      <mo>(</mo>
      <mi>G</mi>
      <mo>)</mo>
    </mfenced>
    <mo>=</mo>
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>∞</mi> </munderover>
    <mfrac><mn>1</mn> <msup><mn>2</mn> <mi>k</mi> </msup></mfrac>
    <mi>u</mi>
    <mfenced separators="" open="(" close=")">
      <msup><mn>2</mn> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow> </msup>
    </mfenced>
    <mo>=</mo>
    <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>∞</mi> </munderover>
    <mfrac><mrow><mo form="prefix">ln</mo><mfenced separators="" open="(" close=")"><msup><mn>2</mn> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow> </msup></mfenced></mrow> <msup><mn>2</mn> <mi>k</mi> </msup></mfrac>
    <mo>=</mo>
    <mfenced separators="" open="(" close=")">
      <munderover><mo>∑</mo> <mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow> <mi>∞</mi> </munderover>
      <mfrac><mrow><mo>(</mo><mi>k</mi><mo>-</mo><mn>1</mn><mo>)</mo></mrow> <msup><mn>2</mn> <mi>k</mi> </msup></mfrac>
    </mfenced>
    <mo>·</mo>
    <mo form="prefix">ln</mo>
    <mrow>
      <mo>(</mo>
      <mn>2</mn>
      <mo>)</mo>
    </mrow>
    <mo>=</mo>
    <mo form="prefix">ln</mo>
    <mrow>
      <mo>(</mo>
      <mn>2</mn>
      <mo>)</mo>
    </mrow>
    <mo>&lt;</mo>
    <mi>∞</mi>
  </mrow>
</math>
</div>

<p>The expected utility of <math alttext="ln left-parenthesis 2 right-parenthesis">
  <mrow>
    <mo form="prefix">ln</mo>
    <mo>(</mo>
    <mn>2</mn>
    <mo>)</mo>
  </mrow>
</math> = 0.693147 is obviously a pretty small number in comparison to the expected payoff of infinity. Bernoulli utility functions and EUT resolve the St. Petersburg paradox.<a data-type="indexterm" data-primary="" data-startref="ix_stpetersburg_paradox" id="idm45625320946616"/></p>

<p><a data-type="indexterm" data-primary="Allais paradox" id="ix_allais_parodox"/>Other paradoxa, such as the <em>Allais paradox</em> published in Allais (1953), address the EUT itself. This paradox is based on an experiment with four different games that test subjects should rank. <a data-type="xref" href="#ddf_allais_table">Table 4-2</a> shows the four games <math alttext="left-parenthesis upper A comma upper B comma upper A prime comma upper B prime right-parenthesis">
  <mrow>
    <mo>(</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>B</mi>
    <mo>,</mo>
    <msup><mi>A</mi> <mo>'</mo> </msup>
    <mo>,</mo>
    <msup><mi>B</mi> <mo>'</mo> </msup>
    <mo>)</mo>
  </mrow>
</math>. The ranking is to be done for the two pairs <math alttext="left-parenthesis upper A comma upper B right-parenthesis">
  <mrow>
    <mo>(</mo>
    <mi>A</mi>
    <mo>,</mo>
    <mi>B</mi>
    <mo>)</mo>
  </mrow>
</math> and <math alttext="left-parenthesis upper A prime comma upper B prime right-parenthesis">
  <mrow>
    <mo>(</mo>
    <msup><mi>A</mi> <mo>'</mo> </msup>
    <mo>,</mo>
    <msup><mi>B</mi> <mo>'</mo> </msup>
    <mo>)</mo>
  </mrow>
</math>. <a data-type="indexterm" data-primary="axioms, in finance" id="idm45625315970776"/><a data-type="indexterm" data-primary="independence axiom" id="idm45625315970040"/>The <em>independence axiom</em> postulates that the first row in the table should not have any influence on the ordering of <math alttext="left-parenthesis upper A prime comma upper B prime right-parenthesis">
  <mrow>
    <mo>(</mo>
    <msup><mi>A</mi> <mo>'</mo> </msup>
    <mo>,</mo>
    <msup><mi>B</mi> <mo>'</mo> </msup>
    <mo>)</mo>
  </mrow>
</math> since the payoff is the same for both games.</p>
<table id="ddf_allais_table">
<caption><span class="label">Table 4-2. </span>Games in Allais paradox</caption>
<thead>
<tr>
<th>Probability</th>
<th>Game A</th>
<th>Game B</th>
<th>Game A’</th>
<th>Game B’</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>0.66</p></td>
<td><p>2,400</p></td>
<td><p>2,400</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr>
<td><p>0.33</p></td>
<td><p>2,500</p></td>
<td><p>2,400</p></td>
<td><p>2,500</p></td>
<td><p>2,400</p></td>
</tr>
<tr>
<td><p>0.01</p></td>
<td><p>0</p></td>
<td><p>2,400</p></td>
<td><p>0</p></td>
<td><p>2,400</p></td>
</tr>
</tbody>
</table>

<p>In experiments, the majority of decision makers rank the games as follows: <math alttext="upper B succeeds upper A">
  <mrow>
    <mi>B</mi>
    <mo>≻</mo>
    <mi>A</mi>
  </mrow>
</math> and <math alttext="upper A prime upper B prime">
  <mrow>
    <mi>A</mi>
    <mo>'</mo>
    <mo>≻</mo>
    <msup><mi>B</mi> <mo>'</mo> </msup>
  </mrow>
</math>. The ranking <math alttext="upper B succeeds upper A">
  <mrow>
    <mi>B</mi>
    <mo>≻</mo>
    <mi>A</mi>
  </mrow>
</math> leads to the following inequalities, where <math alttext="u 1 identical-to u left-parenthesis 2400 right-parenthesis comma u 2 identical-to u left-parenthesis 2500 right-parenthesis comma u 3 identical-to u left-parenthesis 0 right-parenthesis">
  <mrow>
    <msub><mi>u</mi> <mn>1</mn> </msub>
    <mo>≡</mo>
    <mi>u</mi>
    <mrow>
      <mo>(</mo>
      <mn>2400</mn>
      <mo>)</mo>
    </mrow>
    <mo>,</mo>
    <msub><mi>u</mi> <mn>2</mn> </msub>
    <mo>≡</mo>
    <mi>u</mi>
    <mrow>
      <mo>(</mo>
      <mn>2500</mn>
      <mo>)</mo>
    </mrow>
    <mo>,</mo>
    <msub><mi>u</mi> <mn>3</mn> </msub>
    <mo>≡</mo>
    <mi>u</mi>
    <mrow>
      <mo>(</mo>
      <mn>0</mn>
      <mo>)</mo>
    </mrow>
  </mrow>
</math>:</p>
<div data-type="equation">
<math alttext="StartLayout 1st Row 1st Column u 1 2nd Column greater-than 3rd Column 0.66 dot u 1 plus 0.33 dot u 2 plus 0.01 dot u 3 2nd Row 1st Column 0.34 dot u 1 2nd Column greater-than 3rd Column 0.33 dot u 2 plus 0.01 dot u 3 EndLayout" display="block">
  <mtable>
    <mtr>
      <mtd>
        <msub><mi>u</mi> <mn>1</mn> </msub>
      </mtd>
      <mtd>
        <mo>&gt;</mo>
      </mtd>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>66</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>1</mn> </msub>
          <mo>+</mo>
          <mn>0</mn>
          <mo>.</mo>
          <mn>33</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>2</mn> </msub>
          <mo>+</mo>
          <mn>0</mn>
          <mo>.</mo>
          <mn>01</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>3</mn> </msub>
        </mrow>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>34</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>1</mn> </msub>
        </mrow>
      </mtd>
      <mtd>
        <mo>&gt;</mo>
      </mtd>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>33</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>2</mn> </msub>
          <mo>+</mo>
          <mn>0</mn>
          <mo>.</mo>
          <mn>01</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>3</mn> </msub>
        </mrow>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<p>The ranking <math alttext="upper A prime upper B prime">
  <mrow>
    <mi>A</mi>
    <mo>'</mo>
    <mo>≻</mo>
    <msup><mi>B</mi> <mo>'</mo> </msup>
  </mrow>
</math> in turn leads to the following inequalities:</p>
<div data-type="equation">
<math alttext="StartLayout 1st Row 1st Column 0.33 dot u 2 plus 0.01 dot u 3 2nd Column greater-than 3rd Column 0.33 dot u 1 plus 0.01 dot u 1 2nd Row 1st Column 0.34 dot u 1 2nd Column less-than 3rd Column 0.33 dot u 2 plus 0.01 dot u 3 EndLayout" display="block">
  <mtable>
    <mtr>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>33</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>2</mn> </msub>
          <mo>+</mo>
          <mn>0</mn>
          <mo>.</mo>
          <mn>01</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>3</mn> </msub>
        </mrow>
      </mtd>
      <mtd>
        <mo>&gt;</mo>
      </mtd>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>33</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>1</mn> </msub>
          <mo>+</mo>
          <mn>0</mn>
          <mo>.</mo>
          <mn>01</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>1</mn> </msub>
        </mrow>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>34</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>1</mn> </msub>
        </mrow>
      </mtd>
      <mtd>
        <mo>&lt;</mo>
      </mtd>
      <mtd>
        <mrow>
          <mn>0</mn>
          <mo>.</mo>
          <mn>33</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>2</mn> </msub>
          <mo>+</mo>
          <mn>0</mn>
          <mo>.</mo>
          <mn>01</mn>
          <mo>·</mo>
          <msub><mi>u</mi> <mn>3</mn> </msub>
        </mrow>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<p>These inequalities obviously contradict each other and lead to the Allais paradox. One possible explanation is that decision makers in general value certainty higher than the typical models, such as EUT, predict. Most people would probably rather choose to receive $1 million with certainty than play a game in which they can win $100 million with a probability of 5%, although there are a number of suitable utility functions available that under EUT would have the decision maker choose the game instead of the certain amount.</p>

<p>Another explanation lies in <em>framing</em> decisions and the psychology of decision makers. It is well known that more people would accept a surgery if it has a “95% chance of success” than a “5% chance of death.” Simply changing the wording might lead to behavior that is inconsistent with decision-making theories such as EUT.<a data-type="indexterm" data-primary="" data-startref="ix_allais_parodox" id="idm45625320872712"/></p>

<p><a data-type="indexterm" data-primary="Ellsberg paradox" id="ix_ellsberg_paradox"/><a data-type="indexterm" data-primary="ambiguity in decision making" id="ix_ambiguity_decision"/>Another famous paradox addressing shortcomings of EUT in its subjective form, according to Savage (1954, 1972), is the <em>Ellsberg paradox</em>, which dates back to the seminal paper by Ellsberg (1961). It addresses the importance of ambiguity in many real-world decision situations. A standard setting for this paradox comprises two different urns, both of which contain exactly 100 balls. For urn 1, it is known that it contains exactly 50 black and 50 red balls. For urn 2, it is only known that it contains black and red balls but not in which proportion.</p>

<p>Test subjects can choose among the following game options:</p>

<ul>
<li>
<p>Game 1: red 1, black 1, or indifferent</p>
</li>
<li>
<p>Game 2: red 2, black 2, or indifferent</p>
</li>
<li>
<p>Game 3: red 1, red 2, or indifferent</p>
</li>
<li>
<p>Game 4: black 1, black 2, or indifferent</p>
</li>
</ul>

<p>Here, “red 1,” for example, means that a red ball is drawn from urn 1. Typically, a test subject would answer as follows:</p>

<ul>
<li>
<p>Game 1: indifferent</p>
</li>
<li>
<p>Game 2: indifferent</p>
</li>
<li>
<p>Game 3: red 1</p>
</li>
<li>
<p>Game 4: black 1</p>
</li>
</ul>

<p>This set of decisions—which is not the only one to be observed but is a common one—exemplifies what is called <em>ambiguity aversion</em>. Since the probabilities for black and red balls, respectively, are not known for urn 2, decision makers prefer a situation of <em>risk</em> instead of <em>ambiguity</em>.<a data-type="indexterm" data-primary="" data-startref="ix_ambiguity_decision" id="idm45625320857544"/><a data-type="indexterm" data-primary="" data-startref="ix_ellsberg_paradox" id="idm45625320856536"/></p>

<p><a data-type="indexterm" data-primary="Allais paradox" id="idm45625320855336"/>The two paradoxa of Allais and Ellsberg show that real test subjects quite often behave contrary to what well-established decision theories in economics predict. In other words, human beings as decision makers can in general not be compared to machines that carefully collect data and then crunch the numbers to make a decision under uncertainty, be it in the form of risk or ambiguity. Human behavior is more complex than most, if not all, theories currently suggest. How difficult and complex it can be to explain human behavior is clear after reading, for example, the 800-page book <em>Behave</em> by Sapolsky (2018). It covers multiple facets of this topic, ranging from biochemical processes to genetics, human evolution, tribes, language, religion, and more, in an integrative manner.<a data-type="indexterm" data-primary="" data-startref="ix_paradoxa_decision" id="idm45625320853304"/></p>

<p>If standard economic decision paradigms such as EUT do not explain real-world decision making too well, what alternatives are available? Economic experiments that build the basis for the Allais and Ellsberg paradoxa are a good starting point in learning how decision makers behave in specific, controlled situations. Such experiments and their sometimes surprising and paradoxical results have indeed motivated a great number of researchers to come up with alternative theories and models that resolve the paradoxa. <a data-type="indexterm" data-primary="Fontaine, Philippe" id="idm45625320851416"/>The book <em>The Experiment in the History of Economics</em> by Fontaine and Leonard (2005) is about the historical role of experiments in economics. There is, for example, a whole string of literature that addresses issues arising from the Ellsberg paradox. This literature deals with, among other topics, nonadditive probabilities, Choquet integrals, and decision heuristics such as <em>maximizing the minimum payoff</em> (“max-min”) or <em>minimizing the maximum loss</em> (“min-max”). These alternative approaches have proven superior to EUT, at least in certain decision-making scenarios. But they are far from being mainstream in finance.</p>

<p><a data-type="indexterm" data-primary="big data" id="idm45625320848488"/><a data-type="indexterm" data-primary="data" data-secondary="big data" id="idm45625320847624"/>What, after all, has proven to be useful in practice? Not too surprisingly, the answer lies in <em>data and machine learning algorithms</em>. <a data-type="indexterm" data-primary="revealed preferences" id="idm45625320846056"/><a data-type="indexterm" data-primary="internet, as source of data for decision making" id="idm45625320845352"/>The internet, with its billions of users, generates a treasure trove of data describing real-world human behavior, or what is sometimes called <em>revealed preferences</em>. The big data generated on the web has a scale that is multiple orders of magnitude larger than what single experiments can generate. <a data-type="indexterm" data-primary="ML (machine learning)" data-secondary="SL" id="idm45625320843896"/>Companies such as Amazon, Facebook, Google, and Twitter are able to make billions of dollars by recording user behavior (that is, their revealed preferences) and capitalizing on the insights generated by ML algorithms trained on this data.</p>

<p><a data-type="indexterm" data-primary="SL (supervised learning)" id="idm45625320842408"/>The default ML approach taken in this context is supervised learning. The algorithms themselves are in general <em>theory- and model-free</em>; variants of neural networks are often applied. Therefore, when companies today predict the behavior of their users or customers, more often than not a model-free ML algorithm is deployed. Traditional decision theories like EUT or one of its successors generally do not play a role at all. This makes it somewhat surprising that such theories still, at the beginning of the 2020s, are a cornerstone of most economic and financial theories applied in practice. And this is not even to mention the large number of financial textbooks that cover traditional decision theories in detail. If one of the most fundamental building blocks of financial theory seems to lack meaningful empirical support or practical benefits, what about the financial models that build on top of it? More on this appears in subsequent sections and chapters.<a data-type="indexterm" data-primary="" data-startref="ix_EUT_data-driven_fin" id="idm45625321287576"/></p>
<div data-type="important"><h1>Data-Driven Predictions of Behavior</h1>
<p><a data-type="indexterm" data-primary="prediction of economic behavior" data-secondary="data-driven (MVP theory)" id="ix_predict_MVP_theory"/>Standard economic decision theories are intellectually appealing to many, even to those who, faced with a concrete decision under uncertainty, would behave in contrast to the theories’ predictions. On the other hand, big data and model-free, supervised learning approaches prove useful and successful in practice for predicting user and customer behavior. In a financial context, this might imply that one should not really worry about why and how financial agents decide the way they decide. One should rather focus on their indirectly revealed preferences based on features data (new information) that describes the state of a financial market and labels data (outcomes) that reflects the impact of the decisions made by financial agents. This leads to a data-driven instead of a theory- or model-driven view of decision making in financial markets. Financial agents become data-processing organisms that can be much better modeled, for example, by complex neural networks than, say, a simple utility function in combination with an assumed probability distribution.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Mean-Variance Portfolio Theory"><div class="sect2" id="idm45625323155160">
<h2>Mean-Variance Portfolio Theory</h2>

<p><a data-type="indexterm" data-primary="portfolios" data-secondary="MVP theory" id="ix_portfolio_MVP_ch4"/><a data-type="indexterm" data-primary="normative financial theories and models" data-secondary="mean-variance portfolio theory" id="ix_norm_fin_MVP_ch4"/><a data-type="indexterm" data-primary="MVP (mean-variance portfolio) theory" data-secondary="in data-driven finance" data-secondary-sortas="data-driven finance" id="ix_MVP_theory_data-driven_fin"/>Assume a data-driven investor wants to apply MVP theory to invest in a portfolio of technology stocks and wants to add a gold-related exchange-traded fund (ETF) for diversification. Probably, the investor would access relevant historical price data via an API to a trading platform or a data provider. To make the following analysis reproducible, it relies on a CSV data file stored in a remote location. The following Python code retrieves the data file, selects a number of symbols given the investor’s goal, and calculates log returns from the price time series data. <a data-type="xref" href="#figure_ddf_01">Figure 4-4</a> compares the normalized price time series for the selected 
<span class="keep-together">symbols:</span></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">51</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>
</code><code>         </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">pylab</code><code> </code><code class="kn">import</code><code> </code><code class="n">plt</code><code class="p">,</code><code> </code><code class="n">mpl</code><code>
</code><code>         </code><code class="kn">from</code><code> </code><code class="nn">scipy.optimize</code><code> </code><code class="kn">import</code><code> </code><code class="n">minimize</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">savefig.dpi</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">300</code><code>
</code><code>         </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">font.family</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">serif</code><code class="s1">'</code><code>
</code><code>         </code><code class="n">np</code><code class="o">.</code><code class="n">set_printoptions</code><code class="p">(</code><code class="n">precision</code><code class="o">=</code><code class="mi">5</code><code class="p">,</code><code> </code><code class="n">suppress</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code>
</code><code>                            </code><code class="n">formatter</code><code class="o">=</code><code class="p">{</code><code class="s1">'</code><code class="s1">float</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="k">lambda</code><code> </code><code class="n">x</code><code class="p">:</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{x:6.3f}</code><code class="s1">'</code><code class="p">}</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">52</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">url</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">http://hilpisch.com/aiif_eikon_eod_data.csv</code><code class="s1">'</code><code>  </code><a class="co" id="co_data_driven_finance_CO12-1" href="#callout_data_driven_finance_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">53</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">raw</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="n">url</code><code class="p">,</code><code> </code><code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO12-2" href="#callout_data_driven_finance_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">54</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">raw</code><code class="o">.</code><code class="n">info</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO12-3" href="#callout_data_driven_finance_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="o">&lt;</code><code class="k">class</code><code> </code><code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'</code><code class="s1">&gt;</code><code>
</code><code>         </code><code class="n">DatetimeIndex</code><code class="p">:</code><code> </code><code class="mi">2516</code><code> </code><code class="n">entries</code><code class="p">,</code><code> </code><code class="mi">2010</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">04</code><code> </code><code class="n">to</code><code> </code><code class="mi">2019</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">31</code><code>
</code><code>         </code><code class="n">Data</code><code> </code><code class="n">columns</code><code> </code><code class="p">(</code><code class="n">total</code><code> </code><code class="mi">12</code><code> </code><code class="n">columns</code><code class="p">)</code><code class="p">:</code><code>
</code><code>          </code><code class="c1">#   Column  Non-Null Count  Dtype</code><code>
</code><code>         </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>  </code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code class="o">-</code><code>
</code><code>          </code><code class="mi">0</code><code>   </code><code class="n">AAPL</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">1</code><code>   </code><code class="n">MSFT</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">2</code><code>   </code><code class="n">INTC</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">3</code><code>   </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O</code><code>  </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">4</code><code>   </code><code class="n">GS</code><code class="o">.</code><code class="n">N</code><code>    </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">5</code><code>   </code><code class="n">SPY</code><code>     </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">6</code><code>   </code><code class="o">.</code><code class="n">SPX</code><code>    </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">7</code><code>   </code><code class="o">.</code><code class="n">VIX</code><code>    </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">8</code><code>   </code><code class="n">EUR</code><code class="o">=</code><code>    </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">9</code><code>   </code><code class="n">XAU</code><code class="o">=</code><code>    </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">10</code><code>  </code><code class="n">GDX</code><code>     </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>          </code><code class="mi">11</code><code>  </code><code class="n">GLD</code><code>     </code><code class="mi">2516</code><code> </code><code class="n">non</code><code class="o">-</code><code class="n">null</code><code>   </code><code class="n">float64</code><code>
</code><code>         </code><code class="n">dtypes</code><code class="p">:</code><code> </code><code class="n">float64</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code><code>
</code><code>         </code><code class="n">memory</code><code> </code><code class="n">usage</code><code class="p">:</code><code> </code><code class="mf">255.5</code><code> </code><code class="n">KB</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">55</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">symbols</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">AAPL.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">MSFT.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">INTC.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">AMZN.O</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">GLD</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO12-4" href="#callout_data_driven_finance_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">56</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">raw</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="n">raw</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO12-5" href="#callout_data_driven_finance_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">57</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="n">raw</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="n">raw</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>  </code><a class="co" id="co_data_driven_finance_CO12-6" href="#callout_data_driven_finance_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO12-1" href="#co_data_driven_finance_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves historical EOD data from a remote location</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO12-2" href="#co_data_driven_finance_CO12-4"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Specifies the symbols (<code>RICs</code>) to be invested in</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO12-3" href="#co_data_driven_finance_CO12-5"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Calculates the log returns for all time series</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO12-4" href="#co_data_driven_finance_CO12-6"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Plots the normalized financial time series for the selected symbols</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_01" class="figure">
<img src="Images/aiif_0404.png" alt="aiif 0404" width="2402" height="1394"/>
<h6><span class="label">Figure 4-4. </span>Normalized financial time series data</h6>
</div></figure>

<p>The data-driven investor wants to first set a baseline for performance as given by an equally weighted portfolio over the whole period of the available data. <a data-type="indexterm" data-primary="volatility" data-secondary="expected volatility in MVP theory" id="ix_volatility_MVP"/>To this end, the following Python code defines functions to calculate the portfolio return, the portfolio volatility, and the portfolio Sharpe ratio given a set of weights for the selected symbols:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">58</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">weights</code><code> </code><code class="o">=</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">rets</code><code class="o">.</code><code class="n">columns</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="p">[</code><code class="mi">1</code><code> </code><code class="o">/</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">rets</code><code class="o">.</code><code class="n">columns</code><code class="p">)</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-1" href="#callout_data_driven_finance_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">59</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">port_return</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">rets</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-2" href="#callout_data_driven_finance_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">60</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">port_return</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-3" href="#callout_data_driven_finance_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">60</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.15694764653018106</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">61</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">port_volatility</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">weights</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">rets</code><code class="o">.</code><code class="n">cov</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code> </code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">)</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mf">0.5</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-4" href="#callout_data_driven_finance_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">62</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">port_volatility</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-5" href="#callout_data_driven_finance_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">62</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.16106507848480675</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">63</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">port_sharpe</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">port_return</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">port_volatility</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-6" href="#callout_data_driven_finance_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">64</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">port_sharpe</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO13-7" href="#callout_data_driven_finance_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">64</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.97443622172255</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO13-1" href="#co_data_driven_finance_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Equally weighted portfolio</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO13-2" href="#co_data_driven_finance_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Portfolio return</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO13-3" href="#co_data_driven_finance_CO13-4"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Portfolio volatility</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO13-4" href="#co_data_driven_finance_CO13-6"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Portfolio Sharpe ratio (with zero short rate)</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="Sharpe ratio" id="ix_sharpe_ratio_ch4"/>The investor also wants to analyze which combinations of portfolio risk and return—and consequently Sharpe ratio—are roughly possible by applying Monte Carlo simulation to randomize the portfolio weights. Short sales are excluded, and the portfolio weights are assumed to add up to 100%. The following Python code implements the simulation and visualizes the results (see <a data-type="xref" href="#figure_ddf_02">Figure 4-5</a>):</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">65</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">w</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">random</code><code class="p">(</code><code class="p">(</code><code class="mi">1000</code><code class="p">,</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">symbols</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO14-1" href="#callout_data_driven_finance_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">w</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">w</code><code class="o">.</code><code class="n">T</code><code> </code><code class="o">/</code><code> </code><code class="n">w</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code class="o">.</code><code class="n">T</code><code>  </code><a class="co" id="co_data_driven_finance_CO14-2" href="#callout_data_driven_finance_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">66</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">w</code><code class="p">[</code><code class="p">:</code><code class="mi">5</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO14-3" href="#callout_data_driven_finance_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">66</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code> </code><code class="mf">0.184</code><code class="p">,</code><code>  </code><code class="mf">0.157</code><code class="p">,</code><code>  </code><code class="mf">0.227</code><code class="p">,</code><code>  </code><code class="mf">0.353</code><code class="p">,</code><code>  </code><code class="mf">0.079</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                </code><code class="p">[</code><code> </code><code class="mf">0.207</code><code class="p">,</code><code>  </code><code class="mf">0.282</code><code class="p">,</code><code>  </code><code class="mf">0.258</code><code class="p">,</code><code>  </code><code class="mf">0.023</code><code class="p">,</code><code>  </code><code class="mf">0.230</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                </code><code class="p">[</code><code> </code><code class="mf">0.313</code><code class="p">,</code><code>  </code><code class="mf">0.284</code><code class="p">,</code><code>  </code><code class="mf">0.051</code><code class="p">,</code><code>  </code><code class="mf">0.340</code><code class="p">,</code><code>  </code><code class="mf">0.012</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                </code><code class="p">[</code><code> </code><code class="mf">0.238</code><code class="p">,</code><code>  </code><code class="mf">0.181</code><code class="p">,</code><code>  </code><code class="mf">0.145</code><code class="p">,</code><code>  </code><code class="mf">0.191</code><code class="p">,</code><code>  </code><code class="mf">0.245</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                </code><code class="p">[</code><code> </code><code class="mf">0.246</code><code class="p">,</code><code>  </code><code class="mf">0.256</code><code class="p">,</code><code>  </code><code class="mf">0.315</code><code class="p">,</code><code>  </code><code class="mf">0.181</code><code class="p">,</code><code>  </code><code class="mf">0.002</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">67</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">pvr</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">(</code><code class="n">port_volatility</code><code class="p">(</code><code class="n">rets</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                 </code><code class="n">port_return</code><code class="p">(</code><code class="n">rets</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">)</code><code>
</code><code>                </code><code class="k">for</code><code> </code><code class="n">weights</code><code> </code><code class="ow">in</code><code> </code><code class="n">w</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO14-4" href="#callout_data_driven_finance_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">pvr</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">pvr</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO14-5" href="#callout_data_driven_finance_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">68</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">psr</code><code> </code><code class="o">=</code><code> </code><code class="n">pvr</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="n">pvr</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO14-6" href="#callout_data_driven_finance_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">69</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">fig</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">pvr</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">pvr</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                           </code><code class="n">c</code><code class="o">=</code><code class="n">psr</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="s1">'</code><code class="s1">coolwarm</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">cb</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">colorbar</code><code class="p">(</code><code class="n">fig</code><code class="p">)</code><code>
</code><code>         </code><code class="n">cb</code><code class="o">.</code><code class="n">set_label</code><code class="p">(</code><code class="s1">'</code><code class="s1">Sharpe ratio</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">expected volatility</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">expected return</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1"> | </code><code class="s1">'</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">symbols</code><code class="p">)</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO14-1" href="#co_data_driven_finance_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Simulates portfolio weights adding up to 100%</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO14-2" href="#co_data_driven_finance_CO14-4"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Derives the resulting portfolio volatilities and returns</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO14-3" href="#co_data_driven_finance_CO14-6"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Calculates the resulting Sharpe ratios</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_02" class="figure">
<img src="Images/aiif_0405.png" alt="aiif 0405" width="2412" height="1556"/>
<h6><span class="label">Figure 4-5. </span>Simulated portfolio volatilities, returns, and Sharpe ratios</h6>
</div></figure>

<p>The data-driven investor now wants to backtest the performance of a portfolio that was set up at the beginning of 2011. The optimal portfolio composition was derived from the financial time series data available from 2010. At the beginning of 2012, the portfolio composition was adjusted given the available data from 2011, and so on. To this end, the following Python code derives the <em>portfolio weights</em> for every relevant year that <em>maximizes the Sharpe ratio</em>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">70</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">bnds</code><code> </code><code class="o">=</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">symbols</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="p">[</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-1" href="#callout_data_driven_finance_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>         </code><code class="n">bnds</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-2" href="#callout_data_driven_finance_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">70</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">,</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">]</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">71</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">cons</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="s1">'</code><code class="s1">type</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">eq</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">fun</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="k">lambda</code><code> </code><code class="n">weights</code><code class="p">:</code><code> </code><code class="n">weights</code><code class="o">.</code><code class="n">sum</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="p">}</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-3" href="#callout_data_driven_finance_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">72</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">opt_weights</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">year</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code><code> </code><code class="mi">2019</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-12-31</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-4" href="#callout_data_driven_finance_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">ow</code><code> </code><code class="o">=</code><code> </code><code class="n">minimize</code><code class="p">(</code><code class="k">lambda</code><code> </code><code class="n">weights</code><code class="p">:</code><code> </code><code class="o">-</code><code class="n">port_sharpe</code><code class="p">(</code><code class="n">rets_</code><code class="p">,</code><code> </code><code class="n">weights</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                           </code><code class="nb">len</code><code class="p">(</code><code class="n">symbols</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="p">[</code><code class="mi">1</code><code> </code><code class="o">/</code><code> </code><code class="nb">len</code><code class="p">(</code><code class="n">symbols</code><code class="p">)</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                           </code><code class="n">bounds</code><code class="o">=</code><code class="n">bnds</code><code class="p">,</code><code>
</code><code>                           </code><code class="n">constraints</code><code class="o">=</code><code class="n">cons</code><code class="p">)</code><code class="p">[</code><code class="s1">'</code><code class="s1">x</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-5" href="#callout_data_driven_finance_CO15-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">opt_weights</code><code class="p">[</code><code class="n">year</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">ow</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-6" href="#callout_data_driven_finance_CO15-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">73</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">opt_weights</code><code>  </code><a class="co" id="co_data_driven_finance_CO15-7" href="#callout_data_driven_finance_CO15-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">73</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">{</code><code class="mi">2010</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.366</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.056</code><code class="p">,</code><code>  </code><code class="mf">0.578</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2011</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.543</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.077</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.380</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2012</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.324</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.471</code><code class="p">,</code><code>  </code><code class="mf">0.205</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2013</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.012</code><code class="p">,</code><code>  </code><code class="mf">0.305</code><code class="p">,</code><code>  </code><code class="mf">0.219</code><code class="p">,</code><code>  </code><code class="mf">0.464</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2014</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.452</code><code class="p">,</code><code>  </code><code class="mf">0.115</code><code class="p">,</code><code>  </code><code class="mf">0.419</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.015</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2015</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">1.000</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2016</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.150</code><code class="p">,</code><code>  </code><code class="mf">0.260</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.058</code><code class="p">,</code><code>  </code><code class="mf">0.533</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2017</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.231</code><code class="p">,</code><code>  </code><code class="mf">0.203</code><code class="p">,</code><code>  </code><code class="mf">0.031</code><code class="p">,</code><code>  </code><code class="mf">0.109</code><code class="p">,</code><code>  </code><code class="mf">0.426</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>          </code><code class="mi">2018</code><code class="p">:</code><code> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code> </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.295</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">,</code><code>  </code><code class="mf">0.705</code><code class="p">,</code><code>  </code><code class="mf">0.000</code><code class="p">]</code><code class="p">)</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO15-1" href="#co_data_driven_finance_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Specifies the bounds for the single asset weights</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO15-2" href="#co_data_driven_finance_CO15-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Specifies that all weights need to add up to 100%</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO15-3" href="#co_data_driven_finance_CO15-4"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Selects the relevant data set for the given year</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO15-4" href="#co_data_driven_finance_CO15-5"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Derives the portfolio weights that maximize the Sharpe ratio</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO15-5" href="#co_data_driven_finance_CO15-6"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Stores these weights in a <code>dict</code> object<a data-type="indexterm" data-primary="" data-startref="ix_sharpe_ratio_ch4" id="idm45625317964568"/></p></dd>
</dl>

<p>The optimal portfolio compositions as derived for the relevant years illustrate that MVP theory in its original form quite often leads to (relative) extreme situations in the sense that one or more assets are not included at all or that even a single asset makes up 100% of the portfolio. Of course, this can be actively avoided by setting, for example, a minimum weight for every asset considered. The results also indicate that this approach leads to significant rebalancings in the portfolio, driven by the previous year’s realized statistics and correlations.</p>

<p>To complete the backtest, the following code compares the expected portfolio statistics (from the optimal composition of the previous year applied to the previous year’s data) with the realized portfolio statistics for the current year (from the optimal composition from the previous year applied to the current year’s data):</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">74</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">)</code><code>
</code><code>         </code><code class="k">for</code><code> </code><code class="n">year</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code><code> </code><code class="mi">2019</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-12-31</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>             </code><code class="n">epv</code><code> </code><code class="o">=</code><code> </code><code class="n">port_volatility</code><code class="p">(</code><code class="n">rets_</code><code class="p">,</code><code> </code><code class="n">opt_weights</code><code class="p">[</code><code class="n">year</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO16-1" href="#callout_data_driven_finance_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">epr</code><code> </code><code class="o">=</code><code> </code><code class="n">port_return</code><code class="p">(</code><code class="n">rets_</code><code class="p">,</code><code> </code><code class="n">opt_weights</code><code class="p">[</code><code class="n">year</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO16-2" href="#callout_data_driven_finance_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">esr</code><code> </code><code class="o">=</code><code> </code><code class="n">epr</code><code> </code><code class="o">/</code><code> </code><code class="n">epv</code><code>  </code><a class="co" id="co_data_driven_finance_CO16-3" href="#callout_data_driven_finance_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="p">[</code><code class="n">symbols</code><code class="p">]</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year + 1}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year + 1}-12-31</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>             </code><code class="n">rpv</code><code> </code><code class="o">=</code><code> </code><code class="n">port_volatility</code><code class="p">(</code><code class="n">rets_</code><code class="p">,</code><code> </code><code class="n">opt_weights</code><code class="p">[</code><code class="n">year</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" id="co_data_driven_finance_CO16-4" href="#callout_data_driven_finance_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">rpr</code><code> </code><code class="o">=</code><code> </code><code class="n">port_return</code><code class="p">(</code><code class="n">rets_</code><code class="p">,</code><code> </code><code class="n">opt_weights</code><code class="p">[</code><code class="n">year</code><code class="p">]</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO16-5" href="#callout_data_driven_finance_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">rsr</code><code> </code><code class="o">=</code><code> </code><code class="n">rpr</code><code> </code><code class="o">/</code><code> </code><code class="n">rpv</code><code>  </code><a class="co" id="co_data_driven_finance_CO16-6" href="#callout_data_driven_finance_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">res</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">{</code><code class="s1">'</code><code class="s1">epv</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">epv</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">epr</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">epr</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">esr</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">esr</code><code class="p">,</code><code>
</code><code>                                            </code><code class="s1">'</code><code class="s1">rpv</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">rpv</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">rpr</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">rpr</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">rsr</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">rsr</code><code class="p">}</code><code class="p">,</code><code>
</code><code>                                           </code><code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">year</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">75</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">res</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">75</code><code class="p">]</code><code class="p">:</code><code>            </code><code class="n">epv</code><code>       </code><code class="n">epr</code><code>       </code><code class="n">esr</code><code>       </code><code class="n">rpv</code><code>       </code><code class="n">rpr</code><code>       </code><code class="n">rsr</code><code>
</code><code>         </code><code class="mi">2011</code><code>  </code><code class="mf">0.157440</code><code>  </code><code class="mf">0.303003</code><code>  </code><code class="mf">1.924564</code><code>  </code><code class="mf">0.160622</code><code>  </code><code class="mf">0.133836</code><code>  </code><code class="mf">0.833235</code><code>
</code><code>         </code><code class="mi">2012</code><code>  </code><code class="mf">0.173279</code><code>  </code><code class="mf">0.169321</code><code>  </code><code class="mf">0.977156</code><code>  </code><code class="mf">0.182292</code><code>  </code><code class="mf">0.161375</code><code>  </code><code class="mf">0.885256</code><code>
</code><code>         </code><code class="mi">2013</code><code>  </code><code class="mf">0.202460</code><code>  </code><code class="mf">0.278459</code><code>  </code><code class="mf">1.375378</code><code>  </code><code class="mf">0.168714</code><code>  </code><code class="mf">0.166897</code><code>  </code><code class="mf">0.989228</code><code>
</code><code>         </code><code class="mi">2014</code><code>  </code><code class="mf">0.181544</code><code>  </code><code class="mf">0.368961</code><code>  </code><code class="mf">2.032353</code><code>  </code><code class="mf">0.197798</code><code>  </code><code class="mf">0.026830</code><code>  </code><code class="mf">0.135645</code><code>
</code><code>         </code><code class="mi">2015</code><code>  </code><code class="mf">0.160340</code><code>  </code><code class="mf">0.309486</code><code>  </code><code class="mf">1.930190</code><code>  </code><code class="mf">0.211368</code><code> </code><code class="o">-</code><code class="mf">0.024560</code><code> </code><code class="o">-</code><code class="mf">0.116194</code><code>
</code><code>         </code><code class="mi">2016</code><code>  </code><code class="mf">0.326730</code><code>  </code><code class="mf">0.778330</code><code>  </code><code class="mf">2.382179</code><code>  </code><code class="mf">0.296565</code><code>  </code><code class="mf">0.103870</code><code>  </code><code class="mf">0.350242</code><code>
</code><code>         </code><code class="mi">2017</code><code>  </code><code class="mf">0.106148</code><code>  </code><code class="mf">0.090933</code><code>  </code><code class="mf">0.856663</code><code>  </code><code class="mf">0.079521</code><code>  </code><code class="mf">0.230630</code><code>  </code><code class="mf">2.900235</code><code>
</code><code>         </code><code class="mi">2018</code><code>  </code><code class="mf">0.086548</code><code>  </code><code class="mf">0.260702</code><code>  </code><code class="mf">3.012226</code><code>  </code><code class="mf">0.157337</code><code>  </code><code class="mf">0.038234</code><code>  </code><code class="mf">0.243004</code><code>
</code><code>         </code><code class="mi">2019</code><code>  </code><code class="mf">0.323796</code><code>  </code><code class="mf">0.228008</code><code>  </code><code class="mf">0.704174</code><code>  </code><code class="mf">0.207672</code><code>  </code><code class="mf">0.275819</code><code>  </code><code class="mf">1.328147</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">76</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">res</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">76</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">epv</code><code>    </code><code class="mf">0.190920</code><code>
</code><code>         </code><code class="n">epr</code><code>    </code><code class="mf">0.309689</code><code>
</code><code>         </code><code class="n">esr</code><code>    </code><code class="mf">1.688320</code><code>
</code><code>         </code><code class="n">rpv</code><code>    </code><code class="mf">0.184654</code><code>
</code><code>         </code><code class="n">rpr</code><code>    </code><code class="mf">0.123659</code><code>
</code><code>         </code><code class="n">rsr</code><code>    </code><code class="mf">0.838755</code><code>
</code><code>         </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO16-1" href="#co_data_driven_finance_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Expected portfolio statistics</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO16-2" href="#co_data_driven_finance_CO16-4"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Realized portfolio statistics</p></dd>
</dl>

<p><a data-type="xref" href="#figure_ddf_03">Figure 4-6</a> compares the expected and realized portfolio volatilities for the single years. MVP theory does quite a good job in predicting the portfolio volatility. This is also supported by a relatively high correlation between the two time series:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">77</code><code class="p">]:</code> <code class="n">res</code><code class="p">[[</code><code class="s1">'epv'</code><code class="p">,</code> <code class="s1">'rpv'</code><code class="p">]]</code><code class="o">.</code><code class="n">corr</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">77</code><code class="p">]:</code>           <code class="n">epv</code>       <code class="n">rpv</code>
         <code class="n">epv</code>  <code class="mf">1.000000</code>  <code class="mf">0.765733</code>
         <code class="n">rpv</code>  <code class="mf">0.765733</code>  <code class="mf">1.000000</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">78</code><code class="p">]:</code> <code class="n">res</code><code class="p">[[</code><code class="s1">'epv'</code><code class="p">,</code> <code class="s1">'rpv'</code><code class="p">]]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code>
                 <code class="n">title</code><code class="o">=</code><code class="s1">'Expected vs. Realized Portfolio Volatility'</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ddf_03" class="figure">
<img src="Images/aiif_0406.png" alt="aiif 0406" width="2444" height="1559"/>
<h6><span class="label">Figure 4-6. </span>Expected versus realized portfolio volatilities</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="expected returns" data-secondary="under MVP theory" data-secondary-sortas="MVP theory" id="idm45625319469976"/>However, the conclusions are the opposite when comparing the expected with the realized portfolio returns (see <a data-type="xref" href="#figure_ddf_04">Figure 4-7</a>). MVP theory obviously fails in predicting the portfolio returns, as is confirmed by the negative correlation between the two time series:<a data-type="indexterm" data-primary="" data-startref="ix_volatility_MVP" id="idm45625319547944"/></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">79</code><code class="p">]:</code> <code class="n">res</code><code class="p">[[</code><code class="s1">'epr'</code><code class="p">,</code> <code class="s1">'rpr'</code><code class="p">]]</code><code class="o">.</code><code class="n">corr</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">79</code><code class="p">]:</code>           <code class="n">epr</code>       <code class="n">rpr</code>
         <code class="n">epr</code>  <code class="mf">1.000000</code> <code class="o">-</code><code class="mf">0.350437</code>
         <code class="n">rpr</code> <code class="o">-</code><code class="mf">0.350437</code>  <code class="mf">1.000000</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">80</code><code class="p">]:</code> <code class="n">res</code><code class="p">[[</code><code class="s1">'epr'</code><code class="p">,</code> <code class="s1">'rpr'</code><code class="p">]]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code>
                 <code class="n">title</code><code class="o">=</code><code class="s1">'Expected vs. Realized Portfolio Return'</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ddf_04" class="figure">
<img src="Images/aiif_0407.png" alt="aiif 0407" width="2418" height="1559"/>
<h6><span class="label">Figure 4-7. </span>Expected versus realized portfolio returns</h6>
</div></figure>

<p>Similar, or even worse, conclusions need to be drawn with regard to the Sharpe ratio (see <a data-type="xref" href="#figure_ddf_05">Figure 4-8</a>). <a data-type="indexterm" data-primary="Sharpe ratio" id="idm45625319454296"/>For the data-driven investor who aims at maximizing the Sharpe ratio of the portfolio, the theory’s predictions are generally significantly off from the realized values. The correlation between the two time series is even lower than for the returns:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">81</code><code class="p">]:</code> <code class="n">res</code><code class="p">[[</code><code class="s1">'esr'</code><code class="p">,</code> <code class="s1">'rsr'</code><code class="p">]]</code><code class="o">.</code><code class="n">corr</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">81</code><code class="p">]:</code>           <code class="n">esr</code>       <code class="n">rsr</code>
         <code class="n">esr</code>  <code class="mf">1.000000</code> <code class="o">-</code><code class="mf">0.698607</code>
         <code class="n">rsr</code> <code class="o">-</code><code class="mf">0.698607</code>  <code class="mf">1.000000</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">82</code><code class="p">]:</code> <code class="n">res</code><code class="p">[[</code><code class="s1">'esr'</code><code class="p">,</code> <code class="s1">'rsr'</code><code class="p">]]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code>
                 <code class="n">title</code><code class="o">=</code><code class="s1">'Expected vs. Realized Sharpe Ratio'</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ddf_05" class="figure">
<img src="Images/aiif_0408.png" alt="aiif 0408" width="2418" height="1559"/>
<h6><span class="label">Figure 4-8. </span>Expected versus realized portfolio Sharpe ratios</h6>
</div></figure>
<div data-type="caution"><h1>Predictive Power of MVP Theory</h1>
<p>MVP theory applied to real-world data reveals its practical shortcomings. Without additional constraints, optimal portfolio compositions and rebalancings can be extreme. The predictive power with regard to portfolio return and Sharpe ratio is pretty bad in the numerical example, whereas the predictive power with regard to portfolio risk seems acceptable. However, investors generally are interested in risk-adjusted performance measures, such as the Sharpe ratio, and this is the statistic for which MVP theory fails worst in the example.<a data-type="indexterm" data-primary="" data-startref="ix_predict_MVP_theory" id="idm45625316696232"/><a data-type="indexterm" data-primary="" data-startref="ix_MVP_theory_data-driven_fin" id="idm45625316695256"/><a data-type="indexterm" data-primary="" data-startref="ix_norm_fin_MVP_ch4" id="idm45625316694344"/><a data-type="indexterm" data-primary="" data-startref="ix_portfolio_MVP_ch4" id="idm45625316693400"/></p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Capital Asset Pricing Model"><div class="sect2" id="idm45625321282168">
<h2>Capital Asset Pricing Model</h2>

<p><a data-type="indexterm" data-primary="expected returns" data-secondary="under CAPM" data-secondary-sortas="CAPM" id="ix_expect_return_capm"/><a data-type="indexterm" data-primary="CAPM (capital asset pricing model)" data-secondary="in data-driven finance" data-secondary-sortas="data-driven finance" id="ix_capm_data-driven"/>A similar approach can be applied to put the CAPM to a real-world test. Assume that the data-driven technology investor from before wants to apply the CAPM to derive expected returns for the four technology stocks from before. The following Python code first derives the beta for every stock for a given year, and then calculates the expected return for the stock in the next year, given its beta and the performance of the market portfolio. The market portfolio is approximated by the S&amp;P 500 stock index:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">83</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">r</code><code> </code><code class="o">=</code><code> </code><code class="mf">0.005</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-1" href="#callout_data_driven_finance_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">84</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">market</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">.SPX</code><code class="s1">'</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-2" href="#callout_data_driven_finance_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">85</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">raw</code><code> </code><code class="o">/</code><code> </code><code class="n">raw</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">86</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">87</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="p">:</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code class="n">sym</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="mi">54</code><code> </code><code class="o">*</code><code> </code><code class="s1">'</code><code class="s1">=</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="k">for</code><code> </code><code class="n">year</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code><code> </code><code class="mi">2019</code><code class="p">)</code><code class="p">:</code><code>
</code><code>                 </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-12-31</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>                 </code><code class="n">muM</code><code> </code><code class="o">=</code><code> </code><code class="n">rets_</code><code class="p">[</code><code class="n">market</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code>
</code><code>                 </code><code class="n">cov</code><code> </code><code class="o">=</code><code> </code><code class="n">rets_</code><code class="o">.</code><code class="n">cov</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">sym</code><code class="p">,</code><code> </code><code class="n">market</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-3" href="#callout_data_driven_finance_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">var</code><code> </code><code class="o">=</code><code> </code><code class="n">rets_</code><code class="p">[</code><code class="n">market</code><code class="p">]</code><code class="o">.</code><code class="n">var</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-4" href="#callout_data_driven_finance_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">beta</code><code> </code><code class="o">=</code><code> </code><code class="n">cov</code><code> </code><code class="o">/</code><code> </code><code class="n">var</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-5" href="#callout_data_driven_finance_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year + 1}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year + 1}-12-31</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>                 </code><code class="n">muM</code><code> </code><code class="o">=</code><code> </code><code class="n">rets_</code><code class="p">[</code><code class="n">market</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code>
</code><code>                 </code><code class="n">mu_capm</code><code> </code><code class="o">=</code><code> </code><code class="n">r</code><code> </code><code class="o">+</code><code> </code><code class="n">beta</code><code> </code><code class="o">*</code><code> </code><code class="p">(</code><code class="n">muM</code><code> </code><code class="o">-</code><code> </code><code class="n">r</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-6" href="#callout_data_driven_finance_CO17-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">mu_real</code><code> </code><code class="o">=</code><code> </code><code class="n">rets_</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-7" href="#callout_data_driven_finance_CO17-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">res</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">{</code><code class="s1">'</code><code class="s1">symbol</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">sym</code><code class="p">,</code><code>
</code><code>                                                </code><code class="s1">'</code><code class="s1">mu_capm</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">mu_capm</code><code class="p">,</code><code>
</code><code>                                                </code><code class="s1">'</code><code class="s1">mu_real</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">mu_real</code><code class="p">}</code><code class="p">,</code><code>
</code><code>                                               </code><code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">year</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="p">,</code><code>
</code><code>                                 </code><code class="n">sort</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-8" href="#callout_data_driven_finance_CO17-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>                 </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">{} | beta: {:.3f} | mu_capm: {:6.3f} | mu_real: {:6.3f}</code><code class="s1">'</code><code>
</code><code>                       </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">year</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">beta</code><code class="p">,</code><code> </code><code class="n">mu_capm</code><code class="p">,</code><code> </code><code class="n">mu_real</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO17-9" href="#callout_data_driven_finance_CO17-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO17-1" href="#co_data_driven_finance_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Specifies the risk-less short rate</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO17-2" href="#co_data_driven_finance_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Defines the market portfolio</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO17-3" href="#co_data_driven_finance_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Derives the beta of the stock</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO17-4" href="#co_data_driven_finance_CO17-6"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Calculates the expected return given previous year’s beta and current year market portfolio performance</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO17-5" href="#co_data_driven_finance_CO17-7"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Calculates the realized performance of the stock for the current year</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO17-6" href="#co_data_driven_finance_CO17-8"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Collects and prints all results</p></dd>
</dl>

<p>The preceding code provides the following output:</p>

<pre data-type="programlisting" data-code-language="python">         <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>
         <code class="o">======================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.052</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.000</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.228</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.764</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.098</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.275</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.266</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.327</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.053</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.630</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.070</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.320</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.833</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.005</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.047</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.144</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.103</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.096</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.009</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.180</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.381</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.379</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.091</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.071</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.252</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.316</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.621</code>

         <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>
         <code class="o">======================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.890</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.001</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.072</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.816</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.104</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.029</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.109</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.287</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.337</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.876</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.095</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.216</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.955</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.007</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.178</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.249</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.113</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.113</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.224</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.217</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.321</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.303</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.086</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.172</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.442</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.364</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.440</code>

         <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>
         <code class="o">======================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.081</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.000</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.142</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.842</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.108</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.163</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.081</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.280</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.230</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.883</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.096</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.335</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.055</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.008</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.052</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.009</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.092</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.051</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.261</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.223</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.242</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.163</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.076</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.017</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.376</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.347</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.243</code>

         <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>
         <code class="o">======================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.102</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.001</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.039</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">0.958</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.122</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.374</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.116</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.289</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.464</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.262</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.135</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.251</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.473</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.013</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.778</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.122</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.102</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.104</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.118</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.199</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.446</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.300</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.086</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.251</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">beta</code><code class="p">:</code> <code class="mf">1.619</code> <code class="o">|</code> <code class="n">mu_capm</code><code class="p">:</code>  <code class="mf">0.408</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.207</code></pre>

<p><a data-type="xref" href="#figure_ddf_06">Figure 4-9</a> compares the predicted (expected) return for a single stock, given the beta from the previous year and market portfolio performance of the current year, with the realized return of the stock for the current year. Obviously, the CAPM in its original form does not prove really useful in predicting a stock’s performance based on beta only:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">88</code><code class="p">]:</code> <code class="n">sym</code> <code class="o">=</code> <code class="s1">'AMZN.O'</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">89</code><code class="p">]:</code> <code class="n">res</code><code class="p">[</code><code class="n">res</code><code class="p">[</code><code class="s1">'symbol'</code><code class="p">]</code> <code class="o">==</code> <code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">corr</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">89</code><code class="p">]:</code>           <code class="n">mu_capm</code>   <code class="n">mu_real</code>
         <code class="n">mu_capm</code>  <code class="mf">1.000000</code> <code class="o">-</code><code class="mf">0.004826</code>
         <code class="n">mu_real</code> <code class="o">-</code><code class="mf">0.004826</code>  <code class="mf">1.000000</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">90</code><code class="p">]:</code> <code class="n">res</code><code class="p">[</code><code class="n">res</code><code class="p">[</code><code class="s1">'symbol'</code><code class="p">]</code> <code class="o">==</code> <code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code>
                         <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code> <code class="n">title</code><code class="o">=</code><code class="n">sym</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ddf_06" class="figure">
<img src="Images/aiif_0409.png" alt="aiif 0409" width="2451" height="1558"/>
<h6><span class="label">Figure 4-9. </span>CAPM-predicted versus realized stock returns for a single stock</h6>
</div></figure>

<p><a data-type="xref" href="#figure_ddf_07">Figure 4-10</a> compares the averages of the CAPM-predicted stock returns with the averages of the realized returns. Also here, the CAPM does not do a good job.</p>

<p>What is easy to see is that the CAPM predictions do not vary that much on average for the stocks analyzed; they are between 12.2% and 14.4%. However, the realized average returns of the stocks show a high variability; these are between 9.4% and 29.2%. Market portfolio performance and beta alone obviously cannot account for the observed returns of the (technology) stocks:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">91</code><code class="p">]:</code> <code class="n">grouped</code> <code class="o">=</code> <code class="n">res</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'symbol'</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code>
         <code class="n">grouped</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">91</code><code class="p">]:</code>          <code class="n">mu_capm</code>   <code class="n">mu_real</code>
         <code class="n">symbol</code>
         <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.110855</code>  <code class="mf">0.206158</code>
         <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.128223</code>  <code class="mf">0.259395</code>
         <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.117929</code>  <code class="mf">0.116180</code>
         <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.120844</code>  <code class="mf">0.192655</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">92</code><code class="p">]:</code> <code class="n">grouped</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code> <code class="n">title</code><code class="o">=</code><code class="s1">'Average Values'</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ddf_07" class="figure">
<img src="Images/aiif_0410.png" alt="aiif 0410" width="2444" height="1636"/>
<h6><span class="label">Figure 4-10. </span>Average CAPM-predicted versus average realized stock returns for multiple stocks</h6>
</div></figure>
<div data-type="caution"><h1>Predictive Power of the CAPM</h1>
<p>The predictive power of the CAPM with regard to the future performance of stocks, relative to the market portfolio, is pretty low or even nonexistent for certain stocks. One of the reasons is probably the fact that the CAPM rests on the same central assumptions as MVP theory, namely that investors care about only the (expected) return and (expected) volatility of a portfolio and/or stock. From a modeling point of view, one can ask whether the single risk factor is enough to explain variability in stock returns or whether there might be a nonlinear relationship between a stock’s return and the market portfolio performance.<a data-type="indexterm" data-primary="" data-startref="ix_capm_data-driven" id="idm45625317276264"/><a data-type="indexterm" data-primary="" data-startref="ix_expect_return_capm" id="idm45625317275288"/></p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Arbitrage Pricing Theory"><div class="sect2" id="idm45625316692072">
<h2>Arbitrage Pricing Theory</h2>

<p><a data-type="indexterm" data-primary="expected returns" data-secondary="under APT" data-secondary-sortas="APT" id="ix_expect_return_apt"/><a data-type="indexterm" data-primary="normative financial theories and models" data-secondary="arbitrage pricing theory" id="ix_norm_fin_APT_3"/><a data-type="indexterm" data-primary="APT (arbitrage pricing theory)" data-secondary="in data-driven finance" data-secondary-sortas="data-driven finance" id="ix_APT_data-driven"/>The predictive power of the CAPM seems quite limited given the results from the previous numerical example. A valid question is whether the market portfolio performance alone is enough to explain variability in stock returns. The answer of the APT is <em>no</em>—there can be more (even many more) factors that together explain variability in stock returns. <a data-type="xref" href="ch03.xhtml#ap_theory">“Arbitrage Pricing Theory”</a> formally describes the framework of APT that also relies on a linear relationship between the factors and a stock’s return.</p>

<p>The data-driven investor recognizes that the CAPM is not sufficient to reliably predict a stock’s performance relative to the market portfolio performance. Therefore, the investor decides to add to the market portfolio three additional factors that might drive a stock’s performance:</p>

<ul>
<li>
<p>Market volatility (as represented by the VIX index, <code>.VIX</code>)</p>
</li>
<li>
<p>Exchange rates (as represented by the EUR/USD rate, <code>EUR=</code>)</p>
</li>
<li>
<p>Commodity prices (as represented by the gold price, <code>XAU=</code>)</p>
</li>
</ul>

<p>The following Python code implements a simple APT approach by using the four 
<span class="keep-together">factors</span> in combination with multivariate regression to explain a stock’s future performance in relation to the factors:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">93</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">factors</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="s1">'</code><code class="s1">.SPX</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">.VIX</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">EUR=</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">XAU=</code><code class="s1">'</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO18-1" href="#callout_data_driven_finance_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">94</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">95</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">set_printoptions</code><code class="p">(</code><code class="n">formatter</code><code class="o">=</code><code class="p">{</code><code class="s1">'</code><code class="s1">float</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="k">lambda</code><code> </code><code class="n">x</code><code class="p">:</code><code> </code><code class="n">f</code><code class="s1">'</code><code class="s1">{x:5.2f}</code><code class="s1">'</code><code class="p">}</code><code class="p">)</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">96</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">for</code><code> </code><code class="n">sym</code><code> </code><code class="ow">in</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">columns</code><code class="p">[</code><code class="p">:</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code class="n">sym</code><code class="p">)</code><code>
</code><code>             </code><code class="k">print</code><code class="p">(</code><code class="mi">71</code><code> </code><code class="o">*</code><code> </code><code class="s1">'</code><code class="s1">=</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="k">for</code><code> </code><code class="n">year</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code><code> </code><code class="mi">2019</code><code class="p">)</code><code class="p">:</code><code>
</code><code>                 </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year}-12-31</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>                 </code><code class="n">reg</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linalg</code><code class="o">.</code><code class="n">lstsq</code><code class="p">(</code><code class="n">rets_</code><code class="p">[</code><code class="n">factors</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                       </code><code class="n">rets_</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">rcond</code><code class="o">=</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO18-2" href="#callout_data_driven_finance_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">rets_</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year + 1}-01-01</code><code class="s1">'</code><code class="p">:</code><code class="n">f</code><code class="s1">'</code><code class="s1">{year + 1}-12-31</code><code class="s1">'</code><code class="p">]</code><code>
</code><code>                 </code><code class="n">mu_apt</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">rets_</code><code class="p">[</code><code class="n">factors</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code class="p">,</code><code> </code><code class="n">reg</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO18-3" href="#callout_data_driven_finance_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">mu_real</code><code> </code><code class="o">=</code><code>  </code><code class="n">rets_</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code>  </code><a class="co" id="co_data_driven_finance_CO18-4" href="#callout_data_driven_finance_CO18-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>                 </code><code class="n">res</code><code> </code><code class="o">=</code><code> </code><code class="n">res</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">{</code><code class="s1">'</code><code class="s1">symbol</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">sym</code><code class="p">,</code><code>
</code><code>                                 </code><code class="s1">'</code><code class="s1">mu_apt</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">mu_apt</code><code class="p">,</code><code> </code><code class="s1">'</code><code class="s1">mu_real</code><code class="s1">'</code><code class="p">:</code><code> </code><code class="n">mu_real</code><code class="p">}</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">year</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="p">)</code><code>
</code><code>                 </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">{} | fl: {} | mu_apt: {:6.3f} | mu_real: {:6.3f}</code><code class="s1">'</code><code>
</code><code>                       </code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">year</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">reg</code><code class="o">.</code><code class="n">round</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">mu_apt</code><code class="p">,</code><code> </code><code class="n">mu_real</code><code class="p">)</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO18-1" href="#co_data_driven_finance_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The four factors</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO18-2" href="#co_data_driven_finance_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The multivariate regression</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO18-3" href="#co_data_driven_finance_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The APT-predicted return of the stock</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO18-4" href="#co_data_driven_finance_CO18-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The realized return of the stock</p></dd>
</dl>

<p>The preceding code provides the following output:</p>

<pre data-type="programlisting" data-code-language="python">         <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>
         <code class="o">=======================================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.91</code> <code class="o">-</code><code class="mf">0.04</code> <code class="o">-</code><code class="mf">0.35</code>  <code class="mf">0.12</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.011</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.228</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.76</code> <code class="o">-</code><code class="mf">0.02</code> <code class="o">-</code><code class="mf">0.24</code>  <code class="mf">0.05</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.099</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.275</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.67</code>  <code class="mf">0.04</code> <code class="o">-</code><code class="mf">0.56</code>  <code class="mf">0.10</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.366</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.053</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.53</code> <code class="o">-</code><code class="mf">0.00</code>  <code class="mf">0.02</code>  <code class="mf">0.16</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.050</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.320</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.07</code>  <code class="mf">0.02</code>  <code class="mf">0.25</code>  <code class="mf">0.01</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.038</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.047</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.21</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.14</code> <code class="o">-</code><code class="mf">0.02</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.110</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.096</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.10</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.15</code> <code class="o">-</code><code class="mf">0.02</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.170</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.381</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.06</code> <code class="o">-</code><code class="mf">0.03</code> <code class="o">-</code><code class="mf">0.15</code>  <code class="mf">0.12</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.088</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.071</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.37</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.20</code>  <code class="mf">0.13</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.364</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.621</code>

         <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>
         <code class="o">=======================================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.98</code>  <code class="mf">0.01</code>  <code class="mf">0.02</code> <code class="o">-</code><code class="mf">0.11</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.008</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.072</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.82</code>  <code class="mf">0.00</code> <code class="o">-</code><code class="mf">0.03</code> <code class="o">-</code><code class="mf">0.01</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.103</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.029</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.14</code>  <code class="mf">0.00</code> <code class="o">-</code><code class="mf">0.07</code> <code class="o">-</code><code class="mf">0.01</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.294</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.337</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.28</code>  <code class="mf">0.05</code>  <code class="mf">0.04</code>  <code class="mf">0.07</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.149</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.216</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.20</code>  <code class="mf">0.03</code>  <code class="mf">0.05</code>  <code class="mf">0.01</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.016</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.178</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.44</code>  <code class="mf">0.03</code> <code class="o">-</code><code class="mf">0.17</code> <code class="o">-</code><code class="mf">0.02</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.127</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.113</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.33</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.14</code>  <code class="mf">0.00</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.216</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.321</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.10</code> <code class="o">-</code><code class="mf">0.02</code> <code class="o">-</code><code class="mf">0.14</code>  <code class="mf">0.22</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.087</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.172</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.51</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.16</code> <code class="o">-</code><code class="mf">0.02</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.378</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.440</code>

         <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>
         <code class="o">=======================================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.17</code>  <code class="mf">0.01</code>  <code class="mf">0.05</code> <code class="o">-</code><code class="mf">0.13</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.010</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.142</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.03</code>  <code class="mf">0.04</code>  <code class="mf">0.01</code>  <code class="mf">0.03</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.122</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.163</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.06</code> <code class="o">-</code><code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.10</code>  <code class="mf">0.01</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.267</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.230</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.96</code>  <code class="mf">0.02</code>  <code class="mf">0.36</code> <code class="o">-</code><code class="mf">0.02</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.063</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.335</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.93</code> <code class="o">-</code><code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.09</code>  <code class="mf">0.02</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.001</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.052</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.02</code>  <code class="mf">0.00</code> <code class="o">-</code><code class="mf">0.05</code>  <code class="mf">0.06</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.099</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.051</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.41</code>  <code class="mf">0.02</code> <code class="o">-</code><code class="mf">0.18</code>  <code class="mf">0.03</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.226</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.242</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.12</code> <code class="o">-</code><code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.11</code>  <code class="mf">0.17</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.076</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.017</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.50</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.34</code>  <code class="mf">0.30</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.431</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.243</code>

         <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>
         <code class="o">=======================================================================</code>
         <code class="mi">2011</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.02</code> <code class="o">-</code><code class="mf">0.03</code> <code class="o">-</code><code class="mf">0.18</code> <code class="o">-</code><code class="mf">0.14</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.016</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.039</code>
         <code class="mi">2012</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.98</code> <code class="o">-</code><code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.17</code> <code class="o">-</code><code class="mf">0.09</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.117</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.374</code>
         <code class="mi">2013</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.07</code> <code class="o">-</code><code class="mf">0.00</code>  <code class="mf">0.09</code>  <code class="mf">0.00</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.282</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.464</code>
         <code class="mi">2014</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.54</code>  <code class="mf">0.03</code>  <code class="mf">0.01</code> <code class="o">-</code><code class="mf">0.08</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.176</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.251</code>
         <code class="mi">2015</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.26</code> <code class="o">-</code><code class="mf">0.02</code>  <code class="mf">0.45</code> <code class="o">-</code><code class="mf">0.11</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.044</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.778</code>
         <code class="mi">2016</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.06</code> <code class="o">-</code><code class="mf">0.00</code> <code class="o">-</code><code class="mf">0.15</code> <code class="o">-</code><code class="mf">0.04</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.099</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.104</code>
         <code class="mi">2017</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.94</code> <code class="o">-</code><code class="mf">0.02</code>  <code class="mf">0.12</code> <code class="o">-</code><code class="mf">0.03</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.185</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.446</code>
         <code class="mi">2018</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">0.90</code> <code class="o">-</code><code class="mf">0.04</code> <code class="o">-</code><code class="mf">0.25</code>  <code class="mf">0.28</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code> <code class="o">-</code><code class="mf">0.085</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.251</code>
         <code class="mi">2019</code> <code class="o">|</code> <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.99</code>  <code class="mf">0.05</code> <code class="o">-</code><code class="mf">0.37</code>  <code class="mf">0.12</code><code class="p">]</code> <code class="o">|</code> <code class="n">mu_apt</code><code class="p">:</code>  <code class="mf">0.506</code> <code class="o">|</code> <code class="n">mu_real</code><code class="p">:</code>  <code class="mf">0.207</code></pre>

<p><a data-type="xref" href="#figure_ddf_08">Figure 4-11</a> compares the APT-predicted returns for a stock and its realized stock returns over time. <a data-type="indexterm" data-primary="CAPM (capital asset pricing model)" data-secondary="versus APT" data-secondary-sortas="APT" id="idm45625315219448"/>Compared to the single-factor CAPM, there seems to be hardly any improvement:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">97</code><code class="p">]:</code> <code class="n">sym</code> <code class="o">=</code> <code class="s1">'AMZN.O'</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">98</code><code class="p">]:</code> <code class="n">res</code><code class="p">[</code><code class="n">res</code><code class="p">[</code><code class="s1">'symbol'</code><code class="p">]</code> <code class="o">==</code> <code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">corr</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">98</code><code class="p">]:</code>            <code class="n">mu_apt</code>   <code class="n">mu_real</code>
         <code class="n">mu_apt</code>   <code class="mf">1.000000</code> <code class="o">-</code><code class="mf">0.098281</code>
         <code class="n">mu_real</code> <code class="o">-</code><code class="mf">0.098281</code>  <code class="mf">1.000000</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">99</code><code class="p">]:</code> <code class="n">res</code><code class="p">[</code><code class="n">res</code><code class="p">[</code><code class="s1">'symbol'</code><code class="p">]</code> <code class="o">==</code> <code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code>
                         <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code> <code class="n">title</code><code class="o">=</code><code class="n">sym</code><code class="p">);</code></pre>

<figure class="thumb"><div id="figure_ddf_08" class="figure">
<img src="Images/aiif_0411.png" alt="aiif 0411" width="2451" height="1558"/>
<h6><span class="label">Figure 4-11. </span>APT-predicted versus realized stock returns for a stock</h6>
</div></figure>

<p>The same picture arises in <a data-type="xref" href="#figure_ddf_09">Figure 4-12</a>, produced by the following snippet, which compares the averages for multiple stocks. Because there is hardly any variation in the average APT predictions, there are large average differences to the realized returns:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">100</code><code class="p">]:</code> <code class="n">grouped</code> <code class="o">=</code> <code class="n">res</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'symbol'</code><code class="p">)</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code>
          <code class="n">grouped</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">100</code><code class="p">]:</code>           <code class="n">mu_apt</code>   <code class="n">mu_real</code>
          <code class="n">symbol</code>
          <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.116116</code>  <code class="mf">0.206158</code>
          <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.135528</code>  <code class="mf">0.259395</code>
          <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.124811</code>  <code class="mf">0.116180</code>
          <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>  <code class="mf">0.128441</code>  <code class="mf">0.192655</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">101</code><code class="p">]:</code> <code class="n">grouped</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">),</code> <code class="n">title</code><code class="o">=</code><code class="s1">'Average Values'</code><code class="p">);</code></pre>

<p>Of course, the selection of the risk factors is of paramount importance in this context. The data-driven investor decides to find out what risk factors are typically considered relevant ones for stocks. After studying the paper by Bender et al. (2013), the investor replaces the original risk factors with a new set. In particular, the investor chooses the set as presented in <a data-type="xref" href="#ddf_factors_table">Table 4-3</a>.</p>

<figure class="thumb"><div id="figure_ddf_09" class="figure">
<img src="Images/aiif_0412.png" alt="aiif 0412" width="2444" height="1636"/>
<h6><span class="label">Figure 4-12. </span>Average APT-predicted versus average realized stock returns for multiple stocks</h6>
</div></figure>
<table id="ddf_factors_table">
<caption><span class="label">Table 4-3. </span>Risk factors for APT</caption>
<thead>
<tr>
<th>Factor</th>
<th>Description</th>
<th><code>RIC</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Market</p></td>
<td><p>MSCI World Gross Return Daily USD (PUS = Price Return)</p></td>
<td><p><code>.dMIWO00000GUS</code></p></td>
</tr>
<tr>
<td><p>Size</p></td>
<td><p>MSCI World Equal Weight Price Net Index EOD</p></td>
<td><p><code>.dMIWO0000ENUS</code></p></td>
</tr>
<tr>
<td><p>Volatility</p></td>
<td><p>MSCI World Minimum Volatility Net Return</p></td>
<td><p><code>.dMIWO0000YNUS</code></p></td>
</tr>
<tr>
<td><p>Value</p></td>
<td><p>MSCI World Value Weighted Gross (NUS for Net)</p></td>
<td><p><code>.dMIWO000PkGUS</code></p></td>
</tr>
<tr>
<td><p>Risk</p></td>
<td><p>MSCI World Risk Weighted Gross USD EOD</p></td>
<td><p><code>.dMIWO000PlGUS</code></p></td>
</tr>
<tr>
<td><p>Growth</p></td>
<td><p>MSCI World Quality Net Return USD</p></td>
<td><p><code>.MIWO0000vNUS</code></p></td>
</tr>
<tr>
<td><p>Momentum</p></td>
<td><p>MSCI World Momentum Gross Index USD EOD</p></td>
<td><p><code>.dMIWO0000NGUS</code></p></td>
</tr>
</tbody>
</table>

<p>The following Python code retrieves a respective data set from a remote location and visualizes the normalized time series data (see <a data-type="xref" href="#figure_ddf_10">Figure 4-13</a>). Already a brief look reveals that the time series seem to be highly positively correlated:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">102</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">factors</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'</code><code class="s1">http://hilpisch.com/aiif_eikon_eod_factors.csv</code><code class="s1">'</code><code class="p">,</code><code>
</code><code>                                </code><code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code> </code><a class="co" id="co_data_driven_finance_CO19-1" href="#callout_data_driven_finance_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">103</code><code class="p">]</code><code class="p">:</code><code> </code><code class="p">(</code><code class="n">factors</code><code> </code><code class="o">/</code><code> </code><code class="n">factors</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>  </code><a class="co" id="co_data_driven_finance_CO19-2" href="#callout_data_driven_finance_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO19-1" href="#co_data_driven_finance_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Retrieves factors time series data</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO19-2" href="#co_data_driven_finance_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Normalizes and plots the data</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_10" class="figure">
<img src="Images/aiif_0413.png" alt="aiif 0413" width="2466" height="1528"/>
<h6><span class="label">Figure 4-13. </span>Normalized factors time series data</h6>
</div></figure>

<p>This impression is confirmed by the following calculation and the resulting correlation matrix for the factor returns. All correlation factors are about 0.75 or higher:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">104</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">start</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">2017-01-01</code><code class="s1">'</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-1" href="#callout_data_driven_finance_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>          </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">2020-01-01</code><code class="s1">'</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-2" href="#callout_data_driven_finance_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">105</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">retsd</code><code> </code><code class="o">=</code><code> </code><code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code class="o">.</code><code class="n">copy</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-3" href="#callout_data_driven_finance_CO20-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>          </code><code class="n">retsd</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-4" href="#callout_data_driven_finance_CO20-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">106</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">retsf</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">factors</code><code> </code><code class="o">/</code><code> </code><code class="n">factors</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-5" href="#callout_data_driven_finance_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>          </code><code class="n">retsf</code><code> </code><code class="o">=</code><code> </code><code class="n">retsf</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">start</code><code class="p">:</code><code class="n">end</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-6" href="#callout_data_driven_finance_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>          </code><code class="n">retsf</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-7" href="#callout_data_driven_finance_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>          </code><code class="n">retsf</code><code> </code><code class="o">=</code><code> </code><code class="n">retsf</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">retsd</code><code class="o">.</code><code class="n">index</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-8" href="#callout_data_driven_finance_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">107</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">retsf</code><code class="o">.</code><code class="n">corr</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO20-9" href="#callout_data_driven_finance_CO20-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">107</code><code class="p">]</code><code class="p">:</code><code>               </code><code class="n">market</code><code>      </code><code class="n">size</code><code>  </code><code class="n">volatility</code><code>     </code><code class="n">value</code><code>      </code><code class="n">risk</code><code>    </code><code class="n">growth</code><code>  </code><code>\
</code><code>          </code><code class="n">market</code><code>      </code><code class="mf">1.000000</code><code>  </code><code class="mf">0.935867</code><code>    </code><code class="mf">0.845010</code><code>  </code><code class="mf">0.964124</code><code>  </code><code class="mf">0.947150</code><code>  </code><code class="mf">0.959038</code><code>
</code><code>          </code><code class="n">size</code><code>        </code><code class="mf">0.935867</code><code>  </code><code class="mf">1.000000</code><code>    </code><code class="mf">0.791767</code><code>  </code><code class="mf">0.965739</code><code>  </code><code class="mf">0.983238</code><code>  </code><code class="mf">0.835477</code><code>
</code><code>          </code><code class="n">volatility</code><code>  </code><code class="mf">0.845010</code><code>  </code><code class="mf">0.791767</code><code>    </code><code class="mf">1.000000</code><code>  </code><code class="mf">0.778294</code><code>  </code><code class="mf">0.865467</code><code>  </code><code class="mf">0.818280</code><code>
</code><code>          </code><code class="n">value</code><code>       </code><code class="mf">0.964124</code><code>  </code><code class="mf">0.965739</code><code>    </code><code class="mf">0.778294</code><code>  </code><code class="mf">1.000000</code><code>  </code><code class="mf">0.958359</code><code>  </code><code class="mf">0.864222</code><code>
</code><code>          </code><code class="n">risk</code><code>        </code><code class="mf">0.947150</code><code>  </code><code class="mf">0.983238</code><code>    </code><code class="mf">0.865467</code><code>  </code><code class="mf">0.958359</code><code>  </code><code class="mf">1.000000</code><code>  </code><code class="mf">0.858546</code><code>
</code><code>          </code><code class="n">growth</code><code>      </code><code class="mf">0.959038</code><code>  </code><code class="mf">0.835477</code><code>    </code><code class="mf">0.818280</code><code>  </code><code class="mf">0.864222</code><code>  </code><code class="mf">0.858546</code><code>  </code><code class="mf">1.000000</code><code>
</code><code>          </code><code class="n">momentum</code><code>    </code><code class="mf">0.928705</code><code>  </code><code class="mf">0.796420</code><code>    </code><code class="mf">0.819585</code><code>  </code><code class="mf">0.818796</code><code>  </code><code class="mf">0.825563</code><code>  </code><code class="mf">0.952956</code><code>
</code><code>
</code><code>                      </code><code class="n">momentum</code><code>
</code><code>          </code><code class="n">market</code><code>      </code><code class="mf">0.928705</code><code>
</code><code>          </code><code class="n">size</code><code>        </code><code class="mf">0.796420</code><code>
</code><code>          </code><code class="n">volatility</code><code>  </code><code class="mf">0.819585</code><code>
</code><code>          </code><code class="n">value</code><code>       </code><code class="mf">0.818796</code><code>
</code><code>          </code><code class="n">risk</code><code>        </code><code class="mf">0.825563</code><code>
</code><code>          </code><code class="n">growth</code><code>      </code><code class="mf">0.952956</code><code>
</code><code>          </code><code class="n">momentum</code><code>    </code><code class="mf">1.000000</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO20-1" href="#co_data_driven_finance_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Defines start and end dates for data selection</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO20-2" href="#co_data_driven_finance_CO20-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Selects the relevant returns data sub-set</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO20-3" href="#co_data_driven_finance_CO20-5"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Calculates and processes the log returns for the factors</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO20-4" href="#co_data_driven_finance_CO20-9"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Shows the correlation matrix for the factors</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="CAPM (capital asset pricing model)" data-secondary="versus APT" data-secondary-sortas="APT" id="idm45625313963672"/>The following Python code derives factor loadings for the original stocks but with the new factors. They are derived from the first half of the data set and applied to predict the stock return for the second half given the performance of the single factors. The realized return is also calculated. Both time series are compared in <a data-type="xref" href="#figure_ddf_11">Figure 4-14</a>. As to be expected given the high correlation of the factors, the explanatory power of the APT approach is not much higher compared to the CAPM:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">108</code><code class="p">]:</code> <code class="n">res</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">()</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">109</code><code class="p">]:</code> <code class="n">np</code><code class="o">.</code><code class="n">set_printoptions</code><code class="p">(</code><code class="n">formatter</code><code class="o">=</code><code class="p">{</code><code class="s1">'float'</code><code class="p">:</code> <code class="k">lambda</code> <code class="n">x</code><code class="p">:</code> <code class="n">f</code><code class="s1">'{x:5.2f}'</code><code class="p">})</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">110</code><code class="p">]:</code> <code class="n">split</code> <code class="o">=</code> <code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">retsf</code><code class="p">)</code> <code class="o">*</code> <code class="mf">0.5</code><code class="p">)</code>
          <code class="k">for</code> <code class="n">sym</code> <code class="ow">in</code> <code class="n">rets</code><code class="o">.</code><code class="n">columns</code><code class="p">[:</code><code class="mi">4</code><code class="p">]:</code>
              <code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">'</code> <code class="o">+</code> <code class="n">sym</code><code class="p">)</code>
              <code class="k">print</code><code class="p">(</code><code class="mi">74</code> <code class="o">*</code> <code class="s1">'='</code><code class="p">)</code>
              <code class="n">retsf_</code><code class="p">,</code> <code class="n">retsd_</code> <code class="o">=</code> <code class="n">retsf</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="n">split</code><code class="p">],</code> <code class="n">retsd</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="n">split</code><code class="p">]</code>
              <code class="n">reg</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">linalg</code><code class="o">.</code><code class="n">lstsq</code><code class="p">(</code><code class="n">retsf_</code><code class="p">,</code> <code class="n">retsd_</code><code class="p">[</code><code class="n">sym</code><code class="p">],</code> <code class="n">rcond</code><code class="o">=-</code><code class="mi">1</code><code class="p">)[</code><code class="mi">0</code><code class="p">]</code>
              <code class="n">retsf_</code><code class="p">,</code> <code class="n">retsd_</code> <code class="o">=</code> <code class="n">retsf</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:],</code> <code class="n">retsd</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:]</code>
              <code class="n">mu_apt</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">retsf_</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">*</code> <code class="mi">252</code><code class="p">,</code> <code class="n">reg</code><code class="p">)</code>
              <code class="n">mu_real</code> <code class="o">=</code>  <code class="n">retsd_</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">*</code> <code class="mi">252</code>
              <code class="n">res</code> <code class="o">=</code> <code class="n">res</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'mu_apt'</code><code class="p">:</code> <code class="n">mu_apt</code><code class="p">,</code>
                              <code class="s1">'mu_real'</code><code class="p">:</code> <code class="n">mu_real</code><code class="p">},</code> <code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">sym</code><code class="p">,]),</code>
                              <code class="n">sort</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
              <code class="k">print</code><code class="p">(</code><code class="s1">'fl: {} | apt: {:.3f} | real: {:.3f}'</code>
                    <code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">reg</code><code class="o">.</code><code class="n">round</code><code class="p">(</code><code class="mi">1</code><code class="p">),</code> <code class="n">mu_apt</code><code class="p">,</code> <code class="n">mu_real</code><code class="p">))</code>


          <code class="n">AAPL</code><code class="o">.</code><code class="n">O</code>
          <code class="o">==========================================================================</code>
          <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">2.30</code>  <code class="mf">2.80</code> <code class="o">-</code><code class="mf">0.70</code> <code class="o">-</code><code class="mf">1.40</code> <code class="o">-</code><code class="mf">4.20</code>  <code class="mf">2.00</code> <code class="o">-</code><code class="mf">0.20</code><code class="p">]</code> <code class="o">|</code> <code class="n">apt</code><code class="p">:</code> <code class="mf">0.115</code> <code class="o">|</code> <code class="n">real</code><code class="p">:</code> <code class="mf">0.301</code>

          <code class="n">MSFT</code><code class="o">.</code><code class="n">O</code>
          <code class="o">==========================================================================</code>
          <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">1.50</code>  <code class="mf">0.00</code>  <code class="mf">0.10</code> <code class="o">-</code><code class="mf">1.30</code> <code class="o">-</code><code class="mf">1.40</code>  <code class="mf">0.80</code>  <code class="mf">1.00</code><code class="p">]</code> <code class="o">|</code> <code class="n">apt</code><code class="p">:</code> <code class="mf">0.181</code> <code class="o">|</code> <code class="n">real</code><code class="p">:</code> <code class="mf">0.304</code>

          <code class="n">INTC</code><code class="o">.</code><code class="n">O</code>
          <code class="o">==========================================================================</code>
          <code class="n">fl</code><code class="p">:</code> <code class="p">[</code><code class="o">-</code><code class="mf">3.10</code>  <code class="mf">1.60</code>  <code class="mf">0.40</code>  <code class="mf">1.30</code> <code class="o">-</code><code class="mf">2.60</code>  <code class="mf">2.50</code>  <code class="mf">1.10</code><code class="p">]</code> <code class="o">|</code> <code class="n">apt</code><code class="p">:</code> <code class="mf">0.186</code> <code class="o">|</code> <code class="n">real</code><code class="p">:</code> <code class="mf">0.118</code>

          <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>
          <code class="o">==========================================================================</code>
          <code class="n">fl</code><code class="p">:</code> <code class="p">[</code> <code class="mf">9.10</code>  <code class="mf">3.30</code> <code class="o">-</code><code class="mf">1.00</code> <code class="o">-</code><code class="mf">7.10</code> <code class="o">-</code><code class="mf">3.10</code> <code class="o">-</code><code class="mf">1.80</code>  <code class="mf">1.20</code><code class="p">]</code> <code class="o">|</code> <code class="n">apt</code><code class="p">:</code> <code class="mf">0.019</code> <code class="o">|</code> <code class="n">real</code><code class="p">:</code> <code class="mf">0.050</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">111</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'bar'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">));</code></pre>

<figure class="thumb"><div id="figure_ddf_11" class="figure">
<img src="Images/aiif_0414.png" alt="aiif 0414" width="2444" height="1572"/>
<h6><span class="label">Figure 4-14. </span>APT-predicted returns based on typical factors compared to realized returns</h6>
</div></figure>

<p>The data-driven investor is not willing to dismiss the APT completely. Therefore, an additional test might shed some more light on the explanatory power of APT. To this end, the factor loadings are used to test whether APT can explain movements of the stock price over time (correctly). And indeed, although APT does not predict the absolute performance correctly (it is off by 10+ percentage points), it predicts the direction of the stock price movement correctly in the majority of cases (see <a data-type="xref" href="#figure_ddf_12">Figure 4-15</a>). The correlation between the predicted and realized returns is also pretty high at around 85%. However, the analysis uses realized factor returns to generate the APT predictions—something, of course, not available in practice a day before the relevant trading day:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">112</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sym</code><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">112</code><code class="p">]</code><code class="p">:</code><code> </code><code class="s1">'</code><code class="s1">AMZN.O</code><code class="s1">'</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">113</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">retsf_</code><code class="p">,</code><code> </code><code class="n">reg</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO21-1" href="#callout_data_driven_finance_CO21-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">114</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">rets_sym</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">columns</code><code class="o">=</code><code class="p">[</code><code class="n">sym</code><code> </code><code class="o">+</code><code> </code><code class="s1">'</code><code class="s1">_apt</code><code class="s1">'</code><code class="p">]</code><code class="p">,</code><code>
</code><code>                                  </code><code class="n">index</code><code class="o">=</code><code class="n">retsf_</code><code class="o">.</code><code class="n">index</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO21-2" href="#callout_data_driven_finance_CO21-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">115</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code class="p">[</code><code class="n">sym</code><code> </code><code class="o">+</code><code> </code><code class="s1">'</code><code class="s1">_real</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">retsd_</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code>  </code><a class="co" id="co_data_driven_finance_CO21-3" href="#callout_data_driven_finance_CO21-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">116</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code>  </code><a class="co" id="co_data_driven_finance_CO21-4" href="#callout_data_driven_finance_CO21-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">116</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_apt</code><code>     </code><code class="mf">0.019401</code><code>
</code><code>          </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_real</code><code>    </code><code class="mf">0.050344</code><code>
</code><code>          </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">117</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mi">252</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mf">0.5</code><code>  </code><a class="co" id="co_data_driven_finance_CO21-5" href="#callout_data_driven_finance_CO21-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">117</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_apt</code><code>     </code><code class="mf">0.270995</code><code>
</code><code>          </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_real</code><code>    </code><code class="mf">0.307653</code><code>
</code><code>          </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">118</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code class="o">.</code><code class="n">corr</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO21-6" href="#callout_data_driven_finance_CO21-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">118</code><code class="p">]</code><code class="p">:</code><code>              </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_apt</code><code>  </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_real</code><code>
</code><code>          </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_apt</code><code>     </code><code class="mf">1.000000</code><code>     </code><code class="mf">0.832218</code><code>
</code><code>          </code><code class="n">AMZN</code><code class="o">.</code><code class="n">O_real</code><code>    </code><code class="mf">0.832218</code><code>     </code><code class="mf">1.000000</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">119</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">rets_sym</code><code class="o">.</code><code class="n">cumsum</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">apply</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">)</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO21-1" href="#co_data_driven_finance_CO21-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Predicts the daily stock price returns given the realized factor returns</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO21-2" href="#co_data_driven_finance_CO21-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Stores the results in a <code>DataFrame</code> object and adds column and index data</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO21-3" href="#co_data_driven_finance_CO21-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Adds the realized stock price returns to the <code>DataFrame</code> object</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO21-4" href="#co_data_driven_finance_CO21-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Calculates the annualized returns</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO21-5" href="#co_data_driven_finance_CO21-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Calculates the annualized volatility</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO21-6" href="#co_data_driven_finance_CO21-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Calculates the correlation factor</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_12" class="figure">
<img src="Images/aiif_0415.png" alt="aiif 0415" width="2418" height="1428"/>
<h6><span class="label">Figure 4-15. </span>APT-predicted performance and real performance over time (gross)</h6>
</div></figure>

<p>How accurately does APT predict the direction of the stock price movement given the realized factor returns? The following Python code shows that the accuracy score is a bit better than 75%:<a data-type="indexterm" data-primary="" data-startref="ix_data-driven_fin_norm_th" id="idm45625313252488"/><a data-type="indexterm" data-primary="" data-startref="ix_APT_data-driven" id="idm45625313251640"/><a data-type="indexterm" data-primary="" data-startref="ix_expect_return_apt" id="idm45625313250792"/><a data-type="indexterm" data-primary="" data-startref="ix_norm_fin_APT_3" id="idm45625313249944"/></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">120</code><code class="p">]:</code> <code class="n">rets_sym</code><code class="p">[</code><code class="s1">'same'</code><code class="p">]</code> <code class="o">=</code> <code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">rets_sym</code><code class="p">[</code><code class="n">sym</code> <code class="o">+</code> <code class="s1">'_apt'</code><code class="p">])</code> <code class="o">==</code>
                              <code class="n">np</code><code class="o">.</code><code class="n">sign</code><code class="p">(</code><code class="n">rets_sym</code><code class="p">[</code><code class="n">sym</code> <code class="o">+</code> <code class="s1">'_real'</code><code class="p">]))</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">121</code><code class="p">]:</code> <code class="n">rets_sym</code><code class="p">[</code><code class="s1">'same'</code><code class="p">]</code><code class="o">.</code><code class="n">value_counts</code><code class="p">()</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">121</code><code class="p">]:</code> <code class="bp">True</code>     <code class="mi">288</code>
          <code class="bp">False</code>     <code class="mi">89</code>
          <code class="n">Name</code><code class="p">:</code> <code class="n">same</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">122</code><code class="p">]:</code> <code class="n">rets_sym</code><code class="p">[</code><code class="s1">'same'</code><code class="p">]</code><code class="o">.</code><code class="n">value_counts</code><code class="p">()[</code><code class="bp">True</code><code class="p">]</code> <code class="o">/</code> <code class="nb">len</code><code class="p">(</code><code class="n">rets_sym</code><code class="p">)</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">122</code><code class="p">]:</code> <code class="mf">0.7639257294429708</code></pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Debunking Central Assumptions"><div class="sect1" id="debunking_assumptions">
<h1>Debunking Central Assumptions</h1>

<p><a data-type="indexterm" data-primary="data-driven finance" data-secondary="debunking central assumptions" id="ix_data-driven_fin_debunk"/>The previous section provides a number of numerical, real-world examples showing how popular normative financial theories might fail in practice. This section argues that one of the major reasons is that central assumptions of these popular financial theories are invalid; that is, they simply do not describe the reality of financial 
<span class="keep-together">markets.</span> The two assumptions analyzed are <em>normally distributed returns</em> and <em>linear</em> 
<span class="keep-together"><em>relationships</em>.</span></p>








<section data-type="sect2" data-pdf-bookmark="Normally Distributed Returns"><div class="sect2" id="idm45625313168008">
<h2>Normally Distributed Returns</h2>

<p><a data-type="indexterm" data-primary="returns" data-secondary="normally distributed" id="ix_returns_norm_distrib"/><a data-type="indexterm" data-primary="normally distributed returns" id="ix_norm_distrib_returns"/>As a matter of fact, only a normal distribution is completely specified through its first (expectation) and second moment (standard deviation).</p>










<section data-type="sect3" data-pdf-bookmark="Sample data sets"><div class="sect3" id="idm45625313164120">
<h3>Sample data sets</h3>

<p>For illustration, consider a randomly generated set of standard normally distributed numbers as generated by the following Python code.<sup><a data-type="noteref" id="idm45625313161960-marker" href="ch04.xhtml#idm45625313161960">4</a></sup> <a data-type="xref" href="#figure_ddf_13">Figure 4-16</a> shows the typical bell shape of the resulting histogram:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">pylab</code><code> </code><code class="kn">import</code><code> </code><code class="n">plt</code><code class="p">,</code><code> </code><code class="n">mpl</code><code>
</code><code>        </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code>
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'</code><code class="s1">seaborn</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>        </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">savefig.dpi</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">300</code><code>
</code><code>        </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s1">'</code><code class="s1">font.family</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">serif</code><code class="s1">'</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">N</code><code> </code><code class="o">=</code><code> </code><code class="mi">10000</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">snrn</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">standard_normal</code><code class="p">(</code><code class="n">N</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO22-1" href="#callout_data_driven_finance_CO22-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">snrn</code><code> </code><code class="o">-</code><code class="o">=</code><code> </code><code class="n">snrn</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO22-2" href="#callout_data_driven_finance_CO22-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">snrn</code><code> </code><code class="o">/</code><code class="o">=</code><code> </code><code class="n">snrn</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO22-3" href="#callout_data_driven_finance_CO22-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="nb">round</code><code class="p">(</code><code class="n">snrn</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO22-4" href="#callout_data_driven_finance_CO22-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="o">-</code><code class="mf">0.0</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="nb">round</code><code class="p">(</code><code class="n">snrn</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO22-5" href="#callout_data_driven_finance_CO22-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">1.0</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>        </code><code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">snrn</code><code class="p">,</code><code> </code><code class="n">bins</code><code class="o">=</code><code class="mi">35</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO22-1" href="#co_data_driven_finance_CO22-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Draws standard normally distributed random numbers</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO22-2" href="#co_data_driven_finance_CO22-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Corrects the first moment (expectation) to 0.0</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO22-3" href="#co_data_driven_finance_CO22-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Corrects the second moment (standard deviation) to 1.0</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_13" class="figure">
<img src="Images/aiif_0416.png" alt="aiif 0416" width="2432" height="1420"/>
<h6><span class="label">Figure 4-16. </span>Standard normally distributed random numbers</h6>
</div></figure>

<p>Now consider a set of random numbers that share the same first and second moment values but have a completely different distribution than <a data-type="xref" href="#figure_ddf_14">Figure 4-17</a> illustrates. Although the moments are the same, this distribution only consists of three discrete values:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">numbers</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">ones</code><code class="p">(</code><code class="n">N</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mf">1.5</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-1" href="#callout_data_driven_finance_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">split</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="mf">0.25</code><code> </code><code class="o">*</code><code> </code><code class="n">N</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-2" href="#callout_data_driven_finance_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">numbers</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="mi">3</code><code> </code><code class="o">*</code><code> </code><code class="n">split</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">1</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-3" href="#callout_data_driven_finance_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">numbers</code><code class="p">[</code><code class="mi">3</code><code> </code><code class="o">*</code><code> </code><code class="n">split</code><code class="p">:</code><code class="mi">4</code><code> </code><code class="o">*</code><code> </code><code class="n">split</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-4" href="#callout_data_driven_finance_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">numbers</code><code> </code><code class="o">-</code><code class="o">=</code><code> </code><code class="n">numbers</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-5" href="#callout_data_driven_finance_CO23-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">numbers</code><code> </code><code class="o">/</code><code class="o">=</code><code> </code><code class="n">numbers</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-6" href="#callout_data_driven_finance_CO23-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="nb">round</code><code class="p">(</code><code class="n">numbers</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-7" href="#callout_data_driven_finance_CO23-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.0</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="nb">round</code><code class="p">(</code><code class="n">numbers</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO23-8" href="#callout_data_driven_finance_CO23-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="n">Out</code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">1.0</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">numbers</code><code class="p">,</code><code> </code><code class="n">bins</code><code class="o">=</code><code class="mi">35</code><code class="p">)</code><code class="p">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO23-1" href="#co_data_driven_finance_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>A set of numbers with three discrete values only</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO23-2" href="#co_data_driven_finance_CO23-5"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Corrects the first moment (expectation) to 0.0</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO23-3" href="#co_data_driven_finance_CO23-6"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Corrects the second moment (standard deviation) to 1.0</p></dd>
</dl>

<figure class="thumb"><div id="figure_ddf_14" class="figure">
<img src="Images/aiif_0417.png" alt="aiif 0417" width="2459" height="1421"/>
<h6><span class="label">Figure 4-17. </span>Distribution with first and second moment of 0.0 and 1.0, respectively</h6>
</div></figure>
<div data-type="warning" epub:type="warning"><h1>First and Second Moment</h1>
<p>The first and second moment of a probability distribution only describe a normal distribution completely. There are infinitely many other distributions that might share the first two moments with a normal distribution while being completely different.</p>
</div>

<p><a data-type="indexterm" data-primary="PDF (probability density function)" id="ix_pdf_data-driven_fin"/>In preparation for a test of real financial returns, consider the following Python functions that allow one to visualize data as a histogram and to add a probability density function (PDF) of a normal distribution with the first two moments of the data:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">math</code><code>
</code><code>         </code><code class="kn">import</code><code> </code><code class="nn">scipy.stats</code><code> </code><code class="kn">as</code><code> </code><code class="nn">scs</code><code>
</code><code>         </code><code class="kn">import</code><code> </code><code class="nn">statsmodels.api</code><code> </code><code class="kn">as</code><code> </code><code class="nn">sm</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">dN</code><code class="p">(</code><code class="n">x</code><code class="p">,</code><code> </code><code class="n">mu</code><code class="p">,</code><code> </code><code class="n">sigma</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="sd">''' Probability density function of a normal random variable x.
             '''</code><code>
</code><code>             </code><code class="n">z</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">x</code><code> </code><code class="o">-</code><code> </code><code class="n">mu</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">sigma</code><code>
</code><code>             </code><code class="n">pdf</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="o">-</code><code class="mf">0.5</code><code> </code><code class="o">*</code><code> </code><code class="n">z</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="mi">2</code><code> </code><code class="o">*</code><code> </code><code class="n">math</code><code class="o">.</code><code class="n">pi</code><code> </code><code class="o">*</code><code> </code><code class="n">sigma</code><code> </code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">)</code><code>
</code><code>             </code><code class="k">return</code><code> </code><code class="n">pdf</code><code>
</code><code>
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="k">def</code><code> </code><code class="nf">return_histogram</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code><code> </code><code class="n">title</code><code class="o">=</code><code class="s1">'</code><code class="s1">'</code><code class="p">)</code><code class="p">:</code><code>
</code><code>             </code><code class="sd">''' Plots a histogram of the returns.
             '''</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code>
</code><code>             </code><code class="n">x</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="nb">min</code><code class="p">(</code><code class="n">rets</code><code class="p">)</code><code class="p">,</code><code> </code><code class="nb">max</code><code class="p">(</code><code class="n">rets</code><code class="p">)</code><code class="p">,</code><code> </code><code class="mi">100</code><code class="p">)</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">rets</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">bins</code><code class="o">=</code><code class="mi">50</code><code class="p">,</code><code>
</code><code>                      </code><code class="n">density</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">frequency</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO24-1" href="#callout_data_driven_finance_CO24-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">dN</code><code class="p">(</code><code class="n">x</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="n">rets</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="n">rets</code><code class="p">)</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO24-2" href="#callout_data_driven_finance_CO24-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">x</code><code class="p">,</code><code> </code><code class="n">y</code><code class="p">,</code><code> </code><code class="n">linewidth</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">label</code><code class="o">=</code><code class="s1">'</code><code class="s1">PDF</code><code class="s1">'</code><code class="p">)</code><code>  </code><a class="co" id="co_data_driven_finance_CO24-3" href="#callout_data_driven_finance_CO24-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">log returns</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">frequency/probability</code><code class="s1">'</code><code class="p">)</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="n">title</code><code class="p">)</code><code>
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="p">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_data_driven_finance_CO24-1" href="#co_data_driven_finance_CO24-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Plots the histogram of the data</p></dd>
<dt><a class="co" id="callout_data_driven_finance_CO24-2" href="#co_data_driven_finance_CO24-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Plots the PDF of the corresponding normal distribution</p></dd>
</dl>

<p><a data-type="xref" href="#figure_ddf_15">Figure 4-18</a> shows how well the histogram approximates the PDF for the standard normally distributed random numbers:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">15</code><code class="p">]:</code> <code class="n">return_histogram</code><code class="p">(</code><code class="n">snrn</code><code class="p">)</code></pre>

<figure class="thumb"><div id="figure_ddf_15" class="figure">
<img src="Images/aiif_0418.png" alt="aiif 0418" width="2509" height="1492"/>
<h6><span class="label">Figure 4-18. </span>Histogram and PDF for standard normally distributed numbers</h6>
</div></figure>

<p>By contrast, <a data-type="xref" href="#figure_ddf_16">Figure 4-19</a> illustrates that the PDF of the normal distribution has nothing to do with the data shown as a histogram:<a data-type="indexterm" data-primary="" data-startref="ix_pdf_data-driven_fin" id="idm45625312081928"/></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">16</code><code class="p">]:</code> <code class="n">return_histogram</code><code class="p">(</code><code class="n">numbers</code><code class="p">)</code></pre>

<figure class="thumb"><div id="figure_ddf_16" class="figure">
<img src="Images/aiif_0419.png" alt="aiif 0419" width="2469" height="1492"/>
<h6><span class="label">Figure 4-19. </span>Histogram and normal PDF for discrete numbers</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="Q-Q (Quantile-Quantile) plot" id="idm45625312080504"/>Another way of comparing a normal distribution to data is the Quantile-Quantile (Q-Q) plot. As <a data-type="xref" href="#figure_ddf_17">Figure 4-20</a> shows, for normally distributed numbers, the numbers themselves lie (mostly) on a straight line in the Q-Q plane:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">return_qqplot</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code> <code class="n">title</code><code class="o">=</code><code class="s1">''</code><code class="p">):</code>
             <code class="sd">''' Generates a Q-Q plot of the returns.</code>
<code class="sd">             '''</code>
             <code class="n">fig</code> <code class="o">=</code> <code class="n">sm</code><code class="o">.</code><code class="n">qqplot</code><code class="p">(</code><code class="n">rets</code><code class="p">,</code> <code class="n">line</code><code class="o">=</code><code class="s1">'s'</code><code class="p">,</code> <code class="n">alpha</code><code class="o">=</code><code class="mf">0.5</code><code class="p">)</code>
             <code class="n">fig</code><code class="o">.</code><code class="n">set_size_inches</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">)</code>
             <code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="n">title</code><code class="p">)</code>
             <code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'theoretical quantiles'</code><code class="p">)</code>
             <code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'sample quantiles'</code><code class="p">)</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="n">return_qqplot</code><code class="p">(</code><code class="n">snrn</code><code class="p">)</code></pre>

<figure class="thumb"><div id="figure_ddf_17" class="figure">
<img src="Images/aiif_0420.png" alt="aiif 0420" width="2479" height="1490"/>
<h6><span class="label">Figure 4-20. </span>Q-Q plot for standard normally distributed numbers</h6>
</div></figure>

<p>Again, the Q-Q plot as shown in <a data-type="xref" href="#figure_ddf_18">Figure 4-21</a> for the discrete numbers looks completely different to the one in <a data-type="xref" href="#figure_ddf_17">Figure 4-20</a>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">return_qqplot</code><code class="p">(</code><code class="n">numbers</code><code class="p">)</code></pre>

<figure class="thumb"><div id="figure_ddf_18" class="figure">
<img src="Images/aiif_0421.png" alt="aiif 0421" width="2479" height="1490"/>
<h6><span class="label">Figure 4-21. </span>Q-Q plot for discrete numbers</h6>
</div></figure>

<p>Finally, one can also use statistical tests to check whether a set of numbers is normally distributed or not.</p>
<div style="page-break-after: always;"/>

<p>The following Python function implements three tests:</p>

<ul class="less-space-list-2">
<li>
<p>Test for normal skew.</p>
</li>
<li>
<p>Test for normal kurtosis.</p>
</li>
<li>
<p>Test for normal skew and kurtosis combined.</p>
</li>
</ul>

<p>A p-value below 0.05 is generally considered to be a counter-indicator for normality; that is, the hypothesis that the numbers are normally distributed is rejected. In that sense, as in the preceding figures, the p-values for the two data sets speak for 
<span class="keep-together">themselves:</span></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="k">def</code> <code class="nf">print_statistics</code><code class="p">(</code><code class="n">rets</code><code class="p">):</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'RETURN SAMPLE STATISTICS'</code><code class="p">)</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'---------------------------------------------'</code><code class="p">)</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'Skew of Sample Log Returns {:9.6f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code>
                         <code class="n">scs</code><code class="o">.</code><code class="n">skew</code><code class="p">(</code><code class="n">rets</code><code class="p">)))</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'Skew Normal Test p-value   {:9.6f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code>
                         <code class="n">scs</code><code class="o">.</code><code class="n">skewtest</code><code class="p">(</code><code class="n">rets</code><code class="p">)[</code><code class="mi">1</code><code class="p">]))</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'---------------------------------------------'</code><code class="p">)</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'Kurt of Sample Log Returns {:9.6f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code>
                         <code class="n">scs</code><code class="o">.</code><code class="n">kurtosis</code><code class="p">(</code><code class="n">rets</code><code class="p">)))</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'Kurt Normal Test p-value   {:9.6f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code>
                         <code class="n">scs</code><code class="o">.</code><code class="n">kurtosistest</code><code class="p">(</code><code class="n">rets</code><code class="p">)[</code><code class="mi">1</code><code class="p">]))</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'---------------------------------------------'</code><code class="p">)</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'Normal Test p-value        {:9.6f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code>
                         <code class="n">scs</code><code class="o">.</code><code class="n">normaltest</code><code class="p">(</code><code class="n">rets</code><code class="p">)[</code><code class="mi">1</code><code class="p">]))</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'---------------------------------------------'</code><code class="p">)</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">21</code><code class="p">]:</code> <code class="n">print_statistics</code><code class="p">(</code><code class="n">snrn</code><code class="p">)</code>
         <code class="n">RETURN</code> <code class="n">SAMPLE</code> <code class="n">STATISTICS</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Skew</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">0.016793</code>
         <code class="n">Skew</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.492685</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Kurt</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code> <code class="o">-</code><code class="mf">0.024540</code>
         <code class="n">Kurt</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.637637</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>         <code class="mf">0.707334</code>
         <code class="o">---------------------------------------------</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">22</code><code class="p">]:</code> <code class="n">print_statistics</code><code class="p">(</code><code class="n">numbers</code><code class="p">)</code>
         <code class="n">RETURN</code> <code class="n">SAMPLE</code> <code class="n">STATISTICS</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Skew</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">0.689254</code>
         <code class="n">Skew</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Kurt</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code> <code class="o">-</code><code class="mf">1.141902</code>
         <code class="n">Kurt</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>         <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code></pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Real financial returns"><div class="sect3" id="idm45625312540504">
<h3>Real financial returns</h3>

<p>The following Python code retrieves EOD data from a remote source, as done earlier in the chapter, and calculates the log returns for all financial time series contained in the data set. <a data-type="xref" href="#figure_ddf_19">Figure 4-22</a> shows that the log returns of the S&amp;P 500 stock index represented as a histogram show a much higher peak and fatter tails when compared to the normal PDF with the sample expectation and standard deviation. <a data-type="indexterm" data-primary="stylized facts" id="idm45625312253464"/>These two insights are <em>stylized facts</em> because they can be consistently observed for different financial instruments:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">23</code><code class="p">]:</code> <code class="n">raw</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'http://hilpisch.com/aiif_eikon_eod_data.csv'</code><code class="p">,</code>
                           <code class="n">index_col</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code> <code class="n">parse_dates</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code class="o">.</code><code class="n">dropna</code><code class="p">()</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">24</code><code class="p">]:</code> <code class="n">rets</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">log</code><code class="p">(</code><code class="n">raw</code> <code class="o">/</code> <code class="n">raw</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">))</code><code class="o">.</code><code class="n">dropna</code><code class="p">()</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">25</code><code class="p">]:</code> <code class="n">symbol</code> <code class="o">=</code> <code class="s1">'.SPX'</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">26</code><code class="p">]:</code> <code class="n">return_histogram</code><code class="p">(</code><code class="n">rets</code><code class="p">[</code><code class="n">symbol</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code> <code class="n">symbol</code><code class="p">)</code></pre>

<figure class="thumb"><div id="figure_ddf_19" class="figure">
<img src="Images/aiif_0422.png" alt="aiif 0422" width="2469" height="1555"/>
<h6><span class="label">Figure 4-22. </span>Frequency distribution and normal PDF for S&amp;P 500 log returns</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="Q-Q (Quantile-Quantile) plot" id="idm45625311743400"/>Similar insights can be gained when considering the Q-Q plot for the S&amp;P 500 log returns in <a data-type="xref" href="#figure_ddf_20">Figure 4-23</a>. In particular, the Q-Q plot visualizes the fat tails pretty well (points below the straight line to the left and above the straight line to the right):</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">27</code><code class="p">]:</code> <code class="n">return_qqplot</code><code class="p">(</code><code class="n">rets</code><code class="p">[</code><code class="n">symbol</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">,</code> <code class="n">symbol</code><code class="p">)</code></pre>

<figure class="thumb"><div id="figure_ddf_20" class="figure">
<img src="Images/aiif_0423.png" alt="aiif 0423" width="2545" height="1553"/>
<h6><span class="label">Figure 4-23. </span>Q-Q for S&amp;P 500 log returns</h6>
</div></figure>

<p>The Python code that follows conducts the statistical tests regarding the normality of the real financial returns for a selection of the financial time series from the data set. Real financial returns regularly fail such tests. Therefore, it is safe to conclude that the normality assumption about financial returns hardly, if at all, describes financial 
<span class="keep-together">reality:</span></p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">28</code><code class="p">]:</code> <code class="n">symbols</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'.SPX'</code><code class="p">,</code> <code class="s1">'AMZN.O'</code><code class="p">,</code> <code class="s1">'EUR='</code><code class="p">,</code> <code class="s1">'GLD'</code><code class="p">]</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="k">for</code> <code class="n">sym</code> <code class="ow">in</code> <code class="n">symbols</code><code class="p">:</code>
             <code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="se">\n</code><code class="s1">{}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">sym</code><code class="p">))</code>
             <code class="k">print</code><code class="p">(</code><code class="mi">45</code> <code class="o">*</code> <code class="s1">'='</code><code class="p">)</code>
             <code class="n">print_statistics</code><code class="p">(</code><code class="n">rets</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">values</code><code class="p">)</code>

         <code class="o">.</code><code class="n">SPX</code>
         <code class="o">=============================================</code>
         <code class="n">RETURN</code> <code class="n">SAMPLE</code> <code class="n">STATISTICS</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Skew</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code> <code class="o">-</code><code class="mf">0.497160</code>
         <code class="n">Skew</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Kurt</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">4.598167</code>
         <code class="n">Kurt</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>         <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>

         <code class="n">AMZN</code><code class="o">.</code><code class="n">O</code>
         <code class="o">=============================================</code>
         <code class="n">RETURN</code> <code class="n">SAMPLE</code> <code class="n">STATISTICS</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Skew</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">0.135268</code>
         <code class="n">Skew</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.005689</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Kurt</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">7.344837</code>
         <code class="n">Kurt</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>         <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>

         <code class="n">EUR</code><code class="o">=</code>
         <code class="o">=============================================</code>
         <code class="n">RETURN</code> <code class="n">SAMPLE</code> <code class="n">STATISTICS</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Skew</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code> <code class="o">-</code><code class="mf">0.053959</code>
         <code class="n">Skew</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.268203</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Kurt</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">1.780899</code>
         <code class="n">Kurt</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>         <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>

         <code class="n">GLD</code>
         <code class="o">=============================================</code>
         <code class="n">RETURN</code> <code class="n">SAMPLE</code> <code class="n">STATISTICS</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Skew</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code> <code class="o">-</code><code class="mf">0.581025</code>
         <code class="n">Skew</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Kurt</code> <code class="n">of</code> <code class="n">Sample</code> <code class="n">Log</code> <code class="n">Returns</code>  <code class="mf">5.899701</code>
         <code class="n">Kurt</code> <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>    <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code>
         <code class="n">Normal</code> <code class="n">Test</code> <code class="n">p</code><code class="o">-</code><code class="n">value</code>         <code class="mf">0.000000</code>
         <code class="o">---------------------------------------------</code></pre>
<div data-type="warning" epub:type="warning"><h1>Normality Assumption</h1>
<p>Although the normality assumption is a good approximation for many real-world phenomena, such as in physics, it is not appropriate and can even be dangerous when it comes to financial returns. Almost no financial return sample data set passes statistical normality tests. Beyond the fact that it has proven useful in other domains, a major reason why this assumption is found in so many financial models is that it leads to elegant and relatively simple mathematical models, calculations, and proofs.<a data-type="indexterm" data-primary="" data-startref="ix_norm_distrib_returns" id="idm45625311704824"/><a data-type="indexterm" data-primary="" data-startref="ix_returns_norm_distrib" id="idm45625311703848"/></p>
</div>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Linear Relationships"><div class="sect2" id="idm45625311702648">
<h2>Linear Relationships</h2>

<p><a data-type="indexterm" data-primary="expected returns" data-secondary="under CAPM" data-secondary-sortas="CAPM" id="ix_expect_return_capm_2"/><a data-type="indexterm" data-primary="linear relationship assumption" id="ix_linear_relation_assump"/><a data-type="indexterm" data-primary="CAPM (capital asset pricing model)" data-secondary="linear relationship assumption and" id="ix_capm_linear_relation"/>Similar to the “omnipresence” of the normality assumption in financial models and theories, <em>linear relationships</em> between variables seem to be another widespread benchmark. This sub-section considers an important one, namely the assumed linear relationship in the CAPM between the beta of a stock and its expected (realized) return. Generally speaking, the higher the beta is, the higher the expected return given a positive market performance will be—in a fixed proportional way as given by the beta value itself.</p>

<p>Recall the calculation of the betas, the CAPM expected returns, and the realized returns for a selection of technology stocks from the previous section, which is repeated in the following Python code for convenience. This time, the beta values are added to the results’ <code>DataFrame</code> object as well.</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">30</code><code class="p">]:</code> <code class="n">r</code> <code class="o">=</code> <code class="mf">0.005</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">31</code><code class="p">]:</code> <code class="n">market</code> <code class="o">=</code> <code class="s1">'.SPX'</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">32</code><code class="p">]:</code> <code class="n">res</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">()</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">33</code><code class="p">]:</code> <code class="k">for</code> <code class="n">sym</code> <code class="ow">in</code> <code class="n">rets</code><code class="o">.</code><code class="n">columns</code><code class="p">[:</code><code class="mi">4</code><code class="p">]:</code>
             <code class="k">for</code> <code class="n">year</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code> <code class="mi">2019</code><code class="p">):</code>
                 <code class="n">rets_</code> <code class="o">=</code> <code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'{year}-01-01'</code><code class="p">:</code><code class="n">f</code><code class="s1">'{year}-12-31'</code><code class="p">]</code>
                 <code class="n">muM</code> <code class="o">=</code> <code class="n">rets_</code><code class="p">[</code><code class="n">market</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">*</code> <code class="mi">252</code>
                 <code class="n">cov</code> <code class="o">=</code> <code class="n">rets_</code><code class="o">.</code><code class="n">cov</code><code class="p">()</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">sym</code><code class="p">,</code> <code class="n">market</code><code class="p">]</code>
                 <code class="n">var</code> <code class="o">=</code> <code class="n">rets_</code><code class="p">[</code><code class="n">market</code><code class="p">]</code><code class="o">.</code><code class="n">var</code><code class="p">()</code>
                 <code class="n">beta</code> <code class="o">=</code> <code class="n">cov</code> <code class="o">/</code> <code class="n">var</code>
                 <code class="n">rets_</code> <code class="o">=</code> <code class="n">rets</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="n">f</code><code class="s1">'{year + 1}-01-01'</code><code class="p">:</code><code class="n">f</code><code class="s1">'{year + 1}-12-31'</code><code class="p">]</code>
                 <code class="n">muM</code> <code class="o">=</code> <code class="n">rets_</code><code class="p">[</code><code class="n">market</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">*</code> <code class="mi">252</code>
                 <code class="n">mu_capm</code> <code class="o">=</code> <code class="n">r</code> <code class="o">+</code> <code class="n">beta</code> <code class="o">*</code> <code class="p">(</code><code class="n">muM</code> <code class="o">-</code> <code class="n">r</code><code class="p">)</code>
                 <code class="n">mu_real</code> <code class="o">=</code> <code class="n">rets_</code><code class="p">[</code><code class="n">sym</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">*</code> <code class="mi">252</code>
                 <code class="n">res</code> <code class="o">=</code> <code class="n">res</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'symbol'</code><code class="p">:</code> <code class="n">sym</code><code class="p">,</code>
                                                <code class="s1">'beta'</code><code class="p">:</code> <code class="n">beta</code><code class="p">,</code>
                                                <code class="s1">'mu_capm'</code><code class="p">:</code> <code class="n">mu_capm</code><code class="p">,</code>
                                                <code class="s1">'mu_real'</code><code class="p">:</code> <code class="n">mu_real</code><code class="p">},</code>
                                               <code class="n">index</code><code class="o">=</code><code class="p">[</code><code class="n">year</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]),</code>
                                 <code class="n">sort</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code></pre>

<p>The following analysis calculates the <math alttext="upper R squared">
  <msup><mi>R</mi> <mn>2</mn> </msup>
</math> score for a linear regression for which the beta is the independent variable and the <em>expected CAPM return</em>, given the market portfolio performance, is the dependent variable. <math alttext="upper R squared">
  <msup><mi>R</mi> <mn>2</mn> </msup>
</math> refers to the <em>coefficient of determination</em> and measures how well a model performs compared to a baseline predictor in the form of a simple mean value. The linear regression can only explain around 10% of the variability in the expected CAPM return, a pretty low value, which is also confirmed through <a data-type="xref" href="#figure_ddf_21">Figure 4-24</a>:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">34</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">sklearn.metrics</code> <code class="kn">import</code> <code class="n">r2_score</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">35</code><code class="p">]:</code> <code class="n">reg</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">],</code> <code class="n">res</code><code class="p">[</code><code class="s1">'mu_capm'</code><code class="p">],</code> <code class="n">deg</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>
         <code class="n">res</code><code class="p">[</code><code class="s1">'mu_capm_ols'</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code> <code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">])</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">36</code><code class="p">]:</code> <code class="n">r2_score</code><code class="p">(</code><code class="n">res</code><code class="p">[</code><code class="s1">'mu_capm'</code><code class="p">],</code> <code class="n">res</code><code class="p">[</code><code class="s1">'mu_capm_ols'</code><code class="p">])</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">36</code><code class="p">]:</code> <code class="mf">0.09272355783573516</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">37</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'scatter'</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'beta'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'mu_capm'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">x</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">]</code><code class="o">.</code><code class="n">min</code><code class="p">(),</code> <code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">]</code><code class="o">.</code><code class="n">max</code><code class="p">())</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">x</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code> <code class="n">x</code><code class="p">),</code> <code class="s1">'g--'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'regression'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">();</code></pre>

<figure class="thumb"><div id="figure_ddf_21" class="figure">
<img src="Images/aiif_0424.png" alt="aiif 0424" width="2507" height="1482"/>
<h6><span class="label">Figure 4-24. </span>Expected CAPM return versus beta (including linear regression)</h6>
</div></figure>

<p>For the <em>realized return</em>, the explanatory power of the linear regression is even lower, with about 4.5% (see <a data-type="xref" href="#figure_ddf_22">Figure 4-25</a>). The linear regressions recover the positive relationship between beta and stock returns—“the higher the beta, the higher the return given the (positive) market portfolio performance”—as indicated by the positive slope of the regression lines. However, they only explain a small part of the observed overall variability in the stock returns:</p>

<pre data-type="programlisting" data-code-language="python"><code class="n">In</code> <code class="p">[</code><code class="mi">38</code><code class="p">]:</code> <code class="n">reg</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">],</code> <code class="n">res</code><code class="p">[</code><code class="s1">'mu_real'</code><code class="p">],</code> <code class="n">deg</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code>
         <code class="n">res</code><code class="p">[</code><code class="s1">'mu_real_ols'</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code> <code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">])</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">39</code><code class="p">]:</code> <code class="n">r2_score</code><code class="p">(</code><code class="n">res</code><code class="p">[</code><code class="s1">'mu_real'</code><code class="p">],</code> <code class="n">res</code><code class="p">[</code><code class="s1">'mu_real_ols'</code><code class="p">])</code>
<code class="n">Out</code><code class="p">[</code><code class="mi">39</code><code class="p">]:</code> <code class="mf">0.04466919444752959</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">40</code><code class="p">]:</code> <code class="n">res</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">kind</code><code class="o">=</code><code class="s1">'scatter'</code><code class="p">,</code> <code class="n">x</code><code class="o">=</code><code class="s1">'beta'</code><code class="p">,</code> <code class="n">y</code><code class="o">=</code><code class="s1">'mu_real'</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">6</code><code class="p">))</code>
         <code class="n">x</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">]</code><code class="o">.</code><code class="n">min</code><code class="p">(),</code> <code class="n">res</code><code class="p">[</code><code class="s1">'beta'</code><code class="p">]</code><code class="o">.</code><code class="n">max</code><code class="p">())</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">x</code><code class="p">,</code> <code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code> <code class="n">x</code><code class="p">),</code> <code class="s1">'g--'</code><code class="p">,</code> <code class="n">label</code><code class="o">=</code><code class="s1">'regression'</code><code class="p">)</code>
         <code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">();</code></pre>

<figure class="thumb"><div id="figure_ddf_22" class="figure">
<img src="Images/aiif_0425.png" alt="aiif 0425" width="2518" height="1482"/>
<h6><span class="label">Figure 4-25. </span>Expected CAPM return versus beta (including linear regression)</h6>
</div></figure>
<div data-type="warning" epub:type="warning"><h1>Linear Relationships</h1>
<p>As with the normality assumptions, linear relationships can often be observed in the physical world. However, in finance there are hardly any cases in which variables depend on each other in a clearly linear way. From a modeling point of view, linear relationships lead, as does the normality assumption, to elegant and relatively simple mathematical models, calculations, and proofs. In addition, the standard tool in financial econometrics, OLS regression, is well suited to dealing with linear relationships in data. These are major reasons why normality and linearity are often deliberately chosen as convenient building blocks of financial 
<span class="keep-together">models</span> and theories.<a data-type="indexterm" data-primary="" data-startref="ix_data-driven_fin_ch4" id="idm45625310770616"/><a data-type="indexterm" data-primary="" data-startref="ix_data-driven_fin_debunk" id="idm45625310769608"/><a data-type="indexterm" data-primary="" data-startref="ix_capm_linear_relation" id="idm45625310768696"/><a data-type="indexterm" data-primary="" data-startref="ix_expect_return_capm_2" id="idm45625310767752"/><a data-type="indexterm" data-primary="" data-startref="ix_linear_relation_assump" id="idm45625310766808"/></p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusions"><div class="sect1" id="idm45625311702056">
<h1>Conclusions</h1>

<p>Science has been driven for centuries by the rigorous generation and analysis of data. However, finance used to be characterized by normative theories based on simplified mathematical models of the financial markets, relying on assumptions such as normality of returns and linear relationships. The almost universal and comprehensive availability of (financial) data has led to a shift in focus from a <em>theory-first</em> approach to <em>data-driven</em> finance. Several examples based on real financial data illustrate that many popular financial models and theories cannot survive a confrontation with financial market realities. Although elegant, they might be too simplistic to capture the complexities, changing nature, and nonlinearities of financial markets.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="References"><div class="sect1" id="idm45625310762600">
<h1>References</h1>

<p>Books and papers cited in this chapter:</p>

<ul class="author-date-bib">
<li>
<p>Allais, M. 1953. “Le Comportement de l’Homme Rationnel devant le Risque: Critique des Postulats et Axiomes de l’Ecole Americaine.” <em>Econometrica</em> 21 (4): 503-546.</p>
</li>
<li>
<p>Alexander, Carol. 2008a. <em>Quantitative Methods in Finance</em>. Market Risk Analysis I, West Sussex: John Wiley &amp; Sons.</p>
</li>
<li>
<p>⸻. 2008b. <em>Practical Financial Econometrics</em>. Market Risk Analysis II, West Sussex: John Wiley &amp; Sons.</p>
</li>
<li>
<p>Bender, Jennifer et al. 2013. “Foundations of Factor Investing.” <em>MSCI Research Insight</em>. <a href="http://bit.ly/aiif_factor_invest"><em class="hyperlink">http://bit.ly/aiif_factor_invest</em></a>.</p>
</li>
<li>
<p>Campbell, John Y. 2018. <em>Financial Decisions and Markets: A Course in Asset Pricing.</em> Princeton and Oxford: Princeton University Press.</p>
</li>
<li>
<p>Ellsberg, Daniel. 1961. “Risk, Ambiguity, and the Savage Axioms.” <em>Quarterly Journal of Economics</em> 75 (4): 643-669.</p>
</li>
<li>
<p>Fontaine, Philippe and Robert Leonard. 2005. <em>The Experiment in the History of Economics</em>. London and New York: Routledge.</p>
</li>
<li>
<p>Kopf, Dan. 2015. “The Discovery of Statistical Regression.” <em>Priceonomics</em>, November 6, 2015. <a href="http://bit.ly/aiif_ols"><em class="hyperlink">http://bit.ly/aiif_ols</em></a>.</p>
</li>
<li>
<p>Lee, Kai-Fu. 2018. <em>AI Superpowers: China, Silicon Valley, and the New World Order.</em> Boston and New York: Houghton Mifflin Harcourt.</p>
</li>
<li>
<p>Sapolsky, Robert M. 2018. <em>Behave: The Biology of Humans at Our Best and Worst.</em> New York: Penguin Books.</p>
</li>
<li>
<p>Savage, Leonard J. (1954) 1972. <em>The Foundations of Statistics.</em> 2nd ed. New York: Dover Publications.</p>
</li>
<li>
<p>Wigglesworth, Robin. 2019. “How Investment Analysts Became Data Miners.” <em>Financial Times</em>, November 28, 2019. <a href="https://oreil.ly/QJGtd"><em class="hyperlink">https://oreil.ly/QJGtd</em></a>.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Python Code"><div class="sect1" id="nlp_functions">
<h1>Python Code</h1>

<p><a data-type="indexterm" data-primary="NLP (natural language processing)" id="idm45625310739320"/>The following Python file contains a number of helper functions to simplify certain tasks in NLP:</p>

<pre data-type="programlisting" data-code-language="python"><code class="c1">#</code>
<code class="c1"># NLP Helper Functions</code>
<code class="c1">#</code>
<code class="c1"># Artificial Intelligence in Finance</code>
<code class="c1"># (c) Dr Yves J Hilpisch</code>
<code class="c1"># The Python Quants GmbH</code>
<code class="c1">#</code>
<code class="kn">import</code> <code class="nn">re</code>
<code class="kn">import</code> <code class="nn">nltk</code>
<code class="kn">import</code> <code class="nn">string</code>
<code class="kn">import</code> <code class="nn">pandas</code> <code class="kn">as</code> <code class="nn">pd</code>
<code class="kn">from</code> <code class="nn">pylab</code> <code class="kn">import</code> <code class="n">plt</code>
<code class="kn">from</code> <code class="nn">wordcloud</code> <code class="kn">import</code> <code class="n">WordCloud</code>
<code class="kn">from</code> <code class="nn">nltk.corpus</code> <code class="kn">import</code> <code class="n">stopwords</code>
<code class="kn">from</code> <code class="nn">nltk.corpus</code> <code class="kn">import</code> <code class="n">wordnet</code> <code class="k">as</code> <code class="n">wn</code>
<code class="kn">from</code> <code class="nn">lxml.html.clean</code> <code class="kn">import</code> <code class="n">Cleaner</code>
<code class="kn">from</code> <code class="nn">sklearn.feature_extraction.text</code> <code class="kn">import</code> <code class="n">TfidfVectorizer</code>
<code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s1">'seaborn'</code><code class="p">)</code>

<code class="n">cleaner</code> <code class="o">=</code> <code class="n">Cleaner</code><code class="p">(</code><code class="n">style</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code> <code class="n">links</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code> <code class="n">allow_tags</code><code class="o">=</code><code class="p">[</code><code class="s1">''</code><code class="p">],</code>
                  <code class="n">remove_unknown_tags</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code>

<code class="n">stop_words</code> <code class="o">=</code> <code class="n">stopwords</code><code class="o">.</code><code class="n">words</code><code class="p">(</code><code class="s1">'english'</code><code class="p">)</code>
<code class="n">stop_words</code><code class="o">.</code><code class="n">extend</code><code class="p">([</code><code class="s1">'new'</code><code class="p">,</code> <code class="s1">'old'</code><code class="p">,</code> <code class="s1">'pro'</code><code class="p">,</code> <code class="s1">'open'</code><code class="p">,</code> <code class="s1">'menu'</code><code class="p">,</code> <code class="s1">'close'</code><code class="p">])</code>


<code class="k">def</code> <code class="nf">remove_non_ascii</code><code class="p">(</code><code class="n">s</code><code class="p">):</code>
    <code class="sd">''' Removes all non-ascii characters.</code>
<code class="sd">    '''</code>
    <code class="k">return</code> <code class="s1">''</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">i</code> <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="n">s</code> <code class="k">if</code> <code class="nb">ord</code><code class="p">(</code><code class="n">i</code><code class="p">)</code> <code class="o">&lt;</code> <code class="mi">128</code><code class="p">)</code>

<code class="k">def</code> <code class="nf">clean_up_html</code><code class="p">(</code><code class="n">t</code><code class="p">):</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">cleaner</code><code class="o">.</code><code class="n">clean_html</code><code class="p">(</code><code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s1">'[</code><code class="se">\n\t\r</code><code class="s1">]'</code><code class="p">,</code> <code class="s1">' '</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s1">' +'</code><code class="p">,</code> <code class="s1">' '</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s1">'&lt;.*?&gt;'</code><code class="p">,</code> <code class="s1">''</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">remove_non_ascii</code><code class="p">(</code><code class="n">t</code><code class="p">)</code>
    <code class="k">return</code> <code class="n">t</code>

<code class="k">def</code> <code class="nf">clean_up_text</code><code class="p">(</code><code class="n">t</code><code class="p">,</code> <code class="n">numbers</code><code class="o">=</code><code class="bp">False</code><code class="p">,</code> <code class="n">punctuation</code><code class="o">=</code><code class="bp">False</code><code class="p">):</code>
    <code class="sd">''' Cleans up a text, e.g. HTML document,</code>
<code class="sd">        from HTML tags and also cleans up the</code>
<code class="sd">        text body.</code>
<code class="sd">    '''</code>
    <code class="k">try</code><code class="p">:</code>
        <code class="n">t</code> <code class="o">=</code> <code class="n">clean_up_html</code><code class="p">(</code><code class="n">t</code><code class="p">)</code>
    <code class="k">except</code><code class="p">:</code>
        <code class="k">pass</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">t</code><code class="o">.</code><code class="n">lower</code><code class="p">()</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"what's"</code><code class="p">,</code> <code class="s2">"what is "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">t</code><code class="o">.</code><code class="n">replace</code><code class="p">(</code><code class="s1">'(ap)'</code><code class="p">,</code> <code class="s1">''</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"\'ve"</code><code class="p">,</code> <code class="s2">" have "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"can't"</code><code class="p">,</code> <code class="s2">"cannot "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"n't"</code><code class="p">,</code> <code class="s2">" not "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"i'm"</code><code class="p">,</code> <code class="s2">"i am "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"\'s"</code><code class="p">,</code> <code class="s2">""</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"\'re"</code><code class="p">,</code> <code class="s2">" are "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"\'d"</code><code class="p">,</code> <code class="s2">" would "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"\'ll"</code><code class="p">,</code> <code class="s2">" will "</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s1">'\s+'</code><code class="p">,</code> <code class="s1">' '</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"</code><code class="se">\\</code><code class="s2">"</code><code class="p">,</code> <code class="s2">""</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"\'"</code><code class="p">,</code> <code class="s2">""</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s2">"</code><code class="se">\"</code><code class="s2">"</code><code class="p">,</code> <code class="s2">""</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="k">if</code> <code class="n">numbers</code><code class="p">:</code>
        <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s1">'[^a-zA-Z ?!]+'</code><code class="p">,</code> <code class="s1">''</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="k">if</code> <code class="n">punctuation</code><code class="p">:</code>
        <code class="n">t</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="s-Affix">r</code><code class="s1">'\W+'</code><code class="p">,</code> <code class="s1">' '</code><code class="p">,</code> <code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">remove_non_ascii</code><code class="p">(</code><code class="n">t</code><code class="p">)</code>
    <code class="n">t</code> <code class="o">=</code> <code class="n">t</code><code class="o">.</code><code class="n">strip</code><code class="p">()</code>
    <code class="k">return</code> <code class="n">t</code>

<code class="k">def</code> <code class="nf">nltk_lemma</code><code class="p">(</code><code class="n">word</code><code class="p">):</code>
    <code class="sd">''' If one exists, returns the lemma of a word.</code>
<code class="sd">        I.e. the base or dictionary version of it.</code>
<code class="sd">    '''</code>
    <code class="n">lemma</code> <code class="o">=</code> <code class="n">wn</code><code class="o">.</code><code class="n">morphy</code><code class="p">(</code><code class="n">word</code><code class="p">)</code>
    <code class="k">if</code> <code class="n">lemma</code> <code class="ow">is</code> <code class="bp">None</code><code class="p">:</code>
        <code class="k">return</code> <code class="n">word</code>
    <code class="k">else</code><code class="p">:</code>
        <code class="k">return</code> <code class="n">lemma</code>

<code class="k">def</code> <code class="nf">tokenize</code><code class="p">(</code><code class="n">text</code><code class="p">,</code> <code class="n">min_char</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code> <code class="n">lemma</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code> <code class="n">stop</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>
             <code class="n">numbers</code><code class="o">=</code><code class="bp">False</code><code class="p">):</code>
    <code class="sd">''' Tokenizes a text and implements some</code>
<code class="sd">        transformations.</code>
<code class="sd">    '''</code>
    <code class="n">tokens</code> <code class="o">=</code> <code class="n">nltk</code><code class="o">.</code><code class="n">word_tokenize</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>
    <code class="n">tokens</code> <code class="o">=</code> <code class="p">[</code><code class="n">t</code> <code class="k">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="n">tokens</code> <code class="k">if</code> <code class="nb">len</code><code class="p">(</code><code class="n">t</code><code class="p">)</code> <code class="o">&gt;=</code> <code class="n">min_char</code><code class="p">]</code>
    <code class="k">if</code> <code class="n">numbers</code><code class="p">:</code>
        <code class="n">tokens</code> <code class="o">=</code> <code class="p">[</code><code class="n">t</code> <code class="k">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="n">tokens</code> <code class="k">if</code> <code class="n">t</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="o">.</code><code class="n">lower</code><code class="p">()</code>
                  <code class="ow">in</code> <code class="n">string</code><code class="o">.</code><code class="n">ascii_lowercase</code><code class="p">]</code>
    <code class="k">if</code> <code class="n">stop</code><code class="p">:</code>
        <code class="n">tokens</code> <code class="o">=</code> <code class="p">[</code><code class="n">t</code> <code class="k">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="n">tokens</code> <code class="k">if</code> <code class="n">t</code> <code class="ow">not</code> <code class="ow">in</code> <code class="n">stop_words</code><code class="p">]</code>
    <code class="k">if</code> <code class="n">lemma</code><code class="p">:</code>
        <code class="n">tokens</code> <code class="o">=</code> <code class="p">[</code><code class="n">nltk_lemma</code><code class="p">(</code><code class="n">t</code><code class="p">)</code> <code class="k">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="n">tokens</code><code class="p">]</code>
    <code class="k">return</code> <code class="n">tokens</code>

<code class="k">def</code> <code class="nf">generate_word_cloud</code><code class="p">(</code><code class="n">text</code><code class="p">,</code> <code class="n">no</code><code class="p">,</code> <code class="n">name</code><code class="o">=</code><code class="bp">None</code><code class="p">,</code> <code class="n">show</code><code class="o">=</code><code class="bp">True</code><code class="p">):</code>
    <code class="sd">''' Generates a word cloud bitmap given a</code>
<code class="sd">        text document (string).</code>
<code class="sd">        It uses the Term Frequency (TF) and</code>
<code class="sd">        Inverse Document Frequency (IDF)</code>
<code class="sd">        vectorization approach to derive the</code>
<code class="sd">        importance of a word -- represented</code>
<code class="sd">        by the size of the word in the word cloud.</code>

<code class="sd">    Parameters</code>
<code class="sd">    ==========</code>
<code class="sd">    text: str</code>
<code class="sd">        text as the basis</code>
<code class="sd">    no: int</code>
<code class="sd">        number of words to be included</code>
<code class="sd">    name: str</code>
<code class="sd">        path to save the image</code>
<code class="sd">    show: bool</code>
<code class="sd">        whether to show the generated image or not</code>
<code class="sd">    '''</code>
    <code class="n">tokens</code> <code class="o">=</code> <code class="n">tokenize</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>
    <code class="n">vec</code> <code class="o">=</code> <code class="n">TfidfVectorizer</code><code class="p">(</code><code class="n">min_df</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code>
                      <code class="n">analyzer</code><code class="o">=</code><code class="s1">'word'</code><code class="p">,</code>
                      <code class="n">ngram_range</code><code class="o">=</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">),</code>
                      <code class="n">stop_words</code><code class="o">=</code><code class="s1">'english'</code>
                     <code class="p">)</code>
    <code class="n">vec</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">tokens</code><code class="p">)</code>
    <code class="n">wc</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'words'</code><code class="p">:</code> <code class="n">vec</code><code class="o">.</code><code class="n">get_feature_names</code><code class="p">(),</code>
                       <code class="s1">'tfidf'</code><code class="p">:</code> <code class="n">vec</code><code class="o">.</code><code class="n">idf_</code><code class="p">})</code>
    <code class="n">words</code> <code class="o">=</code> <code class="s1">' '</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="n">wc</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="s1">'tfidf'</code><code class="p">,</code> <code class="n">ascending</code><code class="o">=</code><code class="bp">True</code><code class="p">)[</code><code class="s1">'words'</code><code class="p">]</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="n">no</code><code class="p">))</code>
    <code class="n">wordcloud</code> <code class="o">=</code> <code class="n">WordCloud</code><code class="p">(</code><code class="n">max_font_size</code><code class="o">=</code><code class="mi">110</code><code class="p">,</code>
                      <code class="n">background_color</code><code class="o">=</code><code class="s1">'white'</code><code class="p">,</code>
                      <code class="n">width</code><code class="o">=</code><code class="mi">1024</code><code class="p">,</code> <code class="n">height</code><code class="o">=</code><code class="mi">768</code><code class="p">,</code>
                      <code class="n">margin</code><code class="o">=</code><code class="mi">10</code><code class="p">,</code> <code class="n">max_words</code><code class="o">=</code><code class="mi">150</code><code class="p">)</code><code class="o">.</code><code class="n">generate</code><code class="p">(</code><code class="n">words</code><code class="p">)</code>
    <code class="k">if</code> <code class="n">show</code><code class="p">:</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">10</code><code class="p">))</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">imshow</code><code class="p">(</code><code class="n">wordcloud</code><code class="p">,</code> <code class="n">interpolation</code><code class="o">=</code><code class="s1">'bilinear'</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">axis</code><code class="p">(</code><code class="s1">'off'</code><code class="p">)</code>
        <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code>
    <code class="k">if</code> <code class="n">name</code> <code class="ow">is</code> <code class="ow">not</code> <code class="bp">None</code><code class="p">:</code>
        <code class="n">wordcloud</code><code class="o">.</code><code class="n">to_file</code><code class="p">(</code><code class="n">name</code><code class="p">)</code>

<code class="k">def</code> <code class="nf">generate_key_words</code><code class="p">(</code><code class="n">text</code><code class="p">,</code> <code class="n">no</code><code class="p">):</code>
    <code class="k">try</code><code class="p">:</code>
        <code class="n">tokens</code> <code class="o">=</code> <code class="n">tokenize</code><code class="p">(</code><code class="n">text</code><code class="p">)</code>
        <code class="n">vec</code> <code class="o">=</code> <code class="n">TfidfVectorizer</code><code class="p">(</code><code class="n">min_df</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code>
                      <code class="n">analyzer</code><code class="o">=</code><code class="s1">'word'</code><code class="p">,</code>
                      <code class="n">ngram_range</code><code class="o">=</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">),</code>
                      <code class="n">stop_words</code><code class="o">=</code><code class="s1">'english'</code>
                     <code class="p">)</code>

        <code class="n">vec</code><code class="o">.</code><code class="n">fit_transform</code><code class="p">(</code><code class="n">tokens</code><code class="p">)</code>
        <code class="n">wc</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">({</code><code class="s1">'words'</code><code class="p">:</code> <code class="n">vec</code><code class="o">.</code><code class="n">get_feature_names</code><code class="p">(),</code>
                       <code class="s1">'tfidf'</code><code class="p">:</code> <code class="n">vec</code><code class="o">.</code><code class="n">idf_</code><code class="p">})</code>
        <code class="n">words</code> <code class="o">=</code> <code class="n">wc</code><code class="o">.</code><code class="n">sort_values</code><code class="p">(</code><code class="s1">'tfidf'</code><code class="p">,</code> <code class="n">ascending</code><code class="o">=</code><code class="bp">False</code><code class="p">)[</code><code class="s1">'words'</code><code class="p">]</code><code class="o">.</code><code class="n">values</code>
        <code class="n">words</code> <code class="o">=</code> <code class="p">[</code> <code class="n">a</code> <code class="k">for</code> <code class="n">a</code> <code class="ow">in</code> <code class="n">words</code> <code class="k">if</code> <code class="ow">not</code> <code class="n">a</code><code class="o">.</code><code class="n">isnumeric</code><code class="p">()][:</code><code class="n">no</code><code class="p">]</code>
    <code class="k">except</code><code class="p">:</code>
        <code class="n">words</code> <code class="o">=</code> <code class="nb">list</code><code class="p">()</code>
    <code class="k">return</code> <code class="n">words</code></pre>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45625324920136"><sup><a href="ch04.xhtml#idm45625324920136-marker">1</a></sup> See, for example, Kopf (2015).</p><p data-type="footnote" id="idm45625324874120"><sup><a href="ch04.xhtml#idm45625324874120-marker">2</a></sup> This data service is only available via a paid subscription.</p><p data-type="footnote" id="idm45625324543064"><sup><a href="ch04.xhtml#idm45625324543064-marker">3</a></sup> <code>RIC</code> stands for <em>Reuters Instrument Code</em>.</p><p data-type="footnote" id="idm45625313161960"><sup><a href="ch04.xhtml#idm45625313161960-marker">4</a></sup> Numbers generated by the random number generator of <code>NumPy</code> are <em>pseudorandom numbers</em>, although they are referenced throughout the book as <em>random numbers</em>.</p></div></div></section></div>



  </body></html>