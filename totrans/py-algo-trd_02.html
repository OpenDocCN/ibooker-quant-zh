<html><head></head><body><section data-pdf-bookmark="Chapter 2. Python Infrastructure" data-type="chapter" epub:type="chapter"><div class="chapter" id="python_environment">&#13;
<h1><span class="label">Chapter 2. </span>Python Infrastructure</h1>&#13;
&#13;
<blockquote data-type="epigraph" epub:type="epigraph">&#13;
    <p>In building a house, there is the problem of the selection of wood.</p>&#13;
&#13;
    <p>It is essential that the carpenter’s aim be to carry equipment that will cut well and, when he has time, to sharpen that equipment.</p>&#13;
    <p data-type="attribution">Miyamoto Musashi (<em>The Book of Five Rings</em>)</p>&#13;
  </blockquote>&#13;
&#13;
<p><a data-primary="Python infrastructure" data-type="indexterm" id="ix_02_python_environment_-asciidoc0"/><a data-primary="Musashi, Miyamoto" data-type="indexterm" id="idm45785393619112"/>For someone new to Python, Python deployment might seem all but straightforward. The same holds true for the wealth of libraries and packages that can be installed optionally. First of all, there is not only one Python. Python comes in many different flavors, like CPython, Jython, IronPython, or PyPy. Then there is still the divide between Python 2.7 and the 3.x world. <a data-primary="CPython" data-type="indexterm" id="idm45785393617928"/>This chapter focuses on <em>CPython</em>, the most popular version of the Python programming language, and on version 3.8.</p>&#13;
&#13;
<p><a data-primary="Python (generally)" data-secondary="deployment difficulties" data-type="indexterm" id="idm45785393616456"/>Even when focusing on CPython 3.8 (henceforth just “Python”), deployment is made difficult due to a number of reasons:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The interpreter (a standard CPython installation) only comes with the so-called <em>standard library</em> (e.g. covering typical mathematical functions).</p>&#13;
</li>&#13;
<li>&#13;
<p>Optional Python packages need to be installed separately, and there are hundreds of them.</p>&#13;
</li>&#13;
<li>&#13;
<p>Compiling (“building”) such non-standard packages on your own can be tricky due to dependencies and operating system–specific requirements.</p>&#13;
</li>&#13;
<li>&#13;
<p>Taking care of such dependencies and of version consistency over time (maintenance) is often tedious and time consuming.</p>&#13;
</li>&#13;
<li>&#13;
<p>Updates and upgrades for certain packages might cause the need for recompiling a multitude of other packages.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<ul class="pagebreak-before less_space">&#13;
<li>&#13;
<p>Changing or replacing one package might cause trouble in (many) other places.</p>&#13;
</li>&#13;
<li>&#13;
<p>Migrating from one Python version to another one at some later point might amplify all the preceding issues.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Fortunately, there are tools and strategies available that help with the Python deployment issue. This chapter covers the following types of technologies that help with Python deployment:</p>&#13;
<dl>&#13;
<dt>Package manager</dt>&#13;
<dd>&#13;
<p>Package managers like <a href="https://oreil.ly/5vKCa"><code>pip</code></a> or <a href="https://oreil.ly/uTZRn"><code>conda</code></a> help with the installing, updating, and removing of Python packages. They also help with version consistency of different packages.</p>&#13;
</dd>&#13;
<dt>Virtual environment manager</dt>&#13;
<dd>&#13;
<p>A virtual environment manager like <a href="https://oreil.ly/xMnlC"><code>virtualenv</code></a> or <code>conda</code> allows one to manage multiple Python installations in parallel (for example, to have both a Python 2.7 and 3.8 installation on a single machine or to test the most recent development version of a fancy Python package without risk).<sup><a data-type="noteref" href="ch02.html#idm45785393599784" id="idm45785393599784-marker">1</a></sup></p>&#13;
</dd>&#13;
<dt>Container</dt>&#13;
<dd>&#13;
<p><a href="http://docker.com">Docker</a> containers represent complete file systems containing all pieces of a system needed to run a certain software, such as code, runtime, or system tools. For example, you can run a Ubuntu 20.04 operating system with a Python 3.8 installation and the respective Python codes in a Docker container hosted on a machine running Mac OS or Windows 10. Such a containerized environment can then also be deployed later in the cloud without any major changes.</p>&#13;
</dd>&#13;
<dt>Cloud instance</dt>&#13;
<dd>&#13;
<p>Deploying Python code for financial applications generally requires high availability, security, and performance. These requirements can typically be met only by the use of professional compute and storage infrastructure that is nowadays available at attractive conditions in the form of fairly small to really large and powerful cloud instances. One benefit of a cloud instance (virtual server) compared to a dedicated server rented longer term is that users generally get charged only for the hours of actual usage. Another advantage is that such cloud instances are available literally in a minute or two if needed, which helps with agile development and scalability.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The structure of this chapter is as follows. <a data-type="xref" href="#conda_package">“Conda as a Package Manager”</a> introduces <code>conda</code> as a package manager for Python. <a data-type="xref" href="#conda_environment">“Conda as a Virtual Environment Manager”</a> focuses on <code>conda</code> capabilities for virtual environment management. <a data-type="xref" href="#docker_container">“Using Docker Containers”</a> gives a brief overview of Docker as a containerization technology and focuses on the building of a Ubuntu-based container with Python 3.8 installation. <a data-type="xref" href="#cloud_instance">“Using Cloud Instances”</a> shows how to deploy Python and <a href="https://oreil.ly/4LqUS"><code>Jupyter Lab</code></a>, a powerful, browser-based tool suite for Python development and deployment in the cloud.</p>&#13;
&#13;
<p>The goal of this chapter is to have a proper Python installation with the most important tools, as well as numerical, data analysis, and visualization packages, available on a professional infrastructure. This combination then serves as the backbone for implementing and deploying the Python codes in later chapters, be it interactive financial analytics code or code in the form of scripts and modules.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conda as a Package Manager" data-type="sect1"><div class="sect1" id="conda_package">&#13;
<h1>Conda as a Package Manager</h1>&#13;
&#13;
<p><a data-primary="conda" data-secondary="as package manager" data-type="indexterm" id="ix_02_python_environment_-asciidoc1"/><a data-primary="package manager, conda as" data-type="indexterm" id="ix_02_python_environment_-asciidoc2"/><a data-primary="Python infrastructure" data-secondary="conda as package manager" data-type="indexterm" id="ix_02_python_environment_-asciidoc3"/>Although <code>conda</code> can be installed alone, an efficient way of doing it is via <em>Miniconda</em>, a minimal Python distribution that includes <code>conda</code> as a package and virtual environment manager.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Installing Miniconda" data-type="sect2"><div class="sect2" id="idm45785395844408">&#13;
<h2>Installing Miniconda</h2>&#13;
&#13;
<p><a data-primary="conda" data-secondary="installing Miniconda" data-type="indexterm" id="ix_02_python_environment_-asciidoc4"/><a data-primary="Miniconda" data-type="indexterm" id="ix_02_python_environment_-asciidoc5"/>You can download the different versions of Miniconda on the <a href="https://oreil.ly/-Z_6H">Miniconda page</a>. In what follows, the Python 3.8 64-bit version is assumed, which is available for Linux, Windows, and Mac OS. The main example in this sub-section is a session in an Ubuntu-based Docker container, which downloads the Linux 64-bit installer via <code>wget</code> and then installs Miniconda. The code as shown should work (with maybe minor modifications) on any other Linux-based or Mac OS–based machine, as well:<sup><a data-type="noteref" href="ch02.html#idm45785395838952" id="idm45785395838952-marker">2</a></sup></p>&#13;
&#13;
<pre data-type="programlisting">$ docker run -ti -h pyalgo -p 11111:11111 ubuntu:latest /bin/bash&#13;
&#13;
root@pyalgo:/# apt-get update; apt-get upgrade -y&#13;
...&#13;
root@pyalgo:/# apt-get install -y gcc wget&#13;
...&#13;
root@pyalgo:/# cd root&#13;
root@pyalgo:~# wget \&#13;
&gt; https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh \&#13;
&gt; -O miniconda.sh&#13;
...&#13;
HTTP request sent, awaiting response... 200 OK&#13;
Length: 93052469 (89M) [application/x-sh]&#13;
Saving to: 'miniconda.sh'&#13;
&#13;
miniconda.sh              100%[============&gt;]  88.74M  1.60MB/s    in 2m 15s&#13;
&#13;
2020-08-25 11:01:54 (3.08 MB/s) - 'miniconda.sh' saved [93052469/93052469]&#13;
&#13;
root@pyalgo:~# bash miniconda.sh&#13;
&#13;
Welcome to Miniconda3 py38_4.8.3&#13;
&#13;
In order to continue the installation process, please review the license&#13;
agreement.&#13;
Please, press ENTER to continue&#13;
&gt;&gt;&gt;</pre>&#13;
&#13;
<p>Simply pressing the <code>ENTER</code> key starts the installation process. After reviewing the license agreement, approve the terms by answering <code>yes</code>:</p>&#13;
&#13;
<pre data-type="programlisting">...&#13;
Last updated February 25, 2020&#13;
&#13;
Do you accept the license terms? [yes|no]&#13;
[no] &gt;&gt;&gt; yes&#13;
&#13;
Miniconda3 will now be installed into this location:&#13;
/root/miniconda3&#13;
&#13;
  - Press ENTER to confirm the location&#13;
  - Press CTRL-C to abort the installation&#13;
  - Or specify a different location below&#13;
&#13;
[/root/miniconda3] &gt;&gt;&gt;&#13;
PREFIX=/root/miniconda3&#13;
Unpacking payload ...&#13;
Collecting package metadata (current_repodata.json): done&#13;
Solving environment: done&#13;
&#13;
## Package Plan ##&#13;
&#13;
  environment location: /root/miniconda3&#13;
...&#13;
  python             pkgs/main/linux-64::python-3.8.3-hcff3b4d_0&#13;
...&#13;
Preparing transaction: done&#13;
Executing transaction: done&#13;
installation finished.</pre>&#13;
&#13;
<p>After you have agreed to the licensing terms and have confirmed the install location, you should allow Miniconda to prepend the new Miniconda install location to the <code>PATH</code> environment variable by answering <code>yes</code> once again:</p>&#13;
&#13;
<pre data-type="programlisting">Do you wish the installer to initialize Miniconda3&#13;
by running conda init? [yes|no]&#13;
[no] &gt;&gt;&gt; yes&#13;
...&#13;
no change     /root/miniconda3/etc/profile.d/conda.csh&#13;
modified      /root/.bashrc&#13;
&#13;
==&gt; For changes to take effect, close and re-open your current shell. &lt;==&#13;
&#13;
If you'd prefer that conda's base environment not be activated on startup,&#13;
   set the auto_activate_base parameter to false:&#13;
&#13;
conda config --set auto_activate_base false&#13;
&#13;
Thank you for installing Miniconda3!&#13;
root@pyalgo:~#</pre>&#13;
&#13;
<p>After that, you might want to update <code>conda</code> since the Miniconda installer is in general not as regularly updated as <code>conda</code> itself:</p>&#13;
&#13;
<pre data-type="programlisting">root@pyalgo:~# export PATH="/root/miniconda3/bin/:$PATH"&#13;
root@pyalgo:~# conda update -y conda&#13;
...&#13;
root@pyalgo:~# echo ". /root/miniconda3/etc/profile.d/conda.sh" &gt;&gt; ~/.bashrc&#13;
root@pyalgo:~# bash&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p>After this rather simple installation procedure, there are now both a basic Python installation and <code>conda</code> available. The basic Python installation comes already with some nice batteries included, like the <a href="https://sqlite.org"><code>SQLite3</code></a> database engine. You might try out whether you can start Python in a <em>new shell instance</em> or after <em>appending the relevant path</em> to the respective environment variable (as done in the preceding example):<a data-startref="ix_02_python_environment_-asciidoc5" data-type="indexterm" id="idm45785395825048"/><a data-startref="ix_02_python_environment_-asciidoc4" data-type="indexterm" id="idm45785395824312"/></p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# python&#13;
Python 3.8.3 (default, May 19 2020, 18:47:26)&#13;
[GCC 7.3.0] :: Anaconda, Inc. on linux&#13;
Type "help", "copyright", "credits" or "license" for more information.&#13;
&gt;&gt;&gt; print('Hello Python for Algorithmic Trading World.')&#13;
Hello Python for Algorithmic Trading World.&#13;
&gt;&gt;&gt; exit()&#13;
(base) root@pyalgo:~#</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Basic Operations with Conda" data-type="sect2"><div class="sect2" id="idm45785395843848">&#13;
<h2>Basic Operations with Conda</h2>&#13;
&#13;
<p><a data-primary="conda" data-secondary="basic operations" data-type="indexterm" id="ix_02_python_environment_-asciidoc6"/><code>conda</code> can be used to efficiently handle, among other things, the installation, updating, and removal of Python packages. The following list provides an overview of the major functions:</p>&#13;
<dl>&#13;
<dt>Installing Python x.x</dt>&#13;
<dd>&#13;
<p><code>conda install python=x.x</code></p>&#13;
</dd>&#13;
<dt>Updating Python</dt>&#13;
<dd>&#13;
<p><code>conda update python</code></p>&#13;
</dd>&#13;
<dt>Installing a package</dt>&#13;
<dd>&#13;
<p><code>conda install $PACKAGE_NAME</code></p>&#13;
</dd>&#13;
<dt>Updating a package</dt>&#13;
<dd>&#13;
<p><code>conda update $PACKAGE_NAME</code></p>&#13;
</dd>&#13;
<dt>Removing a package</dt>&#13;
<dd>&#13;
<p><code>conda remove $PACKAGE_NAME</code></p>&#13;
</dd>&#13;
<dt>Updating conda itself</dt>&#13;
<dd>&#13;
<p><code>conda update conda</code></p>&#13;
</dd>&#13;
<dt>Searching for packages</dt>&#13;
<dd>&#13;
<p><code>conda search $SEARCH_TERM</code></p>&#13;
</dd>&#13;
<dt>Listing installed packages</dt>&#13;
<dd>&#13;
<p><code>conda list</code></p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Given these capabilities, installing, for example, <code>NumPy</code> (as one of the most important packages of the so-called <em>scientific stack</em>) is a single command only. When the installation takes place on a machine with an Intel processor, <a data-primary="Intel Math Kernel Library" data-type="indexterm" id="idm45785395805656"/><a data-primary="mkl (Intel Math Kernel Library)" data-type="indexterm" id="idm45785395804984"/>the procedure automatically installs the <a href="https://oreil.ly/Tca2C">Intel Math Kernel Library <code>mkl</code></a>, which speeds up numerical operations not only for <code>NumPy</code> on Intel machines but also for a few other scientific Python packages:<sup><a data-type="noteref" href="ch02.html#idm45785395802712" id="idm45785395802712-marker">3</a></sup></p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda install numpy&#13;
Collecting package metadata (current_repodata.json): done&#13;
Solving environment: done&#13;
&#13;
## Package Plan ##&#13;
&#13;
  environment location: /root/miniconda3&#13;
&#13;
  added / updated specs:&#13;
    - numpy&#13;
&#13;
&#13;
The following packages will be downloaded:&#13;
&#13;
    package                    |            build&#13;
    ---------------------------|-----------------&#13;
    blas-1.0                   |              mkl           6 KB&#13;
    intel-openmp-2020.1        |              217         780 KB&#13;
    mkl-2020.1                 |              217       129.0 MB&#13;
    mkl-service-2.3.0          |   py38he904b0f_0          62 KB&#13;
    mkl_fft-1.1.0              |   py38h23d657b_0         150 KB&#13;
    mkl_random-1.1.1           |   py38h0573a6f_0         341 KB&#13;
    numpy-1.19.1               |   py38hbc911f0_0          21 KB&#13;
    numpy-base-1.19.1          |   py38hfa32c7d_0         4.2 MB&#13;
    ------------------------------------------------------------&#13;
                                           Total:       134.5 MB&#13;
&#13;
The following NEW packages will be INSTALLED:&#13;
&#13;
  blas               pkgs/main/linux-64::blas-1.0-mkl&#13;
  intel-openmp       pkgs/main/linux-64::intel-openmp-2020.1-217&#13;
  mkl                pkgs/main/linux-64::mkl-2020.1-217&#13;
  mkl-service        pkgs/main/linux-64::mkl-service-2.3.0-py38he904b0f_0&#13;
  mkl_fft            pkgs/main/linux-64::mkl_fft-1.1.0-py38h23d657b_0&#13;
  mkl_random         pkgs/main/linux-64::mkl_random-1.1.1-py38h0573a6f_0&#13;
  numpy              pkgs/main/linux-64::numpy-1.19.1-py38hbc911f0_0&#13;
  numpy-base         pkgs/main/linux-64::numpy-base-1.19.1-py38hfa32c7d_0&#13;
&#13;
&#13;
Proceed ([y]/n)? y&#13;
&#13;
&#13;
Downloading and Extracting Packages&#13;
numpy-base-1.19.1    | 4.2 MB    | ############################## | 100%&#13;
blas-1.0             | 6 KB      | ############################## | 100%&#13;
mkl_fft-1.1.0        | 150 KB    | ############################## | 100%&#13;
mkl-service-2.3.0    | 62 KB     | ############################## | 100%&#13;
numpy-1.19.1         | 21 KB     | ############################## | 100%&#13;
mkl-2020.1           | 129.0 MB  | ############################## | 100%&#13;
mkl_random-1.1.1     | 341 KB    | ############################## | 100%&#13;
intel-openmp-2020.1  | 780 KB    | ############################## | 100%&#13;
Preparing transaction: done&#13;
Verifying transaction: done&#13;
Executing transaction: done&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p class="pagebreak-before">Multiple packages can also be installed at once. The <code>-y</code> flag indicates that all (potential) questions shall be answered with <code>yes</code>:</p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda install -y ipython matplotlib pandas \&#13;
&gt; pytables scikit-learn scipy&#13;
...&#13;
Collecting package metadata (current_repodata.json): done&#13;
Solving environment: done&#13;
&#13;
## Package Plan ##&#13;
&#13;
  environment location: /root/miniconda3&#13;
&#13;
  added / updated specs:&#13;
    - ipython&#13;
    - matplotlib&#13;
    - pandas&#13;
    - pytables&#13;
    - scikit-learn&#13;
    - scipy&#13;
&#13;
&#13;
The following packages will be downloaded:&#13;
&#13;
    package                    |            build&#13;
    ---------------------------|-----------------&#13;
    backcall-0.2.0             |             py_0          15 KB&#13;
    ...&#13;
    zstd-1.4.5                 |       h9ceee32_0         619 KB&#13;
    ------------------------------------------------------------&#13;
                                           Total:       144.9 MB&#13;
&#13;
The following NEW packages will be INSTALLED:&#13;
&#13;
  backcall           pkgs/main/noarch::backcall-0.2.0-py_0&#13;
  blosc              pkgs/main/linux-64::blosc-1.20.0-hd408876_0&#13;
  ...&#13;
  zstd               pkgs/main/linux-64::zstd-1.4.5-h9ceee32_0&#13;
&#13;
&#13;
&#13;
Downloading and Extracting Packages&#13;
glib-2.65.0          | 2.9 MB    | ############################## | 100%&#13;
...&#13;
snappy-1.1.8         | 40 KB     | ############################## | 100%&#13;
Preparing transaction: done&#13;
Verifying transaction: done&#13;
Executing transaction: done&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p class="pagebreak-before">After the resulting installation procedure, some of the most important libraries for financial analytics are available in addition to the standard ones:</p>&#13;
<dl>&#13;
<dt><a href="http://ipython.org">IPython</a></dt>&#13;
<dd>&#13;
<p>An improved interactive Python shell</p>&#13;
</dd>&#13;
<dt><a href="http://matplotlib.org">matplotlib</a></dt>&#13;
<dd>&#13;
<p>The standard plotting library for Python</p>&#13;
</dd>&#13;
<dt><a href="http://numpy.org">NumPy</a></dt>&#13;
<dd>&#13;
<p>Efficient handling of numerical arrays</p>&#13;
</dd>&#13;
<dt><a href="http://pandas.pydata.org">pandas</a></dt>&#13;
<dd>&#13;
<p>Management of tabular data, like financial time series data</p>&#13;
</dd>&#13;
<dt><a href="http://pytables.org">PyTables</a></dt>&#13;
<dd>&#13;
<p>A Python wrapper for the <a href="http://hdfgroup.org">HDF5</a> library</p>&#13;
</dd>&#13;
<dt><a href="http://scikit-learn.org">scikit-learn</a></dt>&#13;
<dd>&#13;
<p>A package for machine learning and related tasks</p>&#13;
</dd>&#13;
<dt><a href="http://scipy.org">SciPy</a></dt>&#13;
<dd>&#13;
<p>A collection of scientific classes and functions</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>This provides a basic tool set for data analysis in general and financial analytics in particular. The next example uses <code>IPython</code> and draws a set of pseudo-random numbers with <code>NumPy</code>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="p">(</code><code class="n">base</code><code class="p">)</code> <code class="n">root</code><code class="nd">@pyalgo</code><code class="p">:</code><code class="o">~</code><code class="c1"># ipython</code>&#13;
<code class="n">Python</code> <code class="mf">3.8</code><code class="o">.</code><code class="mi">3</code> <code class="p">(</code><code class="n">default</code><code class="p">,</code> <code class="n">May</code> <code class="mi">19</code> <code class="mi">2020</code><code class="p">,</code> <code class="mi">18</code><code class="p">:</code><code class="mi">47</code><code class="p">:</code><code class="mi">26</code><code class="p">)</code>&#13;
<code class="n">Type</code> <code class="s1">'copyright'</code><code class="p">,</code> <code class="s1">'credits'</code> <code class="ow">or</code> <code class="s1">'license'</code> <code class="k">for</code> <code class="n">more</code> <code class="n">information</code>&#13;
<code class="n">IPython</code> <code class="mf">7.16</code><code class="o">.</code><code class="mi">1</code> <code class="o">--</code> <code class="n">An</code> <code class="n">enhanced</code> <code class="n">Interactive</code> <code class="n">Python</code><code class="o">.</code> <code class="n">Type</code> <code class="s1">'?'</code> <code class="k">for</code> <code class="n">help</code><code class="o">.</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">1</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">numpy</code> <code class="kn">as</code> <code class="nn">np</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">2</code><code class="p">]:</code> <code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">seed</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">3</code><code class="p">]:</code> <code class="n">np</code><code class="o">.</code><code class="n">random</code><code class="o">.</code><code class="n">standard_normal</code><code class="p">((</code><code class="mi">5</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">3</code><code class="p">]:</code>&#13;
<code class="n">array</code><code class="p">([[</code><code class="o">-</code><code class="mf">1.74976547</code><code class="p">,</code>  <code class="mf">0.3426804</code> <code class="p">,</code>  <code class="mf">1.1530358</code> <code class="p">,</code> <code class="o">-</code><code class="mf">0.25243604</code><code class="p">],</code>&#13;
       <code class="p">[</code> <code class="mf">0.98132079</code><code class="p">,</code>  <code class="mf">0.51421884</code><code class="p">,</code>  <code class="mf">0.22117967</code><code class="p">,</code> <code class="o">-</code><code class="mf">1.07004333</code><code class="p">],</code>&#13;
       <code class="p">[</code><code class="o">-</code><code class="mf">0.18949583</code><code class="p">,</code>  <code class="mf">0.25500144</code><code class="p">,</code> <code class="o">-</code><code class="mf">0.45802699</code><code class="p">,</code>  <code class="mf">0.43516349</code><code class="p">],</code>&#13;
       <code class="p">[</code><code class="o">-</code><code class="mf">0.58359505</code><code class="p">,</code>  <code class="mf">0.81684707</code><code class="p">,</code>  <code class="mf">0.67272081</code><code class="p">,</code> <code class="o">-</code><code class="mf">0.10441114</code><code class="p">],</code>&#13;
       <code class="p">[</code><code class="o">-</code><code class="mf">0.53128038</code><code class="p">,</code>  <code class="mf">1.02973269</code><code class="p">,</code> <code class="o">-</code><code class="mf">0.43813562</code><code class="p">,</code> <code class="o">-</code><code class="mf">1.11831825</code><code class="p">]])</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">4</code><code class="p">]:</code> <code class="nb">exit</code>&#13;
<code class="p">(</code><code class="n">base</code><code class="p">)</code> <code class="n">root</code><code class="nd">@pyalgo</code><code class="p">:</code><code class="o">~</code><code class="c1">#</code></pre>&#13;
&#13;
<p class="pagebreak-before">Executing <code>conda list</code> shows which packages are installed:</p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda list&#13;
# packages in environment at /root/miniconda3:&#13;
#&#13;
# Name                    Version                   Build  Channel&#13;
_libgcc_mutex             0.1                        main&#13;
backcall                  0.2.0                      py_0&#13;
blas                      1.0                         mkl&#13;
blosc                     1.20.0               hd408876_0&#13;
...&#13;
zlib                      1.2.11               h7b6447c_3&#13;
zstd                      1.4.5                h9ceee32_0&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p><a data-primary="conda remove" data-type="indexterm" id="idm45785395773960"/>In case a package is not needed anymore, it is efficiently removed with <code>conda remove</code>:</p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda remove matplotlib&#13;
Collecting package metadata (repodata.json): done&#13;
Solving environment: done&#13;
&#13;
## Package Plan ##&#13;
&#13;
  environment location: /root/miniconda3&#13;
&#13;
  removed specs:&#13;
    - matplotlib&#13;
&#13;
&#13;
The following packages will be REMOVED:&#13;
&#13;
The following packages will be REMOVED:&#13;
&#13;
  cycler-0.10.0-py38_0&#13;
  ...&#13;
  tornado-6.0.4-py38h7b6447c_1&#13;
&#13;
&#13;
Proceed ([y]/n)? y&#13;
&#13;
Preparing transaction: done&#13;
Verifying transaction: done&#13;
Executing transaction: done&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p><code>conda</code> as a package manager is already quite useful. However, its full power only becomes evident when adding virtual environment management to the mix.</p>&#13;
<div data-type="tip">&#13;
<p><code>conda</code> as a package manager makes installing, updating, and removing Python packages a pleasant experience. There is no need to take care of building and compiling packages on your own, which can be tricky sometimes given the list of dependencies a package specifies and given the specifics to be considered on different operating systems<a data-startref="ix_02_python_environment_-asciidoc6" data-type="indexterm" id="idm45785399447784"/>.<a data-startref="ix_02_python_environment_-asciidoc3" data-type="indexterm" id="idm45785399446984"/><a data-startref="ix_02_python_environment_-asciidoc2" data-type="indexterm" id="idm45785399446312"/><a data-startref="ix_02_python_environment_-asciidoc1" data-type="indexterm" id="idm45785399445672"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conda as a Virtual Environment Manager" data-type="sect1"><div class="sect1" id="conda_environment">&#13;
<h1>Conda as a Virtual Environment Manager</h1>&#13;
&#13;
<p><a data-primary="conda" data-secondary="as virtual environment manager" data-type="indexterm" id="ix_02_python_environment_-asciidoc7"/><a data-primary="Python infrastructure" data-secondary="conda as virtual environment manager" data-type="indexterm" id="ix_02_python_environment_-asciidoc8"/><a data-primary="virtual environment management" data-type="indexterm" id="ix_02_python_environment_-asciidoc9"/>Having installed Miniconda with <code>conda</code> included provides a default Python installation depending on what version of Miniconda has been chosen. The virtual environment management capabilities of <code>conda</code> allow one, for example, to add to a Python 3.8 default installation a completely separated installation of Python 2.7.x. To this end, <code>conda</code> offers the following functionality:</p>&#13;
<dl>&#13;
<dt>Creating a virtual environment</dt>&#13;
<dd>&#13;
<p><code>conda create --name $ENVIRONMENT_NAME</code></p>&#13;
</dd>&#13;
<dt>Activating an environment</dt>&#13;
<dd>&#13;
<p><code>conda activate $ENVIRONMENT_NAME</code></p>&#13;
</dd>&#13;
<dt>Deactivating an environment</dt>&#13;
<dd>&#13;
<p><code>conda deactivate $ENVIRONMENT_NAME</code></p>&#13;
</dd>&#13;
<dt>Removing an environment</dt>&#13;
<dd>&#13;
<p><code>conda env remove --name $ENVIRONMENT_NAME</code></p>&#13;
</dd>&#13;
<dt>Exporting to an environment file</dt>&#13;
<dd>&#13;
<p><code>conda env export &gt; $FILE_NAME</code></p>&#13;
</dd>&#13;
<dt>Creating an environment from a file</dt>&#13;
<dd>&#13;
<p><code>conda env create -f $FILE_NAME</code></p>&#13;
</dd>&#13;
<dt>Listing all environments</dt>&#13;
<dd>&#13;
<p><code>conda info --envs</code></p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>As a simple illustration, the example code that follows creates an environment called <code>py27</code>, installs <code>IPython</code>, and executes a line of Python 2.7.x code. Although the support for Python 2.7 has ended, the example illustrates how legacy Python 2.7 code can easily be executed and tested:</p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda create --name py27 python=2.7&#13;
Collecting package metadata (current_repodata.json): done&#13;
Solving environment: failed with repodata from current_repodata.json,&#13;
will retry with next repodata source.&#13;
Collecting package metadata (repodata.json): done&#13;
Solving environment: done&#13;
&#13;
## Package Plan ##&#13;
&#13;
  environment location: /root/miniconda3/envs/py27&#13;
&#13;
  added / updated specs:&#13;
    - python=2.7&#13;
&#13;
&#13;
The following packages will be downloaded:&#13;
&#13;
    package                    |            build&#13;
    ---------------------------|-----------------&#13;
    certifi-2019.11.28         |           py27_0         153 KB&#13;
    pip-19.3.1                 |           py27_0         1.7 MB&#13;
    python-2.7.18              |       h15b4118_1         9.9 MB&#13;
    setuptools-44.0.0          |           py27_0         512 KB&#13;
    wheel-0.33.6               |           py27_0          42 KB&#13;
    ------------------------------------------------------------&#13;
                                           Total:        12.2 MB&#13;
&#13;
The following NEW packages will be INSTALLED:&#13;
&#13;
  _libgcc_mutex      pkgs/main/linux-64::_libgcc_mutex-0.1-main&#13;
  ca-certificates    pkgs/main/linux-64::ca-certificates-2020.6.24-0&#13;
  ...&#13;
  zlib               pkgs/main/linux-64::zlib-1.2.11-h7b6447c_3&#13;
&#13;
&#13;
Proceed ([y]/n)? y&#13;
&#13;
&#13;
Downloading and Extracting Packages&#13;
certifi-2019.11.28   | 153 KB    | ############################### | 100%&#13;
python-2.7.18        | 9.9 MB    | ############################### | 100%&#13;
pip-19.3.1           | 1.7 MB    | ############################### | 100%&#13;
setuptools-44.0.0    | 512 KB    | ############################### | 100%&#13;
wheel-0.33.6         | 42 KB     | ############################### | 100%&#13;
Preparing transaction: done&#13;
Verifying transaction: done&#13;
Executing transaction: done&#13;
#&#13;
# To activate this environment, use&#13;
#&#13;
#     $ conda activate py27&#13;
#&#13;
# To deactivate an active environment, use&#13;
#&#13;
#     $ conda deactivate&#13;
&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p class="pagebreak-before">Notice how the prompt changes to include <code>(py27)</code> after the environment is &#13;
<span class="keep-together">activated:</span></p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda activate py27&#13;
(py27) root@pyalgo:~# pip install ipython&#13;
DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020.&#13;
...&#13;
Executing transaction: done&#13;
(py27) root@pyalgo:~#</pre>&#13;
&#13;
<p>Finally, this allows one to use <code>IPython</code> with Python 2.7 syntax:</p>&#13;
&#13;
<pre data-type="programlisting">(py27) root@pyalgo:~# ipython&#13;
Python 2.7.18 |Anaconda, Inc.| (default, Apr 23 2020, 22:42:48)&#13;
Type "copyright", "credits" or "license" for more information.&#13;
&#13;
IPython 5.10.0 -- An enhanced Interactive Python.&#13;
?         -&gt; Introduction and overview of IPython's features.&#13;
%quickref -&gt; Quick reference.&#13;
help      -&gt; Python's own help system.&#13;
object?   -&gt; Details about 'object', use 'object??' for extra details.&#13;
&#13;
In [1]: print "Hello Python for Algorithmic Trading World."&#13;
Hello Python for Algorithmic Trading World.&#13;
&#13;
In [2]: exit&#13;
(py27) root@pyalgo:~#</pre>&#13;
&#13;
<p>As this example demonstrates, <code>conda</code> as a virtual environment manager allows one to install different Python versions alongside each other. It also allows one to install different versions of certain packages. The default Python installation is not influenced by such a procedure, nor are other environments that might exist on the same machine. All available environments can be shown via <code>conda info --envs</code>:</p>&#13;
&#13;
<pre data-type="programlisting">(py27) root@pyalgo:~# conda env list&#13;
# conda environments:&#13;
#&#13;
base                     /root/miniconda3&#13;
py27                  *  /root/miniconda3/envs/py27&#13;
&#13;
(py27) root@pyalgo:~#</pre>&#13;
&#13;
<p>Sometimes it is necessary to share environment information with others or to use environment information on multiple machines, for instance. To this end, one can export the installed packages list to a file with <code>conda env export</code>. However, this only works properly by default for the same operating system since the build versions are specified in the resulting <code>yaml</code> file. However, they can be deleted to only specify the package version via the <code>--no-builds</code> flag:</p>&#13;
&#13;
<pre data-type="programlisting">(py27) root@pyalgo:~# conda deactivate&#13;
(base) root@pyalgo:~# conda env export --no-builds &gt; base.yml&#13;
(base) root@pyalgo:~# cat base.yml&#13;
name: base&#13;
channels:&#13;
  - defaults&#13;
dependencies:&#13;
  - _libgcc_mutex=0.1&#13;
  - backcall=0.2.0&#13;
  - blas=1.0&#13;
  - blosc=1.20.0&#13;
  ...&#13;
  - zlib=1.2.11&#13;
  - zstd=1.4.5&#13;
prefix: /root/miniconda3&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p>Often, virtual environments, which are technically not that much more than a certain (sub-)folder structure, are created to do some quick tests.<sup><a data-type="noteref" href="ch02.html#idm45785399695288" id="idm45785399695288-marker">4</a></sup> In such a case, an environment is easily removed (after deactivation) via <code>conda env remove</code>:</p>&#13;
&#13;
<pre data-type="programlisting">(base) root@pyalgo:~# conda env remove -n py27&#13;
&#13;
Remove all packages in environment /root/miniconda3/envs/py27:&#13;
&#13;
(base) root@pyalgo:~#</pre>&#13;
&#13;
<p>This concludes the overview of <code>conda</code> as a virtual environment manager.</p>&#13;
<div data-type="tip">&#13;
<p><code>conda</code> not only helps with managing packages, but it is also a virtual environment manager for Python. It simplifies the creation of different Python environments, allowing one to have multiple versions of Python and optional packages available on the same machine without them influencing each other in any way. <code>conda</code> also allows one to export environment information to easily replicate it on multiple machines or to share it with others.<a data-startref="ix_02_python_environment_-asciidoc9" data-type="indexterm" id="idm45785399688936"/><a data-startref="ix_02_python_environment_-asciidoc8" data-type="indexterm" id="idm45785399688168"/><a data-startref="ix_02_python_environment_-asciidoc7" data-type="indexterm" id="idm45785399687480"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Docker Containers" data-type="sect1"><div class="sect1" id="docker_container">&#13;
<h1>Using Docker Containers</h1>&#13;
&#13;
<p><a data-primary="Docker containers" data-type="indexterm" id="ix_02_python_environment_-asciidoc10"/><a data-primary="Python infrastructure" data-secondary="Docker containers" data-type="indexterm" id="ix_02_python_environment_-asciidoc11"/>Docker containers have taken the IT world by storm (see <a href="http://docker.com">Docker</a>). Although the technology is still relatively young, it has established itself as one of the benchmarks for the efficient development and deployment of almost any kind of software application.</p>&#13;
&#13;
<p>For our purposes, it suffices to think of a Docker container as a separated (“containerized”) file system that includes an operating system (for example, Ubuntu 20.04 LTS for server), a (Python) runtime, additional system and development tools, and &#13;
<span class="keep-together">further</span> (Python) libraries and packages as needed. Such a Docker container might run on a local machine with Windows 10 Professional 64 Bit or on a cloud instance with a Linux operating system, for instance.</p>&#13;
&#13;
<p>This section goes into the exciting details of Docker containers. It is a concise illustration of what the Docker technology can do in the context of Python deployment.<sup><a data-type="noteref" href="ch02.html#idm45785399679560" id="idm45785399679560-marker">5</a></sup></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Docker Images and Containers" data-type="sect2"><div class="sect2" id="idm45785399678872">&#13;
<h2>Docker Images and Containers</h2>&#13;
&#13;
<p><a data-primary="Docker containers" data-secondary="Docker images versus" data-type="indexterm" id="idm45785399677496"/><a data-primary="Docker images" data-secondary="Docker containers versus" data-type="indexterm" id="idm45785399676520"/>Before moving on to the illustration, two fundamental terms need to be distinguished when talking about Docker. The first is a <em>Docker image</em>, which can be compared to a Python class. The second is a <em>Docker container</em>, which can be compared to an instance of the respective Python class.</p>&#13;
&#13;
<p><a data-primary="Docker images" data-secondary="defined" data-type="indexterm" id="idm45785399674152"/>On a more technical level, you will find the following definition for a <em>Docker image</em> in the <a href="https://oreil.ly/NNUiB">Docker glossary</a>:</p>&#13;
<blockquote>&#13;
<p>Docker images are the basis of containers. An image is an ordered collection of root filesystem changes and the corresponding execution parameters for use within a container runtime. An image typically contains a union of layered filesystems stacked on top of each other. An image does not have state and it never changes.</p></blockquote>&#13;
&#13;
<p><a data-primary="Docker containers" data-secondary="defined" data-type="indexterm" id="idm45785399670584"/>Similarly, you will find the following definition for a <em>Docker container</em> in the <a href="https://oreil.ly/NNUiB">Docker glossary</a>, which makes the analogy to Python classes and instances of such classes transparent:</p>&#13;
<blockquote>&#13;
<p>A container is a runtime instance of a Docker image.</p>&#13;
&#13;
<p>A Docker container consists of</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A Docker image</p>&#13;
</li>&#13;
<li>&#13;
<p>An execution environment</p>&#13;
</li>&#13;
<li>&#13;
<p>A standard set of instructions</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The concept is borrowed from Shipping Containers, which define a standard to ship goods globally. Docker defines a standard to ship software.</p></blockquote>&#13;
&#13;
<p>Depending on the operating system, the installation of Docker is somewhat different. That is why this section does not go into the respective details. More information and further links are found on the <a href="https://oreil.ly/hGgxs">Get Docker page</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Building a Ubuntu and Python Docker Image" data-type="sect2"><div class="sect2" id="idm45785399662056">&#13;
<h2>Building a Ubuntu and Python Docker Image</h2>&#13;
&#13;
<p><a data-primary="Docker containers" data-secondary="building a Ubuntu and Python Docker image" data-type="indexterm" id="ix_02_python_environment_-asciidoc12"/><a data-primary="Ubuntu" data-type="indexterm" id="ix_02_python_environment_-asciidoc13"/>This sub-section illustrates the building of a Docker image based on the latest version of Ubuntu that includes Miniconda, as well as a few important Python packages. In addition, it does some Linux housekeeping by updating the Linux packages index, upgrading packages if required and installing certain additional system tools. To this end, two scripts are needed. <a data-primary="Bash script" data-type="indexterm" id="idm45785399657256"/>One is a <code>Bash</code> script doing all the work on the Linux level.<sup><a data-type="noteref" href="ch02.html#idm45785399656040" id="idm45785399656040-marker">6</a></sup> <a data-primary="Dockerfile" data-type="indexterm" id="ix_02_python_environment_-asciidoc14"/>The other is a so-called <em>Dockerfile</em>, which controls the building procedure for the image itself.</p>&#13;
&#13;
<p>The Bash script in <a data-type="xref" href="#docker_install">Example 2-1</a>, which does the installing, consists of three major parts. The first part handles the Linux housekeeping. The second part installs Miniconda, while the third part installs optional Python packages. There are also more detailed comments inline:</p>&#13;
<div data-type="example" id="docker_install">&#13;
<h5><span class="label">Example 2-1. </span>Script installing Python and optional packages</h5>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="c">#!/bin/bash</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># Script to Install</code>&#13;
<code class="c"># Linux System Tools and</code>&#13;
<code class="c"># Basic Python Components</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># Python for Algorithmic Trading</code>&#13;
<code class="c"># (c) Dr. Yves J. Hilpisch</code>&#13;
<code class="c"># The Python Quants GmbH</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># GENERAL LINUX</code>&#13;
apt-get update  <code class="c"># updates the package index cache</code>&#13;
apt-get upgrade -y  <code class="c"># updates packages</code>&#13;
<code class="c"># installs system tools</code>&#13;
apt-get install -y bzip2 gcc git  <code class="c"># system tools</code>&#13;
apt-get install -y htop screen vim wget  <code class="c"># system tools</code>&#13;
apt-get upgrade -y bash  <code class="c"># upgrades bash if necessary</code>&#13;
apt-get clean  <code class="c"># cleans up the package index cache</code>&#13;
&#13;
<code class="c"># INSTALL MINICONDA</code>&#13;
<code class="c"># downloads Miniconda</code>&#13;
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O <code class="se">\</code>&#13;
  Miniconda.sh&#13;
bash Miniconda.sh -b  <code class="c"># installs it</code>&#13;
rm -rf Miniconda.sh  <code class="c"># removes the installer</code>&#13;
<code class="nb">export </code><code class="nv">PATH</code><code class="o">=</code><code class="s2">"/root/miniconda3/bin:</code><code class="nv">$PATH</code><code class="s2">"</code>  <code class="c"># prepends the new path</code>&#13;
&#13;
<code class="c"># INSTALL PYTHON LIBRARIES</code>&#13;
conda install -y pandas  <code class="c"># installs pandas</code>&#13;
conda install -y ipython  <code class="c"># installs IPython shell</code>&#13;
&#13;
<code class="c"># CUSTOMIZATION</code>&#13;
<code class="nb">cd</code> /root/&#13;
wget http://hilpisch.com/.vimrc  <code class="c"># Vim configuration</code></pre></div>&#13;
&#13;
<p>The <code>Dockerfile</code> in <a data-type="xref" href="#docker_file">Example 2-2</a> uses the <code>Bash</code> script in <a data-type="xref" href="#docker_install">Example 2-1</a> to build a new Docker image. It also has its major parts commented inline:</p>&#13;
<div data-type="example" id="docker_file">&#13;
<h5><span class="label">Example 2-2. </span>Dockerfile to build the image</h5>&#13;
&#13;
<pre data-type="programlisting">#&#13;
# Building a Docker Image with&#13;
# the Latest Ubuntu Version and&#13;
# Basic Python Install&#13;
#&#13;
# Python for Algorithmic Trading&#13;
# (c) Dr. Yves J. Hilpisch&#13;
# The Python Quants GmbH&#13;
#&#13;
&#13;
# latest Ubuntu version&#13;
FROM ubuntu:latest&#13;
&#13;
# information about maintainer&#13;
MAINTAINER yves&#13;
&#13;
# add the bash script&#13;
ADD install.sh /&#13;
# change rights for the script&#13;
RUN chmod u+x /install.sh&#13;
# run the bash script&#13;
RUN /install.sh&#13;
# prepend the new path&#13;
ENV PATH /root/miniconda3/bin:$PATH&#13;
&#13;
# execute IPython when container is run&#13;
CMD ["ipython"]</pre></div>&#13;
&#13;
<p>If these two files are in a single folder and Docker is installed, then the building of the new Docker image is straightforward. Here, the tag <code>pyalgo:basic</code> is used for the image. This tag is needed to reference the image, for example, when running a &#13;
<span class="keep-together">container</span> based on it:<a data-startref="ix_02_python_environment_-asciidoc14" data-type="indexterm" id="idm45785395026840"/></p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:Docker yves$ docker build -t pyalgo:basic .&#13;
Sending build context to Docker daemon  4.096kB&#13;
Step 1/7 : FROM ubuntu:latest&#13;
 ---&gt; 4e2eef94cd6b&#13;
Step 2/7 : MAINTAINER yves&#13;
 ---&gt; Running in 859db5550d82&#13;
Removing intermediate container 859db5550d82&#13;
 ---&gt; 40adf11b689f&#13;
Step 3/7 : ADD install.sh /&#13;
 ---&gt; 34cd9dc267e0&#13;
Step 4/7 : RUN chmod u+x /install.sh&#13;
 ---&gt; Running in 08ce2f46541b&#13;
Removing intermediate container 08ce2f46541b&#13;
 ---&gt; 88c0adc82cb0&#13;
Step 5/7 : RUN /install.sh&#13;
 ---&gt; Running in 112e70510c5b&#13;
...&#13;
Removing intermediate container 112e70510c5b&#13;
 ---&gt; 314dc8ec5b48&#13;
Step 6/7 : ENV PATH /root/miniconda3/bin:$PATH&#13;
 ---&gt; Running in 82497aea20bd&#13;
Removing intermediate container 82497aea20bd&#13;
 ---&gt; 5364f494f4b4&#13;
Step 7/7 : CMD ["ipython"]&#13;
 ---&gt; Running in ff434d5a3c1b&#13;
Removing intermediate container ff434d5a3c1b&#13;
 ---&gt; a0bb86daf9ad&#13;
Successfully built a0bb86daf9ad&#13;
Successfully tagged pyalgo:basic&#13;
(base) pro:Docker yves$</pre>&#13;
&#13;
<p>Existing Docker images can be listed via <code>docker images</code>. The new image should be on top of the list:</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:Docker yves$ docker images&#13;
REPOSITORY         TAG              IMAGE ID          CREATED             SIZE&#13;
pyalgo             basic            a0bb86daf9ad      2 minutes ago       1.79GB&#13;
ubuntu             latest           4e2eef94cd6b      5 days ago          73.9MB&#13;
(base) pro:Docker yves$</pre>&#13;
&#13;
<p>Having built the <code>pyalgo:basic</code> image successfully allows one to run a respective Docker container with <code>docker run</code>. The parameter combination <code>-ti</code> is needed for interactive processes running within a Docker container, like a shell process of &#13;
<span class="keep-together"><code>IPython</code></span> (see the <a href="https://oreil.ly/s0_hn">Docker Run Reference page</a>):</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:Docker yves$ docker run -ti pyalgo:basic&#13;
Python 3.8.3 (default, May 19 2020, 18:47:26)&#13;
Type 'copyright', 'credits' or 'license' for more information&#13;
IPython 7.16.1 -- An enhanced Interactive Python. Type '?' for help.&#13;
&#13;
In [1]: import numpy as np&#13;
&#13;
In [2]: np.random.seed(100)&#13;
&#13;
In [3]: a = np.random.standard_normal((5, 3))&#13;
&#13;
In [4]: import pandas as pd&#13;
&#13;
In [5]: df = pd.DataFrame(a, columns=['a', 'b', 'c'])&#13;
&#13;
In [6]: df&#13;
Out[6]:&#13;
          a         b         c&#13;
0 -1.749765  0.342680  1.153036&#13;
1 -0.252436  0.981321  0.514219&#13;
2  0.221180 -1.070043 -0.189496&#13;
3  0.255001 -0.458027  0.435163&#13;
4 -0.583595  0.816847  0.672721</pre>&#13;
&#13;
<p>Exiting <code>IPython</code> will exit the container as well, since it is the only application running within the container. However, you can detach from a container via the following:</p>&#13;
&#13;
<pre data-type="programlisting">Ctrl+p --&gt; Ctrl+q</pre>&#13;
&#13;
<p>After having detached from the container, the <code>docker ps</code> command shows the running container (and maybe other currently running containers):</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:Docker yves$ docker ps&#13;
CONTAINER ID  IMAGE         COMMAND     CREATED       ...    NAMES&#13;
e93c4cbd8ea8  pyalgo:basic  "ipython"   About a minute ago   jolly_rubin&#13;
(base) pro:Docker yves$</pre>&#13;
&#13;
<p>Attaching to the Docker container is accomplished by <code>docker attach $CONTAINER_ID</code>. Notice that a few letters of the <code>CONTAINER ID</code> are enough:</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:Docker yves$ docker attach e93c&#13;
In [7]: df.info()&#13;
&lt;class 'pandas.core.frame.DataFrame'&gt;&#13;
RangeIndex: 5 entries, 0 to 4&#13;
Data columns (total 3 columns):&#13;
 #   Column  Non-Null Count  Dtype&#13;
---  ------  --------------  -----&#13;
 0   a       5 non-null      float64&#13;
 1   b       5 non-null      float64&#13;
 2   c       5 non-null      float64&#13;
dtypes: float64(3)&#13;
memory usage: 248.0 bytes</pre>&#13;
&#13;
<p>The <code>exit</code> command terminates <code>IPython</code> and therewith stops the Docker container, as well. It can be removed by <code>docker rm</code>:</p>&#13;
&#13;
<pre data-type="programlisting">In [8]: exit&#13;
(base) pro:Docker yves$ docker rm e93c&#13;
e93c&#13;
(base) pro:Docker yves$</pre>&#13;
&#13;
<p>Similarly, the Docker image <code>pyalgo:basic</code> can be removed via <code>docker rmi</code> if not needed any longer. While containers are relatively lightweight, single images might consume quite a bit of storage. In the case of the <code>pyalgo:basic</code> image, the size is close to 2 GB. That is why you might want to regularly clean up the list of Docker images:</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:Docker yves$ docker rmi a0bb86&#13;
Untagged: pyalgo:basic&#13;
Deleted: sha256:a0bb86daf9adfd0ddf65312ce6c1b068100448152f2ced5d0b9b5adef5788d88&#13;
...&#13;
Deleted: sha256:40adf11b689fc778297c36d4b232c59fedda8c631b4271672cc86f505710502d&#13;
(base) pro:Docker yves$</pre>&#13;
&#13;
<p>Of course, there is much more to say about Docker containers and their benefits in certain application scenarios. For the purposes of this book, they provide a modern approach to deploying Python, to doing Python development in a completely separated (containerized) environment, and to shipping codes for algorithmic trading.</p>&#13;
<div data-type="tip">&#13;
<p>If you are not yet using Docker containers, you should consider starting to use them. They provide a number of benefits when it comes to Python deployment and development efforts, not only when working locally but also in particular when working with remote cloud instances and servers deploying code for algorithmic trading<a data-startref="ix_02_python_environment_-asciidoc13" data-type="indexterm" id="idm45785399641192"/><a data-startref="ix_02_python_environment_-asciidoc12" data-type="indexterm" id="idm45785399640424"/>.<a data-startref="ix_02_python_environment_-asciidoc11" data-type="indexterm" id="idm45785399639608"/><a data-startref="ix_02_python_environment_-asciidoc10" data-type="indexterm" id="idm45785399638888"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Cloud Instances" data-type="sect1"><div class="sect1" id="cloud_instance">&#13;
<h1>Using Cloud Instances</h1>&#13;
&#13;
<p><a data-primary="cloud instances" data-type="indexterm" id="ix_02_python_environment_-asciidoc15"/><a data-primary="DigitalOcean" data-secondary="cloud instances" data-type="indexterm" id="ix_02_python_environment_-asciidoc16"/><a data-primary="Python infrastructure" data-secondary="using cloud instances" data-type="indexterm" id="ix_02_python_environment_-asciidoc17"/>This section shows how to set up a full-fledged Python infrastructure on a &#13;
<span class="keep-together"><a href="http://digitalocean.com">DigitalOcean</a></span> cloud instance. There are many other cloud providers out there, among them <a href="http://aws.amazon.com">Amazon Web Services</a> (AWS) as the leading provider. <a data-primary="Droplet" data-type="indexterm" id="idm45785399104264"/>However, DigitalOcean is well known for its simplicity and relatively low rates for smaller cloud instances, which it calls <em>Droplet</em>. The smallest Droplet, which is generally sufficient for exploration and development purposes, only costs 5 USD per month or 0.007 USD per hour. Usage is charged by the hour so that one can (for example) easily spin up a Droplet for two hours, destroy it, and get charged just 0.014 USD.<sup><a data-type="noteref" href="ch02.html#idm45785399102600" id="idm45785399102600-marker">7</a></sup></p>&#13;
&#13;
<p>The goal of this section is to set up a Droplet on DigitalOcean that has a Python 3.8 installation plus typically needed packages (such as <code>NumPy</code> and <code>pandas</code>) in combination with a password-protected and Secure Sockets Layer (SSL)-encrypted <a href="http://jupyter.org">Jupyter Lab</a> server installation.<sup><a data-type="noteref" href="ch02.html#idm45785399086424" id="idm45785399086424-marker">8</a></sup> <a data-primary="Jupyter Lab" data-secondary="tools included" data-type="indexterm" id="idm45785399084808"/>As a web-based tool suite, <code>Jupyter Lab</code> provides several tools that can be used via a regular browser:</p>&#13;
<dl>&#13;
<dt>Jupyter Notebook</dt>&#13;
<dd>&#13;
<p>This is one of the most popular (if not <em>the</em> most popular) browser-based, interactive development environment that features a selection of different language kernels like Python, R, and Julia.</p>&#13;
</dd>&#13;
<dt>Python console</dt>&#13;
<dd>&#13;
<p>This is an <code>IPython</code>-based console that has a graphical user interface different from the look and feel of the standard, terminal-based implementation.</p>&#13;
</dd>&#13;
<dt>Terminal</dt>&#13;
<dd>&#13;
<p>This is a system shell implementation accessible via the browser that allows not only for all typical system administration tasks, but also for usage of helpful tools such as <a href="http://vim.org/download"><code>Vim</code></a> for code editing or <a href="https://git-scm.com/"><code>git</code></a> for version control.</p>&#13;
</dd>&#13;
<dt>Editor</dt>&#13;
<dd>&#13;
<p>Another major tool is a browser-based text file editor with syntax highlighting for many different programming languages and file types, as well as typical text/code editing capabilities.</p>&#13;
</dd>&#13;
<dt>File manager</dt>&#13;
<dd>&#13;
<p><code>Jupyter Lab</code> also provides a full-fledged file manager that allows for typical file operations, such as uploading, downloading, and renaming.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Having <code>Jupyter Lab</code> installed on a Droplet allows one to do Python development and deployment via the browser, circumventing the need to log in to the cloud instance via Secure Shell (SSH) access.</p>&#13;
&#13;
<p>To accomplish the goal of this section, several scripts are needed:</p>&#13;
<dl>&#13;
<dt>Server setup script</dt>&#13;
<dd>&#13;
<p>This script orchestrates all steps necessary, such as copying other files to the Droplet and running them on the Droplet.</p>&#13;
</dd>&#13;
<dt>Python and <code>Jupyter</code> installation script</dt>&#13;
<dd>&#13;
<p>This script installs Python, additional packages, <code>Jupyter Lab</code>, and starts the <code>Jupyter Lab</code> server.</p>&#13;
</dd>&#13;
<dt>Jupyter Notebook configuration file</dt>&#13;
<dd>&#13;
<p>This file is for the configuration of the <code>Jupyter Lab</code> server, for example, with regard to password protection.</p>&#13;
</dd>&#13;
<dt>RSA public and private key files</dt>&#13;
<dd>&#13;
<p>These two files are needed for the SSL encryption of the communication with the <code>Jupyter Lab</code> server.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The following section works backwards through this list of files since although the setup script is executed first, the other files need to have been created beforehand.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="RSA Public and Private Keys" data-type="sect2"><div class="sect2" id="idm45785399062520">&#13;
<h2>RSA Public and Private Keys</h2>&#13;
&#13;
<p><a data-primary="cloud instances" data-secondary="RSA public/private keys" data-type="indexterm" id="idm45785399060888"/><a data-primary="Jupyter Lab" data-secondary="RSA public/private keys for" data-type="indexterm" id="idm45785399059720"/><a data-primary="keys, public/private" data-type="indexterm" id="idm45785399058808"/><a data-primary="RSA public/private keys" data-type="indexterm" id="idm45785399058136"/>In order to accomplish a secure connection to the <code>Jupyter Lab</code> server via an arbitrary browser, an <a data-primary="SSL certificate" data-type="indexterm" id="idm45785399056888"/>SSL certificate consisting of RSA public and private keys (see <a href="https://oreil.ly/8UG1K">RSA Wikipedia page</a>) is needed. In general, one would expect that such a certificate comes from a so-called Certificate Authority (CA). For the purposes of this book, however, a self-generated certificate is “good enough.”<sup><a data-type="noteref" href="ch02.html#idm45785399055176" id="idm45785399055176-marker">9</a></sup> A popular tool to generate RSA key pairs is <a href="http://openssl.org"><code>OpenSSL</code></a>. The brief interactive session to follow generates a certificate appropriate for use with a <code>Jupyter Lab</code> server (see the <a href="https://oreil.ly/YxxaF">Jupyter Notebook docs</a>):</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:cloud yves$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 \&#13;
&gt; -keyout mykey.key -out mycert.pem&#13;
Generating a RSA private key&#13;
.......+++++&#13;
.....+++++&#13;
+++++&#13;
writing new private key to 'mykey.key'&#13;
-----&#13;
You are about to be asked to enter information that will be incorporated&#13;
into your certificate request.&#13;
What you are about to enter is what is called a Distinguished Name or a DN.&#13;
There are quite a few fields but you can leave some blank.&#13;
For some fields there will be a default value,&#13;
If you enter '.', the field will be left blank.&#13;
-----&#13;
Country Name (2 letter code) [AU]:DE&#13;
State or Province Name (full name) [Some-State]:Saarland&#13;
Locality Name (e.g., city) []:Voelklingen&#13;
Organization Name (eg, company) [Internet Widgits Pty Ltd]:TPQ GmbH&#13;
Organizational Unit Name (e.g., section) []:Algorithmic Trading&#13;
Common Name (e.g., server FQDN or YOUR name) []:Jupyter Lab&#13;
Email Address []:pyalgo@tpq.io&#13;
(base) pro:cloud yves$</pre>&#13;
&#13;
<p>The two files <code>mykey.key</code> and <code>mycert.pem</code> need to be copied to the Droplet and need to be referenced by the <code>Jupyter Notebook</code> configuration file. This file is presented next.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Jupyter Notebook Configuration File" data-type="sect2"><div class="sect2" id="idm45785399048712">&#13;
<h2>Jupyter Notebook Configuration File</h2>&#13;
&#13;
<p><a data-primary="cloud instances" data-secondary="Jupyter Notebook configuration file" data-type="indexterm" id="idm45785399047304"/><a data-primary="Jupyter Notebook" data-type="indexterm" id="idm45785399046136"/>A public <code>Jupyter Lab</code> server can be deployed securely, as explained in the <a href="https://oreil.ly/YxxaF">Jupyter Notebook docs</a>. <a data-primary="password protection, for Jupyter lab" data-type="indexterm" id="idm45785399044232"/>Among others things, <code>Jupyter Lab</code> shall be password protected. To this end, there is a password hash code-generating function called <code>passwd()</code> available in the <code>notebook.auth</code> sub-package. The following code generates a password hash code with <code>jupyter</code> being the password itself:</p>&#13;
&#13;
<pre data-type="programlisting">In [1]: from notebook.auth import passwd&#13;
&#13;
In [2]: passwd('jupyter')&#13;
Out[2]: 'sha1:da3a3dfc0445:052235bb76e56450b38d27e41a85a136c3bf9cd7'&#13;
&#13;
In [3]: exit</pre>&#13;
&#13;
<p>This hash code needs to be placed in the <code>Jupyter Notebook</code> configuration file as presented in <a data-type="xref" href="#jupyter_config_file">Example 2-3</a>. The configuration file assumes that the RSA key files have been copied on the Droplet to the <code>/root/.jupyter/</code> folder.</p>&#13;
<div data-type="example" id="jupyter_config_file">&#13;
<h5><span class="label">Example 2-3. </span>Jupyter Notebook configuration file</h5>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="c1">#</code>&#13;
<code class="c1"># Jupyter Notebook Configuration File</code>&#13;
<code class="c1">#</code>&#13;
<code class="c1"># Python for Algorithmic Trading</code>&#13;
<code class="c1"># (c) Dr. Yves J. Hilpisch</code>&#13;
<code class="c1"># The Python Quants GmbH</code>&#13;
<code class="c1">#</code>&#13;
<code class="c1"># SSL ENCRYPTION</code>&#13;
<code class="c1"># replace the following file names (and files used) by your choice/files</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">certfile</code> <code class="o">=</code> <code class="s-Affix">u</code><code class="s1">'/root/.jupyter/mycert.pem'</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">keyfile</code> <code class="o">=</code> <code class="s-Affix">u</code><code class="s1">'/root/.jupyter/mykey.key'</code>&#13;
&#13;
<code class="c1"># IP ADDRESS AND PORT</code>&#13;
<code class="c1"># set ip to '*' to bind on all IP addresses of the cloud instance</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">ip</code> <code class="o">=</code> <code class="s1">'0.0.0.0'</code>&#13;
<code class="c1"># it is a good idea to set a known, fixed default port for server access</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">port</code> <code class="o">=</code> <code class="mi">8888</code>&#13;
&#13;
<code class="c1"># PASSWORD PROTECTION</code>&#13;
<code class="c1"># here: 'jupyter' as password</code>&#13;
<code class="c1"># replace the hash code with the one for your password</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">password</code> <code class="o">=</code> \&#13;
	<code class="s1">'sha1:da3a3dfc0445:052235bb76e56450b38d27e41a85a136c3bf9cd7'</code>&#13;
&#13;
<code class="c1"># NO BROWSER OPTION</code>&#13;
<code class="c1"># prevent Jupyter from trying to open a browser</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">open_browser</code> <code class="o">=</code> <code class="bp">False</code>&#13;
&#13;
<code class="c1"># ROOT ACCESS</code>&#13;
<code class="c1"># allow Jupyter to run from root user</code>&#13;
<code class="n">c</code><code class="o">.</code><code class="n">NotebookApp</code><code class="o">.</code><code class="n">allow_root</code> <code class="o">=</code> <code class="bp">True</code></pre></div>&#13;
&#13;
<p>The next step is to make sure that Python and <code>Jupyter Lab</code> get installed on the Droplet.</p>&#13;
<div data-type="caution">&#13;
<p>Deploying <code>Jupyter Lab</code> in the cloud leads to a number of security issues since it is a full-fledged development environment accessible via a web browser. It is therefore of paramount importance to use the security measures that a <code>Jupyter Lab</code> server provides by default, like password protection and SSL encryption. But this is just the beginning, and further security measures might be advised depending on what exactly is done on the cloud instance.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Installation Script for Python and Jupyter Lab" data-type="sect2"><div class="sect2" id="idm45785398804968">&#13;
<h2>Installation Script for Python and Jupyter Lab</h2>&#13;
&#13;
<p><a data-primary="Bash script" data-secondary="for Python/Jupyter Lab installation" data-type="indexterm" id="ix_02_python_environment_-asciidoc18"/><a data-primary="cloud instances" data-secondary="installation script for Python and Jupyter Lab" data-type="indexterm" id="ix_02_python_environment_-asciidoc19"/><a data-primary="installation script, Python/Jupyter Lab" data-type="indexterm" id="ix_02_python_environment_-asciidoc20"/><a data-primary="Jupyter Lab" data-secondary="installation script for" data-type="indexterm" id="ix_02_python_environment_-asciidoc21"/>The bash script to install Python and <code>Jupyter Lab</code> is similar to the one presented in section <a data-type="xref" href="#docker_container">“Using Docker Containers”</a> to install Python via Miniconda in a Docker container. However, the script in <a data-type="xref" href="#cloud_install">Example 2-4</a> needs to start the <code>Jupyter Lab</code> server, as well. All major parts and lines of code are commented inline.</p>&#13;
<div data-type="example" id="cloud_install">&#13;
<h5><span class="label">Example 2-4. </span>Bash script to install Python and to run the <code>Jupyter Notebook</code> server</h5>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="c">#!/bin/bash</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># Script to Install</code>&#13;
<code class="c"># Linux System Tools and Basic Python Components</code>&#13;
<code class="c"># as well as to</code>&#13;
<code class="c"># Start Jupyter Lab Server</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># Python for Algorithmic Trading</code>&#13;
<code class="c"># (c) Dr. Yves J. Hilpisch</code>&#13;
<code class="c"># The Python Quants GmbH</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># GENERAL LINUX</code>&#13;
apt-get update  <code class="c"># updates the package index cache</code>&#13;
apt-get upgrade -y  <code class="c"># updates packages</code>&#13;
<code class="c"># install system tools</code>&#13;
apt-get install -y build-essential git  <code class="c"># system tools</code>&#13;
apt-get install -y screen htop vim wget  <code class="c"># system tools</code>&#13;
apt-get upgrade -y bash  <code class="c"># upgrades bash if necessary</code>&#13;
apt-get clean  <code class="c"># cleans up the package index cache</code>&#13;
&#13;
<code class="c"># INSTALLING MINICONDA</code>&#13;
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh <code class="se">\</code>&#13;
		-O Miniconda.sh&#13;
bash Miniconda.sh -b  <code class="c"># installs Miniconda</code>&#13;
rm -rf Miniconda.sh  <code class="c"># removes the installer</code>&#13;
<code class="c"># prepends the new path for current session</code>&#13;
<code class="nb">export </code><code class="nv">PATH</code><code class="o">=</code><code class="s2">"/root/miniconda3/bin:</code><code class="nv">$PATH</code><code class="s2">"</code>&#13;
<code class="c"># prepends the new path in the shell configuration</code>&#13;
cat &gt;&gt; ~/.profile <code class="s">&lt;&lt;EOF</code>&#13;
<code class="s">export PATH="/root/miniconda3/bin:$PATH"</code>&#13;
<code class="s">EOF</code>&#13;
&#13;
<code class="c"># INSTALLING PYTHON LIBRARIES</code>&#13;
conda install -y jupyter  <code class="c"># interactive data analytics in the browser</code>&#13;
conda install -y jupyterlab  <code class="c"># Jupyter Lab environment</code>&#13;
conda install -y numpy  <code class="c">#  numerical computing package</code>&#13;
conda install -y pytables  <code class="c"># wrapper for HDF5 binary storage</code>&#13;
conda install -y pandas  <code class="c">#  data analysis package</code>&#13;
conda install -y scipy  <code class="c">#  scientific computations package</code>&#13;
conda install -y matplotlib  <code class="c"># standard plotting library</code>&#13;
conda install -y seaborn  <code class="c"># statistical plotting library</code>&#13;
conda install -y quandl  <code class="c"># wrapper for Quandl data API</code>&#13;
conda install -y scikit-learn  <code class="c"># machine learning library</code>&#13;
conda install -y openpyxl  <code class="c"># package for Excel interaction</code>&#13;
conda install -y xlrd xlwt  <code class="c"># packages for Excel interaction</code>&#13;
conda install -y pyyaml  <code class="c"># package to manage yaml files</code>&#13;
&#13;
pip install --upgrade pip  <code class="c"># upgrading the package manager</code>&#13;
pip install q  <code class="c"># logging and debugging</code>&#13;
pip install plotly  <code class="c"># interactive D3.js plots</code>&#13;
pip install cufflinks  <code class="c"># combining plotly with pandas</code>&#13;
pip install tensorflow  <code class="c"># deep learning library</code>&#13;
pip install keras  <code class="c"># deep learning library</code>&#13;
pip install eikon  <code class="c"># Python wrapper for the Refinitiv Eikon Data API</code>&#13;
<code class="c"># Python wrapper for Oanda API</code>&#13;
pip install git+git://github.com/yhilpisch/tpqoa&#13;
&#13;
<code class="c"># COPYING FILES AND CREATING DIRECTORIES</code>&#13;
mkdir -p /root/.jupyter/custom&#13;
wget http://hilpisch.com/custom.css&#13;
mv custom.css /root/.jupyter/custom&#13;
mv /root/jupyter_notebook_config.py /root/.jupyter/&#13;
mv /root/mycert.pem /root/.jupyter&#13;
mv /root/mykey.key /root/.jupyter&#13;
mkdir /root/notebook&#13;
<code class="nb">cd</code> /root/notebook&#13;
&#13;
<code class="c"># STARTING JUPYTER LAB</code>&#13;
jupyter lab <code class="p">&amp;</code></pre></div>&#13;
&#13;
<p>This script needs to be copied to the Droplet and needs to be started by the orchestration script, as described in the next sub-section.<a data-startref="ix_02_python_environment_-asciidoc21" data-type="indexterm" id="idm45785398793080"/><a data-startref="ix_02_python_environment_-asciidoc20" data-type="indexterm" id="idm45785398792376"/><a data-startref="ix_02_python_environment_-asciidoc19" data-type="indexterm" id="idm45785401210296"/><a data-startref="ix_02_python_environment_-asciidoc18" data-type="indexterm" id="idm45785401209640"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Script to Orchestrate the Droplet Set Up" data-type="sect2"><div class="sect2" id="idm45785401208728">&#13;
<h2>Script to Orchestrate the Droplet Set Up</h2>&#13;
&#13;
<p><a data-primary="Bash script" data-secondary="for Droplet set-up" data-type="indexterm" id="ix_02_python_environment_-asciidoc22"/><a data-primary="cloud instances" data-secondary="script to orchestrate Droplet set-up" data-type="indexterm" id="ix_02_python_environment_-asciidoc23"/><a data-primary="Droplet" data-secondary="script to orchestrate set-up" data-type="indexterm" id="ix_02_python_environment_-asciidoc24"/>The second bash script, which sets up the Droplet, is the shortest one (see <a data-type="xref" href="#server_setup">Example 2-5</a>). It mainly copies all the other files to the Droplet for which the respective IP address is expected as a parameter. In the final line, it starts the <code>install.sh</code> bash script, which in turn does the installation itself and starts the <code>Jupyter Lab</code> server.</p>&#13;
<div data-type="example" id="server_setup">&#13;
<h5><span class="label">Example 2-5. </span><code>Bash</code> script to set up the Droplet</h5>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting"><code class="c">#!/bin/bash</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># Setting up a DigitalOcean Droplet</code>&#13;
<code class="c"># with Basic Python Stack</code>&#13;
<code class="c"># and Jupyter Notebook</code>&#13;
<code class="c">#</code>&#13;
<code class="c"># Python for Algorithmic Trading</code>&#13;
<code class="c"># (c) Dr Yves J Hilpisch</code>&#13;
<code class="c"># The Python Quants GmbH</code>&#13;
<code class="c">#</code>&#13;
&#13;
<code class="c"># IP ADDRESS FROM PARAMETER</code>&#13;
<code class="nv">MASTER_IP</code><code class="o">=</code><code class="nv">$1</code>&#13;
&#13;
<code class="c"># COPYING THE FILES</code>&#13;
scp install.sh root@<code class="si">${</code><code class="nv">MASTER_IP</code><code class="si">}</code>:&#13;
scp mycert.pem mykey.key jupyter_notebook_config.py root@<code class="si">${</code><code class="nv">MASTER_IP</code><code class="si">}</code>:&#13;
&#13;
<code class="c"># EXECUTING THE INSTALLATION SCRIPT</code>&#13;
ssh root@<code class="si">${</code><code class="nv">MASTER_IP</code><code class="si">}</code> bash /root/install.sh</pre></div>&#13;
&#13;
<p>Everything now is together to give the set up code a try. On DigitalOcean, create a new Droplet with options similar to these:</p>&#13;
<dl>&#13;
<dt>Operating system</dt>&#13;
<dd>&#13;
<p>Ubuntu 20.04 LTS x64 (the newest version available at the time of this writing)</p>&#13;
</dd>&#13;
<dt>Size</dt>&#13;
<dd>&#13;
<p>Two core, 2GB, 60GB SSD (standard Droplet)</p>&#13;
</dd>&#13;
<dt>Data center region</dt>&#13;
<dd>&#13;
<p>Frankfurt (since your author lives in Germany)</p>&#13;
</dd>&#13;
<dt>SSH key</dt>&#13;
<dd>&#13;
<p>Add a (new) SSH key for password-less login<sup><a data-type="noteref" href="ch02.html#idm45785398949480" id="idm45785398949480-marker">10</a></sup></p>&#13;
</dd>&#13;
<dt>Droplet name</dt>&#13;
<dd>&#13;
<p>Prespecified name or something like <code>pyalgo</code></p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Finally, clicking on the <code>Create</code> button initiates the Droplet creation process, which generally takes about one minute. The major outcome for proceeding with the set-up procedure is the IP address, which might be, for instance, 134.122.74.144 when you have chosen Frankfurt as your data center location. Setting up the Droplet now is as easy as what follows:</p>&#13;
&#13;
<pre data-type="programlisting">(base) pro:cloud yves$ bash setup.sh 134.122.74.144</pre>&#13;
&#13;
<p>The resulting process, however, might take a couple of minutes. It is finished when there is a message from the <code>Jupyter Lab</code> server saying something like the following:</p>&#13;
&#13;
<pre data-type="programlisting">[I 12:02:50.190 LabApp] Serving notebooks from local directory: /root/notebook&#13;
[I 12:02:50.190 LabApp] Jupyter Notebook 6.1.1 is running at:&#13;
[I 12:02:50.190 LabApp] https://pyalgo:8888/</pre>&#13;
&#13;
<p>In any current browser, visiting the following address accesses the running <code>Jupyter Notebook</code> server (note the <code>https</code> protocol):</p>&#13;
&#13;
<pre data-type="programlisting">https://134.122.74.144:8888</pre>&#13;
&#13;
<p>After maybe adding a security exception, the <code>Jupyter Notebook</code> login screen prompting for a password (in our case <code>jupyter</code>) should appear. Everything is now ready to start Python development in the browser via <code>Jupyter Lab</code>, via the <code>IPython</code>-based console, and via a terminal window or the text file editor. Other file management capabilities like file upload, deletion of files, or creation of folders are also available.<a data-startref="ix_02_python_environment_-asciidoc24" data-type="indexterm" id="idm45785398937416"/><a data-startref="ix_02_python_environment_-asciidoc23" data-type="indexterm" id="idm45785398936696"/><a data-startref="ix_02_python_environment_-asciidoc22" data-type="indexterm" id="idm45785398936008"/></p>&#13;
<div data-type="tip">&#13;
<p>Cloud instances, like those from DigitalOcean, and <code>Jupyter Lab</code> (powered by the <code>Jupyter Notebook</code> server) are a powerful combination for the Python developer and algorithmic trading practitioner to work on and to make use of professional compute and storage infrastructure. Professional cloud and data center providers make sure that your (virtual) machines are physically secure and highly available. Using cloud instances also keeps the exploration and development phase at rather low costs since usage is generally charged by the hour without the need to enter long term &#13;
<span class="keep-together">agreements.</span><a data-startref="ix_02_python_environment_-asciidoc17" data-type="indexterm" id="idm45785398932488"/><a data-startref="ix_02_python_environment_-asciidoc16" data-type="indexterm" id="idm45785398931816"/><a data-startref="ix_02_python_environment_-asciidoc15" data-type="indexterm" id="idm45785398931128"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusions" data-type="sect1"><div class="sect1" id="idm45785401208104">&#13;
<h1>Conclusions</h1>&#13;
&#13;
<p>Python is the programming language and technology platform of choice not only for this book but also for almost every leading financial institution. However, Python deployment can be tricky at best and sometimes even tedious and nerve-wracking. Fortunately, technologies are available today—almost all of which are younger than ten years—that help with the deployment issue. The open source software <code>conda</code> helps with both Python package and virtual environment management. Docker containers go even further in that complete file systems and runtime environments can be easily created in a technically shielded “sandbox,” or the <em>container</em>. Going even one step further, cloud providers like DigitalOcean offer compute and storage capacity in professionally managed and secured data centers within minutes and billed by the hour. This in combination with a Python 3.8 installation and a secure <code>Jupyter Notebook/Lab</code> server installation provides a professional environment for Python development and deployment in the context of Python for algorithmic trading projects.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="References and Further Resources" data-type="sect1"><div class="sect1" id="idm45785398926680">&#13;
<h1>References and Further Resources</h1>&#13;
&#13;
<p>For <em>Python package management</em>, consult the following resources:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://pypi.python.org/pypi/pip"><code>pip</code> package manager page</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://conda.pydata.org"><code>conda</code> package manager page</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://packaging.python.org/installing">official Installing Packages page</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>For <em>virtual environment management</em>, consult these resources:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://pypi.python.org/pypi/virtualenv"><code>virtualenv</code> environment manager page</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="http://conda.pydata.org/docs/using/envs.html"><code>conda</code> Managing Environments page</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://github.com/pypa/pipenv"><code>pipenv</code> package and environment manager</a></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Information about <em>Docker containers</em> can found, among other places, at the <a href="http://docker.com">Docker home page</a>, as well as in the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Matthias, Karl, and Sean Kane. 2018. <em>Docker: Up and Running.</em> 2nd ed. Sebastopol: O’Reilly.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Robbins (2016) provides a concise introduction to and overview of the <code>Bash</code> <em>scripting language</em>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Robbins, Arnold. 2016. <em>Bash Pocket Reference</em>. 2nd ed. Sebastopol: O’Reilly.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>How to <em>run a public Jupyter Notebook/Lab server securely</em> is explained in <a href="https://oreil.ly/uBEeq">The Jupyter Notebook Docs</a>. There is also <code>JupyterHub</code> available, which allows the management of multiple users for a <code>Jupyter Notebook</code> server (see <a href="https://oreil.ly/-XLi5">JupyterHub</a>).</p>&#13;
&#13;
<p>To sign up on DigitalOcean with a 10 USD starting balance in your new account, visit <a href="http://bit.ly/do_sign_up"><em class="hyperlink">http://bit.ly/do_sign_up</em></a>. This pays for two months of usage for the smallest Droplet.<a data-startref="ix_02_python_environment_-asciidoc0" data-type="indexterm" id="idm45785401131128"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45785393599784"><sup><a href="ch02.html#idm45785393599784-marker">1</a></sup> A recent project called <code>pipenv</code> combines the capabilities of the package manager <code>pip</code> with those of the virual environment manager <code>virtualenv</code>. See <a href="https://github.com/pypa/pipenv"><em class="hyperlink">https://github.com/pypa/pipenv</em></a>.</p><p data-type="footnote" id="idm45785395838952"><sup><a href="ch02.html#idm45785395838952-marker">2</a></sup> On Windows, you can also run the exact same commands in a Docker container (see <a href="https://oreil.ly/GndRR"><em class="hyperlink">https://oreil.ly/GndRR</em></a>). Working on Windows directly requires some adjustments. See, for example, the book by Matthias and Kane (2018) for further details on Docker usage.</p><p data-type="footnote" id="idm45785395802712"><sup><a href="ch02.html#idm45785395802712-marker">3</a></sup> Installing the meta package <code>nomkl</code>, such as in <code>conda install numpy nomkl</code>, avoids the automatic installation and usage of <code>mkl</code> and related other packages.</p><p data-type="footnote" id="idm45785399695288"><sup><a href="ch02.html#idm45785399695288-marker">4</a></sup> In the official documentation, you will find the following explanation: “Python <em>Virtual Environments</em> allow Python packages to be installed in an isolated location for a particular application, rather than being installed globally.” See the <a href="https://oreil.ly/5Jgjc">Creating Virtual Environments page</a>.</p><p data-type="footnote" id="idm45785399679560"><sup><a href="ch02.html#idm45785399679560-marker">5</a></sup> See Matthias and Kane (2018) for a comprehensive introduction to the Docker technology.</p><p data-type="footnote" id="idm45785399656040"><sup><a href="ch02.html#idm45785399656040-marker">6</a></sup> Consult the book by Robbins (2016) for a concise introduction to and a quick overview of <code>Bash</code> scripting. Also see see <a href="https://oreil.ly/SGHn1">GNU Bash</a>.</p><p data-type="footnote" id="idm45785399102600"><sup><a href="ch02.html#idm45785399102600-marker">7</a></sup> For those who do not have an account with a cloud provider yet, on <a href="http://bit.ly/do_sign_up"><em class="hyperlink">http://bit.ly/do_sign_up</em></a>, new users get a starting credit of 10 USD for DigitalOcean.</p><p data-type="footnote" id="idm45785399086424"><sup><a href="ch02.html#idm45785399086424-marker">8</a></sup> Technically, <code>Jupyter Lab</code> is an extension of <code>Jupyter Notebook</code>. Both expressions are, however, sometimes used interchangeably.</p><p data-type="footnote" id="idm45785399055176"><sup><a href="ch02.html#idm45785399055176-marker">9</a></sup> With such a self-generated certificate, you might need to add a security exception when prompted by the browser. On Mac OS you might even explicitely register the certificate as trustworthy.</p><p data-type="footnote" id="idm45785398949480"><sup><a href="ch02.html#idm45785398949480-marker">10</a></sup> If you need assistance, visit either <a href="https://oreil.ly/Tggw7">How To Use SSH Keys with DigitalOcean Droplets</a> or <a href="https://oreil.ly/-jTif">How To Use SSH Keys with PuTTY on DigitalOcean Droplets (Windows users)</a>.</p></div></div></section></body></html>