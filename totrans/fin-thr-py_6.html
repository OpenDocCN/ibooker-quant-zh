<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Dynamic Economy" class="calibre4"><div class="preface" id="dynamic_economy">
<h1 class="calibre11"><span class="firstname">Chapter 6. </span>Dynamic Economy</h1>

<blockquote class="calibre12 pcalibre1 pcalibre2">
<p class="calibre13">Multiperiod<a data-type="indexterm" data-primary="Pliska, Stanley" id="idm44853685259416" class="calibre6"/> models of securities markets are much more realistic than single period models. In fact, they are extensively used for practical purposes in the financial 
<span class="firstname">industry</span>.</p>
<p data-type="attribution" class="pcalibre3 calibre16">Stanley Pliska (1997)</p>
</blockquote>
<blockquote class="calibre12 pcalibre1 pcalibre2">
<p class="calibre13">Although<a data-type="indexterm" data-primary="Duffie, Darrell" id="idm44853685256248" class="calibre6"/> markets are not complete at any one time, they are dynamically complete in the sense that any consumption process can be financed by trading the given set of financial securities, adjusting portfolios through time as uncertainty is resolved bit 
<span class="firstname">by bit.</span></p>
<p data-type="attribution" class="pcalibre3 calibre16">Darrell Duffie (1986)</p>
</blockquote>

<p class="author1">In reality, quantitative information‚Äîsuch as changes in stock prices or interest rates‚Äîis revealed gradually over time. While static model economies are an elegant way of introducing fundamental notions in finance, a realistic financial model requires a dynamic representation of the financial world.</p>

<p class="author1">The formalism needed to properly model dynamic economies is more involved and cannot be covered in full detail in this chapter. However, the chapter can present two of the most important dynamic model economies based on discrete time dynamics: the Cox-Ross-Rubinstein (1979) binomial option pricing model and the Black-Scholes-Merton (1973) option pricing model in a discrete Monte Carlo simulation version. In this <a data-type="indexterm" data-primary="discrete time" id="idm44853685252488" class="calibre6"/>context, <em class="calibre7">discrete time</em> means that the set of relevant dates is extended from just two to a larger, but still finite, number‚Äîsay, to five or 50.</p>

<p class="author1">The tools used in this chapter are more or less the same as before: linear algebra, probability theory, and also, like in the previous chapter, stochastic elements to implement Monte Carlo simulation. Duffie (1988) and Pliska (1997) are great resources for dynamic financial modeling in discrete time. Glasserman (2004) is a comprehensive reference book for Monte Carlo simulation methods in finance.</p>

<p class="author1">Topics covered in this chapter are stochastic processes, option pricing in dynamically complete markets, binomial option pricing, Black-Scholes-Merton (1973) dynamic simulation, early exercise and American option pricing, as well as Least-Squares Monte Carlo (LSM) option pricing.</p>

<p class="author1">The following table gives an overview of the topics in finance, mathematics, and Python found in this chapter:</p>
<table class="calibre34">
<thead class="calibre35">
<tr class="calibre36">
<th class="calibre37">Finance</th>
<th class="calibre37">Mathematics</th>
<th class="calibre37">Python</th>
</tr>
</thead>
<tbody class="calibre38">
<tr class="calibre36">
<td class="calibre39"><p class="author1">Uncertainty, tree-based</p></td>
<td class="calibre39"><p class="author1">Stochastic process, binomial tree</p></td>
<td class="calibre39"><p class="author1"><code class="calibre40">NumPy</code>, <code class="calibre40">ndarray</code></p></td>
</tr>
<tr class="calibre41">
<td class="calibre39"><p class="author1">Uncertainty, simulation-based</p></td>
<td class="calibre39"><p class="author1">Stochastic process, Monte Carlo simulation</p></td>
<td class="calibre39"><p class="author1"><code class="calibre40">NumPy</code>, <code class="calibre40">ndarray</code>,
<span class="firstname"><code class="calibre40">rng.standard_normal</code></span></p></td>
</tr>
<tr class="calibre36">
<td class="calibre39"><p class="author1">European option pricing</p></td>
<td class="calibre39"><p class="author1">Inner values, backward induction, risk-neutral expectation</p></td>
<td class="calibre39"><p class="author1"><code class="calibre40">NumPy</code>, <code class="calibre40">ndarray</code>, <code class="calibre40">np.maximum</code></p></td>
</tr>
<tr class="calibre41">
<td class="calibre39"><p class="author1">American option pricing</p></td>
<td class="calibre39"><p class="author1">Inner values, continuation values, OLS regression, backward induction, risk-neutral expectation</p></td>
<td class="calibre39"><p class="author1"><code class="calibre40">NumPy</code>, <code class="calibre40">ndarray</code>,
<span class="firstname"><code class="calibre40">np.polyval</code></span>,
<span class="firstname"><code class="calibre40">np.polyfit</code></span>, <code class="calibre40">np.where</code></p></td>
</tr>
</tbody>
</table>

<p class="author1">As in <a data-type="xref" href="ch05_split_000.xhtml#static_economy" class="calibre6">Chapter¬†5</a>, the major goal of this chapter is <em class="calibre7">generalization</em>. While <a data-type="xref" href="ch05_split_000.xhtml#static_economy" class="calibre6">Chapter¬†5</a> generalizes the <em class="calibre7">state space</em>, this chapter sets out to generalize the <em class="calibre7">discrete set of relevant points in time</em> at which new information is revealed and economic action takes place. While some additional formalism is needed to do so, the chapter is, on the other hand, less formal since it focuses on two specific models only and does not try to provide a general framework for dynamic economies in discrete time. Such a general framework, including many examples implemented in Python, is found in Hilpisch (2015).</p>






<section data-type="sect1" data-pdf-bookmark="Binomial Option Pricing" class="calibre4"><div class="preface" id="idm44853685230024">
<h1 class="calibre17">Binomial Option Pricing</h1>

<p class="author1">The <a data-type="indexterm" data-primary="model economies" data-secondary="dynamic" data-tertiary="binomial option pricing" id="model-dynamic-binomial" class="calibre6"/><a data-type="indexterm" data-primary="dynamic economy" data-secondary="binomial option pricing" id="dynamic-binomial" class="calibre6"/><a data-type="indexterm" data-primary="binomial option pricing" id="binomial" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" id="cox-ross" class="calibre6"/>binomial option pricing model became popular immediately after publication in 1979‚Äîboth as a numerically efficient method to price European options and American options as well as a teaching tool. While the Black-Scholes-Merton (1973) model relies on continuous time finance and stochastic calculus, the binomial option pricing model is, in a sense, a discrete time version of the BSM model that can be fully understood with elementary mathematics only.</p>

<p class="author1">In the Cox-Ross-Rubinstein (1979) model, there are two traded financial assets: 
<span class="firstname">a risky</span> one, called <em class="calibre7">stock</em>, and a risk-less one, called <em class="calibre7">bond</em>. The model economy is considered over a <em class="calibre7">finite set of dates</em> <math alttext="script upper T identical-to StartSet t 0 equals 0 comma t 1 comma t 2 comma period period period comma t Subscript upper M Baseline equals upper T EndSet">
  <mrow>
    <mi>ùíØ</mi>
    <mo>‚â°</mo>
    <mo>{</mo>
    <msub><mi>t</mi> <mn>0</mn> </msub>
    <mo>=</mo>
    <mn>0</mn>
    <mo>,</mo>
    <msub><mi>t</mi> <mn>1</mn> </msub>
    <mo>,</mo>
    <msub><mi>t</mi> <mn>2</mn> </msub>
    <mo>,</mo>
    <mo>.</mo>
    <mo>.</mo>
    <mo>.</mo>
    <mo>,</mo>
    <msub><mi>t</mi> <mi>M</mi> </msub>
    <mo>=</mo>
    <mi>T</mi>
    <mo>}</mo>
  </mrow>
</math>, with <math alttext="upper M plus 1 comma upper M greater-than 1">
  <mrow>
    <mi>M</mi>
    <mo>+</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mi>M</mi>
    <mo>&gt;</mo>
    <mn>1</mn>
  </mrow>
</math> 
<span class="firstname">elements</span>.</p>

<p class="author1">Given a stock price of <math alttext="upper S Subscript t Sub Subscript i">
  <msub><mi>S</mi> <msub><mi>t</mi> <mi>i</mi> </msub> </msub>
</math>, the stock price at the next date <math alttext="upper S Subscript t Sub Subscript i plus 1">
  <msub><mi>S</mi> <msub><mi>t</mi> <mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow> </msub> </msub>
</math> can only take on two different values:</p>
<div data-type="equation" class="calibre42">
<math alttext="upper S Subscript t Sub Subscript i plus 1 Baseline equals StartLayout Enlarged left-brace 1st Row  upper S Subscript t Sub Subscript i Baseline dot u 2nd Row  upper S Subscript t Sub Subscript i Baseline dot d EndLayout" display="block">
  <mrow>
    <msub><mi>S</mi> <msub><mi>t</mi> <mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow> </msub> </msub>
    <mo>=</mo>
    <mfenced separators="" open="{" close="">
      <mtable>
        <mtr>
          <mtd columnalign="left">
            <mrow>
              <msub><mi>S</mi> <msub><mi>t</mi> <mi>i</mi> </msub> </msub>
              <mo>¬∑</mo>
              <mi>u</mi>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd columnalign="left">
            <mrow>
              <msub><mi>S</mi> <msub><mi>t</mi> <mi>i</mi> </msub> </msub>
              <mo>¬∑</mo>
              <mi>d</mi>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>

<p class="author1"><math alttext="u">
  <mi>u</mi>
</math> stands for an <em class="calibre7">upward movement</em> and <math alttext="d">
  <mi>d</mi>
</math> for a <em class="calibre7">downward movement</em>.</p>

<p class="author1">To simplify the handling of dates, assume an evenly spaced time grid with <math alttext="upper M">
  <mi>M</mi>
</math> time intervals of length <math alttext="normal upper Delta t equals StartFraction upper T Over upper M EndFraction">
  <mrow>
    <mi>Œî</mi>
    <mi>t</mi>
    <mo>=</mo>
    <mfrac><mi>T</mi> <mi>M</mi></mfrac>
  </mrow>
</math> each. The finite set of dates can then be written as <math alttext="script upper T identical-to StartSet t 0 equals 0 comma t 1 equals normal upper Delta t comma t 2 equals 2 normal upper Delta t comma period period period comma upper T EndSet">
  <mrow>
    <mi>ùíØ</mi>
    <mo>‚â°</mo>
    <mo>{</mo>
    <msub><mi>t</mi> <mn>0</mn> </msub>
    <mo>=</mo>
    <mn>0</mn>
    <mo>,</mo>
    <msub><mi>t</mi> <mn>1</mn> </msub>
    <mo>=</mo>
    <mi>Œî</mi>
    <mi>t</mi>
    <mo>,</mo>
    <msub><mi>t</mi> <mn>2</mn> </msub>
    <mo>=</mo>
    <mn>2</mn>
    <mi>Œî</mi>
    <mi>t</mi>
    <mo>,</mo>
    <mo>.</mo>
    <mo>.</mo>
    <mo>.</mo>
    <mo>,</mo>
    <mi>T</mi>
    <mo>}</mo>
  </mrow>
</math>. In addition, define:</p>
<div data-type="equation" class="calibre42">
<math alttext="StartLayout Enlarged left-brace 1st Row  u identical-to e Superscript sigma StartRoot normal upper Delta t EndRoot Baseline 2nd Row  d identical-to e Superscript minus sigma StartRoot normal upper Delta t EndRoot Baseline equals u Superscript negative 1 EndLayout" display="block">
  <mfenced separators="" open="{" close="">
    <mtable>
      <mtr>
        <mtd columnalign="left">
          <mrow>
            <mi>u</mi>
            <mo>‚â°</mo>
            <msup><mi>e</mi> <mrow><mi>œÉ</mi><msqrt><mrow><mi>Œî</mi><mi>t</mi></mrow></msqrt></mrow> </msup>
          </mrow>
        </mtd>
      </mtr>
      <mtr>
        <mtd columnalign="left">
          <mrow>
            <mi>d</mi>
            <mo>‚â°</mo>
            <msup><mi>e</mi> <mrow><mo>-</mo><mi>œÉ</mi><msqrt><mrow><mi>Œî</mi><mi>t</mi></mrow></msqrt></mrow> </msup>
            <mo>=</mo>
            <msup><mi>u</mi> <mrow><mo>-</mo><mn>1</mn></mrow> </msup>
          </mrow>
        </mtd>
      </mtr>
    </mtable>
  </mfenced>
</math>
</div>

<p class="author1">It turns out that one consequence of this definition is the property <math alttext="u dot d equals 1">
  <mrow>
    <mi>u</mi>
    <mo>¬∑</mo>
    <mi>d</mi>
    <mo>=</mo>
    <mn>1</mn>
  </mrow>
</math>, which will prove convenient in that it creates<a data-type="indexterm" data-primary="recombining binomial tree" id="idm44853685148520" class="calibre6"/> a so-called <em class="calibre7">recombining</em> binomial tree.
<math><mrow><mi>œÉ</mi><mo>‚àà</mo><msub><mi>‚Ñù</mi> <mrow><mn>&gt;0</mn></mrow> </msub></mrow></math>
represents the constant <em class="calibre7">volatility factor</em>.</p>

<p class="author1">Assume that the risk-less, constant short rate is given by
<math><mrow><mi>r</mi><mo>‚àà</mo><msub><mi>‚Ñù</mi> <mrow><mn>‚â•0</mn></mrow> </msub></mrow></math>.
Given a bond price of <math alttext="upper B Subscript t Sub Subscript i">
  <msub><mi>B</mi> <msub><mi>t</mi> <mi>i</mi> </msub> </msub>
</math>, the price of the bond one period later is given by</p>
<div data-type="equation" class="calibre42">
<math alttext="upper B Subscript t Sub Subscript i plus 1 Baseline equals upper B Subscript t Sub Subscript i Baseline dot e Superscript r dot left-parenthesis t Super Subscript i plus 1 Superscript minus t Super Subscript i Superscript right-parenthesis" display="block">
  <mrow>
    <msub><mi>B</mi> <msub><mi>t</mi> <mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow> </msub> </msub>
    <mo>=</mo>
    <msub><mi>B</mi> <msub><mi>t</mi> <mi>i</mi> </msub> </msub>
    <mo>¬∑</mo>
    <msup><mi>e</mi> <mrow><mi>r</mi><mo>¬∑</mo><mo>(</mo><msub><mi>t</mi> <mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow> </msub><mo>-</mo><msub><mi>t</mi> <mi>i</mi> </msub><mo>)</mo></mrow> </msup>
  </mrow>
</math>
</div>

<p class="author1">or</p>
<div data-type="equation" class="calibre42">
<math alttext="upper B Subscript t plus normal upper Delta t Baseline equals upper B Subscript t Baseline dot e Superscript r dot normal upper Delta t" display="block">
  <mrow>
    <msub><mi>B</mi> <mrow><mi>t</mi><mo>+</mo><mi>Œî</mi><mi>t</mi></mrow> </msub>
    <mo>=</mo>
    <msub><mi>B</mi> <mi>t</mi> </msub>
    <mo>¬∑</mo>
    <msup><mi>e</mi> <mrow><mi>r</mi><mo>¬∑</mo><mi>Œî</mi><mi>t</mi></mrow> </msup>
  </mrow>
</math>
</div>

<p class="author1">for some <math alttext="t element-of script upper T minus upper T">
  <mrow>
    <mi>t</mi>
    <mo>‚àà</mo>
    <mi>ùíØ</mi>
    <mo>‚àñ</mo>
    <mi>T</mi>
  </mrow>
</math>.</p>

<p class="author1">A central numerical parameter value to be derived, based on the preceding assumptions, is the martingale probability for an upward movement at any given node. Given that there are only two branches for every node, the downward probability is then known as well. Denote <a data-type="indexterm" data-primary="martingale probability" id="idm44853685116808" class="calibre6"/>the <em class="calibre7">martingale probability</em> for an upward movement by
<math><mrow><mi>q</mi><mo>‚àà</mo><msub><mi>‚Ñù</mi> <mrow><mn>&gt;0</mn></mrow> </msub><mo>,</mo><mn>0</mn><mo>&lt;</mo><mi>q</mi><mo>&lt;</mo><mn>1</mn></mrow></math>.
One gets from the martingale property for the stock price:</p>
<div data-type="equation" class="calibre42">
<math alttext="StartLayout 1st Row 1st Column upper S Subscript t 2nd Column equals 3rd Column e Superscript minus r normal upper Delta t Baseline bold upper E Superscript upper Q Baseline left-parenthesis upper S Subscript t plus normal upper Delta t Baseline right-parenthesis 2nd Row 1st Column Blank 2nd Column equals 3rd Column e Superscript minus r normal upper Delta t Baseline left-parenthesis q upper S Subscript t Baseline u plus left-parenthesis 1 minus q right-parenthesis upper S Subscript t Baseline d right-parenthesis 3rd Row 1st Column 1 2nd Column equals 3rd Column e Superscript minus r normal upper Delta t Baseline left-parenthesis q u plus left-parenthesis 1 minus q right-parenthesis d right-parenthesis 4th Row 1st Column q 2nd Column equals 3rd Column StartFraction e Superscript r normal upper Delta t Baseline minus d Over u minus d EndFraction EndLayout" display="block">
  <mtable>
    <mtr>
      <mtd>
        <msub><mi>S</mi> <mi>t</mi> </msub>
      </mtd>
      <mtd>
        <mo>=</mo>
      </mtd>
      <mtd>
        <mrow>
          <msup><mi>e</mi> <mrow><mo>-</mo><mi>r</mi><mi>Œî</mi><mi>t</mi></mrow> </msup>
          <msup><mi>ùêÑ</mi> <mi>Q</mi> </msup>
          <mrow>
            <mo>(</mo>
            <msub><mi>S</mi> <mrow><mi>t</mi><mo>+</mo><mi>Œî</mi><mi>t</mi></mrow> </msub>
            <mo>)</mo>
          </mrow>
        </mrow>
      </mtd>
    </mtr>
    <mtr>
      <mtd/>
      <mtd>
        <mo>=</mo>
      </mtd>
      <mtd>
        <mrow>
          <msup><mi>e</mi> <mrow><mo>-</mo><mi>r</mi><mi>Œî</mi><mi>t</mi></mrow> </msup>
          <mfenced separators="" open="(" close=")">
            <mi>q</mi>
            <msub><mi>S</mi> <mi>t</mi> </msub>
            <mi>u</mi>
            <mo>+</mo>
            <mrow>
              <mo>(</mo>
              <mn>1</mn>
              <mo>-</mo>
              <mi>q</mi>
              <mo>)</mo>
            </mrow>
            <msub><mi>S</mi> <mi>t</mi> </msub>
            <mi>d</mi>
          </mfenced>
        </mrow>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow>
          <mo>‚áî</mo>
          <mn>1</mn>
        </mrow>
      </mtd>
      <mtd>
        <mo>=</mo>
      </mtd>
      <mtd>
        <mrow>
          <msup><mi>e</mi> <mrow><mo>-</mo><mi>r</mi><mi>Œî</mi><mi>t</mi></mrow> </msup>
          <mfenced separators="" open="(" close=")">
            <mi>q</mi>
            <mi>u</mi>
            <mo>+</mo>
            <mo>(</mo>
            <mn>1</mn>
            <mo>-</mo>
            <mi>q</mi>
            <mo>)</mo>
            <mi>d</mi>
          </mfenced>
        </mrow>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mrow>
          <mo>‚áî</mo>
          <mi>q</mi>
        </mrow>
      </mtd>
      <mtd>
        <mo>=</mo>
      </mtd>
      <mtd>
        <mfrac><mrow><msup><mi>e</mi> <mrow><mi>r</mi><mi>Œî</mi><mi>t</mi></mrow> </msup><mo>-</mo><mi>d</mi></mrow> <mrow><mi>u</mi><mo>-</mo><mi>d</mi></mrow></mfrac>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<p class="author1">This shows that the martingale measure is fixed at every node and consequently for the whole tree.</p>

<p class="author1">The basics of the binomial option pricing model are easily translated into Python code:<sup class="calibre14"><a data-type="noteref" id="idm44853685071096-marker" href="ch06.xhtml#idm44853685071096" class="calibre15">1</a></sup></p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="kn">import</code><code class="calibre22"> </code><code class="nn">math</code><code class="calibre22">
</code><code class="calibre22">        </code><code class="kn">import</code><code class="calibre22"> </code><code class="nn">numpy</code><code class="calibre22"> </code><code class="kn">as</code><code class="calibre22"> </code><code class="nn">np</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S0</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">36.</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-1" href="#callout_dynamic_economy_CO1-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">K</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">40.</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-2" href="#callout_dynamic_economy_CO1-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">r</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">0.06</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-3" href="#callout_dynamic_economy_CO1-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">T</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1.0</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-4" href="#callout_dynamic_economy_CO1-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">0.2</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-5" href="#callout_dynamic_economy_CO1-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">4</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-6" href="#callout_dynamic_economy_CO1-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">dt</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">T</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-7" href="#callout_dynamic_economy_CO1-7"><img src="Images/7.png" alt="7" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">df</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="o">-</code><code class="n">r</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">dt</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-8" href="#callout_dynamic_economy_CO1-8"><img src="Images/8.png" alt="8" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">up</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">dt</code><code class="p">)</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-9" href="#callout_dynamic_economy_CO1-9"><img src="Images/9.png" alt="9" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">down</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">up</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-10" href="#callout_dynamic_economy_CO1-9"><img src="Images/9.png" alt="9" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">q</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="p">(</code><code class="mi">1</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">down</code><code class="p">)</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="p">(</code><code class="n">up</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">down</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO1-11" href="#callout_dynamic_economy_CO1-10"><img src="Images/10.png" alt="10" class="calibre44"/></a></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-1" href="#co_dynamic_economy_CO1-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The initial stock price value.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-2" href="#co_dynamic_economy_CO1-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The strike price for the option to be valued.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-3" href="#co_dynamic_economy_CO1-3"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The constant risk-less short rate.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-4" href="#co_dynamic_economy_CO1-4"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The time horizon and option maturity.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-5" href="#co_dynamic_economy_CO1-5"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The constant volatility factor.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-6" href="#co_dynamic_economy_CO1-6"><img src="Images/6.png" alt="6" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The number of time intervals.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-7" href="#co_dynamic_economy_CO1-7"><img src="Images/7.png" alt="7" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The resulting length of each time interval.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-8" href="#co_dynamic_economy_CO1-8"><img src="Images/8.png" alt="8" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The discount factor for the fixed time interval.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-9" href="#co_dynamic_economy_CO1-9"><img src="Images/9.png" alt="9" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The upward and downward factors.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO1-10" href="#co_dynamic_economy_CO1-11"><img src="Images/10.png" alt="10" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The martingale probability for an upward movement.</p></dd>
</dl>

<p class="author1">The simulation of the stock price process and the valuation of options in this model are a bit more involved. The following presents two different implementations: one based on <em class="calibre7">Python loops</em>, which might be easier to understand at the beginning, and one based on <em class="calibre7">vectorized</em> <code class="calibre22">NumPy</code> <em class="calibre7">code</em>, which is more concise and efficient, but may be a bit harder to grasp at first.</p>








<section data-type="sect2" data-pdf-bookmark="Simulation and Valuation Based on Python Loops" class="calibre4"><div class="preface" id="idm44853684841528">
<h2 class="calibre55">Simulation and Valuation Based on Python Loops</h2>

<p class="author1">Even <a data-type="indexterm" data-primary="binomial option pricing" data-secondary="Python loops" id="binomial-python-loops" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-secondary="Python loops" id="cox-ross-python-loops" class="calibre6"/><a data-type="indexterm" data-primary="ndarray" data-secondary="loops" id="ndarray-loops" class="calibre6"/><a data-type="indexterm" data-primary="NumPy" data-secondary="loops" id="numpy-loops" class="calibre6"/><a data-type="indexterm" data-primary="Python loops" id="python-loops" class="calibre6"/><a data-type="indexterm" data-primary="loops (Python)" id="loops-python" class="calibre6"/>though the implementation in this subsection uses Python loops, the basic data structure is a <code class="calibre22">NumPy</code> <code class="calibre22">ndarray</code> object:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">zeros</code><code class="p">(</code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-1" href="#callout_dynamic_economy_CO2-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">S</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-2" href="#callout_dynamic_economy_CO2-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S0</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-3" href="#callout_dynamic_economy_CO2-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="n">S</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-4" href="#callout_dynamic_economy_CO2-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="mi">36.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0.</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">z</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-5" href="#callout_dynamic_economy_CO2-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">        </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-6" href="#callout_dynamic_economy_CO2-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">            </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">i</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="n">z</code><code class="p">)</code><code class="p">:</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-7" href="#callout_dynamic_economy_CO2-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">                </code><code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">up</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-8" href="#callout_dynamic_economy_CO2-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">                </code><code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22"> </code><code class="p">,</code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">down</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-9" href="#callout_dynamic_economy_CO2-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">            </code><code class="n">z</code><code class="calibre22"> </code><code class="o">+</code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-10" href="#callout_dynamic_economy_CO2-7"><img src="Images/7.png" alt="7" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">set_printoptions</code><code class="p">(</code><code class="n">formatter</code><code class="o">=</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">{</code><code class="s">'</code><code class="s">float_kind</code><code class="s">'</code><code class="p">:</code><code class="calibre22"> </code><code class="kn">lambda</code><code class="calibre22"> </code><code class="n">x</code><code class="p">:</code><code class="calibre22"> </code><code class="s">'</code><code class="si">%7.3f</code><code class="s">'</code><code class="calibre22"> </code><code class="o">%</code><code class="calibre22"> </code><code class="n">x</code><code class="p">}</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO2-11" href="#callout_dynamic_economy_CO2-8"><img src="Images/8.png" alt="8" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">39.786</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">43.970</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">48.595</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">53.706</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">32.574</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">39.786</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">43.970</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">29.474</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">32.574</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">26.669</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">29.474</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">               </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">24.132</code><code class="p">]</code><code class="p">]</code><code class="p">)</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-1" href="#co_dynamic_economy_CO2-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Initializes the <code class="calibre22">ndarray</code> object.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-2" href="#co_dynamic_economy_CO2-3"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Sets the initial stock price value in the upper-lefthand corner.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-3" href="#co_dynamic_economy_CO2-5"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Sets a counter <code class="calibre22">z</code> to 1.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-4" href="#co_dynamic_economy_CO2-6"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Iterates from <code class="calibre22">1</code> to <code class="calibre22">m+1</code>, that is, over all time steps after 0.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-5" href="#co_dynamic_economy_CO2-7"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Iterates over the relevant nodes for the given time step.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-6" href="#co_dynamic_economy_CO2-8"><img src="Images/6.png" alt="6" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Calculates the up and down values and sets them in the <code class="calibre22">ndarray</code> object.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-7" href="#co_dynamic_economy_CO2-10"><img src="Images/7.png" alt="7" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Increases the counter by 1 to include more relevant nodes in the next step.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO2-8" href="#co_dynamic_economy_CO2-11"><img src="Images/8.png" alt="8" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The resulting recombining binomial tree.</p></dd>
</dl>










<section data-type="sect3" data-pdf-bookmark="European option pricing" class="calibre4"><div class="preface" id="idm44853684642664">
<h3 class="calibre65">European option pricing</h3>

<p class="author1">The<a data-type="indexterm" data-primary="European option pricing" data-secondary="in binomial model" data-secondary-sortas="binomial model" id="european-option-binomial" class="calibre6"/><a data-type="indexterm" data-primary="backward induction" id="backward-induction" class="calibre6"/> valuation of a European option based on the available stock price process happens by calculating the inner values of the option at maturity and applying <em class="calibre7">backward induction</em>. This basically means starting at the end, moving backward step by step to the present, and at every node repeatedly applying the risk-neutral pricing paradigm as introduced in the simple static two-state economy of <a data-type="xref" href="ch02_split_000.xhtml#two_state_economy" class="calibre6">Chapter¬†2</a>.</p>

<p class="author1">The following Python code assumes a European put option payoff:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">h</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">zeros_like</code><code class="p">(</code><code class="n">S</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO3-1" href="#callout_dynamic_economy_CO3-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">z</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">             </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">i</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="n">z</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">                 </code><code class="n">h</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="nb">max</code><code class="p">(</code><code class="n">K</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO3-2" href="#callout_dynamic_economy_CO3-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">z</code><code class="calibre22"> </code><code class="o">+</code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">h</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO3-3" href="#callout_dynamic_economy_CO3-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">4.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.214</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.214</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">13.331</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">zeros_like</code><code class="p">(</code><code class="n">S</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">V</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">h</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">V</code><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">4</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="c"># European option pricing</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">z</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">0</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">             </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">i</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">z</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">                 </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="p">(</code><code class="n">q</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22">
</code><code class="calibre22">                             </code><code class="p">(</code><code class="mi">1</code><code class="o">-</code><code class="n">q</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO3-4" href="#callout_dynamic_economy_CO3-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">z</code><code class="calibre22"> </code><code class="o">+</code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO3-5" href="#callout_dynamic_economy_CO3-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">3.977</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">2.190</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.784</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">6.299</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">3.985</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">1.771</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">9.344</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">6.830</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">12.735</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">]</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO3-6" href="#callout_dynamic_economy_CO3-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">17</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">3.9771456941187893</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO3-1" href="#co_dynamic_economy_CO3-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The <code class="calibre22">ndarray</code> object for the inner values.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO3-2" href="#co_dynamic_economy_CO3-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">This calculates the inner values for the relevant nodes.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO3-3" href="#co_dynamic_economy_CO3-4"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">This does the node-wise valuation by applying risk-neutral pricing.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO3-4" href="#co_dynamic_economy_CO3-5"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The resulting present value binomial tree.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO3-5" href="#co_dynamic_economy_CO3-6"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The present value today of the European put <a data-type="indexterm" data-primary="European option pricing" data-secondary="in binomial model" data-secondary-sortas="binomial model" data-startref="european-option-binomial" id="idm44853682596008" class="calibre6"/><a data-type="indexterm" data-primary="backward induction" data-startref="backward-induction" id="idm44853682594472" class="calibre6"/>option.</p></dd>
</dl>
</div></section>













<section data-type="sect3" data-pdf-bookmark="American option pricing" class="calibre4"><div class="preface" id="idm44853682525864">
<h3 class="calibre65">American option pricing</h3>

<p class="author1">One<a data-type="indexterm" data-primary="American option pricing" data-secondary="in binomial model" data-secondary-sortas="binomial model" id="american-option-binomial" class="calibre6"/> of the major features of the binomial option pricing model is that American options are as easily valued as their European counterparts. An <em class="calibre7">American option</em> can be exercised at any time <em class="calibre7">on and before</em> the maturity date. The adjustment to be made to the backward valuation algorithm is simple: one just needs to check whether the inner value of the American option is at any given node higher than the continuation value, that is, the present value of not exercising the option. If that is the case, the option is exercised, and the value of the American option is set to the inner value. Formally, one gets</p>
<div data-type="equation" class="calibre42">
<math alttext="upper V Subscript t Baseline equals max left-bracket h Subscript t Baseline comma e Superscript minus r normal upper Delta t Baseline bold upper E Superscript upper Q Baseline left-parenthesis upper V Subscript t plus normal upper Delta t Baseline right-parenthesis right-bracket" display="block">
  <mrow>
    <msub><mi>V</mi> <mi>t</mi> </msub>
    <mo>=</mo>
    <mo movablelimits="true" form="prefix">max</mo>
    <mfenced separators="" open="[" close="]">
      <msub><mi>h</mi> <mi>t</mi> </msub>
      <mo>,</mo>
      <msup><mi>e</mi> <mrow><mo>-</mo><mi>r</mi><mi>Œî</mi><mi>t</mi></mrow> </msup>
      <msup><mi>ùêÑ</mi> <mi>Q</mi> </msup>
      <mrow>
        <mo>(</mo>
        <msub><mi>V</mi> <mrow><mi>t</mi><mo>+</mo><mi>Œî</mi><mi>t</mi></mrow> </msub>
        <mo>)</mo>
      </mrow>
    </mfenced>
  </mrow>
</math>
</div>

<p class="author1">where <math alttext="h Subscript t">
  <msub><mi>h</mi> <mi>t</mi> </msub>
</math> is the inner value at time <math alttext="t">
  <mi>t</mi>
</math>, and <math alttext="e Superscript minus r normal upper Delta t Baseline bold upper E Superscript upper Q Baseline left-parenthesis upper V Subscript t plus normal upper Delta t Baseline right-parenthesis">
  <mrow>
    <msup><mi>e</mi> <mrow><mo>-</mo><mi>r</mi><mi>Œî</mi><mi>t</mi></mrow> </msup>
    <msup><mi>ùêÑ</mi> <mi>Q</mi> </msup>
    <mrow>
      <mo>(</mo>
      <msub><mi>V</mi> <mrow><mi>t</mi><mo>+</mo><mi>Œî</mi><mi>t</mi></mrow> </msub>
      <mo>)</mo>
    </mrow>
  </mrow>
</math> is the continuation value.</p>

<p class="author1">In Python, a single line of code needs to be added:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">18</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="c"># American option pricing</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">z</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">0</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">             </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">i</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="n">m</code><code class="o">-</code><code class="n">z</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">                 </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="p">(</code><code class="n">q</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22">
</code><code class="calibre22">                           </code><code class="p">(</code><code class="mi">1</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">q</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">                 </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="nb">max</code><code class="p">(</code><code class="n">h</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="p">,</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO4-1" href="#callout_dynamic_economy_CO4-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">z</code><code class="calibre22"> </code><code class="o">+</code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO4-2" href="#callout_dynamic_economy_CO4-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">19</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">4.540</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">2.307</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.784</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.249</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">1.771</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">13.331</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">]</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO4-3" href="#callout_dynamic_economy_CO4-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">4.539560595224299</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO4-1" href="#co_dynamic_economy_CO4-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">This line checks for the early exercise decision and puts the inner value as the American option value when it is higher than the continuation value.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO4-2" href="#co_dynamic_economy_CO4-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The resulting binomial tree for the present values of the American put option.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO4-3" href="#co_dynamic_economy_CO4-3"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The present value today of the American put option, which is considerably higher than without early <a data-type="indexterm" data-primary="binomial option pricing" data-secondary="Python loops" data-startref="binomial-python-loops" id="idm44853682426536" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-secondary="Python loops" data-startref="cox-ross-python-loops" id="idm44853682726168" class="calibre6"/><a data-type="indexterm" data-primary="ndarray" data-secondary="loops" data-startref="ndarray-loops" id="idm44853682724936" class="calibre6"/><a data-type="indexterm" data-primary="NumPy" data-secondary="loops" data-startref="numpy-loops" id="idm44853682423624" class="calibre6"/><a data-type="indexterm" data-primary="Python loops" data-startref="python-loops" id="idm44853682422408" class="calibre6"/><a data-type="indexterm" data-primary="loops (Python)" data-startref="loops-python" id="idm44853683880600" class="calibre6"/><a data-type="indexterm" data-primary="American option pricing" data-secondary="in binomial model" data-secondary-sortas="binomial model" data-startref="american-option-binomial" id="idm44853683879656" class="calibre6"/>exercise.</p></dd>
</dl>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Simulation and Valuation Based on Vectorized Code" class="calibre4"><div class="preface" id="idm44853684170200">
<h2 class="calibre55">Simulation and Valuation Based on Vectorized Code</h2>

<p class="author1">The <a data-type="indexterm" data-primary="binomial option pricing" data-secondary="vectorization" id="binomial-vectorization" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-secondary="vectorization" id="cox-ross-vectorization" class="calibre6"/><a data-type="indexterm" data-primary="vectorization" data-secondary="in binomial model" data-secondary-sortas="binomial model" id="vectorization-binomial" class="calibre6"/><a data-type="indexterm" data-primary="NumPy" data-secondary="vector modeling" id="numpy-vectorization" class="calibre6"/>algorithm implementation that follows makes systematic use of <code class="calibre22">NumPy</code> vectorization capabilities. The implementation is presented step by step, also with some illustrating lines of code not needed for the algorithm implementation itself:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">u</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-1" href="#callout_dynamic_economy_CO5-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">u</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-2" href="#callout_dynamic_economy_CO5-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">u</code><code class="calibre22"> </code><code class="o">*</code><code class="o">*</code><code class="calibre22"> </code><code class="mi">2</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-3" href="#callout_dynamic_economy_CO5-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">1</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">4</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">9</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">16</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">2</code><code class="calibre22"> </code><code class="o">*</code><code class="o">*</code><code class="calibre22"> </code><code class="n">u</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-4" href="#callout_dynamic_economy_CO5-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">2</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">4</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">8</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">16</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">u</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">resize</code><code class="p">(</code><code class="n">u</code><code class="p">,</code><code class="calibre22"> </code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-5" href="#callout_dynamic_economy_CO5-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">u</code><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">25</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">d</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">u</code><code class="o">.</code><code class="n">T</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-6" href="#callout_dynamic_economy_CO5-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">d</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-7" href="#callout_dynamic_economy_CO5-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">25</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">3</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="mi">4</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">4</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="p">(</code><code class="n">u</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">2</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">d</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO5-8" href="#callout_dynamic_economy_CO5-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">1</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">2</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">3</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">4</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="o">-</code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">1</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">2</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="o">-</code><code class="mi">4</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">2</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="o">-</code><code class="mi">6</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">5</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">4</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">3</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">2</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="o">-</code><code class="mi">8</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">7</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">6</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">5</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">4</code><code class="p">]</code><code class="p">]</code><code class="p">)</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO5-1" href="#co_dynamic_economy_CO5-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Creates an <code class="calibre22">ndarray</code> object for the number of upward movements from <code class="calibre22">0</code> to <code class="calibre22">m</code>.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO5-2" href="#co_dynamic_economy_CO5-3"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Calculating the squares by a vectorized operation.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO5-3" href="#co_dynamic_economy_CO5-4"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Calculating the powers of 2 by using the <code class="calibre22">u</code> object as a vector exponent.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO5-4" href="#co_dynamic_economy_CO5-5"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Resizes the <code class="calibre22">u</code> object from one dimension to two dimensions. The number of upward movements is now stored in each row.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO5-5" href="#co_dynamic_economy_CO5-6"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Transposes the <code class="calibre22">u</code> object to get a two-dimensional <code class="calibre22">ndarray</code> object <code class="calibre22">d</code> with the number of downward movements in each column.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO5-6" href="#co_dynamic_economy_CO5-8"><img src="Images/6.png" alt="6" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Combines the <code class="calibre22">u</code> and <code class="calibre22">d</code> objects to arrive at the net number of upward and downward movements. For instance, <code class="calibre22">+2</code> means ‚Äútwo more upward movements than downward movements‚Äù or <code class="calibre22">-1</code> means ‚Äúone more downward movement than upward movements.‚Äù<sup class="calibre14"><a data-type="noteref" id="idm44853683423000-marker" href="ch06.xhtml#idm44853683423000" class="calibre15">2</a></sup></p></dd>
</dl>

<p class="author1">Equipped with a matrix containing the net number of movements in the binomial tree, simulation of the stock price process boils down to a single line of code:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S0</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">dt</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="p">(</code><code class="n">u</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">2</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">d</code><code class="p">)</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO6-1" href="#callout_dynamic_economy_CO6-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">S</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO6-2" href="#callout_dynamic_economy_CO6-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">39.786</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">43.970</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">48.595</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">53.706</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">29.474</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">32.574</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">39.786</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">43.970</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">24.132</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">26.669</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">29.474</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">32.574</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">19.757</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">21.835</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">24.132</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">26.669</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">29.474</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">16.176</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">17.877</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">19.757</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">21.835</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">24.132</code><code class="p">]</code><code class="p">]</code><code class="p">)</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO6-1" href="#co_dynamic_economy_CO6-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The vectorized simulation of the stock price process (binomial tree).</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO6-2" href="#co_dynamic_economy_CO6-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Only the numbers on and above the diagonal are relevant.</p></dd>
</dl>

<p class="author1">The valuation<a data-type="indexterm" data-primary="European option pricing" data-secondary="vectorization" id="european-option-vectorization" class="calibre6"/><a data-type="indexterm" data-primary="American option pricing" data-secondary="vectorization" id="american-option-vectorization" class="calibre6"/> of both the European and American put options is also vectorized to some extent. A single loop over the time steps remains:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">h</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">maximum</code><code class="p">(</code><code class="n">K</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">S</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-1" href="#callout_dynamic_economy_CO7-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">h</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-2" href="#callout_dynamic_economy_CO7-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">4.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.214</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">10.526</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.214</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">15.868</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">13.331</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">20.243</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">18.165</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">13.331</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">23.824</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">22.123</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">20.243</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">18.165</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">29</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">h</code><code class="o">.</code><code class="n">copy</code><code class="p">(</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-3" href="#callout_dynamic_economy_CO7-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">30</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="c"># European option pricing</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-4" href="#callout_dynamic_economy_CO7-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="p">(</code><code class="n">q</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="p">:</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22">
</code><code class="calibre22">                            </code><code class="p">(</code><code class="mi">1</code><code class="o">-</code><code class="n">q</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-5" href="#callout_dynamic_economy_CO7-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">31</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">]</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-6" href="#callout_dynamic_economy_CO7-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">31</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">3.977145694118792</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">32</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="c"># American option pricing</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="n">m</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-7" href="#callout_dynamic_economy_CO7-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="p">(</code><code class="n">q</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="p">:</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22">
</code><code class="calibre22">                            </code><code class="p">(</code><code class="mi">1</code><code class="o">-</code><code class="n">q</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="mi">1</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-8" href="#callout_dynamic_economy_CO7-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">V</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">maximum</code><code class="p">(</code><code class="n">h</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="p">,</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="n">t</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-9" href="#callout_dynamic_economy_CO7-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">4.540</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">2.307</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.784</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">10.526</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.249</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">1.771</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">15.868</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">13.331</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">7.426</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">4.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">20.243</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">18.165</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">13.331</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">10.526</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">23.824</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">22.123</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">20.243</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">18.165</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">15.868</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">34</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">]</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO7-10" href="#callout_dynamic_economy_CO7-7"><img src="Images/7.png" alt="7" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">34</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">4.5395605952243</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-1" href="#co_dynamic_economy_CO7-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The calculation of the inner value of the put option, fully vectorized this time.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-2" href="#co_dynamic_economy_CO7-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">As before, only the numbers on and above the diagonal are relevant.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-3" href="#co_dynamic_economy_CO7-3"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Creates a copy of the <code class="calibre22">h</code> object.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-4" href="#co_dynamic_economy_CO7-4"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The partly vectorized valuation algorithm for the European put option.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-5" href="#co_dynamic_economy_CO7-6"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The present value of the European put option.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-6" href="#co_dynamic_economy_CO7-7"><img src="Images/6.png" alt="6" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The partly vectorized valuation algorithm for the American put option.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO7-7" href="#co_dynamic_economy_CO7-10"><img src="Images/7.png" alt="7" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The present value of the American put option.</p></dd>
</dl>
<div data-type="important" class="calibre28"><h1 class="calibre49">European and American Options</h1>
<p class="author1">The beauty of the (recombining) binomial option pricing model of Cox, Ross, and Rubinstein (1979) not only lies in its simplicity but also in the fact that it can be used to value both European options and American options with high accuracy in an efficient manner. In the limit, making time steps infinitely small, the model converges to the Black-Scholes-Merton (1973) model, which is another<a data-type="indexterm" data-primary="binomial option pricing" data-secondary="vectorization" data-startref="binomial-vectorization" id="idm44853683546568" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-secondary="vectorization" data-startref="cox-ross-vectorization" id="idm44853683634616" class="calibre6"/><a data-type="indexterm" data-primary="vectorization" data-secondary="in binomial model" data-secondary-sortas="binomial model" data-startref="vectorization-binomial" id="idm44853683633336" class="calibre6"/><a data-type="indexterm" data-primary="NumPy" data-secondary="vector modeling" data-startref="numpy-vectorization" id="idm44853683631848" class="calibre6"/><a data-type="indexterm" data-primary="European option pricing" data-secondary="vectorization" data-startref="european-option-vectorization" id="idm44853683630632" class="calibre6"/><a data-type="indexterm" data-primary="American option pricing" data-secondary="vectorization" data-startref="american-option-vectorization" id="idm44853683650104" class="calibre6"/> advantage.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Speed Comparison" class="calibre4"><div class="preface" id="idm44853684169608">
<h2 class="calibre55">Speed Comparison</h2>

<p class="author1">Vectorizing <a data-type="indexterm" data-primary="binomial option pricing" data-secondary="speed comparison" id="binomial-speed" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-secondary="speed comparison" id="cox-ross-speed" class="calibre6"/><a data-type="indexterm" data-primary="vectorization" data-secondary="speed comparison with Python loops" id="vectorization-speed" class="calibre6"/><a data-type="indexterm" data-primary="Python loops" id="python-loops-speed" class="calibre6"/><a data-type="indexterm" data-primary="loops (Python)" id="loops-python-speed" class="calibre6"/>code not only makes Python code more concise, but it generally allows for significant speed improvements. The following code snippets implement the previous algorithms for a speed comparison based on a larger, more realistic number of time steps. First, the basic numerical parameters need to be adjusted:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">35</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">500</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO8-1" href="#callout_dynamic_economy_CO8-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">dt</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">T</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">m</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">df</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="o">-</code><code class="n">r</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">dt</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">up</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">dt</code><code class="p">)</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">down</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">up</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">q</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="p">(</code><code class="mi">1</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">down</code><code class="p">)</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="p">(</code><code class="n">up</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">down</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">q</code><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">35</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">0.5044724639230862</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO8-1" href="#co_dynamic_economy_CO8-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Increases the number of time intervals to a realistic level, yielding rather accurate numerical option values.</p></dd>
</dl>

<p class="author1">The<a data-type="indexterm" data-primary="binomial_looping() function" id="idm44853681812856" class="calibre6"/> function <code class="calibre22">binomial_looping()</code> integrates all elements of the <em class="calibre7">loop-based implementation</em> of the simulation and valuation algorithm for the American put option:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code> <code class="p">[</code><code class="mi">36</code><code class="p">]:</code> <code class="kn">def</code> <code class="nf">binomial_looping</code><code class="p">():</code>
             <code class="c"># stock price simulation in binomial tree</code>
             <code class="n">S</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">zeros</code><code class="p">((</code><code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code> <code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">))</code>
             <code class="n">S</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">]</code> <code class="o">=</code> <code class="n">S0</code>
             <code class="n">z</code> <code class="o">=</code> <code class="mi">1</code>
             <code class="kn">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">):</code>
                 <code class="kn">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="n">z</code><code class="p">):</code>
                     <code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code> <code class="o">-</code> <code class="mi">1</code><code class="p">]</code> <code class="o">*</code> <code class="n">up</code>
                     <code class="n">S</code><code class="p">[</code><code class="n">i</code> <code class="o">+</code> <code class="mi">1</code> <code class="p">,</code><code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code> <code class="o">-</code> <code class="mi">1</code><code class="p">]</code> <code class="o">*</code> <code class="n">down</code>
                 <code class="n">z</code> <code class="o">+=</code> <code class="mi">1</code>
             <code class="c"># inner value calculation</code>
             <code class="n">h</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">zeros_like</code><code class="p">(</code><code class="n">S</code><code class="p">)</code>
             <code class="n">z</code> <code class="o">=</code> <code class="mi">1</code>
             <code class="kn">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">):</code>
                 <code class="kn">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="n">z</code><code class="p">):</code>
                     <code class="n">h</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="nb">max</code><code class="p">(</code><code class="n">K</code> <code class="o">-</code> <code class="n">S</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">],</code> <code class="mi">0</code><code class="p">)</code>
                 <code class="n">z</code> <code class="o">+=</code> <code class="mi">1</code>
             <code class="c"># American option pricing</code>
             <code class="n">V</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">zeros_like</code><code class="p">(</code><code class="n">S</code><code class="p">)</code>
             <code class="n">V</code><code class="p">[:,</code> <code class="o">-</code><code class="mi">1</code><code class="p">]</code> <code class="o">=</code> <code class="n">h</code><code class="p">[:,</code> <code class="o">-</code><code class="mi">1</code><code class="p">]</code>
             <code class="n">z</code> <code class="o">=</code> <code class="mi">0</code>
             <code class="kn">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">m</code> <code class="o">-</code> <code class="mi">1</code><code class="p">,</code> <code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="o">-</code><code class="mi">1</code><code class="p">):</code>
                 <code class="kn">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="n">m</code> <code class="o">-</code> <code class="n">z</code><code class="p">):</code>
                     <code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">df</code> <code class="o">*</code> <code class="p">(</code><code class="n">q</code> <code class="o">*</code> <code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code> <code class="o">+</code>
                               <code class="p">(</code><code class="mi">1</code> <code class="o">-</code> <code class="n">q</code><code class="p">)</code> <code class="o">*</code> <code class="n">V</code><code class="p">[</code><code class="n">i</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code> <code class="n">t</code> <code class="o">+</code> <code class="mi">1</code><code class="p">])</code>
                     <code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="nb">max</code><code class="p">(</code><code class="n">h</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">],</code> <code class="n">V</code><code class="p">[</code><code class="n">i</code><code class="p">,</code> <code class="n">t</code><code class="p">])</code>
                 <code class="n">z</code> <code class="o">+=</code> <code class="mi">1</code>
             <code class="kn">return</code> <code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">]</code></pre>

<p class="author1">The execution takes less than 200 milliseconds on the author‚Äôs computer:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code> <code class="p">[</code><code class="mi">37</code><code class="p">]:</code> <code class="o">%</code><code class="n">time</code> <code class="n">binomial_looping</code><code class="p">()</code>
         <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mi">190</code> <code class="n">ms</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mi">4.69</code> <code class="n">ms</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mi">194</code> <code class="n">ms</code>
         <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mi">190</code> <code class="n">ms</code>

<code class="n">Out</code><code class="p">[</code><code class="mi">37</code><code class="p">]:</code> <code class="mi">4.486374777505983</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">38</code><code class="p">]:</code> <code class="o">%</code><code class="n">timeit</code> <code class="n">binomial_looping</code><code class="p">()</code>
         <code class="mi">173</code> <code class="n">ms</code> <code class="si">¬±</code> <code class="mi">2.48</code> <code class="n">ms</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="si">¬±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">10</code> <code class="n">loops</code> <code class="n">each</code><code class="p">)</code></pre>

<p class="author1">The function <code class="calibre22">binomial_vectorization()</code> integrates all elements of the <em class="calibre7">vectorized implementation</em> of the simulation and valuation algorithm for the American put option:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code> <code class="p">[</code><code class="mi">39</code><code class="p">]:</code> <code class="kn">def</code> <code class="nf">binomial_vectorization</code><code class="p">():</code>
             <code class="n">u</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">)</code>
             <code class="n">u</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">resize</code><code class="p">(</code><code class="n">u</code><code class="p">,</code> <code class="p">(</code><code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code> <code class="n">m</code> <code class="o">+</code> <code class="mi">1</code><code class="p">))</code>
             <code class="n">d</code> <code class="o">=</code> <code class="n">u</code><code class="o">.</code><code class="n">T</code>
             <code class="c"># stock price simulation</code>
             <code class="n">S</code> <code class="o">=</code> <code class="n">S0</code> <code class="o">*</code> <code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="n">sigma</code> <code class="o">*</code> <code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">dt</code><code class="p">)</code> <code class="o">*</code> <code class="p">(</code><code class="n">u</code> <code class="o">-</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">d</code><code class="p">))</code>
             <code class="c"># inner value calculation</code>
             <code class="n">h</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">maximum</code><code class="p">(</code><code class="n">K</code> <code class="o">-</code> <code class="n">S</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
             <code class="c"># American option pricing</code>
             <code class="n">V</code> <code class="o">=</code> <code class="n">h</code><code class="o">.</code><code class="n">copy</code><code class="p">()</code>
             <code class="kn">for</code> <code class="n">t</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="n">m</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="o">-</code><code class="mi">1</code><code class="p">):</code>
                 <code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">:</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">df</code> <code class="o">*</code> <code class="p">(</code><code class="n">q</code> <code class="o">*</code> <code class="n">V</code><code class="p">[:</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="n">t</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code> <code class="o">+</code>
                                <code class="p">(</code><code class="mi">1</code><code class="o">-</code><code class="n">q</code><code class="p">)</code> <code class="o">*</code> <code class="n">V</code><code class="p">[</code><code class="mi">1</code><code class="p">:,</code> <code class="n">t</code> <code class="o">+</code> <code class="mi">1</code><code class="p">])</code>
                 <code class="n">V</code><code class="p">[:,</code> <code class="n">t</code><code class="p">]</code> <code class="o">=</code> <code class="n">np</code><code class="o">.</code><code class="n">maximum</code><code class="p">(</code><code class="n">h</code><code class="p">[:,</code> <code class="n">t</code><code class="p">],</code> <code class="n">V</code><code class="p">[:,</code> <code class="n">t</code><code class="p">])</code>
             <code class="kn">return</code> <code class="n">V</code><code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">]</code></pre>

<p class="author1">This implementation is about 40 times faster than the loop-based one, which impressively illustrates the power of vectorized implementation approaches in terms of performance improvements:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code> <code class="p">[</code><code class="mi">40</code><code class="p">]:</code> <code class="o">%</code><code class="n">time</code> <code class="n">binomial_vectorization</code><code class="p">()</code>
         <code class="n">CPU</code> <code class="n">times</code><code class="p">:</code> <code class="n">user</code> <code class="mi">4.67</code> <code class="n">ms</code><code class="p">,</code> <code class="n">sys</code><code class="p">:</code> <code class="mi">2.39</code> <code class="n">ms</code><code class="p">,</code> <code class="n">total</code><code class="p">:</code> <code class="mi">7.07</code> <code class="n">ms</code>
         <code class="n">Wall</code> <code class="n">time</code><code class="p">:</code> <code class="mi">8.73</code> <code class="n">ms</code>

<code class="n">Out</code><code class="p">[</code><code class="mi">40</code><code class="p">]:</code> <code class="mi">4.486374777506075</code>

<code class="n">In</code> <code class="p">[</code><code class="mi">41</code><code class="p">]:</code> <code class="o">%</code><code class="n">timeit</code> <code class="n">binomial_vectorization</code><code class="p">()</code>
         <code class="mi">4.7</code> <code class="n">ms</code> <code class="si">¬±</code> <code class="mi">252</code> <code class="si">¬µ</code><code class="n">s</code> <code class="n">per</code> <code class="n">loop</code> <code class="p">(</code><code class="n">mean</code> <code class="si">¬±</code> <code class="n">std</code><code class="o">.</code> <code class="n">dev</code><code class="o">.</code> <code class="n">of</code> <code class="mi">7</code> <code class="n">runs</code><code class="p">,</code> <code class="mi">100</code> <code class="n">loops</code> <code class="n">each</code><code class="p">)</code></pre>
<div data-type="note" epub:type="note" class="calibre26"><h1 class="calibre33">Infrastructure and Performance</h1>
<p class="author1">All absolute times reported here are dependent both on the hardware and software configuration used. For instance, you can use <code class="calibre22">NumPy</code> in combination with the <a href="https://oreil.ly/dWyk9" class="calibre6">Math Kernel Library (MKL) from Intel</a>. This combination can significantly speed up numerical operations on Intel processor-based systems. Relative times and speed-up factors should be roughly similar on different <a data-type="indexterm" data-primary="model economies" data-secondary="dynamic" data-tertiary="binomial option pricing" data-startref="model-dynamic-binomial" id="idm44853681104248" class="calibre6"/><a data-type="indexterm" data-primary="dynamic economy" data-secondary="binomial option pricing" data-startref="dynamic-binomial" id="idm44853681096728" class="calibre6"/><a data-type="indexterm" data-primary="binomial option pricing" data-startref="binomial" id="idm44853681095512" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-startref="cox-ross" id="idm44853681094568" class="calibre6"/><a data-type="indexterm" data-primary="binomial option pricing" data-secondary="speed comparison" data-startref="binomial-speed" id="idm44853681093560" class="calibre6"/><a data-type="indexterm" data-primary="Cox-Ross-Rubinstein model" data-secondary="speed comparison" data-startref="cox-ross-speed" id="idm44853681092344" class="calibre6"/><a data-type="indexterm" data-primary="vectorization" data-secondary="speed comparison with Python loops" data-startref="vectorization-speed" id="idm44853681091112" class="calibre6"/><a data-type="indexterm" data-primary="Python loops" data-startref="python-loops-speed" id="idm44853681089880" class="calibre6"/><a data-type="indexterm" data-primary="loops (Python)" data-startref="loops-python-speed" id="idm44853681088936" class="calibre6"/>infrastructures.</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Black-Scholes-Merton Option Pricing" class="calibre4"><div class="preface" id="idm44853685229240">
<h1 class="calibre17">Black-Scholes-Merton Option Pricing</h1>

<p class="author1">A <a data-type="indexterm" data-primary="model economies" data-secondary="dynamic" data-tertiary="Black-Scholes-Merton option pricing" id="model-dynamic-black-scholes" class="calibre6"/><a data-type="indexterm" data-primary="dynamic economy" data-secondary="Black-Scholes-Merton option pricing" id="dynamic-black-scholes" class="calibre6"/><a data-type="indexterm" data-primary="Black-Scholes-Merton option pricing" data-secondary="in dynamic model" data-secondary-sortas="dynamic model" id="black-scholes-dynamic" class="calibre6"/><a data-type="indexterm" data-primary="Monte Carlo simulation" id="monte-carlo" class="calibre6"/>static simulation version of the Black-Scholes-Merton (1973) model for option pricing is discussed in <a data-type="xref" href="ch05_split_000.xhtml#static_economy" class="calibre6">Chapter¬†5</a>. This section introduces a <em class="calibre7">dynamic simulation version</em> for their seminal option pricing model. For additional background information on the model, refer to <a data-type="xref" href="ch05_split_000.xhtml#static_economy" class="calibre6">Chapter¬†5</a>.</p>

<p class="author1">The stochastic differential equation for the Black-Scholes-Merton (1973) economy is given by</p>
<div data-type="equation" class="calibre42">
<math alttext="d upper S Subscript t Baseline equals r upper S Subscript t Baseline d t plus sigma upper S Subscript t Baseline d upper Z Subscript t" display="block">
  <mrow>
    <mi>d</mi>
    <msub><mi>S</mi> <mi>t</mi> </msub>
    <mo>=</mo>
    <mi>r</mi>
    <msub><mi>S</mi> <mi>t</mi> </msub>
    <mi>d</mi>
    <mi>t</mi>
    <mo>+</mo>
    <mi>œÉ</mi>
    <msub><mi>S</mi> <mi>t</mi> </msub>
    <mi>d</mi>
    <msub><mi>Z</mi> <mi>t</mi> </msub>
  </mrow>
</math>
</div>

<p class="author1">where
<math><mrow><msub><mi>S</mi> <mi>t</mi> </msub><mo>‚àà</mo><msub><mi>‚Ñù</mi> <mrow><mn>&gt;0</mn></mrow> </msub></mrow></math>
is the stock price at time <math alttext="t">
  <mi>t</mi>
</math>,
<math><mrow><mi>r</mi><mo>‚àà</mo><msub><mi>‚Ñù</mi> <mrow><mn>‚â•0</mn></mrow> </msub></mrow></math>
is the constant short rate,
<math><mrow><mi>œÉ</mi><mo>‚àà</mo><msub><mi>‚Ñù</mi> <mrow><mn>&gt;0</mn></mrow> </msub></mrow></math>
is the constant volatility factor, and <math alttext="upper Z Subscript t">
  <msub><mi>Z</mi> <mi>t</mi> </msub>
</math> is an arithmetic Brownian motion (see Glasserman (2004, chapter 3) and Hilpisch (2018, chapter 12)).</p>








<section data-type="sect2" data-pdf-bookmark="Monte Carlo Simulation of Stock Price Paths" class="calibre4"><div class="preface" id="idm44853681056728">
<h2 class="calibre55">Monte Carlo Simulation of Stock Price Paths</h2>

<p class="author1">Assume a finite set of relevant points in time <math alttext="script upper T identical-to StartSet t 0 equals 0 comma t 1 comma t 2 comma period period period comma t Subscript upper M Baseline equals upper T EndSet">
  <mrow>
    <mi>ùíØ</mi>
    <mo>‚â°</mo>
    <mo>{</mo>
    <msub><mi>t</mi> <mn>0</mn> </msub>
    <mo>=</mo>
    <mn>0</mn>
    <mo>,</mo>
    <msub><mi>t</mi> <mn>1</mn> </msub>
    <mo>,</mo>
    <msub><mi>t</mi> <mn>2</mn> </msub>
    <mo>,</mo>
    <mo>.</mo>
    <mo>.</mo>
    <mo>.</mo>
    <mo>,</mo>
    <msub><mi>t</mi> <mi>M</mi> </msub>
    <mo>=</mo>
    <mi>T</mi>
    <mo>}</mo>
  </mrow>
</math>, with <math alttext="upper M plus 1 comma upper M greater-than 1">
  <mrow>
    <mi>M</mi>
    <mo>+</mo>
    <mn>1</mn>
    <mo>,</mo>
    <mi>M</mi>
    <mo>&gt;</mo>
    <mn>1</mn>
  </mrow>
</math>, and a fixed interval length of <math alttext="normal upper Delta t">
  <mrow>
    <mi>Œî</mi>
    <mi>t</mi>
  </mrow>
</math>. The stock price <math alttext="upper S Subscript t Baseline comma 0 less-than t less-than-or-equal-to upper T">
  <mrow>
    <msub><mi>S</mi> <mi>t</mi> </msub>
    <mo>,</mo>
    <mn>0</mn>
    <mo>&lt;</mo>
    <mi>t</mi>
    <mo>‚â§</mo>
    <mi>T</mi>
  </mrow>
</math>, given 
<span class="firstname">the previous</span> stock price <math alttext="upper S Subscript t minus normal upper Delta t">
  <msub><mi>S</mi> <mrow><mi>t</mi><mo>-</mo><mi>Œî</mi><mi>t</mi></mrow> </msub>
</math>, can then be simulated according to the difference 
<span class="firstname">equation</span></p>
<div data-type="equation" class="calibre42">
<math alttext="upper S Subscript t Baseline equals upper S Subscript t minus normal upper Delta t Baseline dot exp left-parenthesis left-parenthesis r minus StartFraction sigma squared Over 2 EndFraction right-parenthesis normal upper Delta t plus sigma StartRoot normal upper Delta t EndRoot z right-parenthesis" display="block">
  <mrow>
    <msub><mi>S</mi> <mi>t</mi> </msub>
    <mo>=</mo>
    <msub><mi>S</mi> <mrow><mi>t</mi><mo>-</mo><mi>Œî</mi><mi>t</mi></mrow> </msub>
    <mo>¬∑</mo>
    <mo form="prefix">exp</mo>
    <mfenced separators="" open="(" close=")">
      <mfenced separators="" open="(" close=")">
        <mi>r</mi>
        <mo>-</mo>
        <mfrac><msup><mi>œÉ</mi> <mn>2</mn> </msup> <mn>2</mn></mfrac>
      </mfenced>
      <mi>Œî</mi>
      <mi>t</mi>
      <mo>+</mo>
      <mi>œÉ</mi>
      <msqrt>
        <mrow>
          <mi>Œî</mi>
          <mi>t</mi>
        </mrow>
      </msqrt>
      <mi>z</mi>
    </mfenced>
  </mrow>
</math>
</div>

<p class="author1">where <math alttext="z">
  <mi>z</mi>
</math> is a standard normally distributed random variable. This scheme is <a data-type="indexterm" data-primary="Euler discretization" id="idm44853680955736" class="calibre6"/>called <em class="calibre7">Euler discretization</em>. It is known to be accurate in that it ensures convergence of the discrete time process to the continuous time process for <math alttext="normal upper Delta t">
  <mrow>
    <mi>Œî</mi>
    <mi>t</mi>
  </mrow>
</math> converging to 0.</p>

<p class="author1">The dynamic Monte Carlo simulation is‚Äîwith the background knowledge from the static simulation in <a data-type="xref" href="ch05_split_000.xhtml#static_economy" class="calibre6">Chapter¬†5</a>‚Äîstraightforward to implement in Python. <a data-type="xref" href="#bsm_dyn_01" class="calibre6">Figure¬†6-1</a> shows 10 simulated stock price paths:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">43</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S0</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">36.</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-1" href="#callout_dynamic_economy_CO9-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">K</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">40.</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-2" href="#callout_dynamic_economy_CO9-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">r</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">0.06</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-3" href="#callout_dynamic_economy_CO9-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">T</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">1.0</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-4" href="#callout_dynamic_economy_CO9-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">0.2</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-5" href="#callout_dynamic_economy_CO9-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">44</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">M</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">100</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-6" href="#callout_dynamic_economy_CO9-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">I</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">50000</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-7" href="#callout_dynamic_economy_CO9-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">45</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">dt</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">T</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="n">M</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-8" href="#callout_dynamic_economy_CO9-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">dt</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-9" href="#callout_dynamic_economy_CO9-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">45</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">0.01</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">46</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="o">-</code><code class="n">r</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">dt</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-10" href="#callout_dynamic_economy_CO9-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">df</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-11" href="#callout_dynamic_economy_CO9-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">46</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">0.9994001799640054</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">47</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="kn">from</code><code class="calibre22"> </code><code class="nn">numpy.random</code><code class="calibre22"> </code><code class="kn">import</code><code class="calibre22"> </code><code class="n">default_rng</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">rng</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">default_rng</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">rn</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">rng</code><code class="o">.</code><code class="n">standard_normal</code><code class="p">(</code><code class="p">(</code><code class="n">M</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">I</code><code class="p">)</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-12" href="#callout_dynamic_economy_CO9-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">rn</code><code class="calibre22"> </code><a class="calibre6" id="co_dynamic_economy_CO9-13" href="#callout_dynamic_economy_CO9-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">48</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1.160</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.290</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.780</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">1.890</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.050</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.760</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.460</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">1.400</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.140</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">1.350</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.150</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.530</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.200</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.040</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.730</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">2.140</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.170</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.340</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">0.220</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">1.310</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.730</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.820</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.600</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.400</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">2.130</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">1.240</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.580</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.960</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.890</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.780</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">2.130</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.410</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.710</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">1.190</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.100</code><code class="p">,</code><code class="calibre22">  </code><code class="o">-</code><code class="mi">0.520</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">zeros_like</code><code class="p">(</code><code class="n">rn</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-14" href="#callout_dynamic_economy_CO9-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">S</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S0</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-15" href="#callout_dynamic_economy_CO9-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">S</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-16" href="#callout_dynamic_economy_CO9-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">49</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">50</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="n">M</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">S</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="n">t</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">]</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="p">(</code><code class="n">r</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">*</code><code class="o">*</code><code class="calibre22"> </code><code class="mi">2</code><code class="calibre22"> </code><code class="o">/</code><code class="calibre22"> </code><code class="mi">2</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">dt</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22">
</code><code class="calibre22">                                    </code><code class="n">sigma</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">sqrt</code><code class="p">(</code><code class="n">dt</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">rn</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-17" href="#callout_dynamic_economy_CO9-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">51</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-18" href="#callout_dynamic_economy_CO9-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">51</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="p">[</code><code class="calibre22"> </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.000</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">36.349</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">35.023</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.114</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">35.056</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.119</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">35.633</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">36.508</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">35.009</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">35.602</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.601</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">36.259</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">35.402</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">42.689</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">39.760</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">40.681</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">37.516</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">47.893</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">42.846</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">40.921</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">38.804</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">41.175</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">38.260</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">48.769</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">43.534</code><code class="p">]</code><code class="p">,</code><code class="calibre22">
</code><code class="calibre22">                </code><code class="p">[</code><code class="calibre22"> </code><code class="mi">42.716</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">38.499</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">41.782</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">39.200</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">48.884</code><code class="p">,</code><code class="calibre22">  </code><code class="mi">43.103</code><code class="p">]</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">52</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="kn">from</code><code class="calibre22"> </code><code class="nn">pylab</code><code class="calibre22"> </code><code class="kn">import</code><code class="calibre22"> </code><code class="n">mpl</code><code class="p">,</code><code class="calibre22"> </code><code class="n">plt</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">use</code><code class="p">(</code><code class="s">'</code><code class="s">seaborn</code><code class="s">'</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s">'</code><code class="s">font.family</code><code class="s">'</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="s">'</code><code class="s">serif</code><code class="s">'</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">mpl</code><code class="o">.</code><code class="n">rcParams</code><code class="p">[</code><code class="s">'</code><code class="s">savefig.dpi</code><code class="s">'</code><code class="p">]</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="mi">300</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">53</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">S</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code class="calibre22"> </code><code class="p">:</code><code class="mi">10</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO9-19" href="#callout_dynamic_economy_CO9-6"><img src="Images/6.png" alt="6" class="calibre44"/></a></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO9-1" href="#co_dynamic_economy_CO9-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The financial parameters are as before.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO9-2" href="#co_dynamic_economy_CO9-6"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">These are the Monte Carlo simulation parameters (paths, time steps, length of time interval, discount factor for single time interval).</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO9-3" href="#co_dynamic_economy_CO9-12"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">A two-dimensional <code class="calibre22">ndarray</code> object with standard normally distributed random numbers of appropriate size is generated.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO9-4" href="#co_dynamic_economy_CO9-14"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Another two-dimensional <code class="calibre22">ndarray</code> object of the same shape is instantiated, and the initial values for the single stock price paths are set.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO9-5" href="#co_dynamic_economy_CO9-17"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The single stock price paths are simulated based on the initial stock prices, the random number matrix, and the difference equation for the geometric Brownian motion.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO9-6" href="#co_dynamic_economy_CO9-19"><img src="Images/6.png" alt="6" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Plots the first 10 simulated paths.</p></dd>
</dl>

<figure class="calibre50"><div id="bsm_dyn_01" class="figure">
<img src="Images/ftwp_0601.png" alt="ftwp 0601" class="calibre57"/>
<h6 class="calibre52"><span class="firstname">Figure 6-1. </span>Simulated stock price paths for Black-Scholes-Merton (1973)</h6>
</div></figure>

<p class="author1">As in the static case, the end-of-period values of the stock price can be visualized in the form of a histogram (see <a data-type="xref" href="#bsm_dyn_02" class="calibre6">Figure¬†6-2</a>):</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">54</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">ST</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">ST</code><code class="p">,</code><code class="calibre22"> </code><code class="n">bins</code><code class="o">=</code><code class="mi">35</code><code class="p">,</code><code class="calibre22"> </code><code class="n">color</code><code class="o">=</code><code class="s">'</code><code class="s">b</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">label</code><code class="o">=</code><code class="s">'</code><code class="s">frequency</code><code class="s">'</code><code class="p">)</code><code class="p">;</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">axvline</code><code class="p">(</code><code class="n">ST</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code class="calibre22"> </code><code class="n">color</code><code class="o">=</code><code class="s">'</code><code class="s">r</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">label</code><code class="o">=</code><code class="s">'</code><code class="s">mean</code><code class="s">'</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">axvline</code><code class="p">(</code><code class="n">ST</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="calibre22"> </code><code class="o">+</code><code class="calibre22"> </code><code class="n">ST</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code class="calibre22"> </code><code class="n">ls</code><code class="o">=</code><code class="s">'</code><code class="s">--</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">color</code><code class="o">=</code><code class="s">'</code><code class="s">y</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">label</code><code class="o">=</code><code class="s">'</code><code class="s">sd up</code><code class="s">'</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">axvline</code><code class="p">(</code><code class="n">ST</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">ST</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code class="calibre22"> </code><code class="n">ls</code><code class="o">=</code><code class="s">'</code><code class="s">-.</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">color</code><code class="o">=</code><code class="s">'</code><code class="s">y</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">label</code><code class="o">=</code><code class="s">'</code><code class="s">sd down</code><code class="s">'</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">legend</code><code class="p">(</code><code class="n">loc</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code class="p">;</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">55</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">S0</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="n">r</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">T</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO10-1" href="#callout_dynamic_economy_CO10-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">55</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">38.22611567563295</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">56</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">ST</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO10-2" href="#callout_dynamic_economy_CO10-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">56</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">38.25248936738523</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO10-1" href="#co_dynamic_economy_CO10-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Mathematically expected value for <math alttext="upper S Subscript upper T">
  <msub><mi>S</mi> <mi>T</mi> </msub>
</math>.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO10-2" href="#co_dynamic_economy_CO10-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The average over all simulated values <code class="calibre22">ST</code>.</p></dd>
</dl>

<figure class="calibre50"><div id="bsm_dyn_02" class="figure">
<img src="Images/ftwp_0602.png" alt="ftwp 0602" class="calibre66"/>
<h6 class="calibre52"><span class="firstname">Figure 6-2. </span>Frequency distribution of simulated end-of-period stock prices for Black-Scholes-Merton (1973)</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Monte Carlo Valuation of the European Put Option" class="calibre4"><div class="preface" id="idm44853681056104">
<h2 class="calibre55">Monte Carlo Valuation of the European Put Option</h2>

<p class="author1">The<a data-type="indexterm" data-primary="Monte Carlo simulation" data-secondary="for European put options" data-secondary-sortas="European put options" id="monte-carlo-european" class="calibre6"/><a data-type="indexterm" data-primary="European option pricing" data-secondary="Monte Carlo simulation" id="european-option-monte-carlo" class="calibre6"/> Monte Carlo estimator for the price of the European put option is</p>
<div data-type="equation" class="calibre42">
<math alttext="upper P 0 equals e Superscript minus r upper T Baseline StartFraction 1 Over upper I EndFraction sigma-summation Underscript i equals 1 Overscript upper I Endscripts max left-parenthesis upper K minus upper S Subscript upper T Baseline left-parenthesis i right-parenthesis comma 0 right-parenthesis" display="block">
  <mrow>
    <msub><mi>P</mi> <mn>0</mn> </msub>
    <mo>=</mo>
    <msup><mi>e</mi> <mrow><mo>-</mo><mi>r</mi><mi>T</mi></mrow> </msup>
    <mfrac><mn>1</mn> <mi>I</mi></mfrac>
    <munderover><mo>‚àë</mo> <mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow> <mi>I</mi> </munderover>
    <mo movablelimits="true" form="prefix">max</mo>
    <mrow>
      <mo>(</mo>
      <mi>K</mi>
      <mo>-</mo>
      <msub><mi>S</mi> <mi>T</mi> </msub>
      <mrow>
        <mo>(</mo>
        <mi>i</mi>
        <mo>)</mo>
      </mrow>
      <mo>,</mo>
      <mn>0</mn>
      <mo>)</mo>
    </mrow>
  </mrow>
</math>
</div>

<p class="author1">where <math alttext="upper I">
  <mi>I</mi>
</math> is the number of simulated price paths. Against this background, European put option pricing boils down to a few lines of Python code only given the simulated stock price paths. <a data-type="xref" href="#bsm_dyn_03" class="calibre6">Figure¬†6-3</a> shows a histogram of the simulated inner values at maturity:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">57</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">h</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">maximum</code><code class="p">(</code><code class="n">K</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">ST</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO11-1" href="#callout_dynamic_economy_CO11-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">h</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO11-2" href="#callout_dynamic_economy_CO11-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">57</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">array</code><code class="p">(</code><code class="p">[</code><code class="calibre22">  </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">1.501</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22"> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.800</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">,</code><code class="calibre22">   </code><code class="mi">0.000</code><code class="p">]</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">58</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">6</code><code class="p">)</code><code class="p">)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">h</code><code class="p">,</code><code class="calibre22"> </code><code class="n">color</code><code class="o">=</code><code class="s">'</code><code class="s">b</code><code class="s">'</code><code class="p">,</code><code class="calibre22"> </code><code class="n">bins</code><code class="o">=</code><code class="mi">35</code><code class="p">)</code><code class="p">;</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO11-3" href="#callout_dynamic_economy_CO11-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">59</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">math</code><code class="o">.</code><code class="n">exp</code><code class="p">(</code><code class="o">-</code><code class="n">r</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">T</code><code class="p">)</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">h</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO11-4" href="#callout_dynamic_economy_CO11-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">59</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">3.818117261795047</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO11-1" href="#co_dynamic_economy_CO11-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Calculates the inner values in vectorized fashion.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO11-2" href="#co_dynamic_economy_CO11-3"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Plots the frequency distribution of the inner values at maturity, illustrating the highly asymmetric payoff that is typical for an option.<sup class="calibre14"><a data-type="noteref" id="idm44853679632632-marker" href="ch06.xhtml#idm44853679632632" class="calibre15">3</a></sup></p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO11-3" href="#co_dynamic_economy_CO11-4"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Calculates the average over all inner values and discounts the average to the<a data-type="indexterm" data-primary="Monte Carlo simulation" data-secondary="for European put options" data-secondary-sortas="European put options" data-startref="monte-carlo-european" id="idm44853679629560" class="calibre6"/><a data-type="indexterm" data-primary="European option pricing" data-secondary="Monte Carlo simulation" data-startref="european-option-monte-carlo" id="idm44853679539192" class="calibre6"/> present.</p></dd>
</dl>

<figure class="calibre50"><div id="bsm_dyn_03" class="figure">
<img src="Images/ftwp_0603.png" alt="ftwp 0603" class="calibre67"/>
<h6 class="calibre52"><span class="firstname">Figure 6-3. </span>Frequency distribution of simulated inner values at maturity for the European put option</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Monte Carlo Valuation of the American Put Option" class="calibre4"><div class="preface" id="idm44853679535704">
<h2 class="calibre55">Monte Carlo Valuation of the American Put Option</h2>

<p class="author1">The <a data-type="indexterm" data-primary="Monte Carlo simulation" data-secondary="for American put options" data-secondary-sortas="American put options" id="monte-carlo-american" class="calibre6"/><a data-type="indexterm" data-primary="American option pricing" data-secondary="Monte Carlo simulation" id="american-option-monte-carlo" class="calibre6"/><a data-type="indexterm" data-primary="LSM (Least-Squares Monte Carlo)" id="lsm" class="calibre6"/><a data-type="indexterm" data-primary="Least-Squares Monte Carlo (LSM)" id="least-squares-monte-carlo" class="calibre6"/>valuation of American (put) options based on Monte Carlo simulation is a bit more involved. The most popular algorithm in this regard is the <em class="calibre7">Least-Squares Monte Carlo</em> (LSM) algorithm from Longstaff and Schwartz (2001) because it is relatively simple and efficient to apply from a numerical and computational perspective. The scope of this chapter does not allow us to go into details. However, it allows us to present a concise, highly vectorized Python implementation. For an in-depth treatment of the LSM algorithm applied to the Black-Scholes-Merton (1973) model economy, including Python code, refer to Hilpisch (2015, chapter 7).</p>

<p class="author1">The following Python code implements the LSM algorithm for American option 
<span class="firstname">valuation</span>:</p>

<pre data-type="programlisting" data-code-language="python" class="calibre43"><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">60</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">h</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">maximum</code><code class="p">(</code><code class="n">K</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="n">S</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-1" href="#callout_dynamic_economy_CO12-1"><img src="Images/1.png" alt="1" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">61</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="c"># Least-Squares Monte Carlo Valuation (LSM algorithm)</code><code class="calibre22">
</code><code class="calibre22">         </code><code class="n">V</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">h</code><code class="p">[</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-2" href="#callout_dynamic_economy_CO12-2"><img src="Images/2.png" alt="2" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">         </code><code class="kn">for</code><code class="calibre22"> </code><code class="n">t</code><code class="calibre22"> </code><code class="ow">in</code><code class="calibre22"> </code><code class="nb">range</code><code class="p">(</code><code class="n">M</code><code class="calibre22"> </code><code class="o">-</code><code class="calibre22"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre22"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre22"> </code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code class="p">:</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-3" href="#callout_dynamic_economy_CO12-3"><img src="Images/3.png" alt="3" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">reg</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">polyfit</code><code class="p">(</code><code class="n">S</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code class="p">,</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">,</code><code class="calibre22"> </code><code class="n">deg</code><code class="o">=</code><code class="mi">5</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-4" href="#callout_dynamic_economy_CO12-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">C</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">polyval</code><code class="p">(</code><code class="n">reg</code><code class="p">,</code><code class="calibre22"> </code><code class="n">S</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-5" href="#callout_dynamic_economy_CO12-4"><img src="Images/4.png" alt="4" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">             </code><code class="n">V</code><code class="calibre22"> </code><code class="o">=</code><code class="calibre22"> </code><code class="n">np</code><code class="o">.</code><code class="n">where</code><code class="p">(</code><code class="n">h</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code class="calibre22"> </code><code class="o">&gt;</code><code class="calibre22"> </code><code class="n">C</code><code class="p">,</code><code class="calibre22"> </code><code class="n">h</code><code class="p">[</code><code class="n">t</code><code class="p">]</code><code class="p">,</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-6" href="#callout_dynamic_economy_CO12-5"><img src="Images/5.png" alt="5" class="calibre44"/></a><code class="calibre22">
</code><code class="calibre22">
</code><code class="n">In</code><code class="calibre22"> </code><code class="p">[</code><code class="mi">62</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="n">df</code><code class="calibre22"> </code><code class="o">*</code><code class="calibre22"> </code><code class="n">V</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code class="calibre22">  </code><a class="calibre6" id="co_dynamic_economy_CO12-7" href="#callout_dynamic_economy_CO12-6"><img src="Images/6.png" alt="6" class="calibre44"/></a><code class="calibre22">
</code><code class="n">Out</code><code class="p">[</code><code class="mi">62</code><code class="p">]</code><code class="p">:</code><code class="calibre22"> </code><code class="mi">4.454837750511421</code></pre>
<dl class="calibre18">
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO12-1" href="#co_dynamic_economy_CO12-1"><img src="Images/1.png" alt="1" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Calculates the inner values over the complete stock price path <code class="calibre22">ndarray</code> object.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO12-2" href="#co_dynamic_economy_CO12-2"><img src="Images/2.png" alt="2" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">Sets the initial simulated American option price values to the inner values at maturity.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO12-3" href="#co_dynamic_economy_CO12-3"><img src="Images/3.png" alt="3" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The algorithm also works based on backward induction, starting at <math alttext="upper T minus normal upper Delta t">
  <mrow>
    <mi>T</mi>
    <mo>-</mo>
    <mi>Œî</mi>
    <mi>t</mi>
  </mrow>
</math> and stopping at <math alttext="normal upper Delta t">
  <mrow>
    <mi>Œî</mi>
    <mi>t</mi>
  </mrow>
</math>.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO12-4" href="#co_dynamic_economy_CO12-4"><img src="Images/4.png" alt="4" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">This is the central step of the algorithm during which the continuation values are estimated (approximated) based on the OLS regression of the present simulated option values against the stock price levels.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO12-5" href="#co_dynamic_economy_CO12-6"><img src="Images/5.png" alt="5" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">If the inner value is higher than the estimated (approximated) continuation value, exercise takes place and otherwise not.</p></dd>
<dt class="calibre19"><a class="calibre6" id="callout_dynamic_economy_CO12-6" href="#co_dynamic_economy_CO12-7"><img src="Images/6.png" alt="6" class="calibre44"/></a></dt>
<dd class="calibre45"><p class="calibre46">The present value is calculated as the average over the American option price vector at <math alttext="t equals normal upper Delta t">
  <mrow>
    <mi>t</mi>
    <mo>=</mo>
    <mi>Œî</mi>
    <mi>t</mi>
  </mrow>
</math> as derived based on the LSM algorithm and discounted for the last remaining time interval to the present <math alttext="t equals 0">
  <mrow>
    <mi>t</mi>
    <mo>=</mo>
    <mn>0</mn>
  </mrow>
</math>.</p></dd>
</dl>
<div data-type="note" epub:type="note" class="calibre26"><h1 class="calibre33">Early Exercise and Monte Carlo Simulation</h1>
<p class="author1">The efficient, Monte Carlo simulation‚Äìbased valuation of options and derivatives with early exercise features had been a mainly unsolved problem until the end of the 1990s. At the beginning of the 2000s only, researchers were able to propose computationally efficient algorithms to deal with early exercise in a simulation context. As often in science and finance, once such an algorithm is known‚Äîsuch as the LSM algorithm‚Äîthe implementation and application almost seem quite natural. After all, only a few lines of Python code are needed to accurately value the American put option in this section based on simulation. Nevertheless, the LSM algorithm must be considered a major breakthrough that helped to kick off the computational period <a data-type="indexterm" data-primary="model economies" data-secondary="dynamic" data-tertiary="Black-Scholes-Merton option pricing" data-startref="model-dynamic-black-scholes" id="idm44853680081912" class="calibre6"/><a data-type="indexterm" data-primary="dynamic economy" data-secondary="Black-Scholes-Merton option pricing" data-startref="dynamic-black-scholes" id="idm44853680080312" class="calibre6"/><a data-type="indexterm" data-primary="Black-Scholes-Merton option pricing" data-secondary="in dynamic model" data-secondary-sortas="dynamic model" data-startref="black-scholes-dynamic" id="idm44853680079080" class="calibre6"/><a data-type="indexterm" data-primary="Monte Carlo simulation" data-startref="monte-carlo" id="idm44853680077576" class="calibre6"/><a data-type="indexterm" data-primary="Monte Carlo simulation" data-secondary="for American put options" data-secondary-sortas="American put options" data-startref="monte-carlo-american" id="idm44853680076632" class="calibre6"/><a data-type="indexterm" data-primary="American option pricing" data-secondary="Monte Carlo simulation" data-startref="american-option-monte-carlo" id="idm44853680075128" class="calibre6"/><a data-type="indexterm" data-primary="LSM (Least-Squares Monte Carlo)" data-startref="lsm" id="idm44853680073896" class="calibre6"/><a data-type="indexterm" data-primary="Least-Squares Monte Carlo (LSM)" data-startref="least-squares-monte-carlo" id="idm44853680072936" class="calibre6"/>in finance (see <a data-type="xref" href="ch01.xhtml#finance_python" class="calibre6">Chapter¬†1</a>).</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusions" class="calibre4"><div class="preface" id="idm44853680071000">
<h1 class="calibre17">Conclusions</h1>

<p class="author1">This chapter presents in a rather informal manner two popular, dynamically complete financial models. The first is the so-called <em class="calibre7">recombining binomial tree model</em> by Cox-Ross-Rubinstein (1979). The beauty of it lies in its simplicity and that it allows one to implement European and American option pricing in a numerically efficient way and based on high school mathematics only. It is also a good ‚Äúteaching and understanding‚Äù tool as compared to continuous time financial models that require advanced stochastic calculus.</p>

<p class="author1">The second model is a <em class="calibre7">dynamic Monte Carlo simulation version</em> of the Black-Scholes-Merton (1973) continuous time option pricing model. Using <code class="calibre22">NumPy</code> simulation techniques, dynamic Monte Carlo simulation can also be implemented in a numerically efficient manner. Even the computationally demanding Least-Squares Monte Carlo algorithm by Longstaff and Schwartz (2001), involving a time-consuming OLS regression step, is quite fast when implemented based on vectorization techniques.</p>

<p class="author1">In summary, <code class="calibre22">NumPy</code>, with its powerful vectorization capabilities, has proven once again that it allows not only for concise algorithmic code but also for fast execution times‚Äîeven in the context of more realistic and complex dynamic model economies.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Further Resources" class="calibre4"><div class="preface" id="idm44853680065784">
<h1 class="calibre17">Further Resources</h1>

<p class="author1">Papers cited in this chapter:</p>

<ul class="printings">
<li class="calibre54">
<p class="author1">Black, Fischer and Myron Scholes. 1973. ‚ÄúThe Pricing of Options and Corporate Liabilities.‚Äù <em class="calibre7">Journal of Political Economy</em> 81 (3): 638‚Äì659.</p>
</li>
<li class="calibre54">
<p class="author1">Cox, John, Stephen Ross and Mark Rubinstein. 1979. ‚ÄúOption Pricing: A Simplified Approach.‚Äù <em class="calibre7">Journal of Financial Economics</em> 7 (3): 229‚Äì263.</p>
</li>
<li class="calibre54">
<p class="author1">Duffie, Darrell. 1986. ‚ÄúStochastic Equilibria: Existence, Spanning Number, and the <em class="calibre7">No Expected Gains from Financial Trade</em> Hypothesis.‚Äù <em class="calibre7">Econometrica</em> 54 (5): 1161‚Äì1183.</p>
</li>
<li class="calibre54">
<p class="author1">Longstaff, Francis and Eduardo Schwartz. 2001. ‚ÄúValuing American Options by Simulation: A Simple Least Squares Approach.‚Äù <em class="calibre7">Review of Financial Studies</em> 14 (1): 113‚Äì147.</p>
</li>
<li class="calibre54">
<p class="author1">Merton, Robert. 1973. ‚ÄúTheory of Rational Option Pricing.‚Äù <em class="calibre7">Bell Journal of Economics and Management Science</em> (4): 141‚Äì183.</p>
</li>
</ul>

<p class="author1">Books cited in this chapter:</p>

<ul class="printings">
<li class="calibre54">
<p class="author1">Duffie, Darrell. 1988. <em class="calibre7">Security Markets‚ÄîStochastic Models</em>. San Diego: Academic Press.</p>
</li>
<li class="calibre54">
<p class="author1">Glasserman, Paul. 2004. <em class="calibre7">Monte Carlo Methods in Financial Engineering</em>. New York: Springer Verlag.</p>
</li>
<li class="calibre54">
<p class="author1">Hilpisch, Yves. 2018. <em class="calibre7">Python for Finance</em>. 2nd ed. Sebastopol: O‚ÄôReilly.</p>
</li>
<li class="calibre54">
<p class="author1">Hilpisch, Yves. 2015. <em class="calibre7">Derivatives Analytics with Python</em>. Wiley Finance.</p>
</li>
<li class="calibre54">
<p class="author1">Pliska, Stanley. 1997. <em class="calibre7">Introduction to Mathematical Finance.</em> Malden and Oxford: Blackwell Publishers.</p>
</li>
</ul>
</div></section>







<div data-type="footnotes" class="calibre30"><p data-type="footnote" id="idm44853685071096" class="calibre31"><sup class="calibre32"><a href="ch06.xhtml#idm44853685071096-marker" class="calibre15">1</a></sup> The parameters assumed in this chapter are from Longstaff and Schwartz (2001, table 1).</p><p data-type="footnote" id="idm44853683423000" class="calibre31"><sup class="calibre32"><a href="ch06.xhtml#idm44853683423000-marker" class="calibre15">2</a></sup> Note that only the numbers on and above the diagonal are relevant. Numbers below the diagonal can be ignored. They result from the specific vectorized operations implemented on the <code class="calibre22">ndarray</code> object.</p><p data-type="footnote" id="idm44853679632632" class="calibre31"><sup class="calibre32"><a href="ch06.xhtml#idm44853679632632-marker" class="calibre15">3</a></sup> Here, as also often seen in practice, there is a large number of cases for which the option expires worthless, that is, with a payoff of 0.</p></div></div></section></div></body></html>