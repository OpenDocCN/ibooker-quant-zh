<html><head></head><body><section data-pdf-bookmark="Chapter 10. Synthetic Data Generation and &#10;The Hidden Markov Model in Finance" data-type="chapter" epub:type="chapter"><div class="chapter" id="chapter_10">&#13;
<h1><span class="label">Chapter 10. </span>Synthetic Data Generation and &#13;
<span class="keep-together">The Hidden Markov Model in Finance</span></h1>&#13;
&#13;
<blockquote data-type="epigram">&#13;
<p> The data does not have to be rooted in the real world to have value: it can be fabricated and slotted in where some is missing or hard to get hold of. </p>&#13;
<p data-type="attribution">Ahuja (2020)</p>&#13;
</blockquote>&#13;
&#13;
<p><a data-primary="synthetic data generation" data-type="indexterm" id="ix_synth_data_gen_ch10"/>Synthetic data generation has been gaining attention in finance due to rising concerns about confidentiality and increasing data requirements. So, instead of working with real data, why not feed your model with synthetic data as long as it mimics the requisite statistical properties? It sounds appealing, doesn’t it? Synthetic data generation is one part of this chapter; the other part is devoted to another underappreciated but quite important and interesting topic: the hidden Markov model (HMM). You may be tempted to ask: what is the common ground between synthetic data and HMM? Well, we can generate synthetic data from HMM—and this is one of the aims of this chapter. The other aim is to introduce these two important topics, as they are often used in machine learning.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Synthetic Data Generation" data-type="sect1"><div class="sect1" id="idm45737199914320">&#13;
<h1>Synthetic Data Generation</h1>&#13;
&#13;
<p>The confidentiality, sensitivity, and cost of financial data greatly restricts its usage. This, in turn, hinders the progress and dissemination of useful knowledge in finance. Synthetic data addresses these drawbacks and helps researchers and practitioners conduct their analyses and disseminate the results.</p>&#13;
&#13;
<p>Synthetic data is data generated from a process by which it mimics the statistical properties of the real data. Even though there is a belief that data must be modeled in its original form, generating synthetic data from real data is not the only way we can create it (Patki, Wedge, and Veeramachaneni 2016). Rather, there are three ways we can generate synthetic data:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a data-primary="real data, synthetic data generated from" data-type="indexterm" id="idm45737199910832"/>Synthetic data can be generated from the <em>real data</em>. The workflow of this process starts with getting real data, and continues with modeling to unveil the distribution of the data, and as a last step synthetic data is sampled from this existing model.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="knowledge, synthetic data generated from" data-type="indexterm" id="idm45737199908560"/>Synthetic data can be obtained from a <em>model or knowledge</em>. Generally speaking, this type of synthetic data generation can be applied either by using an existing model or knowledge of the researcher.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="hybrid process, synthetic data generated from" data-type="indexterm" id="idm45737199906304"/>A <em>hybrid</em> process includes the previous two steps, because sometimes only a part of the data becomes available and this part of the real data is used to generate synthetic data and the other part of the synthetic data can be obtained from a model.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>We will soon see how we can apply these techniques to generate synthetic data. <a data-primary="privacy-utility tradeoff, data-generation processes" data-type="indexterm" id="idm45737199904096"/>By its nature, the synthetic data generation process has an uncompromising trade-off between privacy and utility. To be exact, synthetic data generation from real undisclosed data results in high utility. However, the utility of the synthetic data generation depends greatly on the deidentification and aggregation of real public data.&#13;
The utility of synthetic data generation is dependent upon successful modeling or the expertise of the analyst.</p>&#13;
&#13;
<p>The privacy-utility trade-off in the context of data-generating processes is illustrated in <a data-type="xref" href="#synt_sch">Figure 10-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="synt_sch">&#13;
<img alt="synt_sch" src="assets/mlfr_1001.png"/>&#13;
<h6><span class="label">Figure 10-1. </span>Privacy-utility trade-off</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Evaluation of the Synthetic Data" data-type="sect1"><div class="sect1" id="idm45737199899296">&#13;
<h1>Evaluation of the Synthetic Data</h1>&#13;
&#13;
<p><a data-primary="synthetic data generation" data-secondary="evaluation of synthetic data" data-type="indexterm" id="ix_synth_data_gen_eval"/>As you can imagine, various tools can be applied to measure the effectiveness of the synthetic data; however, we will restrict our attention to four commonly embraced methods: KL-divergence, distinguishable, ROC curve, and comparing the main statistics such as mean, median, etc. As KL-divergence and ROC were discussed in Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch08.html#chapter_8">8</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch06.html#chapter_6">6</a>, respectively, we will skip over those and start with the distinguishable method.</p>&#13;
&#13;
<p><em>Distinguishable</em>, as its <a data-primary="distinguishable method, synthetic data evaluation" data-type="indexterm" id="idm45737199892976"/>name implies, tries to distinguish between real and synthetic records by assigning 1 if they are real and 0 if not using a classification model that&#13;
distinguishes between real and synthetic data. <a data-primary="propensity score, real versus synthetic data" data-type="indexterm" id="idm45737199891872"/>If the output is closer to 1, it predicts that the record is real, otherwise it predicts it is synthetic data using a <em>propensity score</em> (El Emam 2020).</p>&#13;
&#13;
<p><a data-primary="statistical comparison, real versus synthetic data" data-type="indexterm" id="idm45737199890208"/>The other method is easy yet powerful, and is based on comparing the main statistics of the real and synthetic data. Given the model employed, the mean (or other statistic) of the real data and the synthetic data can be compared to get a sense of the extent to which the synthetic data mimics the real data.</p>&#13;
&#13;
<p>Let’s discuss the advantages and disadvantages of synthetic data generation:</p>&#13;
<dl>&#13;
<dt>Advantages</dt>&#13;
<dd>&#13;
<div class="openblock"><dl>&#13;
<dt>Increased availability of data</dt>&#13;
<dd>&#13;
<p>Synthetic data generation equips us with a strong tool by which we can overcome the difficulty of accessing real data, which can be costly and &#13;
<span class="keep-together">proprietary</span>.</p>&#13;
</dd>&#13;
<dt>Improved analytical skill</dt>&#13;
<dd>&#13;
<p>Synthetic data as a good proxy of the real data can be used in various analytical processes, and this, in turn, improves our understanding of a specific topic. Besides, synthetic data can be used for labeling, paving the way for highly accurate analyses.</p>&#13;
</dd>&#13;
<dt>Handling common statistical problems</dt>&#13;
<dd>&#13;
<p>Synthetic data generation can mitigate the problems arising from real data. Real data may come with issues—such as missing values, outliers, and so on—that badly affect the performance of the model. Synthetics data provides a tool to cope with these statistical problems so that we might end up with improved modeling performance.</p>&#13;
</dd>&#13;
</dl>&#13;
</div>&#13;
&#13;
</dd>&#13;
<dt>Disadvantages</dt>&#13;
<dd>&#13;
<div class="openblock"><dl>&#13;
<dt>Inability to preserve confidentiality</dt>&#13;
<dd>&#13;
<p>Due to cyberattacks, synthetic data might turn out to be a source of private-information leakage. For instance, the credentials of customers can be obtained by reverse engineering.</p>&#13;
</dd>&#13;
<dt>Quality concerns</dt>&#13;
<dd>&#13;
<p>There are two important things that need to be taken into account during the synthetic data generation process: the researcher’s ability and the characteristics of data. These two points determine the quality process of synthetic data generation. If these points are lacking, it is likely to expect low-quality synthetic data.<a data-primary="" data-startref="ix_synth_data_gen_eval" data-type="indexterm" id="idm45737199875920"/></p>&#13;
</dd>&#13;
</dl>&#13;
</div>&#13;
&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Generating Synthetic Data" data-type="sect1"><div class="sect1" id="idm45737199874176">&#13;
<h1>Generating Synthetic Data</h1>&#13;
&#13;
<p><a data-primary="real data, synthetic data generated from" data-type="indexterm" id="idm45737199872352"/><a data-primary="synthetic data generation" data-secondary="classical approaches" data-type="indexterm" id="ix_synth_data_gen_classical"/>Let’s start off with generating synthetic data first from real data, and then from a model. We will use real data from <code>fetch_california_housing</code> to generate synthetic data, and we will also use the <a data-primary="CTGAN library" data-type="indexterm" id="idm45737199869504"/>CTGAN library (<code>CTGANSynthesizer</code>) in this process. The CTGAN library enables us to generate synthetic data with high fidelity to the original data based on generative adversarial networks (GANs). In generating synthetic data, the number of training steps is controlled by <code>epoch</code> parameter, which enables us to obtain synthetic data in a short period of time:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.datasets</code><code> </code><code class="kn">import</code><code> </code><code class="n">fetch_california_housing</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">pandas</code><code> </code><code class="kn">as</code><code> </code><code class="nn">pd</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">matplotlib.</code><code> </code><code class="nn">pyplot</code><code> </code><code class="kn">as</code><code> </code><code class="nn">plt</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">yfinance</code><code> </code><code class="kn">as</code><code> </code><code class="nn">yf</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">datetime</code><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">warnings</code><code>&#13;
</code><code>        </code><code class="n">warnings</code><code class="o">.</code><code class="n">filterwarnings</code><code class="p">(</code><code class="s1">'</code><code class="s1">ignore</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">fetch_california_housing</code><code class="p">(</code><code class="n">return_X_y</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">import</code><code> </code><code class="nn">numpy</code><code> </code><code class="kn">as</code><code> </code><code class="nn">np</code><code>&#13;
</code><code>        </code><code class="n">california_housing</code><code class="o">=</code><code class="n">np</code><code class="o">.</code><code class="n">column_stack</code><code class="p">(</code><code class="p">[</code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-3" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">california_housing_df</code><code class="o">=</code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">california_housing</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">ctgan</code><code> </code><code class="kn">import</code><code> </code><code class="n">CTGANSynthesizer</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-4" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">ctgan</code><code> </code><code class="o">=</code><code> </code><code class="n">CTGANSynthesizer</code><code class="p">(</code><code class="n">epochs</code><code class="o">=</code><code class="mi">10</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-5" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="n">ctgan</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">california_housing_df</code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="n">synt_sample</code><code> </code><code class="o">=</code><code> </code><code class="n">ctgan</code><code class="o">.</code><code class="n">sample</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">california_housing_df</code><code class="p">)</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-6" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-6"><img alt="6" src="assets/6.png"/></a></pre>&#13;
<dl class="calloutlist pagebreak-before less_space">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Importing the <code>fetch_california_housing</code> data from <code>sklearn</code></p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Generating independent and dependent variables from <code>fetch_california_​<span class="keep-together">housing</span></code></p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-3" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Stacking two arrays using the stack function</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-4" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Importing <code>CTGANSynthesizer</code> for synthetic data generation</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-5" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Initializing the synthetic data generation process from <code>CTGANSynthesizer</code> with an <code>epoch</code> of 10</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-6" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO1-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Generating the sample</p></dd>&#13;
</dl>&#13;
&#13;
<p>After generating the synthetic data, the similarity of the synthetic data can be checked by descriptive statistics. <a data-primary="SDV (Synthetic Data Vault)" data-type="indexterm" id="ix_sdv_synth_data"/><a data-primary="evaluate package, SDV" data-type="indexterm" id="ix_eval_pkg_sdv"/>As always, descriptive statistics is handy, but we have another tool, the <code>evaluate</code> package from the Synthetic Data Vault (SDV). The output of this function will be a number between 0 and 1, which will indicate how similar the two tables are, with 0 being the worst and 1 being the best possible score. In addition, the result of the generation process can be visualized (in the resulting Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#eval_synt1">10-2</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#eval_synt2">10-3</a>) and compared with the real data so we can fully understand whether the synthetic data is a good representation of the real data or not:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">california_housing_df</code><code class="o">.</code><code class="n">describe</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="p">:</code><code>              </code><code class="mi">0</code><code>             </code><code class="mi">1</code><code>             </code><code class="mi">2</code><code>             </code><code class="mi">3</code><code>             </code><code class="mi">4</code><code> </code><code>\&#13;
</code><code>   </code><code class="n">count</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>&#13;
</code><code>   </code><code class="n">mean</code><code>       </code><code class="mf">3.870671</code><code>     </code><code class="mf">28.639486</code><code>      </code><code class="mf">5.429000</code><code>      </code><code class="mf">1.096675</code><code>   </code><code class="mf">1425.476744</code><code>&#13;
</code><code>   </code><code class="n">std</code><code>        </code><code class="mf">1.899822</code><code>     </code><code class="mf">12.585558</code><code>      </code><code class="mf">2.474173</code><code>      </code><code class="mf">0.473911</code><code>   </code><code class="mf">1132.462122</code><code>&#13;
</code><code>   </code><code class="nb">min</code><code>        </code><code class="mf">0.499900</code><code>      </code><code class="mf">1.000000</code><code>      </code><code class="mf">0.846154</code><code>      </code><code class="mf">0.333333</code><code>      </code><code class="mf">3.000000</code><code>&#13;
</code><code>   </code><code class="mi">25</code><code class="o">%</code><code>        </code><code class="mf">2.563400</code><code>     </code><code class="mf">18.000000</code><code>      </code><code class="mf">4.440716</code><code>      </code><code class="mf">1.006079</code><code>    </code><code class="mf">787.000000</code><code>&#13;
</code><code>   </code><code class="mi">50</code><code class="o">%</code><code>        </code><code class="mf">3.534800</code><code>     </code><code class="mf">29.000000</code><code>      </code><code class="mf">5.229129</code><code>      </code><code class="mf">1.048780</code><code>   </code><code class="mf">1166.000000</code><code>&#13;
</code><code>   </code><code class="mi">75</code><code class="o">%</code><code>        </code><code class="mf">4.743250</code><code>     </code><code class="mf">37.000000</code><code>      </code><code class="mf">6.052381</code><code>      </code><code class="mf">1.099526</code><code>   </code><code class="mf">1725.000000</code><code>&#13;
</code><code>   </code><code class="nb">max</code><code>       </code><code class="mf">15.000100</code><code>     </code><code class="mf">52.000000</code><code>    </code><code class="mf">141.909091</code><code>     </code><code class="mf">34.066667</code><code>  </code><code class="mf">35682.000000</code><code>&#13;
</code><code>&#13;
</code><code>                     </code><code class="mi">5</code><code>             </code><code class="mi">6</code><code>             </code><code class="mi">7</code><code>             </code><code class="mi">8</code><code>&#13;
</code><code>   </code><code class="n">count</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>&#13;
</code><code>   </code><code class="n">mean</code><code>       </code><code class="mf">3.070655</code><code>     </code><code class="mf">35.631861</code><code>   </code><code class="o">-</code><code class="mf">119.569704</code><code>      </code><code class="mf">2.068558</code><code>&#13;
</code><code>   </code><code class="n">std</code><code>       </code><code class="mf">10.386050</code><code>      </code><code class="mf">2.135952</code><code>      </code><code class="mf">2.003532</code><code>      </code><code class="mf">1.153956</code><code>&#13;
</code><code>   </code><code class="nb">min</code><code>        </code><code class="mf">0.692308</code><code>     </code><code class="mf">32.540000</code><code>   </code><code class="o">-</code><code class="mf">124.350000</code><code>      </code><code class="mf">0.149990</code><code>&#13;
</code><code>   </code><code class="mi">25</code><code class="o">%</code><code>        </code><code class="mf">2.429741</code><code>     </code><code class="mf">33.930000</code><code>   </code><code class="o">-</code><code class="mf">121.800000</code><code>      </code><code class="mf">1.196000</code><code>&#13;
</code><code>   </code><code class="mi">50</code><code class="o">%</code><code>        </code><code class="mf">2.818116</code><code>     </code><code class="mf">34.260000</code><code>   </code><code class="o">-</code><code class="mf">118.490000</code><code>      </code><code class="mf">1.797000</code><code>&#13;
</code><code>   </code><code class="mi">75</code><code class="o">%</code><code>        </code><code class="mf">3.282261</code><code>     </code><code class="mf">37.710000</code><code>   </code><code class="o">-</code><code class="mf">118.010000</code><code>      </code><code class="mf">2.647250</code><code>&#13;
</code><code>   </code><code class="nb">max</code><code>     </code><code class="mf">1243.333333</code><code>     </code><code class="mf">41.950000</code><code>   </code><code class="o">-</code><code class="mf">114.310000</code><code>      </code><code class="mf">5.000010</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">synt_sample</code><code class="o">.</code><code class="n">describe</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="p">:</code><code>              </code><code class="mi">0</code><code>             </code><code class="mi">1</code><code>             </code><code class="mi">2</code><code>             </code><code class="mi">3</code><code>             </code><code class="mi">4</code><code> </code><code>\&#13;
</code><code>   </code><code class="n">count</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>&#13;
</code><code>   </code><code class="n">mean</code><code>       </code><code class="mf">4.819246</code><code>     </code><code class="mf">28.954316</code><code>      </code><code class="mf">6.191938</code><code>      </code><code class="mf">1.172562</code><code>   </code><code class="mf">2679.408170</code><code>&#13;
</code><code>   </code><code class="n">std</code><code>        </code><code class="mf">3.023684</code><code>     </code><code class="mf">13.650675</code><code>      </code><code class="mf">2.237810</code><code>      </code><code class="mf">0.402990</code><code>   </code><code class="mf">2127.606868</code><code>&#13;
</code><code>   </code><code class="nb">min</code><code>       </code><code class="o">-</code><code class="mf">0.068225</code><code>     </code><code class="o">-</code><code class="mf">2.927976</code><code>      </code><code class="mf">0.877387</code><code>     </code><code class="o">-</code><code class="mf">0.144332</code><code>   </code><code class="o">-</code><code class="mf">468.985777</code><code>&#13;
</code><code>   </code><code class="mi">25</code><code class="o">%</code><code>        </code><code class="mf">2.627803</code><code>     </code><code class="mf">19.113346</code><code>      </code><code class="mf">4.779587</code><code>      </code><code class="mf">0.957408</code><code>   </code><code class="mf">1148.179104</code><code>&#13;
</code><code>   </code><code class="mi">50</code><code class="o">%</code><code>        </code><code class="mf">4.217247</code><code>     </code><code class="mf">29.798105</code><code>      </code><code class="mf">5.779768</code><code>      </code><code class="mf">1.062072</code><code>   </code><code class="mf">2021.181784</code><code>&#13;
</code><code>   </code><code class="mi">75</code><code class="o">%</code><code>        </code><code class="mf">6.254332</code><code>     </code><code class="mf">38.144114</code><code>      </code><code class="mf">7.058157</code><code>      </code><code class="mf">1.285233</code><code>   </code><code class="mf">3666.957652</code><code>&#13;
</code><code>   </code><code class="nb">max</code><code>       </code><code class="mf">19.815551</code><code>     </code><code class="mf">54.219486</code><code>     </code><code class="mf">15.639807</code><code>      </code><code class="mf">3.262196</code><code>  </code><code class="mf">12548.941245</code><code>&#13;
</code><code>&#13;
</code><code>                     </code><code class="mi">5</code><code>             </code><code class="mi">6</code><code>             </code><code class="mi">7</code><code>             </code><code class="mi">8</code><code>&#13;
</code><code>   </code><code class="n">count</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>  </code><code class="mf">20640.000000</code><code>&#13;
</code><code>   </code><code class="n">mean</code><code>       </code><code class="mf">3.388233</code><code>     </code><code class="mf">36.371957</code><code>   </code><code class="o">-</code><code class="mf">119.957959</code><code>      </code><code class="mf">2.584699</code><code>&#13;
</code><code>   </code><code class="n">std</code><code>        </code><code class="mf">1.035668</code><code>      </code><code class="mf">2.411460</code><code>      </code><code class="mf">2.306550</code><code>      </code><code class="mf">1.305122</code><code>&#13;
</code><code>   </code><code class="nb">min</code><code>        </code><code class="mf">0.650323</code><code>     </code><code class="mf">32.234033</code><code>   </code><code class="o">-</code><code class="mf">125.836387</code><code>      </code><code class="mf">0.212203</code><code>&#13;
</code><code>   </code><code class="mi">25</code><code class="o">%</code><code>        </code><code class="mf">2.651633</code><code>     </code><code class="mf">34.081107</code><code>   </code><code class="o">-</code><code class="mf">122.010873</code><code>      </code><code class="mf">1.579294</code><code>&#13;
</code><code>   </code><code class="mi">50</code><code class="o">%</code><code>        </code><code class="mf">3.280092</code><code>     </code><code class="mf">36.677974</code><code>   </code><code class="o">-</code><code class="mf">119.606385</code><code>      </code><code class="mf">2.334144</code><code>&#13;
</code><code>   </code><code class="mi">75</code><code class="o">%</code><code>        </code><code class="mf">3.994524</code><code>     </code><code class="mf">38.023437</code><code>   </code><code class="o">-</code><code class="mf">118.080271</code><code>      </code><code class="mf">3.456931</code><code>&#13;
</code><code>   </code><code class="nb">max</code><code>        </code><code class="mf">7.026720</code><code>     </code><code class="mf">43.131795</code><code>   </code><code class="o">-</code><code class="mf">113.530352</code><code>      </code><code class="mf">5.395162</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sdv.evaluation</code><code> </code><code class="kn">import</code><code> </code><code class="n">evaluate</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">evaluate</code><code class="p">(</code><code class="n">synt_sample</code><code class="p">,</code><code> </code><code class="n">california_housing_df</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="p">:</code><code> </code><code class="mf">0.4773175572768998</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">table_evaluator</code><code> </code><code class="kn">import</code><code> </code><code class="n">TableEvaluator</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-3" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">table_evaluator</code><code> </code><code class="o">=</code><code>  </code><code class="n">TableEvaluator</code><code class="p">(</code><code class="n">california_housing_df</code><code class="p">,</code><code> </code><code class="n">synt_sample</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-4" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">table_evaluator</code><code class="o">.</code><code class="n">visual_evaluation</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-5" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-5"><img alt="5" src="assets/5.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Importing the <code>evaluate</code> package for assessing the similarity of synthetic and real data</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Running the <code>evaluate</code> package on our real and synthetic data</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-3" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Importing <code>TableEvaluator</code> for visual inspection of the similarities between synthetic and real data</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-4" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Running <code>TableEvaluator</code> with real and synthetic data</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-5" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Conducting visual analysis with <code>visual_evaluation</code> package</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="eval_synt1">&#13;
<img alt="eval_synt1" src="assets/mlfr_1002.png"/>&#13;
<h6><span class="label">Figure 10-2. </span>Evaluation of synthetic data generation-1</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="eval_synt2">&#13;
<img alt="eval_synt2" src="assets/mlfr_1003.png"/>&#13;
<h6><span class="label">Figure 10-3. </span>Evaluation of synthetic data generation-2</h6>&#13;
</div></figure>&#13;
&#13;
<p>Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#eval_synt1">10-2</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#eval_synt2">10-3</a> allow us to visually compare the performance of the real and synthetic data using the mean, standard deviation, and heatmaps. Even though <code>evaluation</code> has many different tools, it is worth restricting our attention to these for now.<a data-primary="" data-startref="ix_synth_data_gen_classical" data-type="indexterm" id="idm45737198898464"/><a data-primary="" data-startref="ix_sdv_synth_data" data-type="indexterm" id="idm45737198897424"/><a data-primary="" data-startref="ix_eval_pkg_sdv" data-type="indexterm" id="idm45737198896480"/></p>&#13;
&#13;
<p>As can you see, it is not hard to generate synthetic data from real data. <a data-primary="supervised learning modeling" data-secondary="synthetic data generation" data-type="indexterm" id="ix_sup_learn_synth_data"/><a data-primary="synthetic data generation" data-secondary="from supervised learning" data-secondary-sortas="supervised learning" data-type="indexterm" id="ix_synth_data_gen_sup_learn"/><a data-primary="ML (machine learning)" data-secondary="synthetic data generation" data-type="indexterm" id="ix_ml_synth_data"/>Let’s now walk through a process by which we can generate synthetic data based on a model. <a data-primary="sklearn library" data-type="indexterm" id="idm45737198890688"/>I will use <code>sklearn</code>, the Swiss knife library for ML applications, both for classification and regression models. <code>make_regression</code> is helpful for generating synthetic data for running a regression model. Likewise, <code>make_classification</code> generates synthetic data for the purpose of running a classification model. <a data-primary="make_regression package" data-type="indexterm" id="ix_make_regression"/>The following code also generates <a data-type="xref" href="#regression_noise">Figure 10-4</a>:</p>&#13;
&#13;
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.datasets</code><code> </code><code class="kn">import</code><code> </code><code class="n">make_regression</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="kn">import</code><code> </code><code class="nn">matplotlib.pyplot</code><code> </code><code class="kn">as</code><code> </code><code class="nn">plt</code><code>&#13;
</code><code>        </code><code class="kn">from</code><code> </code><code class="nn">matplotlib</code><code> </code><code class="kn">import</code><code> </code><code class="n">cm</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">make_regression</code><code class="p">(</code><code class="n">n_samples</code><code class="o">=</code><code class="mi">1000</code><code class="p">,</code><code> </code><code class="n">n_features</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code><code> </code><code class="n">noise</code><code class="o">=</code><code class="mf">0.2</code><code class="p">,</code><code>&#13;
</code><code>                                </code><code class="n">random_state</code><code class="o">=</code><code class="mi">123</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">alpha</code><code class="o">=</code><code> </code><code class="mf">0.3</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="s1">'</code><code class="s1">Greys</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">18</code><code class="p">,</code><code> </code><code class="mi">18</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">k</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">make_regression</code><code class="p">(</code><code class="n">n_samples</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">n_features</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code><code> </code><code class="n">noise</code><code class="o">=</code><code class="n">i</code><code class="p">,</code><code>&#13;
</code><code>                                    </code><code class="n">random_state</code><code class="o">=</code><code class="mi">123</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">k</code><code class="o">+</code><code class="o">=</code><code class="mi">1</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">subplot</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">k</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">profit_margin_orange</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">asarray</code><code class="p">(</code><code class="p">[</code><code class="mi">20</code><code class="p">,</code><code> </code><code class="mi">35</code><code class="p">,</code><code> </code><code class="mi">40</code><code class="p">]</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">alpha</code><code class="o">=</code><code class="mf">0.3</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="n">cm</code><code class="o">.</code><code class="n">Greys</code><code class="p">,</code><code> </code><code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Synthetic Data with Different Noises: </code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code class="nb">str</code><code class="p">(</code><code class="n">i</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Importing the <code>make_regression</code> package</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Generating synthetic data for regression with 1000 samples, 3 features, and the standard deviation of the noise</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#regression_noise">Figure 10-4</a> shows the effects of varying noise on synthetic data generation.&#13;
As expected, as the standard deviation goes up, the <code>noise</code> parameter gets bigger and &#13;
<span class="keep-together">bigger</span>.<a data-primary="" data-startref="ix_make_regression" data-type="indexterm" id="idm45737198852688"/></p>&#13;
&#13;
<figure><div class="figure" id="regression_noise">&#13;
<img alt="regression_noise" src="assets/mlfr_1004.png"/>&#13;
<h6><span class="label">Figure 10-4. </span>Synthetic data generation with different noises</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="make_classification package" data-type="indexterm" id="ix_make_classif"/>How about generating synthetic data for classification? Well, it does sound easy. We will follow a very similar process as regression. This time, we’ll use the <code>make_classification</code> package. After generating synthetic data, the effect of different numbers of classes will be observed via scatter plot (<a data-type="xref" href="#classification_class">Figure 10-5</a>):</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.datasets</code><code> </code><code class="kn">import</code><code> </code><code class="n">make_classification</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">13</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">18</code><code class="p">,</code><code> </code><code class="mi">18</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">k</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">make_classification</code><code class="p">(</code><code class="n">n_samples</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code>&#13;
</code><code>                                        </code><code class="n">n_features</code><code class="o">=</code><code class="mi">4</code><code class="p">,</code><code>&#13;
</code><code>                                        </code><code class="n">n_classes</code><code class="o">=</code><code class="n">i</code><code class="p">,</code><code>&#13;
</code><code>                                        </code><code class="n">n_redundant</code><code class="o">=</code><code class="mi">0</code><code class="p">,</code><code>&#13;
</code><code>                                        </code><code class="n">n_informative</code><code class="o">=</code><code class="mi">4</code><code class="p">,</code><code>&#13;
</code><code>                                        </code><code class="n">random_state</code><code class="o">=</code><code class="mi">123</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>             </code><code class="n">k</code><code class="o">+</code><code class="o">=</code><code class="mi">1</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">subplot</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">k</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code> </code><code class="p">,</code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">alpha</code><code class="o">=</code><code class="mf">0.8</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="s1">'</code><code class="s1">gray</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Synthetic Data with Different Classes: </code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code class="nb">str</code><code class="p">(</code><code class="n">i</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Importing <code>make_classification</code> package</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Generating synthetic data for classification with 100 samples, 4 features, and 4 informative features</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#classification_class">Figure 10-5</a> shows us the effect of having different classes on the synthetic data generation; in this case, synthetic data was generated with classes 2 to 5.<a data-primary="" data-startref="ix_make_classif" data-type="indexterm" id="idm45737198331968"/><a data-primary="" data-startref="ix_sup_learn_synth_data" data-type="indexterm" id="idm45737198326064"/><a data-primary="" data-startref="ix_synth_data_gen_sup_learn" data-type="indexterm" id="idm45737198325120"/></p>&#13;
&#13;
<figure class="width-90"><div class="figure" id="classification_class">&#13;
<img alt="classification_class" src="assets/mlfr_1005.png"/>&#13;
<h6><span class="label">Figure 10-5. </span>Synthetic data generation with different classes</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-primary="unsupervised learning modeling" data-secondary="synthetic data generation" data-type="indexterm" id="ix_unsup_learn_synth_data"/><a data-primary="synthetic data generation" data-secondary="from unsupervised learning" data-secondary-sortas="unsupervised learning" data-type="indexterm" id="ix_synth_data_gen_unsup_learn"/><a data-primary="make_blobs package" data-type="indexterm" id="ix_make_blobs"/>It is also possible to generate synthetic data from unsupervised learning. <code>make_blobs</code> is a package that can be used for this purpose. So we will generate synthetic data and eyeball the effect of different numbers of clusters on the synthetic data and produce <a data-type="xref" href="#synthetic_cluster">Figure 10-6</a>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">14</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">sklearn.datasets</code><code> </code><code class="kn">import</code><code> </code><code class="n">make_blobs</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">15</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">make_blobs</code><code class="p">(</code><code class="n">n_samples</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">centers</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code><code>&#13;
</code><code>                               </code><code class="n">n_features</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">random_state</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">16</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">figure</code><code class="p">(</code><code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">18</code><code class="p">,</code><code> </code><code class="mi">18</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">k</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">6</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">X</code><code class="p">,</code><code> </code><code class="n">y</code><code> </code><code class="o">=</code><code> </code><code class="n">make_blobs</code><code class="p">(</code><code class="n">n_samples</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">centers</code><code class="o">=</code><code class="n">i</code><code class="p">,</code><code>&#13;
</code><code>                               </code><code class="n">n_features</code><code class="o">=</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">random_state</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">k</code><code> </code><code class="o">+</code><code class="o">=</code><code> </code><code class="mi">1</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">subplot</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><code class="n">k</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">my_scatter_plot</code><code> </code><code class="o">=</code><code> </code><code class="n">plt</code><code class="o">.</code><code class="n">scatter</code><code class="p">(</code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><code class="n">X</code><code class="p">[</code><code class="p">:</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                                           </code><code class="n">alpha</code><code class="o">=</code><code class="mf">0.3</code><code class="p">,</code><code> </code><code class="n">cmap</code><code class="o">=</code><code class="s1">'</code><code class="s1">gray</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">c</code><code class="o">=</code><code class="n">y</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Synthetic Data with Different Clusters: </code><code class="s1">'</code><code> </code><code class="o">+</code><code> </code><code class="nb">str</code><code class="p">(</code><code class="n">i</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Importing the <code>make_blobs</code> package from <code>sklearn</code></p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Generating synthetic data with 100 samples, 2 centers, and 2 features</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#synthetic_cluster">Figure 10-6</a> shows how the synthetic data looks with varying clusters.</p>&#13;
&#13;
<p>Up until now, we have learned how to generate synthetic data using real data and models, using both supervised learning (regression and classification) and unsupervised learning. From this point on, we will explore the HMM and how to use it. From the financial standpoint, we will accomplish this task by factor investing. Factor investing is not a new topic but it has become more and more appealing after the celebrated Fama-French three-factor model (Fama and French 1993). We will see the impact of HMM on identifying different states in the economy and take it into account in investment strategies. In the end, we will be able to compare the effectiveness of factor-investing based on the three-factor Fama-French model with HMM using the Sharpe ratio.</p>&#13;
&#13;
<figure><div class="figure" id="synthetic_cluster">&#13;
<img alt="synthetic_cluster" src="assets/mlfr_1006.png"/>&#13;
<h6><span class="label">Figure 10-6. </span>Synthetic data generation with different noises</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Brief Introduction to the Hidden Markov Model" data-type="sect1"><div class="sect1" id="idm45737199873264">&#13;
<h1>A Brief Introduction to the Hidden Markov Model</h1>&#13;
&#13;
<p><a data-primary="synthetic data generation" data-secondary="hidden Markov model" data-type="indexterm" id="idm45737198505216"/><a data-primary="HMM (hidden Markov model)" data-type="indexterm" id="idm45737198511632"/>HMM gives us a <a data-primary="probability approaches" data-secondary="distribution over sequential data (HMM)" data-type="indexterm" id="idm45737198510816"/>probability distribution over sequential data, which is modeled by a Markov process with hidden states. HMM enables us to estimate probability transition from one state to another.</p>&#13;
&#13;
<p>To illustrate, let us consider the stock market, in which stocks go up, go down, or stay constant. Pick a random state—say, going up. The next state would be either going up, going down, or staying constant. In this context, the state is thought to be a <em>hidden</em> state because we do not know with certainty which state will prevail next in the market.</p>&#13;
&#13;
<p>In general, there are two fundamental assumptions that HMM makes: first, that all observations are solely dependent on the current state and are conditionally independent of other variables, and second, that the transition probabilities are homogenous and depend only on the current hidden state (Wang, Lin, and Mikhelson 2020).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fama-French Three-Factor Model Versus HMM" data-type="sect1"><div class="sect1" id="idm45737198552608">&#13;
<h1>Fama-French Three-Factor Model Versus HMM</h1>&#13;
&#13;
<p><a data-primary="synthetic data generation" data-secondary="Fama-French three-factor model" data-type="indexterm" id="ix_synth_data_gen_fama-french"/><a data-primary="Fama-French three-factor model" data-type="indexterm" id="ix_fama-french_model"/><a data-primary="CAPM (capital asset pricing model)" data-type="indexterm" id="idm45737198528128"/>The model proposed by Fama and French (1993) paved the way for further studies expanding on CAPM. The model suggests brand-new explanatory variables to account for the changes in stock returns. The three factors in this model are market risk <math alttext="left-parenthesis upper R m minus upper R f right-parenthesis">&#13;
  <mrow>&#13;
    <mo>(</mo>&#13;
    <mi>R</mi>&#13;
    <mi>m</mi>&#13;
    <mo>-</mo>&#13;
    <mi>R</mi>&#13;
    <mi>f</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math>, small minus big (SMB), and high minus low (HML).&#13;
Let’s briefly discuss these factors, as we will use them in the model below.</p>&#13;
&#13;
<p><math alttext="left-parenthesis upper R m minus upper R f right-parenthesis">&#13;
  <mrow>&#13;
    <mo>(</mo>&#13;
    <mi>R</mi>&#13;
    <mi>m</mi>&#13;
    <mo>-</mo>&#13;
    <mi>R</mi>&#13;
    <mi>f</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> is basically the return of a market portfolio minus the risk-free rate, <a data-primary="market risk" data-secondary="in Fama-French three-factor model" data-secondary-sortas="Fama-French three-factor model" data-type="indexterm" id="idm45737198106736"/>which is a hypothetical rate proxied by government-issued T-bills or similar assets.</p>&#13;
&#13;
<p><a data-primary="SMB (small minus big), size effect proxy" data-type="indexterm" id="idm45737198105072"/>SMB is a proxy for size effect. Size effect is an important variable used to explain several phenomenon in corporate finance.&#13;
It is represented by different variables like logarithm of total assets. Fama-French takes size effect into account by calculating between returns of small-cap companies and big-cap companies.</p>&#13;
&#13;
<p><a data-primary="return" data-secondary="HML factor in stock return changes" data-type="indexterm" id="idm45737198103680"/><a data-primary="HML (high minus low) in stock return changes" data-type="indexterm" id="idm45737198102688"/>The third factor is HML, which represents the spread in returns between companies with high book-to-market and companies with low book-to-market, comparing a company’s book value to its market value.</p>&#13;
&#13;
<p>Empirical studies suggest that smaller SMB, higher HML, and smaller <math alttext="left-parenthesis upper R m minus upper R f right-parenthesis">&#13;
  <mrow>&#13;
    <mo>(</mo>&#13;
    <mi>R</mi>&#13;
    <mi>m</mi>&#13;
    <mo>-</mo>&#13;
    <mi>R</mi>&#13;
    <mi>f</mi>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> boosts stock returns. Theoretically speaking, identifying states before running the Fama-French three-factor model would boost the performance of the model. To see if this is the case with real data, let us run the&#13;
factor investment model with or without the HMM.</p>&#13;
&#13;
<p><a data-primary="Kenneth R. French data library" data-type="indexterm" id="idm45737198147360"/>The data is compiled from the <a href="https://oreil.ly/m5ShJ">Kenneth R. French data library</a>. As can be seen in the following, the variables included in the data are: <code>Date</code>, <code>Mkt-RF</code>, <code>SMB</code>, <code>HML</code>, and <code>RF</code>. It turns out all the variables are numerical aside from the date as expected. To save some time processing the model, the data has been trimmed to start from 2000-01-03:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">17</code><code class="p">]:</code> <code class="n">ff</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">read_csv</code><code class="p">(</code><code class="s1">'FF3.csv'</code><code class="p">,</code> <code class="n">skiprows</code><code class="o">=</code><code class="mi">4</code><code class="p">)</code>&#13;
         <code class="n">ff</code> <code class="o">=</code> <code class="n">ff</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="p">{</code><code class="s1">'Unnamed: 0'</code><code class="p">:</code> <code class="s1">'Date'</code><code class="p">})</code>&#13;
         <code class="n">ff</code> <code class="o">=</code> <code class="n">ff</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="o">-</code><code class="mi">1</code><code class="p">]</code>&#13;
         <code class="n">ff</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">17</code><code class="p">]:</code>        <code class="n">Date</code>  <code class="n">Mkt</code><code class="o">-</code><code class="n">RF</code>   <code class="n">SMB</code>   <code class="n">HML</code>     <code class="n">RF</code>&#13;
         <code class="mi">0</code>  <code class="mi">19260701</code>    <code class="mf">0.10</code> <code class="o">-</code><code class="mf">0.24</code> <code class="o">-</code><code class="mf">0.28</code>  <code class="mf">0.009</code>&#13;
         <code class="mi">1</code>  <code class="mi">19260702</code>    <code class="mf">0.45</code> <code class="o">-</code><code class="mf">0.32</code> <code class="o">-</code><code class="mf">0.08</code>  <code class="mf">0.009</code>&#13;
         <code class="mi">2</code>  <code class="mi">19260706</code>    <code class="mf">0.17</code>  <code class="mf">0.27</code> <code class="o">-</code><code class="mf">0.35</code>  <code class="mf">0.009</code>&#13;
         <code class="mi">3</code>  <code class="mi">19260707</code>    <code class="mf">0.09</code> <code class="o">-</code><code class="mf">0.59</code>  <code class="mf">0.03</code>  <code class="mf">0.009</code>&#13;
         <code class="mi">4</code>  <code class="mi">19260708</code>    <code class="mf">0.21</code> <code class="o">-</code><code class="mf">0.36</code>  <code class="mf">0.15</code>  <code class="mf">0.009</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">18</code><code class="p">]:</code> <code class="n">ff</code><code class="o">.</code><code class="n">info</code><code class="p">()</code>&#13;
         <code class="o">&lt;</code><code class="k">class</code> <code class="err">'</code><code class="nc">pandas</code><code class="o">.</code><code class="n">core</code><code class="o">.</code><code class="n">frame</code><code class="o">.</code><code class="n">DataFrame</code><code class="s1">'&gt;</code>&#13;
         <code class="n">RangeIndex</code><code class="p">:</code> <code class="mi">24978</code> <code class="n">entries</code><code class="p">,</code> <code class="mi">0</code> <code class="n">to</code> <code class="mi">24977</code>&#13;
         <code class="n">Data</code> <code class="n">columns</code> <code class="p">(</code><code class="n">total</code> <code class="mi">5</code> <code class="n">columns</code><code class="p">):</code>&#13;
          <code class="c1">#   Column  Non-Null Count  Dtype</code>&#13;
         <code class="o">---</code>  <code class="o">------</code>  <code class="o">--------------</code>  <code class="o">-----</code>&#13;
          <code class="mi">0</code>   <code class="n">Date</code>    <code class="mi">24978</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>  <code class="nb">object</code>&#13;
          <code class="mi">1</code>   <code class="n">Mkt</code><code class="o">-</code><code class="n">RF</code>  <code class="mi">24978</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>  <code class="n">float64</code>&#13;
          <code class="mi">2</code>   <code class="n">SMB</code>     <code class="mi">24978</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>  <code class="n">float64</code>&#13;
          <code class="mi">3</code>   <code class="n">HML</code>     <code class="mi">24978</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>  <code class="n">float64</code>&#13;
          <code class="mi">4</code>   <code class="n">RF</code>      <code class="mi">24978</code> <code class="n">non</code><code class="o">-</code><code class="n">null</code>  <code class="n">float64</code>&#13;
         <code class="n">dtypes</code><code class="p">:</code> <code class="n">float64</code><code class="p">(</code><code class="mi">4</code><code class="p">),</code> <code class="nb">object</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>&#13;
         <code class="n">memory</code> <code class="n">usage</code><code class="p">:</code> <code class="mf">975.8</code><code class="o">+</code> <code class="n">KB</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">19</code><code class="p">]:</code> <code class="n">ff</code><code class="p">[</code><code class="s1">'Date'</code><code class="p">]</code> <code class="o">=</code> <code class="n">pd</code><code class="o">.</code><code class="n">to_datetime</code><code class="p">(</code><code class="n">ff</code><code class="p">[</code><code class="s1">'Date'</code><code class="p">])</code>&#13;
         <code class="n">ff</code><code class="o">.</code><code class="n">set_index</code><code class="p">(</code><code class="s1">'Date'</code><code class="p">,</code> <code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>&#13;
         <code class="n">ff_trim</code> <code class="o">=</code> <code class="n">ff</code><code class="o">.</code><code class="n">loc</code><code class="p">[</code><code class="s1">'2000-01-01'</code><code class="p">:]</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">20</code><code class="p">]:</code> <code class="n">ff_trim</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">20</code><code class="p">]:</code>             <code class="n">Mkt</code><code class="o">-</code><code class="n">RF</code>   <code class="n">SMB</code>   <code class="n">HML</code>     <code class="n">RF</code>&#13;
         <code class="n">Date</code>&#13;
         <code class="mi">2000</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">03</code>   <code class="o">-</code><code class="mf">0.71</code>  <code class="mf">0.61</code> <code class="o">-</code><code class="mf">1.40</code>  <code class="mf">0.021</code>&#13;
         <code class="mi">2000</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">04</code>   <code class="o">-</code><code class="mf">4.06</code>  <code class="mf">0.01</code>  <code class="mf">2.06</code>  <code class="mf">0.021</code>&#13;
         <code class="mi">2000</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">05</code>   <code class="o">-</code><code class="mf">0.09</code>  <code class="mf">0.18</code>  <code class="mf">0.19</code>  <code class="mf">0.021</code>&#13;
         <code class="mi">2000</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">06</code>   <code class="o">-</code><code class="mf">0.73</code> <code class="o">-</code><code class="mf">0.42</code>  <code class="mf">1.27</code>  <code class="mf">0.021</code>&#13;
         <code class="mi">2000</code><code class="o">-</code><code class="mo">01</code><code class="o">-</code><code class="mo">07</code>    <code class="mf">3.21</code> <code class="o">-</code><code class="mf">0.49</code> <code class="o">-</code><code class="mf">1.42</code>  <code class="mf">0.021</code></pre>&#13;
&#13;
<p>Well, we have obtained the variables explaining the dynamic behind the stock return, but which stock return is it? It is supposed to be a return representing general well-being of the economy. <a data-primary="ETF (exchange-traded fund)" data-type="indexterm" id="idm45737198480496"/>A potential candidate for this kind of variable is the S&amp;P 500 exchange-traded fund (ETF).</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>ETF is a special type of investment fund and exchange-traded product that tracks industry, commodities, and so on. SPDR S&amp;P 500 ETF (SPY) is a very well-known example tracking the S&amp;P 500 Index. Some other ETFs are:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Vanguard Total International Stock ETF (VXUS)</p>&#13;
</li>&#13;
<li>&#13;
<p>Energy Select Sector SPDR Fund (XLE)</p>&#13;
</li>&#13;
<li>&#13;
<p>iShares Edge MSCI Min Vol USA ETF (USMV)</p>&#13;
</li>&#13;
<li>&#13;
<p>iShares Morningstar Large-Cap ETF (JKD)</p>&#13;
</li>&#13;
</ul>&#13;
</div>&#13;
&#13;
<p>We’ll collect the daily closing SPY price from&#13;
2000-01-03&#13;
to&#13;
2021-04-30&#13;
to match the period we’re examining. After accessing the data, <code>ff_trim</code> and <code>SP_ETF</code> are merged so that we end up with the data including return and volatility on which the hidden states are determined:</p>&#13;
&#13;
<pre class="pagebreak-before less_space" data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">21</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ticker</code><code> </code><code class="o">=</code><code> </code><code class="s1">'</code><code class="s1">SPY</code><code class="s1">'</code><code>&#13;
</code><code>         </code><code class="n">start</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2000</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="n">datetime</code><code class="o">.</code><code class="n">datetime</code><code class="p">(</code><code class="mi">2021</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">30</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">SP_ETF</code><code> </code><code class="o">=</code><code> </code><code class="n">yf</code><code class="o">.</code><code class="n">download</code><code class="p">(</code><code class="n">ticker</code><code class="p">,</code><code> </code><code class="n">start</code><code class="p">,</code><code> </code><code class="n">end</code><code class="p">,</code><code> </code><code class="n">interval</code><code class="o">=</code><code class="s1">'</code><code class="s1">1d</code><code class="s1">'</code><code class="p">)</code><code class="o">.</code><code class="n">Close</code><code>&#13;
</code><code>         </code><code class="p">[</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="mi">100</code><code class="o">%</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="p">]</code><code>  </code><code class="mi">1</code><code> </code><code class="n">of</code><code> </code><code class="mi">1</code><code> </code><code class="n">completed</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">22</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ff_merge</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">merge</code><code class="p">(</code><code class="n">ff_trim</code><code class="p">,</code><code> </code><code class="n">SP_ETF</code><code class="p">,</code><code> </code><code class="n">how</code><code class="o">=</code><code class="s1">'</code><code class="s1">inner</code><code class="s1">'</code><code class="p">,</code><code> </code><code class="n">on</code><code class="o">=</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">23</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">SP</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">Close</code><code class="s1">'</code><code class="p">]</code><code class="o">=</code><code> </code><code class="n">ff_merge</code><code class="p">[</code><code class="s1">'</code><code class="s1">Close</code><code class="s1">'</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">24</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">Close</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">/</code><code> </code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">Close</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">shift</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code class="o">-</code><code class="mi">1</code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO6-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO6-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO6-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Calculating return of the SPY</p></dd>&#13;
</dl>&#13;
&#13;
<p>It is assumed that there are three states in the economy: up, down, and constant. With this in mind, we run the HMM with full covariance, indicating independent components and a number of iterations (<code>n_iter</code>) of 100. <a data-primary="Gaussian HMM, data generation with" data-type="indexterm" id="ix_gaussian_hmm"/>The following code block shows how we can apply Gaussian HMM and predict the hidden state:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">25</code><code class="p">]</code><code class="p">:</code><code> </code><code class="kn">from</code><code> </code><code class="nn">hmmlearn</code><code> </code><code class="kn">import</code><code> </code><code class="n">hmm</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">26</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">hmm_model</code><code> </code><code class="o">=</code><code> </code><code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code><code>&#13;
</code><code>                                     </code><code class="n">covariance_type</code><code class="o">=</code><code class="s2">"</code><code class="s2">full</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                                     </code><code class="n">n_iter</code><code class="o">=</code><code class="mi">100</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">27</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">hmm_model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">hmm_predict</code><code> </code><code class="o">=</code><code> </code><code class="n">hmm_model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code>                                         </code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">df_hmm</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">hmm_predict</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ret_merged</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">concat</code><code class="p">(</code><code class="p">[</code><code class="n">df_hmm</code><code class="p">,</code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">reset_index</code><code class="p">(</code><code class="p">)</code><code class="p">]</code><code class="p">,</code><code>&#13;
</code><code>                                </code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ret_merged</code><code class="o">.</code><code class="n">drop</code><code class="p">(</code><code class="s1">'</code><code class="s1">Date</code><code class="s1">'</code><code class="p">,</code><code class="n">axis</code><code class="o">=</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ret_merged</code><code class="o">.</code><code class="n">rename</code><code class="p">(</code><code class="n">columns</code><code class="o">=</code><code class="p">{</code><code class="mi">0</code><code class="p">:</code><code class="s1">'</code><code class="s1">states</code><code class="s1">'</code><code class="p">}</code><code class="p">,</code><code> </code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ret_merged</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">head</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">28</code><code class="p">]</code><code class="p">:</code><code>    </code><code class="n">states</code><code>    </code><code class="k">return</code><code>&#13;
</code><code>         </code><code class="mi">0</code><code>       </code><code class="mi">1</code><code> </code><code class="o">-</code><code class="mf">0.039106</code><code>&#13;
</code><code>         </code><code class="mi">1</code><code>       </code><code class="mi">1</code><code>  </code><code class="mf">0.001789</code><code>&#13;
</code><code>         </code><code class="mi">2</code><code>       </code><code class="mi">1</code><code> </code><code class="o">-</code><code class="mf">0.016071</code><code>&#13;
</code><code>         </code><code class="mi">3</code><code>       </code><code class="mi">1</code><code>  </code><code class="mf">0.058076</code><code>&#13;
</code><code>         </code><code class="mi">4</code><code>       </code><code class="mi">2</code><code>  </code><code class="mf">0.003431</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Fitting the Gaussian HMM with return data</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Given the return data, predicting the hidden states</p></dd>&#13;
</dl>&#13;
&#13;
<p>After predicting the hidden states, return data is concatenated with the hidden state so that we are able to see which return belongs to which state.</p>&#13;
&#13;
<p>Let’s now examine the result we obtained after running our Gaussian HMM analysis. In the following code block, we compute the mean and standard deviations of different states. Also, covariance, initial probability, and transition matrix are estimated:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="n">ret_merged</code><code class="p">[</code><code class="s1">'states'</code><code class="p">]</code><code class="o">.</code><code class="n">value_counts</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">29</code><code class="p">]:</code> <code class="mi">0</code>    <code class="mi">3014</code>&#13;
         <code class="mi">2</code>    <code class="mi">2092</code>&#13;
         <code class="mi">1</code>     <code class="mi">258</code>&#13;
         <code class="n">Name</code><code class="p">:</code> <code class="n">states</code><code class="p">,</code> <code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">30</code><code class="p">]:</code> <code class="n">state_means</code> <code class="o">=</code> <code class="p">[]</code>&#13;
         <code class="n">state_std</code> <code class="o">=</code> <code class="p">[]</code>&#13;
&#13;
         <code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">3</code><code class="p">):</code>&#13;
             <code class="n">state_means</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">ret_merged</code><code class="p">[</code><code class="n">ret_merged</code><code class="o">.</code><code class="n">states</code> <code class="o">==</code> <code class="n">i</code><code class="p">][</code><code class="s1">'return'</code><code class="p">]</code>&#13;
                                <code class="o">.</code><code class="n">mean</code><code class="p">())</code>&#13;
             <code class="n">state_std</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">ret_merged</code><code class="p">[</code><code class="n">ret_merged</code><code class="o">.</code><code class="n">states</code> <code class="o">==</code> <code class="n">i</code><code class="p">][</code><code class="s1">'return'</code><code class="p">]</code>&#13;
                              <code class="o">.</code><code class="n">std</code><code class="p">())</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'State Means are: {:.4f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">state_means</code><code class="p">))</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'State Standard Deviations are: {:.4f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">state_std</code><code class="p">))</code>&#13;
         <code class="n">State</code> <code class="n">Means</code> <code class="n">are</code><code class="p">:</code> <code class="p">[</code><code class="mf">0.0009956956923795376</code><code class="p">,</code> <code class="o">-</code><code class="mf">0.0018371952883552139</code><code class="p">,</code> <code class="o">-</code><code class="mf">0.</code>&#13;
         <code class="mo">0005000714110</code><code class="mi">860054</code><code class="p">]</code>&#13;
         <code class="n">State</code> <code class="n">Standard</code> <code class="n">Deviations</code> <code class="n">are</code><code class="p">:</code> <code class="p">[</code><code class="mf">0.006006540155737148</code><code class="p">,</code> <code class="mf">0.</code>&#13;
         <code class="mo">035</code><code class="mi">98912028897813</code><code class="p">,</code> <code class="mf">0.01372712345328388</code><code class="p">]</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">31</code><code class="p">]:</code> <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'HMM means</code><code class="se">\n</code><code class="s1"> {hmm_model.means_}'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'HMM covariances</code><code class="se">\n</code><code class="s1"> {hmm_model.covars_}'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'HMM transition matrix</code><code class="se">\n</code><code class="s1"> {hmm_model.transmat_}'</code><code class="p">)</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">f</code><code class="s1">'HMM initial probability</code><code class="se">\n</code><code class="s1"> {hmm_model.startprob_}'</code><code class="p">)</code>&#13;
         <code class="n">HMM</code> <code class="n">means</code>&#13;
          <code class="p">[[</code> <code class="mf">0.00100365</code><code class="p">]</code>&#13;
          <code class="p">[</code><code class="o">-</code><code class="mf">0.002317</code>  <code class="p">]</code>&#13;
          <code class="p">[</code><code class="o">-</code><code class="mf">0.00036613</code><code class="p">]]</code>&#13;
         <code class="n">HMM</code> <code class="n">covariances</code>&#13;
          <code class="p">[[[</code><code class="mf">3.85162047e-05</code><code class="p">]]</code>&#13;
&#13;
          <code class="p">[[</code><code class="mf">1.26647594e-03</code><code class="p">]]</code>&#13;
&#13;
          <code class="p">[[</code><code class="mf">1.82565269e-04</code><code class="p">]]]</code>&#13;
         <code class="n">HMM</code> <code class="n">transition</code> <code class="n">matrix</code>&#13;
          <code class="p">[[</code><code class="mf">9.80443302e-01</code> <code class="mf">1.20922866e-06</code> <code class="mf">1.95554886e-02</code><code class="p">]</code>&#13;
          <code class="p">[</code><code class="mf">1.73050704e-08</code> <code class="mf">9.51104459e-01</code> <code class="mf">4.88955238e-02</code><code class="p">]</code>&#13;
          <code class="p">[</code><code class="mf">2.67975578e-02</code> <code class="mf">5.91734590e-03</code> <code class="mf">9.67285096e-01</code><code class="p">]]</code>&#13;
         <code class="n">HMM</code> <code class="n">initial</code> <code class="n">probability</code>&#13;
          <code class="p">[</code><code class="mf">0.00000000e+000</code> <code class="mf">1.00000000e+000</code> <code class="mf">2.98271922e-120</code><code class="p">]</code></pre>&#13;
&#13;
<p>The number of observations per state is given in <a data-type="xref" href="#hmm_states">Table 10-1</a>.</p>&#13;
<table class="pagebreak-before less_space" id="hmm_states">&#13;
<caption><span class="label">Table 10-1. </span>Observations per state</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>State</th>&#13;
<th>Number of observations</th>&#13;
<th>Return means</th>&#13;
<th>Covariances</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>0</p></td>&#13;
<td><p>3014</p></td>&#13;
<td><p>0.0010</p></td>&#13;
<td><p>3.8482e-05</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>1</p></td>&#13;
<td><p>2092</p></td>&#13;
<td><p>-0.0023</p></td>&#13;
<td><p>1.2643e-05</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>2</p></td>&#13;
<td><p>258</p></td>&#13;
<td><p>-0.0003</p></td>&#13;
<td><p>1.8256e-05</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p><a data-primary="Elbow Analysis tool, synthetic data generation" data-type="indexterm" id="idm45737197042176"/>We assume that the economy has three states, but this assumption rests on theory. However, if we want to make sure, there is a strong and convenient tool that can be applied: <em>Elbow Analysis</em>. After running Gaussian HMM, we obtain the likelihood result, and if there is no room for improvement—that is, the likelihood value becomes relatively stagnant—this is the point at which we can stop the analysis. Given the following result (along with the resultant <a data-type="xref" href="#optimum_cluster_hmm">Figure 10-7</a>), it turns out that three components is a good choice:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">32</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">sp_ret</code><code> </code><code class="o">=</code><code> </code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="o">.</code><code class="n">values</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="mi">1</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">n_components</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">arange</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code> </code><code class="mi">10</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">clusters</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="n">n</code><code class="p">,</code><code>&#13;
</code><code>                                     </code><code class="n">covariance_type</code><code class="o">=</code><code class="s2">"</code><code class="s2">full</code><code class="s2">"</code><code class="p">)</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">sp_ret</code><code class="p">)</code><code>&#13;
</code><code>                    </code><code class="k">for</code><code> </code><code class="n">n</code><code> </code><code class="ow">in</code><code> </code><code class="n">n_components</code><code class="p">]</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">n_components</code><code class="p">,</code><code> </code><code class="p">[</code><code class="n">m</code><code class="o">.</code><code class="n">score</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">SP</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code>\&#13;
</code><code>                                         </code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code><code class="mi">1</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">for</code><code> </code><code class="n">m</code><code> </code><code class="ow">in</code><code> </code><code class="n">clusters</code><code class="p">]</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-2" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">title</code><code class="p">(</code><code class="s1">'</code><code class="s1">Optimum Number of States</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">xlabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">n_components</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">plt</code><code class="o">.</code><code class="n">ylabel</code><code class="p">(</code><code class="s1">'</code><code class="s1">Log Likelihood</code><code class="s1">'</code><code class="p">)</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">33</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">hmm_model</code><code> </code><code class="o">=</code><code> </code><code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code><code>&#13;
</code><code>                                 </code><code class="n">covariance_type</code><code class="o">=</code><code class="s2">"</code><code class="s2">full</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                                 </code><code class="n">random_state</code><code class="o">=</code><code class="mi">123</code><code class="p">)</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">sp_ret</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">hidden_states</code><code> </code><code class="o">=</code><code> </code><code class="n">hmm_model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">sp_ret</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Creating ten clusters based on Gaussian HMM via list comprehension</p></dd>&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-2" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Calculating log-likelihood given the number of components</p></dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#optimum_cluster_hmm">Figure 10-7</a> shows the likelihood values per state. It is readily observable that after the third component, the curve becomes flatter.</p>&#13;
&#13;
<figure class="width-90"><div class="figure" id="optimum_cluster_hmm">&#13;
<img alt="optimum_cluster_hmm" src="assets/mlfr_1007.png"/>&#13;
<h6><span class="label">Figure 10-7. </span>Gaussian HMM scree plot</h6>&#13;
</div></figure>&#13;
&#13;
<p>Let us now visualize the states that we have obtained via Gaussian HMM and produce <a data-type="xref" href="#HMM_Regime_plot">Figure 10-8</a>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">34</code><code class="p">]:</code> <code class="kn">from</code> <code class="nn">matplotlib.dates</code> <code class="kn">import</code> <code class="n">YearLocator</code><code class="p">,</code> <code class="n">MonthLocator</code>&#13;
         <code class="kn">from</code> <code class="nn">matplotlib</code> <code class="kn">import</code> <code class="n">cm</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">35</code><code class="p">]:</code> <code class="n">df_sp_ret</code> <code class="o">=</code> <code class="n">SP</code><code class="p">[</code><code class="s1">'return'</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">()</code>&#13;
&#13;
         <code class="n">hmm_model</code> <code class="o">=</code> <code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code>&#13;
                                     <code class="n">covariance_type</code><code class="o">=</code><code class="s2">"full"</code><code class="p">,</code>&#13;
                                     <code class="n">random_state</code><code class="o">=</code><code class="mi">123</code><code class="p">)</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">sp_ret</code><code class="p">)</code>&#13;
&#13;
         <code class="n">hidden_states</code> <code class="o">=</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">sp_ret</code><code class="p">)</code>&#13;
&#13;
         <code class="n">fig</code><code class="p">,</code> <code class="n">axs</code> <code class="o">=</code> <code class="n">plt</code><code class="o">.</code><code class="n">subplots</code><code class="p">(</code><code class="n">hmm_model</code><code class="o">.</code><code class="n">n_components</code><code class="p">,</code> <code class="n">sharex</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code>&#13;
                                 <code class="n">sharey</code><code class="o">=</code><code class="bp">True</code><code class="p">,</code> <code class="n">figsize</code><code class="o">=</code><code class="p">(</code><code class="mi">12</code><code class="p">,</code> <code class="mi">9</code><code class="p">))</code>&#13;
         <code class="n">colors</code> <code class="o">=</code> <code class="n">cm</code><code class="o">.</code><code class="n">gray</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">linspace</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mf">0.7</code><code class="p">,</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">n_components</code><code class="p">))</code>&#13;
&#13;
         <code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="p">(</code><code class="n">ax</code><code class="p">,</code> <code class="n">color</code><code class="p">)</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="nb">zip</code><code class="p">(</code><code class="n">axs</code><code class="p">,</code> <code class="n">colors</code><code class="p">)):</code>&#13;
             <code class="n">mask</code> <code class="o">=</code> <code class="n">hidden_states</code> <code class="o">==</code> <code class="n">i</code>&#13;
             <code class="n">ax</code><code class="o">.</code><code class="n">plot_date</code><code class="p">(</code><code class="n">df_sp_ret</code><code class="o">.</code><code class="n">index</code><code class="o">.</code><code class="n">values</code><code class="p">[</code><code class="n">mask</code><code class="p">],</code>&#13;
                          <code class="n">df_sp_ret</code><code class="o">.</code><code class="n">values</code><code class="p">[</code><code class="n">mask</code><code class="p">],</code>&#13;
                          <code class="s2">".-"</code><code class="p">,</code> <code class="n">c</code><code class="o">=</code><code class="n">color</code><code class="p">)</code>&#13;
             <code class="n">ax</code><code class="o">.</code><code class="n">set_title</code><code class="p">(</code><code class="s2">"Hidden state {}"</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">i</code> <code class="o">+</code> <code class="mi">1</code><code class="p">),</code> <code class="n">fontsize</code><code class="o">=</code><code class="mi">16</code><code class="p">)</code>&#13;
             <code class="n">ax</code><code class="o">.</code><code class="n">xaxis</code><code class="o">.</code><code class="n">set_minor_locator</code><code class="p">(</code><code class="n">MonthLocator</code><code class="p">())</code>&#13;
&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">tight_layout</code><code class="p">()</code></pre>&#13;
&#13;
<figure><div class="figure" id="HMM_Regime_plot">&#13;
<img alt="HMM_Regime_plot" src="assets/mlfr_1008.png"/>&#13;
<h6><span class="label">Figure 10-8. </span>Gaussian HMM states</h6>&#13;
</div></figure>&#13;
&#13;
<p><a data-type="xref" href="#HMM_Regime_plot">Figure 10-8</a> shows the behavior of the hidden states, and as expected, the distributions of these states are entirely different from each other, highlighting the importance of identifying the states.</p>&#13;
&#13;
<p>Given the states, the SPY returns differ, which is something that we expect. After all these preparations, we can move forward and run the Fama-Frech three-factor model with and without Gaussian HMM. <a data-primary="Sharpe ratio, synthetic data generation" data-type="indexterm" id="ix_sharpe_ratio"/>The Sharpe ratio, which we’ll calculate after modeling, will tell us which is the better risk-adjusted return. Analysis with Gaussian HMM reveals a Sharpe ratio of nearly 0.0981:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">36</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ret_merged</code><code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s1">'</code><code class="s1">states</code><code class="s1">'</code><code class="p">)</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">36</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">states</code><code>&#13;
</code><code>         </code><code class="mi">0</code><code>    </code><code class="mf">0.000996</code><code>&#13;
</code><code>         </code><code class="mi">1</code><code>   </code><code class="o">-</code><code class="mf">0.001837</code><code>&#13;
</code><code>         </code><code class="mi">2</code><code>   </code><code class="o">-</code><code class="mf">0.000500</code><code>&#13;
</code><code>         </code><code class="n">Name</code><code class="p">:</code><code> </code><code class="k">return</code><code class="p">,</code><code> </code><code class="n">dtype</code><code class="p">:</code><code> </code><code class="n">float64</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">37</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">ff_merge</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="n">ff_merge</code><code class="p">[</code><code class="s1">'</code><code class="s1">Close</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">pct_change</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">ff_merge</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="n">inplace</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">38</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">split</code><code> </code><code class="o">=</code><code> </code><code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">ff_merge</code><code class="p">)</code><code> </code><code class="o">*</code><code> </code><code class="mf">0.9</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">train_ff</code><code class="o">=</code><code> </code><code class="n">ff_merge</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="p">:</code><code class="n">split</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">test_ff</code><code> </code><code class="o">=</code><code> </code><code class="n">ff_merge</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">39</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">hmm_model</code><code> </code><code class="o">=</code><code> </code><code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code><code>&#13;
</code><code>                                     </code><code class="n">covariance_type</code><code class="o">=</code><code class="s2">"</code><code class="s2">full</code><code class="s2">"</code><code class="p">,</code><code>&#13;
</code><code>                                     </code><code class="n">n_iter</code><code class="o">=</code><code class="mi">100</code><code class="p">,</code><code> </code><code class="n">init_params</code><code class="o">=</code><code class="s2">"</code><code class="s2">"</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">40</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">predictions</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code class="p">]</code><code>&#13;
</code><code>&#13;
</code><code>         </code><code class="k">for</code><code> </code><code class="n">i</code><code> </code><code class="ow">in</code><code> </code><code class="nb">range</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">test_ff</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code>&#13;
</code><code>             </code><code class="n">hmm_model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">train_ff</code><code class="p">)</code><code>&#13;
</code><code>             </code><code class="n">adjustment</code><code> </code><code class="o">=</code><code> </code><code class="n">np</code><code class="o">.</code><code class="n">dot</code><code class="p">(</code><code class="n">hmm_model</code><code class="o">.</code><code class="n">transmat_</code><code class="p">,</code><code> </code><code class="n">hmm_model</code><code class="o">.</code><code class="n">means_</code><code class="p">)</code><code> </code><a class="co" href="#callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO9-1" id="co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>             </code><code class="n">predictions</code><code class="o">.</code><code class="n">append</code><code class="p">(</code><code class="n">test_ff</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">i</code><code class="p">]</code><code> </code><code class="o">+</code><code> </code><code class="n">adjustment</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">predictions</code><code> </code><code class="o">=</code><code> </code><code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">predictions</code><code class="p">)</code><code>&#13;
</code><code>&#13;
</code><code class="n">In</code><code> </code><code class="p">[</code><code class="mi">41</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">std_dev</code><code> </code><code class="o">=</code><code> </code><code class="n">predictions</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">std</code><code class="p">(</code><code class="p">)</code><code>&#13;
</code><code>         </code><code class="n">sharpe</code><code> </code><code class="o">=</code><code> </code><code class="n">predictions</code><code class="p">[</code><code class="s1">'</code><code class="s1">return</code><code class="s1">'</code><code class="p">]</code><code class="o">.</code><code class="n">mean</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">/</code><code> </code><code class="n">std_dev</code><code>&#13;
</code><code>         </code><code class="k">print</code><code class="p">(</code><code class="s1">'</code><code class="s1">Sharpe ratio with HMM is {:.4f}</code><code class="s1">'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">sharpe</code><code class="p">)</code><code class="p">)</code><code>&#13;
</code><code class="n">Out</code><code class="p">[</code><code class="mi">41</code><code class="p">]</code><code class="p">:</code><code> </code><code class="n">Sharpe</code><code> </code><code class="n">ratio</code><code> </code><code class="k">with</code><code> </code><code class="n">HMM</code><code> </code><code class="ow">is</code><code> </code><code class="mf">0.0981</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO9-1" id="callout_synthetic_data_generation_and___span_class__keep_together__the_hidden_markov_model_in_finance__span__CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Adjustment based on transition matrix</p></dd>&#13;
</dl>&#13;
&#13;
<p>The traditional way to run Fama-Frech three-factor model is to apply&#13;
linear regression and the following code block does that. After running linear regression, we can make predictions and then calculate the Sharpe ratio. We’ll see that linear regression produces a lower Sharpe ratio (0.0589) compared to one with Gaussian HMM:<a data-primary="" data-startref="ix_sharpe_ratio" data-type="indexterm" id="idm45737196073312"/></p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">42</code><code class="p">]:</code> <code class="kn">import</code> <code class="nn">statsmodels.api</code> <code class="kn">as</code> <code class="nn">sm</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">43</code><code class="p">]:</code> <code class="n">Y</code> <code class="o">=</code> <code class="n">train_ff</code><code class="p">[</code><code class="s1">'return'</code><code class="p">]</code>&#13;
         <code class="n">X</code> <code class="o">=</code> <code class="n">train_ff</code><code class="p">[[</code><code class="s1">'Mkt-RF'</code><code class="p">,</code> <code class="s1">'SMB'</code><code class="p">,</code> <code class="s1">'HML'</code><code class="p">]]</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">44</code><code class="p">]:</code> <code class="n">model</code> <code class="o">=</code> <code class="n">sm</code><code class="o">.</code><code class="n">OLS</code><code class="p">(</code><code class="n">Y</code><code class="p">,</code> <code class="n">X</code><code class="p">)</code>&#13;
         <code class="n">ff_ols</code> <code class="o">=</code> <code class="n">model</code><code class="o">.</code><code class="n">fit</code><code class="p">()</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="n">ff_ols</code><code class="o">.</code><code class="n">summary</code><code class="p">())</code>&#13;
&#13;
                        <code class="n">OLS</code> <code class="n">Regression</code> <code class="n">Results</code>&#13;
<code class="o">================================================================================</code>&#13;
<code class="n">Dep</code><code class="o">.</code> <code class="n">Variable</code><code class="p">:</code>             <code class="k">return</code>   <code class="n">R</code><code class="o">-</code><code class="n">squared</code> <code class="p">(</code><code class="n">uncentered</code><code class="p">):</code>                <code class="mf">0.962</code>&#13;
<code class="n">Model</code><code class="p">:</code>                        <code class="n">OLS</code>   <code class="n">Adj</code><code class="o">.</code> <code class="n">R</code><code class="o">-</code><code class="n">squared</code> <code class="p">(</code><code class="n">uncentered</code><code class="p">):</code>           <code class="mf">0.962</code>&#13;
<code class="n">Method</code><code class="p">:</code>             <code class="n">Least</code> <code class="n">Squares</code>   <code class="n">F</code><code class="o">-</code><code class="n">statistic</code><code class="p">:</code>                       <code class="mf">4.072e+04</code>&#13;
<code class="n">Date</code><code class="p">:</code>            <code class="n">Tue</code><code class="p">,</code> <code class="mi">30</code> <code class="n">Nov</code> <code class="mi">2021</code>   <code class="n">Prob</code> <code class="p">(</code><code class="n">F</code><code class="o">-</code><code class="n">statistic</code><code class="p">):</code>                     <code class="mf">0.00</code>&#13;
<code class="n">Time</code><code class="p">:</code>                    <code class="mo">00</code><code class="p">:</code><code class="mo">05</code><code class="p">:</code><code class="mo">02</code>   <code class="n">Log</code><code class="o">-</code><code class="n">Likelihood</code><code class="p">:</code>                       <code class="mf">22347.</code>&#13;
<code class="n">No</code><code class="o">.</code> <code class="n">Observations</code><code class="p">:</code>            <code class="mi">4827</code>   <code class="n">AIC</code><code class="p">:</code>                              <code class="o">-</code><code class="mf">4.469e+04</code>&#13;
<code class="n">Df</code> <code class="n">Residuals</code><code class="p">:</code>                <code class="mi">4824</code>   <code class="n">BIC</code><code class="p">:</code>                              <code class="o">-</code><code class="mf">4.467e+04</code>&#13;
<code class="n">Df</code> <code class="n">Model</code><code class="p">:</code>                       <code class="mi">3</code>&#13;
<code class="n">Covariance</code> <code class="n">Type</code><code class="p">:</code>        <code class="n">nonrobust</code>&#13;
<code class="o">==============================================================================</code>&#13;
                 <code class="n">coef</code>    <code class="n">std</code> <code class="n">err</code>          <code class="n">t</code>      <code class="n">P</code><code class="o">&gt;|</code><code class="n">t</code><code class="o">|</code>      <code class="p">[</code><code class="mf">0.025</code>      <code class="mf">0.975</code><code class="p">]</code>&#13;
<code class="o">------------------------------------------------------------------------------</code>&#13;
<code class="n">Mkt</code><code class="o">-</code><code class="n">RF</code>         <code class="mf">0.0098</code>   <code class="mf">2.82e-05</code>    <code class="mf">348.173</code>      <code class="mf">0.000</code>       <code class="mf">0.010</code>       <code class="mf">0.010</code>&#13;
<code class="n">SMB</code>           <code class="o">-</code><code class="mf">0.0017</code>   <code class="mf">5.71e-05</code>    <code class="o">-</code><code class="mf">29.005</code>      <code class="mf">0.000</code>      <code class="o">-</code><code class="mf">0.002</code>      <code class="o">-</code><code class="mf">0.002</code>&#13;
<code class="n">HML</code>        <code class="o">-</code><code class="mf">6.584e-05</code>   <code class="mf">5.21e-05</code>     <code class="o">-</code><code class="mf">1.264</code>      <code class="mf">0.206</code>      <code class="o">-</code><code class="mf">0.000</code>    <code class="mf">3.63e-05</code>&#13;
<code class="o">==============================================================================</code>&#13;
<code class="n">Omnibus</code><code class="p">:</code>                     <code class="mf">1326.960</code>   <code class="n">Durbin</code><code class="o">-</code><code class="n">Watson</code><code class="p">:</code>                   <code class="mf">2.717</code>&#13;
<code class="n">Prob</code><code class="p">(</code><code class="n">Omnibus</code><code class="p">):</code>                  <code class="mf">0.000</code>   <code class="n">Jarque</code><code class="o">-</code><code class="n">Bera</code> <code class="p">(</code><code class="n">JB</code><code class="p">):</code>            <code class="mf">80241.345</code>&#13;
<code class="n">Skew</code><code class="p">:</code>                           <code class="mf">0.433</code>   <code class="n">Prob</code><code class="p">(</code><code class="n">JB</code><code class="p">):</code>                         <code class="mf">0.00</code>&#13;
<code class="n">Kurtosis</code><code class="p">:</code>                      <code class="mf">22.955</code>   <code class="n">Cond</code><code class="o">.</code> <code class="n">No</code><code class="o">.</code>                         <code class="mf">2.16</code>&#13;
<code class="o">==============================================================================</code>&#13;
&#13;
<code class="n">Notes</code><code class="p">:</code>&#13;
<code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="n">R²</code> <code class="ow">is</code> <code class="n">computed</code> <code class="n">without</code> <code class="n">centering</code> <code class="p">(</code><code class="n">uncentered</code><code class="p">)</code> <code class="n">since</code> <code class="n">the</code> <code class="n">model</code> <code class="n">does</code> <code class="ow">not</code>&#13;
<code class="n">contain</code> <code class="n">a</code> <code class="n">constant</code><code class="o">.</code>&#13;
<code class="p">[</code><code class="mi">2</code><code class="p">]</code> <code class="n">Standard</code> <code class="n">Errors</code> <code class="n">assume</code> <code class="n">that</code> <code class="n">the</code> <code class="n">covariance</code> <code class="n">matrix</code> <code class="n">of</code> <code class="n">the</code> <code class="n">errors</code> <code class="ow">is</code>&#13;
<code class="n">correctly</code> <code class="n">specified</code><code class="o">.</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">45</code><code class="p">]:</code> <code class="n">ff_pred</code> <code class="o">=</code> <code class="n">ff_ols</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">test_ff</code><code class="p">[[</code><code class="s2">"Mkt-RF"</code><code class="p">,</code> <code class="s2">"SMB"</code><code class="p">,</code> <code class="s2">"HML"</code><code class="p">]])</code>&#13;
         <code class="n">ff_pred</code><code class="o">.</code><code class="n">head</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">45</code><code class="p">]:</code> <code class="n">Date</code>&#13;
         <code class="mi">2019</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">14</code>   <code class="o">-</code><code class="mf">0.000340</code>&#13;
         <code class="mi">2019</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">15</code>    <code class="mf">0.005178</code>&#13;
         <code class="mi">2019</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">18</code>    <code class="mf">0.004273</code>&#13;
         <code class="mi">2019</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">19</code>   <code class="o">-</code><code class="mf">0.000194</code>&#13;
         <code class="mi">2019</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">20</code>   <code class="o">-</code><code class="mf">0.003795</code>&#13;
         <code class="n">dtype</code><code class="p">:</code> <code class="n">float64</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">46</code><code class="p">]:</code> <code class="n">std_dev</code> <code class="o">=</code> <code class="n">ff_pred</code><code class="o">.</code><code class="n">std</code><code class="p">()</code>&#13;
         <code class="n">sharpe</code> <code class="o">=</code> <code class="n">ff_pred</code><code class="o">.</code><code class="n">mean</code><code class="p">()</code> <code class="o">/</code> <code class="n">std_dev</code>&#13;
         <code class="k">print</code><code class="p">(</code><code class="s1">'Sharpe ratio with FF 3 factor model is {:.4f}'</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">sharpe</code><code class="p">))</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">46</code><code class="p">]:</code> <code class="n">Sharpe</code> <code class="n">ratio</code> <code class="k">with</code> <code class="n">FF</code> <code class="mi">3</code> <code class="n">factor</code> <code class="n">model</code> <code class="ow">is</code> <code class="mf">0.0589</code></pre>&#13;
&#13;
<p>This result suggests that Gaussian HMM delivers better risk-adjusted returns, making it useful in portfolio allocation, among other analyses.</p>&#13;
&#13;
<p>The following analysis tries to show what happens if the states of the index return need to be predicted based on the unseen data that can be used for backtesting for future analysis:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">47</code><code class="p">]:</code> <code class="n">split</code> <code class="o">=</code> <code class="nb">int</code><code class="p">(</code><code class="nb">len</code><code class="p">(</code><code class="n">SP</code><code class="p">[</code><code class="s1">'return'</code><code class="p">])</code> <code class="o">*</code> <code class="mf">0.9</code><code class="p">)</code>&#13;
         <code class="n">train_ret_SP</code> <code class="o">=</code> <code class="n">SP</code><code class="p">[</code><code class="s1">'return'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[</code><code class="n">split</code><code class="p">:]</code><code class="o">.</code><code class="n">dropna</code><code class="p">()</code>&#13;
         <code class="n">test_ret_SP</code> <code class="o">=</code> <code class="n">SP</code><code class="p">[</code><code class="s1">'return'</code><code class="p">]</code><code class="o">.</code><code class="n">iloc</code><code class="p">[:</code><code class="n">split</code><code class="p">]</code><code class="o">.</code><code class="n">dropna</code><code class="p">()</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">48</code><code class="p">]:</code> <code class="n">hmm_model</code> <code class="o">=</code> <code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code>&#13;
                                     <code class="n">covariance_type</code><code class="o">=</code><code class="s2">"full"</code><code class="p">,</code>&#13;
                                     <code class="n">n_iter</code><code class="o">=</code><code class="mi">100</code><code class="p">)</code>&#13;
         <code class="n">hmm_model</code><code class="o">.</code><code class="n">fit</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">train_ret_SP</code><code class="p">)</code><code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">))</code>&#13;
         <code class="n">hmm_predict_vol</code> <code class="o">=</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">predict</code><code class="p">(</code><code class="n">np</code><code class="o">.</code><code class="n">array</code><code class="p">(</code><code class="n">test_ret_SP</code><code class="p">)</code>&#13;
                                             <code class="o">.</code><code class="n">reshape</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">))</code>&#13;
         <code class="n">pd</code><code class="o">.</code><code class="n">DataFrame</code><code class="p">(</code><code class="n">hmm_predict_vol</code><code class="p">)</code><code class="o">.</code><code class="n">value_counts</code><code class="p">()</code>&#13;
<code class="n">Out</code><code class="p">[</code><code class="mi">48</code><code class="p">]:</code> <code class="mi">0</code>    <code class="mi">4447</code>&#13;
         <code class="mi">1</code>     <code class="mi">282</code>&#13;
         <code class="mi">2</code>      <code class="mi">98</code>&#13;
         <code class="n">dtype</code><code class="p">:</code> <code class="n">int64</code></pre>&#13;
&#13;
<p>As we have discussed, HMM provides a helpful and strong way for further expanding our analysis to get more reliable and accurate results. Before concluding this chapter, it is worthwhile to show the synthetic data generation process using Gaussian HMM. To do that, we should first define our initial parameters.&#13;
These parameters are:&#13;
initial probability (<code>startprob</code>),&#13;
transition matrix (<code>transmat</code>),&#13;
mean (<code>means</code>), and&#13;
covariance (<code>covars</code>). Having defined the parameters, we can run Gaussian HMM and apply a random sampling procedure to end up with a desired number of observations, which is 1,000 in our case. The following code results in Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#HMM_syn_hist">10-9</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#HMM_syn_line">10-10</a>:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">In</code> <code class="p">[</code><code class="mi">49</code><code class="p">]:</code> <code class="n">startprob</code> <code class="o">=</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">startprob_</code>&#13;
         <code class="n">transmat</code> <code class="o">=</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">transmat_</code>&#13;
         <code class="n">means</code> <code class="o">=</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">means_</code>&#13;
         <code class="n">covars</code> <code class="o">=</code> <code class="n">hmm_model</code><code class="o">.</code><code class="n">covars_</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">50</code><code class="p">]:</code> <code class="n">syn_hmm</code> <code class="o">=</code> <code class="n">hmm</code><code class="o">.</code><code class="n">GaussianHMM</code><code class="p">(</code><code class="n">n_components</code><code class="o">=</code><code class="mi">3</code><code class="p">,</code> <code class="n">covariance_type</code><code class="o">=</code><code class="s2">"full"</code><code class="p">)</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">51</code><code class="p">]:</code> <code class="n">syn_hmm</code><code class="o">.</code><code class="n">startprob_</code> <code class="o">=</code> <code class="n">startprob</code>&#13;
         <code class="n">syn_hmm</code><code class="o">.</code><code class="n">transmat_</code> <code class="o">=</code> <code class="n">transmat</code>&#13;
         <code class="n">syn_hmm</code><code class="o">.</code><code class="n">means_</code> <code class="o">=</code> <code class="n">means</code>&#13;
         <code class="n">syn_hmm</code><code class="o">.</code><code class="n">covars_</code> <code class="o">=</code> <code class="n">covars</code>&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">52</code><code class="p">]:</code> <code class="n">syn_data</code><code class="p">,</code> <code class="n">_</code> <code class="o">=</code> <code class="n">syn_hmm</code><code class="o">.</code><code class="n">sample</code><code class="p">(</code><code class="n">n_samples</code><code class="o">=</code><code class="mi">1000</code><code class="p">)</code>&#13;
&#13;
&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">53</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">hist</code><code class="p">(</code><code class="n">syn_data</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code>&#13;
<code class="n">In</code> <code class="p">[</code><code class="mi">54</code><code class="p">]:</code> <code class="n">plt</code><code class="o">.</code><code class="n">plot</code><code class="p">(</code><code class="n">syn_data</code><code class="p">,</code> <code class="s2">"--"</code><code class="p">)</code>&#13;
         <code class="n">plt</code><code class="o">.</code><code class="n">show</code><code class="p">()</code></pre>&#13;
&#13;
<p>The distribution and line plot based on the synthetic data can be seen in Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#HMM_syn_hist">10-9</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#HMM_syn_line">10-10</a>. As we have a large enough sample size coming out of our Gaussian HMM, we observe normally distributed data.<a data-primary="" data-startref="ix_ml_synth_data" data-type="indexterm" id="idm45737195338064"/><a data-primary="" data-startref="ix_fama-french_model" data-type="indexterm" id="idm45737195337088"/><a data-primary="" data-startref="ix_synth_data_gen_fama-french" data-type="indexterm" id="idm45737195336144"/><a data-primary="" data-startref="ix_gaussian_hmm" data-type="indexterm" id="idm45737195335136"/></p>&#13;
&#13;
<figure><div class="figure" id="HMM_syn_hist">&#13;
<img alt="HMM_syn_hist" src="assets/mlfr_1009.png"/>&#13;
<h6><span class="label">Figure 10-9. </span>Gaussian HMM synthetic data histogram</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="HMM_syn_line">&#13;
<img alt="HMM_syn_line" src="assets/mlfr_1010.png"/>&#13;
<h6><span class="label">Figure 10-10. </span>Gaussian HMM synthetic data line plot</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45737198530672">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>In this final chapter, we discussed two relatively new yet promising topics. Synthetic data generation enables us to conduct analysis in the absence of real data or in the case of breaching confidentiality, so it can be life-saver for a practitioner in these situations. In the second part of this chapter, we looked at Gaussian HMM and its usefulness in financial analysis&#13;
and then used Gaussian HMM to generate synthetic data.<a data-primary="" data-startref="ix_synth_data_gen_ch10" data-type="indexterm" id="idm45737195329504"/></p>&#13;
&#13;
<p>We saw how Gaussian HMM helps us obtain better results in portfolio allocations, but it is worth noting that this is not the only area in which we can apply HMM. Rather, there are many different areas where researchers take advantage of this method, and&#13;
it’s a safe bet that more are to come.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="References" data-type="sect1"><div class="sect1" id="idm45737195327584">&#13;
<h1>References</h1>&#13;
&#13;
<p>Articles and books cited in this chapter:</p>&#13;
&#13;
<ul class="author-date-bib">&#13;
<li>&#13;
<p>Ahuja, Ankana. 2020. “The promise of synthetic data”. <em>Financial Times</em>. <a href="https://oreil.ly/qphEN"><em class="hyperlink">https://oreil.ly/qphEN</em></a>.</p>&#13;
</li>&#13;
<li>&#13;
<p>El Emam, Khaled, Lucy Mosquera, and Richard Hoptroff. 2020. <em>Practical Synthetic Data Generation: Balancing Privacy and the Broad Availability of Data</em>. Sebastopol: O’Reilly.</p>&#13;
</li>&#13;
<li>&#13;
<p>Fama, Eugene F., and Kenneth R. French. 1993. “Common Risk Factors in the Returns on Stocks and Bonds.” <em>Journal of Financial Economics</em> 33 (3): 56.</p>&#13;
</li>&#13;
<li>&#13;
<p>Patki, Neha, Roy Wedge, and Kalyan Veeramachaneni. 2016. “The Synthetic Data Vault.” In the 2016 IEEE International Conference on Data Science and Advanced Analytics (DSAA), 399-410.</p>&#13;
</li>&#13;
<li>&#13;
<p>Wang, Matthew, Yi-Hong Lin, and Ilya Mikhelson. 2020. “Regime-Switching Factor Investing with Hidden Markov Models.” <em>Journal of Risk and Financial Management</em> 13 (12): 311.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>